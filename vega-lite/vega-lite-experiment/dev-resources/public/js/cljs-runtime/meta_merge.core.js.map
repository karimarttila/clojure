{"version":3,"sources":["meta_merge/core.cljc"],"mappings":"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","names":["meta-merge.core/meta*","obj","cljs.core/PROTOCOL_SENTINEL","cljs.core/native-satisfies?","cljs.core/IMeta","cljs.core/meta","meta-merge.core/with-meta*","m","cljs.core/IWithMeta","cljs.core/with-meta","meta-merge.core/displace?","meta-merge.core/replace?","meta-merge.core/top-displace?","meta-merge.core/different-priority?","left","right","cljs.core/boolean","or__4126__auto__","cljs.core/some","cljs.core.some_fn","cljs.core/nil?","meta-merge.core/remove-top-displace","cljs.core/not","cljs.core.vary_meta","cljs.core/dissoc","meta-merge.core/pick-prioritized","and__4115__auto__","cljs.core.merge","cljs.core.dissoc","var_args","G__78857","meta-merge.core/meta-merge","args-arr__4757__auto__","len__4736__auto__","i__4737__auto__","argseq__4758__auto__","cljs.core/IndexedSeq","seq78851","G__78852","cljs.core/first","cljs.core/next","G__78853","self__4723__auto__","cljs.core/map?","cljs.core.merge_with","cljs.core/set?","clojure.set.union","cljs.core/coll?","cljs.core.into","cljs.core/empty","cljs.core.concat","cljs.core/select-keys","more","cljs.core.reduce","cljs.core/cons"],"sourcesContent":["(ns meta-merge.core\n  (:require [clojure.set :as set]))\n\n(defn- meta*\n  \"Returns the metadata of an object, or nil if the object cannot hold\n  metadata.\"\n  [obj]\n  (if #?(:clj (instance? clojure.lang.IObj obj)\n         :cljs (satisfies? IMeta obj))\n    (meta obj)\n    nil))\n\n(defn- with-meta*\n  \"Returns an object of the same type and value as obj, with map m as its\n  metadata if the object can hold metadata.\"\n  [obj m]\n  (if #?(:clj (instance? clojure.lang.IObj obj)\n         :cljs (satisfies? IWithMeta obj))\n    (with-meta obj m)\n    obj))\n\n(defn- displace?\n  \"Returns true if the object is marked as displaceable\"\n  [obj]\n  (-> obj meta* :displace))\n\n(defn- replace?\n  \"Returns true if the object is marked as replaceable\"\n  [obj]\n  (-> obj meta* :replace))\n\n(defn- top-displace?\n  \"Returns true if the object is marked as top-displaceable\"\n  [obj]\n  (-> obj meta* :top-displace))\n\n(defn- different-priority?\n  \"Returns true if either left has a higher priority than right or vice versa.\"\n  [left right]\n  (boolean\n   (or (some (some-fn nil? displace? replace?) [left right])\n       (top-displace? left))))\n\n(defn- remove-top-displace [obj]\n  (if-not (top-displace? obj)\n    obj\n    (vary-meta obj dissoc :top-displace)))\n\n(defn- pick-prioritized\n  \"Picks the highest prioritized element of left and right and merge their\n  metadata.\"\n  [left right]\n  (cond (nil? left) right\n        (nil? right) (remove-top-displace left)\n\n        (top-displace? left) right\n\n        (and (displace? left)   ;; Pick the rightmost\n             (displace? right)) ;; if both are marked as displaceable\n        (with-meta* right\n          (merge (meta* left) (meta* right)))\n\n        (and (replace? left)    ;; Pick the rightmost\n             (replace? right))  ;; if both are marked as replaceable\n        (with-meta* right\n          (merge (meta* left) (meta* right)))\n\n        (or (displace? left)\n            (replace? right))\n        (with-meta* right\n          (merge (-> left meta* (dissoc :displace))\n                 (-> right meta* (dissoc :replace))))\n\n        (or (replace? left)\n            (displace? right))\n        (with-meta* left\n          (merge (-> right meta* (dissoc :displace))\n                 (-> left meta* (dissoc :replace))))))\n\n(defn meta-merge\n  \"Recursively merge values based on the information in their metadata.\"\n  ([] {})\n  ([left] left)\n  ([left right]\n   (cond (different-priority? left right)\n         (pick-prioritized left right)\n\n         (and (map? left) (map? right))\n         (merge-with meta-merge left right)\n\n         (and (set? left) (set? right))\n         (set/union right left)\n\n         (and (coll? left) (coll? right))\n         (if (or (-> left meta :prepend)\n                 (-> right meta :prepend))\n           (-> (into (empty left) (concat right left))\n             (with-meta (merge (meta left)\n                               (select-keys (meta right) [:displace]))))\n           (into (empty left) (concat left right)))\n\n         :else right))\n  ([left right & more]\n   (reduce meta-merge left (cons right more))))\n"]}