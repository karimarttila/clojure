shadow$provide.module$node_modules$vega_view_transforms$build$vega_view_transforms=function(global$jscomp$0,require,module,exports$jscomp$0){(function(global,factory){"object"===typeof exports$jscomp$0&&"undefined"!==typeof module?factory(exports$jscomp$0,require("module$node_modules$vega_dataflow$build$vega_dataflow"),require("module$node_modules$vega_scenegraph$build$vega_scenegraph"),require("module$node_modules$vega_util$build$vega_util")):"function"===typeof define&&define.amd?define(["exports",
"vega-dataflow","vega-scenegraph","vega-util"],factory):(global="undefined"!==typeof globalThis?globalThis:global||self,factory((global.vega=global.vega||{},global.vega.transforms={}),global.vega,global.vega,global.vega))})(this,function(exports,vegaDataflow,vegaScenegraph,vegaUtil){function Bound(params){vegaDataflow.Transform.call(this,null,params)}function boundItem(item,bound,opt){return bound(item.bounds.clear(),item,opt)}function Identifier(params){vegaDataflow.Transform.call(this,0,params)}
function getCounter(view){return view._signals[":vega_identifier:"]||(view._signals[":vega_identifier:"]=view.add(0))}function Mark(params){vegaDataflow.Transform.call(this,null,params)}function lookup(_){var g=_.groups;_=_.parent;return g&&1===g.size?g.get(Object.keys(g.object)[0]):g&&_?g.lookup(_):null}function Overlap(params){vegaDataflow.Transform.call(this,null,params)}function Render(params){vegaDataflow.Transform.call(this,null,params)}function set(item,property,value){return item[property]===
value?0:(item[property]=value,1)}function isYAxis(mark){mark=mark.items[0].orient;return"left"===mark||"right"===mark}function axisLayout(view,axis,width,height){axis=axis.items[0];var datum=axis.datum,delta=null!=axis.translate?axis.translate:.5,orient=axis.orient,index=+datum.grid;var indices=[datum.ticks?index++:-1,datum.labels?index++:-1,index+ +datum.domain];index=axis.range;var offset=axis.offset,position=axis.position,minExtent=axis.minExtent,maxExtent=axis.maxExtent;datum=datum.title&&axis.items[indices[2]].items[0];
var titlePadding=axis.titlePadding,bounds=axis.bounds,dl=datum&&vegaScenegraph.multiLineOffset(datum),i;tempBounds.clear().union(bounds);bounds.clear();-1<(i=indices[0])&&bounds.union(axis.items[i].bounds);-1<(i=indices[1])&&bounds.union(axis.items[i].bounds);switch(orient){case "top":width=position||0;height=-offset;minExtent=Math.max(minExtent,Math.min(maxExtent,-bounds.y1));bounds.add(0,-minExtent).add(index,0);datum&&axisTitleLayout(view,datum,minExtent,titlePadding,dl,0,-1,bounds);break;case "left":width=
-offset;height=position||0;minExtent=Math.max(minExtent,Math.min(maxExtent,-bounds.x1));bounds.add(-minExtent,0).add(0,index);datum&&axisTitleLayout(view,datum,minExtent,titlePadding,dl,1,-1,bounds);break;case "right":width+=offset;height=position||0;minExtent=Math.max(minExtent,Math.min(maxExtent,bounds.x2));bounds.add(0,0).add(minExtent,index);datum&&axisTitleLayout(view,datum,minExtent,titlePadding,dl,1,1,bounds);break;case "bottom":width=position||0;height+=offset;minExtent=Math.max(minExtent,
Math.min(maxExtent,bounds.y2));bounds.add(0,0).add(index,minExtent);datum&&axisTitleLayout(view,datum,minExtent,titlePadding,0,0,1,bounds);break;default:width=axis.x,height=axis.y}vegaScenegraph.boundStroke(bounds.translate(width,height),axis);set(axis,"x",width+delta)|set(axis,"y",height+delta)&&(axis.bounds=tempBounds,view.dirty(axis),axis.bounds=bounds,view.dirty(axis));return axis.mark.bounds.clear().union(bounds)}function axisTitleLayout(view,title,offset,pad,dl,isYAxis,sign,bounds){var b=title.bounds;
title.auto&&(offset=sign*(offset+dl+pad),dl=pad=0,view.dirty(title),isYAxis?pad=(title.x||0)-(title.x=offset):dl=(title.y||0)-(title.y=offset),title.mark.bounds.clear().union(b.translate(-pad,-dl)),view.dirty(title));bounds.union(b)}function bboxFlush(item){return(new vegaScenegraph.Bounds).set(0,0,item.width||0,item.height||0)}function bboxFull(item){var b=item.bounds.clone();return b.empty()?b.set(0,0,0,0):b.translate(-(item.x||0),-(item.y||0))}function get(opt,key,d){opt=vegaUtil.isObject(opt)?
opt[key]:opt;return null!=opt?opt:void 0!==d?d:0}function offsetValue(v){return 0>v?Math.ceil(-v):0}function gridLayout(view,groups,opt){var dirty=!opt.nodirty,bbox="flush"===opt.bounds?bboxFlush:bboxFull,bounds=tempBounds.set(0,0,0,0),alignCol=get(opt.align,"column"),alignRow=get(opt.align,"row"),padCol=get(opt.padding,"column"),padRow=get(opt.padding,"row"),ncols=opt.columns||groups.length,nrows=0>=ncols?1:Math.ceil(groups.length/ncols),n=groups.length,xOffset=Array(n),xExtent=Array(ncols),xMax=
0,yOffset=Array(n),yExtent=Array(nrows),yMax=0,dx=Array(n),dy=Array(n),boxes=Array(n),i,px,py;for(i=0;i<ncols;++i)xExtent[i]=0;for(i=0;i<nrows;++i)yExtent[i]=0;for(i=0;i<n;++i){var m=groups[i];var b=boxes[i]=bbox(m);m.x=m.x||0;dx[i]=0;m.y=m.y||0;dy[i]=0;m=i%ncols;var r=~~(i/ncols);xMax=Math.max(xMax,px=Math.ceil(b.x2));yMax=Math.max(yMax,py=Math.ceil(b.y2));xExtent[m]=Math.max(xExtent[m],px);yExtent[r]=Math.max(yExtent[r],py);xOffset[i]=padCol+offsetValue(b.x1);yOffset[i]=padRow+offsetValue(b.y1);
dirty&&view.dirty(groups[i])}for(i=0;i<n;++i)0===i%ncols&&(xOffset[i]=0),i<ncols&&(yOffset[i]=0);if("each"===alignCol)for(m=1;m<ncols;++m){bbox=0;for(i=m;i<n;i+=ncols)bbox<xOffset[i]&&(bbox=xOffset[i]);for(i=m;i<n;i+=ncols)xOffset[i]=bbox+xExtent[m-1]}else if("all"===alignCol){for(i=bbox=0;i<n;++i)i%ncols&&bbox<xOffset[i]&&(bbox=xOffset[i]);for(i=0;i<n;++i)i%ncols&&(xOffset[i]=bbox+xMax)}else for(alignCol=!1,m=1;m<ncols;++m)for(i=m;i<n;i+=ncols)xOffset[i]+=xExtent[m-1];if("each"===alignRow)for(r=
1;r<nrows;++r){bbox=0;i=r*ncols;for(m=i+ncols;i<m;++i)bbox<yOffset[i]&&(bbox=yOffset[i]);for(i=r*ncols;i<m;++i)yOffset[i]=bbox+yExtent[r-1]}else if("all"===alignRow){bbox=0;for(i=ncols;i<n;++i)bbox<yOffset[i]&&(bbox=yOffset[i]);for(i=ncols;i<n;++i)yOffset[i]=bbox+yMax}else for(alignRow=!1,r=1;r<nrows;++r)for(i=r*ncols,m=i+ncols;i<m;++i)yOffset[i]+=yExtent[r-1];for(i=r=0;i<n;++i)r=xOffset[i]+(i%ncols?r:0),dx[i]+=r-groups[i].x;for(m=0;m<ncols;++m)for(xOffset=0,i=m;i<n;i+=ncols)xOffset+=yOffset[i],dy[i]+=
xOffset-groups[i].y;if(alignCol&&get(opt.center,"column")&&1<nrows)for(i=0;i<n;++i)b="all"===alignCol?xMax:xExtent[i%ncols],r=b-boxes[i].x2-groups[i].x-dx[i],0<r&&(dx[i]+=r/2);if(alignRow&&get(opt.center,"row")&&1!==ncols)for(i=0;i<n;++i)b="all"===alignRow?yMax:yExtent[~~(i/ncols)],xOffset=b-boxes[i].y2-groups[i].y-dy[i],0<xOffset&&(dy[i]+=xOffset/2);for(i=0;i<n;++i)bounds.union(boxes[i].translate(dx[i],dy[i]));r=get(opt.anchor,"x");xOffset=get(opt.anchor,"y");switch(get(opt.anchor,"column")){case "end":r-=
bounds.width();break;case "middle":r-=bounds.width()/2}switch(get(opt.anchor,"row")){case "end":xOffset-=bounds.height();break;case "middle":xOffset-=bounds.height()/2}r=Math.round(r);xOffset=Math.round(xOffset);bounds.clear();for(i=0;i<n;++i)groups[i].mark.bounds.clear();for(i=0;i<n;++i)m=groups[i],m.x+=dx[i]+=r,m.y+=dy[i]+=xOffset,bounds.union(m.mark.bounds.union(m.bounds.translate(dx[i],dy[i]))),dirty&&view.dirty(m);return bounds}function boundFlush(item,field){return"x1"===field?item.x||0:"y1"===
field?item.y||0:"x2"===field?(item.x||0)+(item.width||0):"y2"===field?(item.y||0)+(item.height||0):void 0}function boundFull(item,field){return item.bounds[field]}function layoutHeaders(view,headers,groups,ncols,limit,offset,agg,isX,bound,bf,start,stride,back,band){var n=groups.length,edge=ncols=0,i,g;if(!n)return ncols;for(i=start;i<n;i+=stride)groups[i]&&(ncols=agg(ncols,bound(groups[i],bf)));if(!headers.length)return ncols;headers.length>limit&&(view.warn("Grid headers exceed limit: "+limit),headers=
headers.slice(0,limit));ncols+=offset;limit=0;for(offset=headers.length;limit<offset;++limit)view.dirty(headers[limit]),headers[limit].mark.bounds.clear();i=start;limit=0;for(offset=headers.length;limit<offset;++limit,i+=stride){bound=headers[limit];start=bound.mark.bounds;for(n=i;0<=n&&null==(g=groups[n]);n-=back);if(isX){n=null==band?g.x:Math.round(g.bounds.x1+band*g.bounds.width());var y=ncols}else n=ncols,y=null==band?g.y:Math.round(g.bounds.y1+band*g.bounds.height());start.union(bound.bounds.translate(n-
(bound.x||0),y-(bound.y||0)));bound.x=n;bound.y=y;view.dirty(bound);edge=agg(edge,start[bf])}return edge}function layoutTitle(view,g,offset,isX,bounds,band){if(g){view.dirty(g);var x=offset;isX?x=Math.round(bounds.x1+band*bounds.width()):offset=Math.round(bounds.y1+band*bounds.height());g.bounds.translate(x-(g.x||0),offset-(g.y||0));g.mark.bounds.clear().union(g.bounds);g.x=x;g.y=offset;view.dirty(g)}}function lookup$1(config,orient){var opt=config[orient]||{};return function(key,d){return null!=
opt[key]?opt[key]:null!=config[key]?config[key]:d}}function offsets(legends,value){var max=-Infinity;legends.forEach(function(item){null!=item.offset&&(max=Math.max(max,item.offset))});return-Infinity<max?max:value}function legendParams(g,orient,config,xb,yb,w,h){var _=lookup$1(config,orient);config=offsets(g,_("offset",0));var anchor=_("anchor","start"),mult="end"===anchor?1:"middle"===anchor?.5:0;g={align:"each",bounds:_("bounds","flush"),columns:"vertical"===_("direction")?1:g.length,padding:_("margin",
8),center:_("center"),nodirty:!0};switch(orient){case "left":g.anchor={x:Math.floor(xb.x1)-config,column:"end",y:mult*(h||xb.height()+2*xb.y1),row:anchor};break;case "right":g.anchor={x:Math.ceil(xb.x2)+config,y:mult*(h||xb.height()+2*xb.y1),row:anchor};break;case "top":g.anchor={y:Math.floor(yb.y1)-config,row:"end",x:mult*(w||yb.width()+2*yb.x1),column:anchor};break;case "bottom":g.anchor={y:Math.ceil(yb.y2)+config,x:mult*(w||yb.width()+2*yb.x1),column:anchor};break;case "top-left":g.anchor={x:config,
y:config};break;case "top-right":g.anchor={x:w-config,y:config,column:"end"};break;case "bottom-left":g.anchor={x:config,y:h-config,row:"end"};break;case "bottom-right":g.anchor={x:w-config,y:h-config,column:"end",row:"end"}}return g}function legendLayout(view,legend){legend=legend.items[0];var datum=legend.datum,orient=legend.orient,bounds=legend.bounds,x=legend.x,y=legend.y;legend._bounds?legend._bounds.clear().union(bounds):legend._bounds=bounds.clone();bounds.clear();var h=legend.items[0].items[0];
var pad=legend.padding,ex=pad-h.x,ey=pad-h.y;if(legend.datum.title){var title=legend.items[1].items[0],anchor=title.anchor,tpad=legend.titlePadding||0,tx=pad-title.x,ty=pad-title.y;switch(title.orient){case "left":ex+=Math.ceil(title.bounds.width())+tpad;break;case "right":case "bottom":break;default:ey+=title.bounds.height()+tpad}(ex||ey)&&translate(view,h,ex,ey);switch(title.orient){case "left":ty+=legendTitleOffset(legend,h,title,anchor,1,1);break;case "right":tx+=legendTitleOffset(legend,h,title,
"end",0,0)+tpad;ty+=legendTitleOffset(legend,h,title,anchor,1,1);break;case "bottom":tx+=legendTitleOffset(legend,h,title,anchor,0,0);ty+=legendTitleOffset(legend,h,title,"end",-1,0,1)+tpad;break;default:tx+=legendTitleOffset(legend,h,title,anchor,0,0)}(tx||ty)&&translate(view,title,tx,ty);0>(tx=Math.round(title.bounds.x1-pad))&&(translate(view,h,-tx,0),translate(view,title,-tx,0))}else(ex||ey)&&translate(view,h,ex,ey);bounds=legendBounds(legend,bounds);view=2*legend.padding;h=2*legend.padding;bounds.empty()||
(view=Math.ceil(bounds.width()+view),h=Math.ceil(bounds.height()+h));"symbol"===datum.type&&legendEntryLayout(legend.items[0].items[0].items[0].items);"none"!==orient&&(legend.x=x=0,legend.y=y=0);legend.width=view;legend.height=h;vegaScenegraph.boundStroke(bounds.set(x,y,x+view,y+h),legend);legend.mark.bounds.clear().union(bounds);return legend}function legendBounds(item,b){item.items.forEach(function(_){return b.union(_.bounds)});b.x1=item.padding;b.y1=item.padding;return b}function legendTitleOffset(item,
entry,title,anchor,y,lr,noBar){var vgrad=title.datum.vgrad;item=("symbol"===item.datum.type||!lr&&vgrad||noBar?entry:entry.items[0]).bounds[y?"y2":"x2"]-item.padding;entry=vgrad&&lr?item:0;lr=vgrad&&lr?0:item;title=0>=y?0:vegaScenegraph.multiLineOffset(title);return Math.round("start"===anchor?entry:"end"===anchor?lr-title:.5*(item-title))}function translate(view,item,dx,dy){item.x+=dx;item.y+=dy;item.bounds.translate(dx,dy);item.mark.bounds.translate(dx,dy);view.dirty(item)}function legendEntryLayout(entries){var widths=
entries.reduce(function(w,g){w[g.column]=Math.max(g.bounds.x2-g.x,w[g.column]||0);return w},{});entries.forEach(function(g){g.width=widths[g.column];g.height=g.bounds.y2-g.y})}function titleLayout(view,mark,width,height,viewBounds){var group=mark.items[0],orient=group.orient,anchor=group.anchor,offset=group.offset,padding=group.padding,title=group.items[0].items[0],subtitle=group.items[1]&&group.items[1].items[0],end="left"===orient||"right"===orient?height:width,start=0,sy=width=0;"group"!==group.frame?
"left"===orient?(start=viewBounds.y2,end=viewBounds.y1):"right"===orient?(start=viewBounds.y1,end=viewBounds.y2):(start=viewBounds.x1,end=viewBounds.x2):"left"===orient&&(start=height,end=0);height="start"===anchor?start:"end"===anchor?end:(start+end)/2;if(subtitle&&subtitle.text){switch(orient){case "top":case "bottom":sy=title.bounds.height()+padding;break;case "left":width=title.bounds.width()+padding;break;case "right":width=-title.bounds.width()-padding}tempBounds.clear().union(subtitle.bounds);
tempBounds.translate(width-(subtitle.x||0),sy-(subtitle.y||0));set(subtitle,"x",width)|set(subtitle,"y",sy)&&(view.dirty(subtitle),subtitle.bounds.clear().union(tempBounds),subtitle.mark.bounds.clear().union(tempBounds),view.dirty(subtitle));tempBounds.clear().union(subtitle.bounds)}else tempBounds.clear();tempBounds.union(title.bounds);switch(orient){case "top":orient=height;viewBounds=viewBounds.y1-tempBounds.height()-offset;break;case "left":orient=viewBounds.x1-tempBounds.width()-offset;viewBounds=
height;break;case "right":orient=viewBounds.x2+tempBounds.width()+offset;viewBounds=height;break;case "bottom":orient=height;viewBounds=viewBounds.y2+offset;break;default:orient=group.x,viewBounds=group.y}set(group,"x",orient)|set(group,"y",viewBounds)&&(tempBounds.translate(orient,viewBounds),view.dirty(group),group.bounds.clear().union(tempBounds),mark.bounds.clear().union(tempBounds),view.dirty(group));return group.bounds}function ViewLayout(params){vegaDataflow.Transform.call(this,null,params)}
function shouldReflow(group){return group&&"legend-entry"!==group.mark.role}function layoutGroup(view,group,_){var items=group.items,width=Math.max(0,group.width||0),height=Math.max(0,group.height||0),viewBounds=(new vegaScenegraph.Bounds).set(0,0,width,height),xBounds=viewBounds.clone(),yBounds=viewBounds.clone(),legends=[],orient,n;var i=0;for(n=items.length;i<n;++i){var mark=items[i];switch(mark.role){case "axis":var b$jscomp$0=isYAxis(mark)?xBounds:yBounds;b$jscomp$0.union(axisLayout(view,mark,
width,height));break;case "title":var title=mark;break;case "legend":legends.push(legendLayout(view,mark));break;case "frame":case "scope":case "row-header":case "row-footer":case "row-title":case "column-header":case "column-footer":case "column-title":xBounds.union(mark.bounds);yBounds.union(mark.bounds);break;default:viewBounds.union(mark.bounds)}}if(legends.length){var l={};legends.forEach(function(item){orient=item.orient||"right";"none"!==orient&&(l[orient]||(l[orient]=[])).push(item)});for(var orient$693 in l)items=
l[orient$693],gridLayout(view,items,legendParams(items,orient$693,_.legends,xBounds,yBounds,width,height));legends.forEach(function(item){var b=item.bounds;b.equals(item._bounds)||(item.bounds=item._bounds,view.dirty(item),item.bounds=b,view.dirty(item));if(_.autosize&&"fit"===_.autosize.type)switch(item.orient){case "left":case "right":viewBounds.add(b.x1,0).add(b.x2,0);break;case "top":case "bottom":viewBounds.add(0,b.y1).add(0,b.y2)}else viewBounds.union(b)})}viewBounds.union(xBounds).union(yBounds);
title&&viewBounds.union(titleLayout(view,title,width,height,viewBounds));group.clip&&viewBounds.set(0,0,group.width||0,group.height||0);viewSizeLayout(view,group,viewBounds,_)}function viewSizeLayout(view,group,viewBounds,_){_=_.autosize||{};var type=_.type;if(!(1>view._autosize)&&type){var viewWidth=view._width,viewHeight=view._height,width=Math.max(0,group.width||0),left=Math.max(0,Math.ceil(-viewBounds.x1));group=Math.max(0,group.height||0);var top=Math.max(0,Math.ceil(-viewBounds.y1)),right=Math.max(0,
Math.ceil(viewBounds.x2-width));viewBounds=Math.max(0,Math.ceil(viewBounds.y2-group));if("padding"===_.contains){var padding=view.padding();viewWidth-=padding.left+padding.right;viewHeight-=padding.top+padding.bottom}"none"===type?(top=left=0,width=viewWidth,group=viewHeight):"fit"===type?(width=Math.max(0,viewWidth-left-right),group=Math.max(0,viewHeight-top-viewBounds)):"fit-x"===type?(width=Math.max(0,viewWidth-left-right),viewHeight=group+top+viewBounds):"fit-y"===type?(viewWidth=width+left+right,
group=Math.max(0,viewHeight-top-viewBounds)):"pad"===type&&(viewWidth=width+left+right,viewHeight=group+top+viewBounds);view._resizeView(viewWidth,viewHeight,width,group,[left,top],_.resize)}}vegaUtil.inherits(Bound,vegaDataflow.Transform,{transform:function(_,pulse){var view=pulse.dataflow,mark=_.mark,type=mark.marktype,entry=vegaScenegraph.Marks[type],bound=entry.bound,markBounds=mark.bounds;if(entry.nested)mark.items.length&&view.dirty(mark.items[0]),markBounds=boundItem(mark,bound),mark.items.forEach(function(item){item.bounds.clear().union(markBounds)});
else if("group"===type||_.modified())switch(pulse.visit(pulse.MOD,function(item){return view.dirty(item)}),markBounds.clear(),mark.items.forEach(function(item){return markBounds.union(boundItem(item,bound))}),mark.role){case "axis":case "legend":case "title":pulse.reflow()}else{var rebound=pulse.changed(pulse.REM);pulse.visit(pulse.ADD,function(item){markBounds.union(boundItem(item,bound))});pulse.visit(pulse.MOD,function(item){rebound=rebound||markBounds.alignsWith(item.bounds);view.dirty(item);
markBounds.union(boundItem(item,bound))});rebound&&(markBounds.clear(),mark.items.forEach(function(item){return markBounds.union(item.bounds)}))}vegaScenegraph.boundClip(mark);return pulse.modifies("bounds")}});Identifier.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};vegaUtil.inherits(Identifier,vegaDataflow.Transform,{transform:function(_,pulse){var counter=getCounter(pulse.dataflow),as=_.as,id=counter.value;pulse.visit(pulse.ADD,function(t){return t[as]=
t[as]||++id});counter.set(this.value=id);return pulse}});vegaUtil.inherits(Mark,vegaDataflow.Transform,{transform:function(_,pulse){var mark=this.value;mark||(mark=pulse.dataflow.scenegraph().mark(_.markdef,lookup(_),_.index),mark.group.context=_.context,_.context.group||(_.context.group=mark.group),mark.source=this.source,mark.clip=_.clip,mark.interactive=_.interactive,this.value=mark);var Init="group"===mark.marktype?vegaScenegraph.GroupItem:vegaScenegraph.Item;pulse.visit(pulse.ADD,function(item){return Init.call(item,
mark)});if(_.modified("clip")||_.modified("interactive"))mark.clip=_.clip,mark.interactive=!!_.interactive,mark.zdirty=!0,pulse.reflow();mark.items=pulse.source;return pulse}});var methods={parity:function(items){return items.filter(function(item,i){return i%2?item.opacity=0:1})},greedy:function(items,sep){var a;return items.filter(function(b,i){return i&&intersect(a.bounds,b.bounds,sep)?b.opacity=0:(a=b,1)})}},intersect=function(a,b,sep){return sep>Math.max(b.x1-a.x2,a.x1-b.x2,b.y1-a.y2,a.y1-b.y2)},
hasOverlap=function(items,pad){for(var i=1,n=items.length,a=items[0].bounds;i<n;++i)if(intersect(a,a=items[i].bounds,pad))return!0},hasBounds=function(item){item=item.bounds;return 1<item.width()&&1<item.height()},boundTest=function(scale,orient,tolerance){scale=scale.range();var b=new vegaScenegraph.Bounds;"top"===orient||"bottom"===orient?b.set(scale[0],-Infinity,scale[1],Infinity):b.set(-Infinity,scale[0],Infinity,scale[1]);b.expand(tolerance||1);return function(item){return b.encloses(item.bounds)}},
reset=function(source){source.forEach(function(item){return item.opacity=1});return source};vegaUtil.inherits(Overlap,vegaDataflow.Transform,{transform:function(_,pulse){var reduce=methods[_.method]||methods.parity,sep=_.separation||0,source=pulse.materialize(pulse.SOURCE).source;if(source&&source.length){if(!_.method)return _.modified("method")&&(reset(source),pulse=pulse.reflow(_.modified()).modifies("opacity")),pulse;source=source.filter(hasBounds);if(source.length){_.sort&&(source=source.slice().sort(_.sort));
var items=reset(source);pulse=pulse.reflow(_.modified()).modifies("opacity");if(3<=items.length&&hasOverlap(items,sep)){do items=reduce(items,sep);while(3<=items.length&&hasOverlap(items,sep));3>items.length&&!vegaUtil.peek(source).opacity&&(1<items.length&&(vegaUtil.peek(items).opacity=0),vegaUtil.peek(source).opacity=1)}if(_.boundScale&&0<=_.boundTolerance){var test=boundTest(_.boundScale,_.boundOrient,+_.boundTolerance);source.forEach(function(item){test(item)||(item.opacity=0)})}var bounds=items[0].mark.bounds.clear();
source.forEach(function(item){item.opacity&&bounds.union(item.bounds)});return pulse}}}});vegaUtil.inherits(Render,vegaDataflow.Transform,{transform:function(_,pulse){var view=pulse.dataflow;pulse.visit(pulse.ALL,function(item){return view.dirty(item)});pulse.fields&&pulse.fields.zindex&&(_=pulse.source&&pulse.source[0])&&(_.mark.zdirty=!0)}});var tempBounds=new vegaScenegraph.Bounds,min=function(a,b){return Math.floor(Math.min(a,b))},max$jscomp$0=function(a,b){return Math.ceil(Math.max(a,b))};vegaUtil.inherits(ViewLayout,
vegaDataflow.Transform,{transform:function(_,pulse){var view=pulse.dataflow;_.mark.items.forEach(function(group){if(_.layout){for(var opt=_.layout,groups=group.items,n=groups.length,i=0,mark,items,JSCompiler_object_inline_marks_6228=[],JSCompiler_object_inline_rowheaders_6229=[],JSCompiler_object_inline_rowfooters_6230=[],JSCompiler_object_inline_colheaders_6231=[],JSCompiler_object_inline_colfooters_6232=[],JSCompiler_object_inline_rowtitle_6233=null,JSCompiler_object_inline_coltitle_6234=null;i<
n;++i)if(mark=groups[i],items=mark.items,"group"===mark.marktype)switch(mark.role){case "axis":case "legend":case "title":break;case "row-header":JSCompiler_object_inline_rowheaders_6229.push.apply(JSCompiler_object_inline_rowheaders_6229,$jscomp.arrayFromIterable(items));break;case "row-footer":JSCompiler_object_inline_rowfooters_6230.push.apply(JSCompiler_object_inline_rowfooters_6230,$jscomp.arrayFromIterable(items));break;case "column-header":JSCompiler_object_inline_colheaders_6231.push.apply(JSCompiler_object_inline_colheaders_6231,
$jscomp.arrayFromIterable(items));break;case "column-footer":JSCompiler_object_inline_colfooters_6232.push.apply(JSCompiler_object_inline_colfooters_6232,$jscomp.arrayFromIterable(items));break;case "row-title":JSCompiler_object_inline_rowtitle_6233=items[0];break;case "column-title":JSCompiler_object_inline_coltitle_6234=items[0];break;default:JSCompiler_object_inline_marks_6228.push.apply(JSCompiler_object_inline_marks_6228,$jscomp.arrayFromIterable(items))}mark="flush"===opt.bounds?boundFlush:
boundFull;groups=opt.offset;items=opt.columns||JSCompiler_object_inline_marks_6228.length;var nrows=0>=items?1:Math.ceil(JSCompiler_object_inline_marks_6228.length/items),cells=nrows*items;n=gridLayout(view,JSCompiler_object_inline_marks_6228,opt);n.empty()&&n.set(0,0,0,0);if(JSCompiler_object_inline_rowheaders_6229){i=get(opt.headerBand,"row",null);var x=layoutHeaders(view,JSCompiler_object_inline_rowheaders_6229,JSCompiler_object_inline_marks_6228,items,nrows,-get(groups,"rowHeader"),min,0,mark,
"x1",0,items,1,i)}if(JSCompiler_object_inline_colheaders_6231){i=get(opt.headerBand,"column",null);var y=layoutHeaders(view,JSCompiler_object_inline_colheaders_6231,JSCompiler_object_inline_marks_6228,items,items,-get(groups,"columnHeader"),min,1,mark,"y1",0,1,items,i)}if(JSCompiler_object_inline_rowfooters_6230){i=get(opt.footerBand,"row",null);var x2=layoutHeaders(view,JSCompiler_object_inline_rowfooters_6230,JSCompiler_object_inline_marks_6228,items,nrows,get(groups,"rowFooter"),max$jscomp$0,0,
mark,"x2",items-1,items,1,i)}if(JSCompiler_object_inline_colfooters_6232){i=get(opt.footerBand,"column",null);var y2=layoutHeaders(view,JSCompiler_object_inline_colfooters_6232,JSCompiler_object_inline_marks_6228,items,items,get(groups,"columnFooter"),max$jscomp$0,1,mark,"y2",cells-items,1,items,i)}JSCompiler_object_inline_rowtitle_6233&&(JSCompiler_object_inline_rowheaders_6229=get(opt.titleAnchor,"row"),JSCompiler_object_inline_marks_6228=get(groups,"rowTitle"),JSCompiler_object_inline_marks_6228=
"end"===JSCompiler_object_inline_rowheaders_6229?x2+JSCompiler_object_inline_marks_6228:x-JSCompiler_object_inline_marks_6228,i=get(opt.titleBand,"row",.5),layoutTitle(view,JSCompiler_object_inline_rowtitle_6233,JSCompiler_object_inline_marks_6228,0,n,i));JSCompiler_object_inline_coltitle_6234&&(JSCompiler_object_inline_rowheaders_6229=get(opt.titleAnchor,"column"),JSCompiler_object_inline_marks_6228=get(groups,"columnTitle"),JSCompiler_object_inline_marks_6228="end"===JSCompiler_object_inline_rowheaders_6229?
y2+JSCompiler_object_inline_marks_6228:y-JSCompiler_object_inline_marks_6228,i=get(opt.titleBand,"column",.5),layoutTitle(view,JSCompiler_object_inline_coltitle_6234,JSCompiler_object_inline_marks_6228,1,n,i))}layoutGroup(view,group,_)});return shouldReflow(_.mark.group)?pulse.reflow():pulse}});exports.bound=Bound;exports.identifier=Identifier;exports.mark=Mark;exports.overlap=Overlap;exports.render=Render;exports.viewlayout=ViewLayout;Object.defineProperty(exports,"__esModule",{value:!0})})}
//# sourceMappingURL=module$node_modules$vega_view_transforms$build$vega_view_transforms.js.map
