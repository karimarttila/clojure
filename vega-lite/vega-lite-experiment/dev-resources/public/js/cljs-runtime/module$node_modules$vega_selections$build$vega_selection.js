shadow$provide.module$node_modules$vega_selections$build$vega_selection=function(global$jscomp$0,require,module,exports$jscomp$0){(function(global,factory){"object"===typeof exports$jscomp$0&&"undefined"!==typeof module?factory(exports$jscomp$0,require("module$node_modules$vega_util$build$vega_util"),require("module$node_modules$vega_expression$build$vega_expression")):"function"===typeof define&&define.amd?define(["exports","vega-util","vega-expression"],factory):(global="undefined"!==typeof globalThis?
globalThis:global||self,factory(global.vega={},global.vega,global.vega))})(this,function(exports,vegaUtil,vegaExpression){function ascendingComparator(f){return function(d,x){d=f(d);return d<x?-1:d>x?1:d>=x?0:NaN}}function testPoint(datum,entry){var fields=entry.fields;entry=entry.values;for(var n=fields.length,i=0,dval,f;i<n;++i)if(f=fields[i],f.getter=vegaUtil.field.getter||vegaUtil.field(f.field),dval=f.getter(datum),vegaUtil.isDate(dval)&&(dval=vegaUtil.toNumber(dval)),vegaUtil.isDate(entry[i])&&
(entry[i]=vegaUtil.toNumber(entry[i])),vegaUtil.isDate(entry[i][0])&&(entry[i]=entry[i].map(vegaUtil.toNumber)),"E"===f.type){if(vegaUtil.isArray(entry[i])?0>entry[i].indexOf(dval):dval!==entry[i])return!1}else if("R"===f.type){if(!vegaUtil.inrange(dval,entry[i]))return!1}else if("R-RE"===f.type){if(!vegaUtil.inrange(dval,entry[i],!0,!1))return!1}else if("R-E"===f.type){if(!vegaUtil.inrange(dval,entry[i],!1,!1))return!1}else if("R-LE"===f.type&&!vegaUtil.inrange(dval,entry[i],!1,!0))return!1;return!0}
var selectionId=vegaUtil.field("_vgsid_"),bisect=function(f){function left(a,x,lo,hi){null==lo&&(lo=0);null==hi&&(hi=a.length);for(;lo<hi;){var mid=lo+hi>>>1;0>compare(a[mid],x)?lo=mid+1:hi=mid}return lo}var delta=f,compare=f;1===f.length&&(delta=function(d,x){return f(d)-x},compare=ascendingComparator(f));return{left:left,center:function(a,x,lo,hi){null==lo&&(lo=0);null==hi&&(hi=a.length);hi=left(a,x,lo,hi-1);return hi>lo&&delta(a[hi-1],x)>-delta(a[hi],x)?hi-1:hi},right:function(a,x,lo,hi){null==
lo&&(lo=0);null==hi&&(hi=a.length);for(;lo<hi;){var mid=lo+hi>>>1;0<compare(a[mid],x)?hi=mid:lo=mid+1}return lo}}}(selectionId),bisectLeft=bisect.left,bisectRight=bisect.right,ops={E_union:function(base,value){if(!base.length)return value;for(var i=0,n=value.length;i<n;++i)0>base.indexOf(value[i])&&base.push(value[i]);return base},E_intersect:function(base,value){return base.length?base.filter(function(v){return 0<=value.indexOf(v)}):value},R_union:function(base,value){var lo=vegaUtil.toNumber(value[0]),
hi=vegaUtil.toNumber(value[1]);lo>hi&&(lo=value[1],hi=value[0]);if(!base.length)return[lo,hi];base[0]>lo&&(base[0]=lo);base[1]<hi&&(base[1]=hi);return base},R_intersect:function(base,value){var lo=vegaUtil.toNumber(value[0]),hi=vegaUtil.toNumber(value[1]);lo>hi&&(lo=value[1],hi=value[0]);if(!base.length)return[lo,hi];if(hi<base[0]||base[1]<lo)return[];base[0]<lo&&(base[0]=lo);base[1]>hi&&(base[1]=hi);return base}};exports.selectionIdTest=function(name,datum,op){var data=this.context.data[name];name=
data?data.values.value:[];data=data?data["index:unit"]&&data["index:unit"].value:void 0;op="intersect"===op;datum=selectionId(datum);var index=bisectLeft(name,datum);if(index===name.length||selectionId(name[index])!==datum)return!1;if(data&&op){if(1===data.size)return!0;if(bisectRight(name,datum)-index<data.size)return!1}return!0};exports.selectionResolve=function(name,op,isMulti,vl5){name=(name=this.context.data[name])?name.values.value:[];for(var resolved={},multiRes={},types={},entry,fields,unit$jscomp$0,
field$jscomp$0,res,resUnit,n=name.length,i=0,j$jscomp$0,m;i<n;++i){entry=name[i];unit$jscomp$0=entry.unit;fields=entry.fields;entry=entry.values;j$jscomp$0=0;for(m=fields.length;j$jscomp$0<m;++j$jscomp$0)field$jscomp$0=fields[j$jscomp$0],res=resolved[field$jscomp$0.field]||(resolved[field$jscomp$0.field]={}),resUnit=res[unit$jscomp$0]||(res[unit$jscomp$0]=[]),types[field$jscomp$0.field]=field$jscomp$0=field$jscomp$0.type.charAt(0),field$jscomp$0=ops[field$jscomp$0+"_union"],res[unit$jscomp$0]=field$jscomp$0(resUnit,
vegaUtil.array(entry[j$jscomp$0]));isMulti&&(resUnit=multiRes[unit$jscomp$0]||(multiRes[unit$jscomp$0]=[]),resUnit.push(vegaUtil.array(entry).reduce(function(obj,curr,j){return obj[fields[j].field]=curr,obj},{})))}op=op||"union";Object.keys(resolved).forEach(function(field){resolved[field]=Object.keys(resolved[field]).map(function(unit){return resolved[field][unit]}).reduce(function(acc,curr){return void 0===acc?curr:ops[types[field]+"_"+op](acc,curr)})});name=Object.keys(multiRes);isMulti&&name.length&&
(isMulti={},unit$jscomp$0={},resolved[vl5?"vlPoint":"vlMulti"]="union"===op?(isMulti.or=name.reduce(function(acc,k){return acc.push.apply(acc,$jscomp.arrayFromIterable(multiRes[k])),acc},[]),isMulti):(unit$jscomp$0.and=name.map(function(k){var $jscomp$compprop214={};return $jscomp$compprop214.or=multiRes[k],$jscomp$compprop214}),unit$jscomp$0));return resolved};exports.selectionTest=function(name,datum,op){var data=this.context.data[name];name=data?data.values.value:[];data=data?data["index:unit"]&&
data["index:unit"].value:void 0;op="intersect"===op;for(var n=name.length,i=0,entry,miss,count,unit;i<n;++i)if(entry=name[i],data&&op){if(miss=miss||{},count=miss[unit=entry.unit]||0,-1!==count){entry=testPoint(datum,entry);miss[unit]=entry?-1:++count;if(entry&&1===data.size)return!0;if(!entry&&count===data.get(unit).count)return!1}}else if(entry=testPoint(datum,entry),op^entry)return entry;return n&&op};exports.selectionTuples=function(array,base){return array.map(function(x){return vegaUtil.extend({values:base.fields.map(function(f){return(f.getter||
(f.getter=vegaUtil.field(f.field)))(x.datum)})},base)})};exports.selectionVisitor=function(name,args,scope,params){args[0].type!==vegaExpression.Literal&&vegaUtil.error("First argument to selection functions must be a string literal.");name=args[0].value;args=2<=args.length&&vegaUtil.peek(args).value;var dataName=":"+name;"intersect"!==args||vegaUtil.hasOwnProperty(params,"@unit")||(params["@unit"]=scope.getData(name).indataRef(scope,"unit"));vegaUtil.hasOwnProperty(params,dataName)||(params[dataName]=
scope.getData(name).tuplesRef())};Object.defineProperty(exports,"__esModule",{value:!0})})}
//# sourceMappingURL=module$node_modules$vega_selections$build$vega_selection.js.map
