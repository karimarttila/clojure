shadow$provide.module$node_modules$vega_label$build$vega_label=function(global$jscomp$0,require,module,exports$jscomp$0){(function(global,factory){"object"===typeof exports$jscomp$0&&"undefined"!==typeof module?factory(exports$jscomp$0,require("module$node_modules$vega_canvas$build$vega_canvas_min"),require("module$node_modules$vega_dataflow$build$vega_dataflow"),require("module$node_modules$vega_scenegraph$build$vega_scenegraph"),require("module$node_modules$vega_util$build$vega_util")):"function"===
typeof define&&define.amd?define(["exports","vega-canvas","vega-dataflow","vega-scenegraph","vega-util"],factory):(global="undefined"!==typeof globalThis?globalThis:global||self,factory((global.vega=global.vega||{},global.vega.transforms={}),global.vega,global.vega,global.vega,global.vega))})(this,function(exports,vegaCanvas,vegaDataflow,vegaScenegraph,vegaUtil){function baseBitmaps($,data){var bitmap=$.bitmap();(data||[]).forEach(function(d){return bitmap.set($(d.boundary[0]),$(d.boundary[3]))});
return[bitmap,void 0]}function markBitmaps($,avoidMarks,labelInside,isGroupArea){var width=$.width,height=$.height,border=labelInside||isGroupArea,context=vegaCanvas.canvas(width,height).getContext("2d");avoidMarks.forEach(function(items){return draw(context,items,border)});avoidMarks=new Uint32Array(context.getImageData(0,0,width,height).data.buffer);labelInside=$.bitmap();var layer2=border&&$.bitmap(),x,y,alpha;for(y=0;y<height;++y)for(x=0;x<width;++x)if(alpha=avoidMarks[y*width+x]&4278190080){var u=
$(x);var v=$(y);isGroupArea||labelInside.set(u,v);border&&alpha^268435456&&layer2.set(u,v)}return[labelInside,layer2]}function draw(context,items,interior){if(items.length){var type=items[0].mark.marktype;"group"===type?items.forEach(function(group){group.items.forEach(function(mark){return draw(context,mark.items,interior)})}):vegaScenegraph.Marks[type].draw(context,{items:interior?items.map(prepare):items})}}function prepare(source){source=vegaDataflow.rederive(source,{});source.stroke&&(source.strokeOpacity=
1);source.fill&&(source.fillOpacity=.0625,source.stroke="#000",source.strokeOpacity=1,source.strokeWidth=2);return source}function Bitmap(w,h){var array=new Uint32Array(~~((w*h+32)/32));return{array:array,get:function(x,y){x=y*w+x;return array[x>>>5]&1<<(x&31)},set:function(x,y){x=y*w+x;array[x>>>5]|=1<<(x&31)},clear:function(x,y){x=y*w+x;array[x>>>5]&=~(1<<(x&31))},getRange:function(x,y,x2,y2){for(var start,end,indexStart,indexEnd;y2>=y;--y2)if(start=y2*w+x,end=y2*w+x2,indexStart=start>>>5,indexEnd=
end>>>5,indexStart===indexEnd){if(array[indexStart]&RIGHT0[start&31]&RIGHT1[(end&31)+1])return!0}else{if(array[indexStart]&RIGHT0[start&31]||array[indexEnd]&RIGHT1[(end&31)+1])return!0;for(start=indexStart+1;start<indexEnd;++start)if(array[start])return!0}return!1},setRange:function(x,y,x2,y2){for(var start,end,indexStart,indexEnd;y<=y2;++y)if(start=y*w+x,end=y*w+x2,indexStart=start>>>5,indexEnd=end>>>5,indexStart===indexEnd)array[indexStart]|=RIGHT0[start&31]&RIGHT1[(end&31)+1];else for(array[indexStart]|=
RIGHT0[start&31],array[indexEnd]|=RIGHT1[(end&31)+1],start=indexStart+1;start<indexEnd;++start)array[start]|=4294967295},clearRange:function(x,y,x2,y2){for(var start,end,indexStart,indexEnd;y<=y2;++y)if(start=y*w+x,end=y*w+x2,indexStart=start>>>5,indexEnd=end>>>5,indexStart===indexEnd)array[indexStart]&=RIGHT1[start&31]|RIGHT0[(end&31)+1];else for(array[indexStart]&=RIGHT1[start&31],array[indexEnd]&=RIGHT0[(end&31)+1],start=indexStart+1;start<indexEnd;++start)array[start]&=0},outOfBounds:function(x,
y,x2,y2){return 0>x||0>y||y2>=h||x2>=w}}}function scaler(width,height,padding){var ratio=Math.max(1,Math.sqrt(width*height/1E6)),w=~~((width+2*padding+ratio)/ratio),h=~~((height+2*padding+ratio)/ratio),scale=function(_){return~~((_+padding)/ratio)};scale.invert=function(_){return _*ratio-padding};scale.bitmap=function(){return Bitmap(w,h)};scale.ratio=ratio;scale.padding=padding;scale.width=width;scale.height=height;return scale}function outOfBounds(x,y,textWidth,textHeight,width,height){textWidth/=
2;return 0>x-textWidth||x+textWidth>width||0>y-(textWidth=textHeight/2)||y+textWidth>height}function _outOfBounds(){return!1}function collision($,x,y,textHeight,textWidth,h,bm0,bm1){textWidth=textWidth*h/(2*textHeight);textHeight=$(x-textWidth);x=$(x+textWidth);textWidth=$(y-(h/=2));$=$(y+h);return bm0.outOfBounds(textHeight,textWidth,x,$)||bm0.getRange(textHeight,textWidth,x,$)||bm1&&bm1.getRange(textHeight,textWidth,x,$)}function _collision($,x,y,textHeight,textWidth,h,bm0,bm1){textWidth=textWidth*
h/(2*textHeight);textHeight=$(x-textWidth);x=$(x+textWidth);textWidth=$(y-(h/=2));y=$(y+h);textHeight=0<textHeight?textHeight:0;textWidth=0<textWidth?textWidth:0;x=x<$.width?x:$.width-1;y=y<$.height?y:$.height-1;return bm0.getRange(textHeight,textWidth,x,y)||bm1&&bm1.getRange(textHeight,textWidth,x,y)}function placeMarkLabel($,bitmaps,anchors,offsets,infPadding){var width=$.width,height=$.height,bm0=bitmaps[0],bm1=bitmaps[1],n=offsets.length;return function(d){var boundary=d.boundary,textHeight=d.datum.fontSize;
if(!infPadding&&(0>boundary[2]||0>boundary[5]||boundary[0]>width||boundary[3]>height))return!1;for(var textWidth=0,dx,dy,isInside,sizeFactor,insideFactor,x1,x2,y2,xc,yc,_x1,_x2,_y1,_y2,i$698=0;i$698<n;++i$698){dx=(anchors[i$698]&3)-1;dy=(anchors[i$698]>>>2&3)-1;isInside=0===dx&&0===dy||0>offsets[i$698];sizeFactor=dx&&dy?Math.SQRT1_2:1;insideFactor=0>offsets[i$698]?-1:1;x1=boundary[1+dx]+offsets[i$698]*dx*sizeFactor;yc=boundary[4+dy]+insideFactor*textHeight*dy/2+offsets[i$698]*dy*sizeFactor;sizeFactor=
yc-textHeight/2;y2=yc+textHeight/2;_x1=$(x1);_y1=$(sizeFactor);_y2=$(y2);infPadding&&(_x1=0>_x1?0:_x1,_y1=0>_y1?0:_y1,_y2=_y2>=$.height?$.height-1:_y2);if(!textWidth){x2=_x1;xc=_y1;_x2=_y2;var x1$jscomp$0=x1,x2$jscomp$0=x1,y1=sizeFactor,y2$jscomp$0=y2,isInside$jscomp$0=isInside;if(!bm0.outOfBounds(x2,xc,_x1,_x2)&&(isInside$jscomp$0&&bm1?!bm1.getRange(x2,xc,_x1,_x2)&&boundary[0]<=x1$jscomp$0&&x2$jscomp$0<=boundary[2]&&boundary[3]<=y1&&y2$jscomp$0<=boundary[5]:!bm0.getRange(x2,xc,_x1,_x2)))textWidth=
vegaScenegraph.textMetrics.width(d.datum,d.datum.text);else continue}xc=x1+insideFactor*textWidth*dx/2;x1=xc-textWidth/2;x2=xc+textWidth/2;_x1=$(x1);_x2=$(x2);infPadding&&(_x1=0>_x1?0:_x1,_x2=_x2>=$.width?$.width-1:_x2);x1$jscomp$0=_x1;x2$jscomp$0=_x2;y1=_y1;y2$jscomp$0=_y2;isInside$jscomp$0=x1;var x2$jscomp$1=x2,y1$jscomp$0=sizeFactor,y2$jscomp$1=y2;if(!bm0.outOfBounds(x1$jscomp$0,y1,x2$jscomp$0,y2$jscomp$0)&&(isInside&&bm1?!bm1.getRange(x1$jscomp$0,y1,x2$jscomp$0,y2$jscomp$0)&&boundary[0]<=isInside$jscomp$0&&
x2$jscomp$1<=boundary[2]&&boundary[3]<=y1$jscomp$0&&y2$jscomp$1<=boundary[5]:!bm0.getRange(x1$jscomp$0,y1,x2$jscomp$0,y2$jscomp$0)))return d.x=dx?0>dx*insideFactor?x2:x1:xc,d.y=dy?0>dy*insideFactor?y2:sizeFactor:yc,d.align=Aligns[dx*insideFactor+1],d.baseline=Baselines[dy*insideFactor+1],bm0.setRange(_x1,_y1,_x2,_y2),!0}return!1}}function labelLayout(texts,size,compare,offset,anchor,avoidMarks,avoidBaseMark,lineAnchor,markIndex,padding,method){if(!texts.length)return texts;var positions=Math.max(offset.length,
anchor.length);offset=getOffsets(offset,positions);anchor=getAnchors(anchor,positions);positions=markType(texts[0].datum);var grouptype="group"===positions&&texts[0].datum.items[markIndex].marktype,isGroupArea="area"===grouptype,boundary=markBoundary(positions,grouptype,lineAnchor,markIndex);lineAnchor=null===padding||Infinity===padding;size=scaler(size[0],size[1],lineAnchor?0:padding);grouptype=isGroupArea&&"naive"===method;padding=texts.map(function(d){return{datum:d,opacity:0,x:void 0,y:void 0,
align:void 0,baseline:void 0,boundary:boundary(d)}});if(!grouptype){compare&&padding.sort(function(a,b){return compare(a.datum,b.datum)});var bitmaps=!1;for(grouptype=0;grouptype<anchor.length&&!bitmaps;++grouptype)bitmaps=5===anchor[grouptype]||0>offset[grouptype];positions&&(avoidBaseMark||isGroupArea)&&(avoidMarks=[texts.map(function(d){return d.datum})].concat(avoidMarks));bitmaps=avoidMarks.length?markBitmaps(size,avoidMarks,bitmaps,isGroupArea):baseBitmaps(size,avoidBaseMark&&padding)}var place=
isGroupArea?placeAreaLabel[method](size,bitmaps,avoidBaseMark,markIndex,lineAnchor):placeMarkLabel(size,bitmaps,anchor,offset,lineAnchor);padding.forEach(function(d){return d.opacity=+place(d)});return padding}function getOffsets(_,count){for(var offsets=new Float64Array(count),n=_.length,i$700=0;i$700<n;++i$700)offsets[i$700]=_[i$700]||0;for(_=n;_<count;++_)offsets[_]=offsets[n-1];return offsets}function getAnchors(_,count){for(var anchors=new Int8Array(count),n=_.length,i$702=0;i$702<n;++i$702)anchors[i$702]|=
anchorCode[_[i$702]];for(_=n;_<count;++_)anchors[_]=anchors[n-1];return anchors}function markType(item){return item&&item.mark&&item.mark.marktype}function markBoundary(marktype,grouptype,lineAnchor,markIndex){var xy=function(d){return[d.x,d.x,d.x,d.y,d.y,d.y]};return marktype?"line"===marktype||"area"===marktype?function(d){return xy(d.datum)}:"line"===grouptype?function(d){d=d.datum.items[markIndex].items;return xy(d.length?d["start"===lineAnchor?0:d.length-1]:{x:NaN,y:NaN})}:function(d){d=d.datum.bounds;
return[d.x1,(d.x1+d.x2)/2,d.x2,d.y1,(d.y1+d.y2)/2,d.y2]}:xy}function Label(params){vegaDataflow.Transform.call(this,null,params)}var RIGHT0=new Uint32Array(33),RIGHT1=new Uint32Array(33);RIGHT1[0]=0;RIGHT0[0]=~RIGHT1[0];for(var i=1;32>=i;++i)RIGHT1[i]=RIGHT1[i-1]<<1|1,RIGHT0[i]=~RIGHT1[i];var X_DIR=[-1,-1,1,1],Y_DIR=[-1,1,-1,1],Aligns=["right","center","left"],Baselines=["bottom","middle","top"],anchorCode={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},
placeAreaLabel={naive:function($,bitmaps,avoidBaseMark,markIndex){var width=$.width,height=$.height;return function(d){for(var items=d.datum.datum.items[markIndex].items,n=items.length,textHeight=d.datum.fontSize,textWidth=vegaScenegraph.textMetrics.width(d.datum,d.datum.text),maxAreaWidth=0,x1,x2,y1,y2,x,y,i$695=0;i$695<n;++i$695)x1=items[i$695].x,y1=items[i$695].y,x2=void 0===items[i$695].x2?x1:items[i$695].x2,y2=void 0===items[i$695].y2?y1:items[i$695].y2,x=(x1+x2)/2,y=(y1+y2)/2,x1=Math.abs(x2-
x1+y2-y1),x1>=maxAreaWidth&&(maxAreaWidth=x1,d.x=x,d.y=y);x=textWidth/2;y=textHeight/2;x1=d.x-x;x2=d.x+x;y1=d.y-y;y2=d.y+y;d.align="center";0>x1&&x2<=width?d.align="left":0<=x1&&width<x2&&(d.align="right");d.baseline="middle";0>y1&&y2<=height?d.baseline="top":0<=y1&&height<y2&&(d.baseline="bottom");return!0}},"reduced-search":function($,bitmaps,avoidBaseMark,markIndex,infPadding){function tryLabel(_x,_y,maxSize,textWidth,textHeight){_x=$.invert(_x);_y=$.invert(_y);var lo=maxSize,hi=height;if(!outOfBounds$jscomp$0(_x,
_y,textWidth,textHeight,width,height)&&!collision$jscomp$0($,_x,_y,textHeight,textWidth,lo,bm0,bm1)&&!collision$jscomp$0($,_x,_y,textHeight,textWidth,textHeight,bm0,null)){for(;1<=hi-lo;){var mid=(lo+hi)/2;collision$jscomp$0($,_x,_y,textHeight,textWidth,mid,bm0,bm1)?hi=mid:lo=mid}if(lo>maxSize)return[_x,_y,lo,!0]}}var width=$.width,height=$.height;infPadding=$jscomp.makeIterator(infPadding?[_collision,_outOfBounds]:[collision,outOfBounds]);var collision$jscomp$0=infPadding.next().value,outOfBounds$jscomp$0=
infPadding.next().value,bm0=bitmaps[0],bm1=bitmaps[1];return function(d){for(var items=d.datum.datum.items[markIndex].items,n=items.length,textHeight=d.datum.fontSize,textWidth=vegaScenegraph.textMetrics.width(d.datum,d.datum.text),maxSize=avoidBaseMark?textHeight:0,labelPlaced=!1,labelPlaced2=!1,maxAreaWidth=0,x1,x2,y1,y2,_x,_y,_x1,_xMid,_x2,_y1,_yMid,_y2,result,i$696=0;i$696<n;++i$696){x1=items[i$696].x;y1=items[i$696].y;x2=void 0===items[i$696].x2?x1:items[i$696].x2;y2=void 0===items[i$696].y2?
y1:items[i$696].y2;x1>x2&&(_x=x1,x1=x2,x2=_x);y1>y2&&(_x=y1,y1=y2,y2=_x);_x1=$(x1);_x2=$(x2);_xMid=~~((_x1+_x2)/2);_y1=$(y1);_y2=$(y2);_yMid=~~((_y1+_y2)/2);for(_x=_xMid;_x>=_x1;--_x)for(_y=_yMid;_y>=_y1;--_y)if(result=tryLabel(_x,_y,maxSize,textWidth,textHeight))labelPlaced=$jscomp.makeIterator(result),d.x=labelPlaced.next().value,d.y=labelPlaced.next().value,maxSize=labelPlaced.next().value,labelPlaced=labelPlaced.next().value;for(_x=_xMid;_x<=_x2;++_x)for(_y=_yMid;_y<=_y2;++_y)if(result=tryLabel(_x,
_y,maxSize,textWidth,textHeight))labelPlaced=$jscomp.makeIterator(result),d.x=labelPlaced.next().value,d.y=labelPlaced.next().value,maxSize=labelPlaced.next().value,labelPlaced=labelPlaced.next().value;labelPlaced||avoidBaseMark||(_x=Math.abs(x2-x1+y2-y1),x1=(x1+x2)/2,y1=(y1+y2)/2,_x>=maxAreaWidth&&!outOfBounds$jscomp$0(x1,y1,textWidth,textHeight,width,height)&&!collision$jscomp$0($,x1,y1,textHeight,textWidth,textHeight,bm0,null)&&(maxAreaWidth=_x,d.x=x1,d.y=y1,labelPlaced2=!0))}return labelPlaced||
labelPlaced2?(x1=textWidth/2,y1=textHeight/2,bm0.setRange($(d.x-x1),$(d.y-y1),$(d.x+x1),$(d.y+y1)),d.align="center",d.baseline="middle",!0):!1}},floodfill:function($,bitmaps,avoidBaseMark,markIndex,infPadding){var width=$.width,height=$.height;infPadding=$jscomp.makeIterator(infPadding?[_collision,_outOfBounds]:[collision,outOfBounds]);var collision$jscomp$0=infPadding.next().value,outOfBounds$jscomp$0=infPadding.next().value,bm0=bitmaps[0],bm1=bitmaps[1],bm2=$.bitmap();return function(d){for(var items=
d.datum.datum.items[markIndex].items,n=items.length,textHeight=d.datum.fontSize,textWidth=vegaScenegraph.textMetrics.width(d.datum,d.datum.text),stack=[],maxSize=avoidBaseMark?textHeight:0,labelPlaced=!1,labelPlaced2=!1,maxAreaWidth=0,x1,x2,y1,y2,x,y,_x,_y,mid,i$697=0;i$697<n;++i$697){x1=items[i$697].x;y1=items[i$697].y;x2=void 0===items[i$697].x2?x1:items[i$697].x2;y2=void 0===items[i$697].y2?y1:items[i$697].y2;for(stack.push([$((x1+x2)/2),$((y1+y2)/2)]);stack.length;)if(x=$jscomp.makeIterator(stack.pop()),
_x=x.next().value,_y=x.next().value,!(bm0.get(_x,_y)||bm1.get(_x,_y)||bm2.get(_x,_y))){bm2.set(_x,_y);for(mid=0;4>mid;++mid)x=_x+X_DIR[mid],y=_y+Y_DIR[mid],bm2.outOfBounds(x,y,x,y)||stack.push([x,y]);x=$.invert(_x);y=$.invert(_y);_x=maxSize;_y=height;if(!outOfBounds$jscomp$0(x,y,textWidth,textHeight,width,height)&&!collision$jscomp$0($,x,y,textHeight,textWidth,_x,bm0,bm1)&&!collision$jscomp$0($,x,y,textHeight,textWidth,textHeight,bm0,null)){for(;1<=_y-_x;)mid=(_x+_y)/2,collision$jscomp$0($,x,y,textHeight,
textWidth,mid,bm0,bm1)?_y=mid:_x=mid;_x>maxSize&&(d.x=x,d.y=y,maxSize=_x,labelPlaced=!0)}}labelPlaced||avoidBaseMark||(_x=Math.abs(x2-x1+y2-y1),x=(x1+x2)/2,y=(y1+y2)/2,_x>=maxAreaWidth&&!outOfBounds$jscomp$0(x,y,textWidth,textHeight,width,height)&&!collision$jscomp$0($,x,y,textHeight,textWidth,textHeight,bm0,null)&&(maxAreaWidth=_x,d.x=x,d.y=y,labelPlaced2=!0))}return labelPlaced||labelPlaced2?(x=textWidth/2,y=textHeight/2,bm0.setRange($(d.x-x),$(d.y-y),$(d.x+x),$(d.y+y)),d.align="center",d.baseline=
"middle",!0):!1}}},Output=["x","y","opacity","align","baseline"],Anchors="top-left left bottom-left top bottom top-right right bottom-right".split(" ");Label.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Anchors},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start",
"end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:Output.length,default:Output}]};vegaUtil.inherits(Label,vegaDataflow.Transform,{transform:function(_,pulse){function modp(param){param=_[param];return vegaUtil.isFunction(param)&&pulse.modified(param.fields)}var mod=_.modified();if(mod||pulse.changed(pulse.ADD_REM)||
modp("sort")){_.size&&2===_.size.length||vegaUtil.error("Size parameter should be specified as a [width, height] array.");var as=_.as||Output;labelLayout(pulse.materialize(pulse.SOURCE).source||[],_.size,_.sort,vegaUtil.array(null==_.offset?1:_.offset),vegaUtil.array(_.anchor||Anchors),_.avoidMarks||[],!1!==_.avoidBaseMark,_.lineAnchor||"end",_.markIndex||0,void 0===_.padding?0:_.padding,_.method||"naive").forEach(function(l){var t=l.datum;t[as[0]]=l.x;t[as[1]]=l.y;t[as[2]]=l.opacity;t[as[3]]=l.align;
t[as[4]]=l.baseline});return pulse.reflow(mod).modifies(as)}}});exports.label=Label;Object.defineProperty(exports,"__esModule",{value:!0})})}
//# sourceMappingURL=module$node_modules$vega_label$build$vega_label.js.map
