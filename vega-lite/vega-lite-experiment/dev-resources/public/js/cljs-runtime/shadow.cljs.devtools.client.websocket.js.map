{"version":3,"sources":["shadow/cljs/devtools/client/websocket.cljs"],"mappings":";AASA,AAAA,AAAMA,AAAOC;AAAb,AACE,AAAMC,AAAO,AAACC;AACRC,AAAO,AAAAC,AAAeH;AAD5B,AAGE,AAAA,AAAME,AACJ,AAAKE;AAAL,AACE,AAACC,AAAuBN,AAAQ,AAAQK;;;AAE5C,AAAA,AAAMF,AACJ,AAAKE;AAAL,AACE,AAACE,AAAwBP,AAAQK;;;AAErC,AAAA,AAAMF,AACJ,AAAKE;AAAL,AACE,AAACG,AAAyBR,AAAQK;;;AAEtC,AAAA,AAAMF,AACJ,AAAKE;AAAL,AAEE,AAACI,AAAyBT,AAAQK;;;AAEtCF;;AAEJ,AAAA,AAAMO,AAAMP,AAAOQ;AAAnB,AACE,AAAOR,AAAOQ;;AAEhB,AAAA,AAAMC,AAAMT;AAAZ,AAWE,AAAA,AAAM,AAAUA;;AAChB,AAAA,AAAM,AAAWA;;AACjB,AAAA,AAAM,AAAaA;;AACnB,AAAA,AAAM,AAAWA;;AACjB,AAAQA","names":["shadow.cljs.devtools.client.websocket/start","runtime","ws-url","shadow.cljs.devtools.client.env/get-ws-relay-url","socket","js/WebSocket","e","shadow.cljs.devtools.client.shared/remote-msg","shadow.cljs.devtools.client.shared/remote-open","shadow.cljs.devtools.client.shared/remote-close","shadow.cljs.devtools.client.shared/remote-error","shadow.cljs.devtools.client.websocket/send","msg","shadow.cljs.devtools.client.websocket/stop"],"sourcesContent":["(ns shadow.cljs.devtools.client.websocket\n  (:require\n    [shadow.cljs.devtools.client.env :as env]\n    [shadow.cljs.devtools.client.shared :as cljs-shared]\n    [shadow.remote.runtime.cljs.js-builtins]\n    ))\n\n;; FIXME: protocolize the 3 fns\n\n(defn start [runtime]\n  (let [ws-url (env/get-ws-relay-url)\n        socket (js/WebSocket. ws-url)]\n\n    (set! socket -onmessage\n      (fn [e]\n        (cljs-shared/remote-msg runtime (.-data e))))\n\n    (set! socket -onopen\n      (fn [e]\n        (cljs-shared/remote-open runtime e)))\n\n    (set! socket -onclose\n      (fn [e]\n        (cljs-shared/remote-close runtime e)))\n\n    (set! socket -onerror\n      (fn [e]\n        ;; followed by close\n        (cljs-shared/remote-error runtime e)))\n\n    socket))\n\n(defn send [socket msg]\n  (.send socket msg))\n\n(defn stop [socket]\n  ;; chrome sometimes gets stuck websockets when waking up from sleep\n  ;; at least on my macbook macos chrome, works fine in windows\n  ;; these sockets don't receive messages or send them\n  ;; and will eventually time out after a minute or so\n  ;; at which point we no longer care about close messages as a new one will\n  ;; be active and we don't want to a late onclose message to disconnect that one.\n\n  ;; firefox also has the stuck socket but that is closed pretty much immediately on wake\n  ;; it still shows an error \"was interrupted while loading page\" after a bit\n  ;; can't seem to get rid of that one but it is from the socket we no longer care about anyways\n  (set! (.-onopen socket) nil)\n  (set! (.-onclose socket) nil)\n  (set! (.-onmessage socket) nil)\n  (set! (.-onerror socket) nil)\n  (.close socket))\n\n"]}