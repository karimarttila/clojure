shadow$provide.module$node_modules$vega_lite$build$vega_lite=function(global$jscomp$0,require,module$jscomp$0,exports$jscomp$0){var Buffer=require("module$node_modules$buffer$index").Buffer;(function(global,factory){"object"===typeof exports$jscomp$0&&"undefined"!==typeof module$jscomp$0?factory(exports$jscomp$0,require("module$node_modules$vega_util$build$vega_util"),require("module$node_modules$vega$build$vega_node")):"function"===typeof define&&define.amd?define(["exports","vega-util","vega"],
factory):(global="undefined"!==typeof globalThis?globalThis:global||self,factory(global.vegaLite={},global.vega,global.vega))})(this,function(exports,vegaUtil,vega){function forEachLeaf(op,fn){if(op.not)forEachLeaf(op.not,fn);else if(op.and){var $jscomp$iter$324=$jscomp.makeIterator(op.and);for(op=$jscomp$iter$324.next();!op.done;op=$jscomp$iter$324.next())forEachLeaf(op.value,fn)}else if(op.or)for($jscomp$iter$324=$jscomp.makeIterator(op.or),op=$jscomp$iter$324.next();!op.done;op=$jscomp$iter$324.next())forEachLeaf(op.value,
fn);else fn(op)}function normalizeLogicalComposition(op,normalizer){return op.not?{not:normalizeLogicalComposition(op.not,normalizer)}:op.and?{and:op.and.map(function(o){return normalizeLogicalComposition(o,normalizer)})}:op.or?{or:op.or.map(function(o){return normalizeLogicalComposition(o,normalizer)})}:normalizer(op)}function pick(obj,props){var copy={};props=$jscomp.makeIterator(props);for(var $jscomp$key$prop=props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next())$jscomp$key$prop=$jscomp$key$prop.value,
vegaUtil.hasOwnProperty(obj,$jscomp$key$prop)&&(copy[$jscomp$key$prop]=obj[$jscomp$key$prop]);return copy}function omit(obj,props){obj=Object.assign({},obj);props=$jscomp.makeIterator(props);for(var $jscomp$key$prop=props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next())delete obj[$jscomp$key$prop.value];return obj}function hash(a){if(vegaUtil.isNumber(a))return a;a=vegaUtil.isString(a)?a:fastJsonStableStringify(a);if(250>a.length)return a;for(var h=0,i=0;i<a.length;i++){var char=a.charCodeAt(i);
h=(h<<5)-h+char;h&=h}return h}function isNullOrFalse(x){return!1===x||null===x}function contains(array,item){return array.includes(item)}function some(arr,f){var i=0;arr=$jscomp.makeIterator(arr.entries());for(var $jscomp$key$=arr.next();!$jscomp$key$.done;$jscomp$key$=arr.next()){var $jscomp$destructuring$var91=$jscomp.makeIterator($jscomp$key$.value);$jscomp$key$=$jscomp$destructuring$var91.next().value;$jscomp$destructuring$var91=$jscomp$destructuring$var91.next().value;if(f($jscomp$destructuring$var91,
$jscomp$key$,i++))return!0}return!1}function every(arr,f){var i=0;arr=$jscomp.makeIterator(arr.entries());for(var $jscomp$key$=arr.next();!$jscomp$key$.done;$jscomp$key$=arr.next()){var $jscomp$destructuring$var93=$jscomp.makeIterator($jscomp$key$.value);$jscomp$key$=$jscomp$destructuring$var93.next().value;$jscomp$destructuring$var93=$jscomp$destructuring$var93.next().value;if(!f($jscomp$destructuring$var93,$jscomp$key$,i++))return!1}return!0}function mergeDeep(dest,src){for(var $jscomp$restParams=
[],$jscomp$restIndex=1;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-1]=arguments[$jscomp$restIndex];$jscomp$restParams=$jscomp.makeIterator($jscomp$restParams);for(var $jscomp$key$s=$jscomp$restParams.next();!$jscomp$key$s.done;$jscomp$key$s=$jscomp$restParams.next()){var $jscomp$nullish$tmp0=void 0;$jscomp$restIndex=dest;$jscomp$key$s=null!=($jscomp$nullish$tmp0=$jscomp$key$s.value)?$jscomp$nullish$tmp0:{};$jscomp$nullish$tmp0=$jscomp.makeIterator(keys$jscomp$0($jscomp$key$s));
for(var $jscomp$inline_4227=$jscomp$nullish$tmp0.next();!$jscomp$inline_4227.done;$jscomp$inline_4227=$jscomp$nullish$tmp0.next())$jscomp$inline_4227=$jscomp$inline_4227.value,vegaUtil.writeConfig($jscomp$restIndex,$jscomp$inline_4227,$jscomp$key$s[$jscomp$inline_4227],!0)}return dest}function unique(values,f){var results=[],u={},v;values=$jscomp.makeIterator(values);for(v=values.next();!v.done;v=values.next()){var val=v.value;v=f(val);v in u||(u[v]=1,results.push(val))}return results}function setEqual(a,
b){if(a.size!==b.size)return!1;a=$jscomp.makeIterator(a);for(var $jscomp$key$e=a.next();!$jscomp$key$e.done;$jscomp$key$e=a.next())if(!b.has($jscomp$key$e.value))return!1;return!0}function hasIntersection(a,b){a=$jscomp.makeIterator(a);for(var $jscomp$key$key=a.next();!$jscomp$key$key.done;$jscomp$key$key=a.next())if(b.has($jscomp$key$key.value))return!0;return!1}function prefixGenerator(a){var prefixes=new Set,$jscomp$loop$1655={};a=$jscomp.makeIterator(a);for(var $jscomp$key$x=a.next();!$jscomp$key$x.done;$jscomp$loop$1655=
{$jscomp$loop$prop$wrappedWithAccessors$1656:$jscomp$loop$1655.$jscomp$loop$prop$wrappedWithAccessors$1656},$jscomp$key$x=a.next()){$jscomp$key$x=vegaUtil.splitAccessPath($jscomp$key$x.value);$jscomp$loop$1655.$jscomp$loop$prop$wrappedWithAccessors$1656=$jscomp$key$x.map(function(y,i){return 0===i?y:"["+y+"]"});$jscomp$key$x=$jscomp$loop$1655.$jscomp$loop$prop$wrappedWithAccessors$1656.map(function($jscomp$loop$1655){return function(_,i){return $jscomp$loop$1655.$jscomp$loop$prop$wrappedWithAccessors$1656.slice(0,
i+1).join("")}}($jscomp$loop$1655));$jscomp$key$x=$jscomp.makeIterator($jscomp$key$x);for(var $jscomp$key$y=$jscomp$key$x.next();!$jscomp$key$y.done;$jscomp$key$y=$jscomp$key$x.next())prefixes.add($jscomp$key$y.value)}return prefixes}function fieldIntersection(a,b){return void 0===a||void 0===b?!0:hasIntersection(prefixGenerator(a),prefixGenerator(b))}function isEmpty(obj){return 0===keys$jscomp$0(obj).length}function isBoolean(b){return!0===b||!1===b}function varName(s){var alphanumericS=s.replace(/\W/g,
"_");return(s.match(/^\d+/)?"_":"")+alphanumericS}function logicalExpr(op,cb){return op.not?"!("+logicalExpr(op.not,cb)+")":op.and?"("+op.and.map(function(and){return logicalExpr(and,cb)}).join(") \x26\x26 (")+")":op.or?"("+op.or.map(function(or){return logicalExpr(or,cb)}).join(") || (")+")":cb(op)}function deleteNestedProperty(obj,orderedProps){if(0===orderedProps.length)return!0;var prop=orderedProps.shift();prop in obj&&deleteNestedProperty(obj[prop],orderedProps)&&delete obj[prop];return isEmpty(obj)}
function titleCase(s){return s.charAt(0).toUpperCase()+s.substr(1)}function accessPathWithDatum(path,datum){datum=void 0===datum?"datum":datum;path=vegaUtil.splitAccessPath(path);for(var prefixes=[],i=1;i<=path.length;i++){var prefix="["+path.slice(0,i).map(vegaUtil.stringValue).join("][")+"]";prefixes.push(""+datum+prefix)}return prefixes.join(" \x26\x26 ")}function flatAccessWithDatum(path,datum){return(void 0===datum?"datum":datum)+"["+vegaUtil.stringValue(vegaUtil.splitAccessPath(path).join("."))+
"]"}function escapePathAccess(string){return string.replace(/(\[|\]|\.|'|")/g,"\\$1")}function replacePathInField(path){return""+vegaUtil.splitAccessPath(path).map(escapePathAccess).join("\\.")}function replaceAll(string,find,replacement){return string.replace(new RegExp(find.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$\x26"),"g"),replacement)}function removePathFromField(path){return""+vegaUtil.splitAccessPath(path).join(".")}function accessPathDepth(path){return path?vegaUtil.splitAccessPath(path).length:
0}function getFirstDefined(args){for(var $jscomp$restParams=[],$jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-0]=arguments[$jscomp$restIndex];$jscomp$restParams=$jscomp.makeIterator($jscomp$restParams);for($jscomp$restIndex=$jscomp$restParams.next();!$jscomp$restIndex.done;$jscomp$restIndex=$jscomp$restParams.next())if($jscomp$restIndex=$jscomp$restIndex.value,void 0!==$jscomp$restIndex)return $jscomp$restIndex}function uniqueId(prefix){var id=
++idCounter;return prefix?String(prefix)+id:id}function internalField(name){return isInternalField(name)?name:"__"+name}function isInternalField(name){return name.startsWith("__")}function normalizeAngle(angle){if(void 0!==angle)return(angle%360+360)%360}function isNumeric(value){return vegaUtil.isNumber(value)?!0:!isNaN(value)&&!isNaN(parseFloat(value))}function getPositionChannelFromLatLong(channel){switch(channel){case "latitude":return"y";case "latitude2":return"y2";case "longitude":return"x";
case "longitude2":return"x2"}}function isColorChannel(channel){return"color"===channel||"fill"===channel||"stroke"===channel}function isSecondaryRangeChannel(c){return getMainRangeChannel(c)!==c}function getMainRangeChannel(channel){switch(channel){case "x2":return"x";case "y2":return"y";case "latitude2":return"latitude";case "longitude2":return"longitude";case "theta2":return"theta";case "radius2":return"radius"}return channel}function getVgPositionChannel(channel){if(channel in POLAR_POSITION_CHANNEL_INDEX)switch(channel){case "theta":return"startAngle";
case "theta2":return"endAngle";case "radius":return"outerRadius";case "radius2":return"innerRadius"}return channel}function getSecondaryRangeChannel(channel){switch(channel){case "x":return"x2";case "y":return"y2";case "latitude":return"latitude2";case "longitude":return"longitude2";case "theta":return"theta2";case "radius":return"radius2"}}function getSizeChannel$1(channel){switch(channel){case "x":case "x2":return"width";case "y":case "y2":return"height"}}function getOffsetChannel(channel){switch(channel){case "x":return"xOffset";
case "y":return"yOffset";case "x2":return"x2Offset";case "y2":return"y2Offset";case "theta":return"thetaOffset";case "radius":return"radiusOffset";case "theta2":return"theta2Offset";case "radius2":return"radius2Offset"}}function getPositionScaleChannel(sizeType){return"width"===sizeType?"x":"y"}function getSupportedMark(channel){switch(channel){case "color":case "fill":case "stroke":case "description":case "detail":case "key":case "tooltip":case "href":case "order":case "opacity":case "fillOpacity":case "strokeOpacity":case "strokeWidth":case "facet":case "row":case "column":return ALL_MARKS;
case "x":case "y":case "latitude":case "longitude":return ALL_MARKS_EXCEPT_GEOSHAPE;case "x2":case "y2":case "latitude2":case "longitude2":return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case "size":return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case "strokeDash":return{line:"always",point:"always",
tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case "shape":return{point:"always",geoshape:"always"};case "text":return{text:"always"};case "angle":return{point:"always",square:"always",text:"always"};case "url":return{image:"always"};case "theta":return{text:"always",arc:"always"};case "radius":return{text:"always",arc:"always"};case "theta2":case "radius2":return{arc:"always"}}}function rangeType(channel){switch(channel){case "facet":case "row":case "column":case "shape":case "strokeDash":case "text":case "tooltip":case "href":case "url":case "description":return"discrete";
case "color":case "fill":case "stroke":return"flexible"}}function isArgminDef(a){return!!a&&!!a.argmin}function isArgmaxDef(a){return!!a&&!!a.argmax}function isAggregateOp(a){return vegaUtil.isString(a)&&!!AGGREGATE_OP_INDEX[a]}function binToString(bin){vegaUtil.isBoolean(bin)&&(bin=normalizeBin(bin,void 0));return"bin"+keys$jscomp$0(bin).map(function(p){return isParameterExtent(bin[p])?varName("_"+p+"_"+entries$1(bin[p])):varName("_"+p+"_"+bin[p])}).join("")}function isBinning(bin){return!0===bin||
vegaUtil.isObject(bin)&&!bin.binned}function isBinned(bin){return"binned"===bin||vegaUtil.isObject(bin)&&!0===bin.binned}function isParameterExtent(extent){return null===extent||void 0===extent?void 0:extent.param}function autoMaxBins(channel){switch(channel){case "row":case "column":case "size":case "color":case "fill":case "stroke":case "strokeWidth":case "opacity":case "fillOpacity":case "strokeOpacity":case "shape":return 6;case "strokeDash":return 4;default:return 10}}function isExprRef(o){return o&&
!!o.expr}function replaceExprRef(index){var props=keys$jscomp$0(index||{}),newIndex={};props=$jscomp.makeIterator(props);for(var $jscomp$key$prop=props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next())$jscomp$key$prop=$jscomp$key$prop.value,newIndex[$jscomp$key$prop]=signalRefOrValue(index[$jscomp$key$prop]);return newIndex}function extractTitleConfig(titleConfig){var $jscomp$destructuring$var105=Object.assign({},titleConfig),anchor=titleConfig.anchor,frame=titleConfig.frame,offset=titleConfig.offset,
orient=titleConfig.orient,angle=titleConfig.angle,limit=titleConfig.limit,color=titleConfig.color,subtitleColor=titleConfig.subtitleColor,subtitleFont=titleConfig.subtitleFont,subtitleFontSize=titleConfig.subtitleFontSize,subtitleFontStyle=titleConfig.subtitleFontStyle,subtitleFontWeight=titleConfig.subtitleFontWeight,subtitleLineHeight=titleConfig.subtitleLineHeight,subtitlePadding=titleConfig.subtitlePadding;$jscomp$destructuring$var105=(delete $jscomp$destructuring$var105.anchor,delete $jscomp$destructuring$var105.frame,
delete $jscomp$destructuring$var105.offset,delete $jscomp$destructuring$var105.orient,delete $jscomp$destructuring$var105.angle,delete $jscomp$destructuring$var105.limit,delete $jscomp$destructuring$var105.color,delete $jscomp$destructuring$var105.subtitleColor,delete $jscomp$destructuring$var105.subtitleFont,delete $jscomp$destructuring$var105.subtitleFontSize,delete $jscomp$destructuring$var105.subtitleFontStyle,delete $jscomp$destructuring$var105.subtitleFontWeight,delete $jscomp$destructuring$var105.subtitleLineHeight,
delete $jscomp$destructuring$var105.subtitlePadding,$jscomp$destructuring$var105);color=Object.assign({},$jscomp$destructuring$var105,color?{fill:color}:{});anchor=Object.assign({},anchor?{anchor:anchor}:{},frame?{frame:frame}:{},offset?{offset:offset}:{},orient?{orient:orient}:{},void 0!==angle?{angle:angle}:{},void 0!==limit?{limit:limit}:{});subtitleColor=Object.assign({},subtitleColor?{subtitleColor:subtitleColor}:{},subtitleFont?{subtitleFont:subtitleFont}:{},subtitleFontSize?{subtitleFontSize:subtitleFontSize}:
{},subtitleFontStyle?{subtitleFontStyle:subtitleFontStyle}:{},subtitleFontWeight?{subtitleFontWeight:subtitleFontWeight}:{},subtitleLineHeight?{subtitleLineHeight:subtitleLineHeight}:{},subtitlePadding?{subtitlePadding:subtitlePadding}:{});titleConfig=pick(titleConfig,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:color,subtitleMarkConfig:titleConfig,nonMarkTitleProperties:anchor,subtitle:subtitleColor}}function isText(v){return vegaUtil.isString(v)||vegaUtil.isArray(v)&&vegaUtil.isString(v[0])}
function isSignalRef(o){return o&&!!o.signal}function isVgRangeStep(range){return!!range.step}function isDataRefDomain(domain){return vegaUtil.isArray(domain)?!1:"field"in domain&&"data"in domain}function signalOrValueRefWithCondition(val){var condition=vegaUtil.isArray(val.condition)?val.condition.map(conditionalSignalRefOrValue):conditionalSignalRefOrValue(val.condition);return Object.assign({},signalRefOrValue(val),{condition:condition})}function signalRefOrValue(value){if(isExprRef(value)){var $jscomp$destructuring$var107=
Object.assign({},value);value=value.expr;$jscomp$destructuring$var107=(delete $jscomp$destructuring$var107.expr,$jscomp$destructuring$var107);return Object.assign({},{signal:value},$jscomp$destructuring$var107)}return value}function conditionalSignalRefOrValue(value){if(isExprRef(value)){var $jscomp$destructuring$var109=Object.assign({},value);value=value.expr;$jscomp$destructuring$var109=(delete $jscomp$destructuring$var109.expr,$jscomp$destructuring$var109);return Object.assign({},{signal:value},
$jscomp$destructuring$var109)}return value}function signalOrValueRef(value){if(isExprRef(value)){var $jscomp$destructuring$var111=Object.assign({},value);value=value.expr;$jscomp$destructuring$var111=(delete $jscomp$destructuring$var111.expr,$jscomp$destructuring$var111);return Object.assign({},{signal:value},$jscomp$destructuring$var111)}return isSignalRef(value)?value:void 0!==value?{value:value}:void 0}function signalOrStringValue(v){return isSignalRef(v)?v.signal:null==v?null:vegaUtil.stringValue(v)}
function applyMarkConfig(e,model,propsList){propsList=$jscomp.makeIterator(propsList);for(var $jscomp$key$property=propsList.next();!$jscomp$key$property.done;$jscomp$key$property=propsList.next()){$jscomp$key$property=$jscomp$key$property.value;var value=getMarkConfig($jscomp$key$property,model.markDef,model.config);void 0!==value&&(e[$jscomp$key$property]=signalOrValueRef(value))}return e}function getStyles(mark){var $jscomp$nullish$tmp1;return[].concat(mark.type,null!=($jscomp$nullish$tmp1=mark.style)?
$jscomp$nullish$tmp1:[])}function getMarkPropOrConfig(channel,mark,config,opt){var $jscomp$destructuring$var112=opt=void 0===opt?{}:opt,vgChannel=$jscomp$destructuring$var112.vgChannel;if(vgChannel&&void 0!==mark[vgChannel])return mark[vgChannel];if(void 0!==mark[channel])return mark[channel];if(!$jscomp$destructuring$var112.ignoreVgConfig||vgChannel&&vgChannel!==channel)return getMarkConfig(channel,mark,config,opt)}function getMarkConfig(channel,mark,config,$jscomp$destructuring$var113){$jscomp$destructuring$var113=
(void 0===$jscomp$destructuring$var113?{}:$jscomp$destructuring$var113).vgChannel;return getFirstDefined($jscomp$destructuring$var113?getMarkStyleConfig(channel,mark,config.style):void 0,getMarkStyleConfig(channel,mark,config.style),$jscomp$destructuring$var113?config[mark.type][$jscomp$destructuring$var113]:void 0,config[mark.type][channel],$jscomp$destructuring$var113?config.mark[$jscomp$destructuring$var113]:config.mark[channel])}function getMarkStyleConfig(prop,mark,styleConfigIndex){return getStyleConfig(prop,
getStyles(mark),styleConfigIndex)}function getStyleConfig(p,styles,styleConfigIndex){styles=vegaUtil.array(styles);var value;styles=$jscomp.makeIterator(styles);for(var $jscomp$key$style=styles.next();!$jscomp$key$style.done;$jscomp$key$style=styles.next())($jscomp$key$style=styleConfigIndex[$jscomp$key$style.value])&&void 0!==$jscomp$key$style[p]&&(value=$jscomp$key$style[p]);return value}function sortParams(orderDef,fieldRefOption){return vegaUtil.array(orderDef).reduce(function(s,orderChannelDef){s.field.push(vgField(orderChannelDef,
fieldRefOption));var $jscomp$nullish$tmp2;s.order.push(null!=($jscomp$nullish$tmp2=orderChannelDef.sort)?$jscomp$nullish$tmp2:"ascending");return s},{field:[],order:[]})}function mergeTitleFieldDefs(f1,f2){var merged=[].concat($jscomp.arrayFromIterable(f1));f2.forEach(function(fdToMerge){for(var $jscomp$iter$342=$jscomp.makeIterator(merged),$jscomp$key$fieldDef1=$jscomp$iter$342.next();!$jscomp$key$fieldDef1.done;$jscomp$key$fieldDef1=$jscomp$iter$342.next())if(deepEqual($jscomp$key$fieldDef1.value,
fdToMerge))return;merged.push(fdToMerge)});return merged}function mergeTitle(title1,title2){return deepEqual(title1,title2)||!title2?title1:title1?[].concat($jscomp.arrayFromIterable(vegaUtil.array(title1)),$jscomp.arrayFromIterable(vegaUtil.array(title2))).join(", "):title2}function mergeTitleComponent(v1,v2){var v1Val=v1.value;v2=v2.value;if(null==v1Val||null===v2)return{explicit:v1.explicit,value:null};if((isText(v1Val)||isSignalRef(v1Val))&&(isText(v2)||isSignalRef(v2)))return{explicit:v1.explicit,
value:mergeTitle(v1Val,v2)};if(isText(v1Val)||isSignalRef(v1Val))return{explicit:v1.explicit,value:v1Val};if(isText(v2)||isSignalRef(v2))return{explicit:v1.explicit,value:v2};if(!(isText(v1Val)||isSignalRef(v1Val)||isText(v2)||isSignalRef(v2)))return{explicit:v1.explicit,value:mergeTitleFieldDefs(v1Val,v2)};throw Error("It should never reach here");}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value;
return obj}function _classPrivateFieldSet(receiver,privateMap,value){privateMap=_classExtractFieldDescriptor(receiver,privateMap,"set");if(privateMap.set)privateMap.set.call(receiver,value);else{if(!privateMap.writable)throw new TypeError("attempted to set read only private field");privateMap.value=value}return value}function _classExtractFieldDescriptor(receiver,privateMap,action){if(!privateMap.has(receiver))throw new TypeError("attempted to "+action+" private field on non-instance");return privateMap.get(receiver)}
function invalidSpec(spec){return"Invalid specification "+stringify(spec)+'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".'}function containerSizeNonSingle(name){return("width"==name?"Width":"Height")+' "container" only works for single views and layered views.'}function containerSizeNotCompatibleWithAutosize(name){return("width"==name?"Width":"Height")+' "container" only works well with autosize "fit" or "fit-'+
("width"==name?"x":"y")+'".'}function droppingFit(channel){return channel?'Dropping "fit-'+channel+'" because spec has discrete '+getSizeChannel$1(channel)+".":'Dropping "fit" because spec has discrete size.'}function unknownField(channel){return"Unknown field for "+channel+". Cannot calculate view size."}function cannotProjectOnChannelWithoutField(channel){return'Cannot project a selection on encoding channel "'+channel+'", which has no field.'}function selectionNotSupported(mark){return"Selection not supported for "+
mark+" yet."}function columnsNotSupportByRowCol(type){return'The "columns" property cannot be used when "'+type+'" has nested row/column.'}function differentParse(field,local,ancestor){return'An ancestor parsed field "'+field+'" as '+ancestor+" but a child wants to parse the field as "+local+"."}function customFormatTypeNotAllowed(channel){return"Config.customFormatTypes is not true, thus custom format type and format for channel "+channel+" are dropped."}function droppingColor(type,opt){var fill=
opt.fill;opt=opt.stroke;return"Dropping color "+type+" as the plot also has "+(fill&&opt?"fill and stroke":fill?"fill":"stroke")+"."}function emptyFieldDef(fieldDef,channel){return"Dropping "+stringify(fieldDef)+' from channel "'+channel+'" since it does not contain any data field, datum, value, or signal.'}function incompatibleChannel(channel,markOrFacet,when){return channel+' dropped as it is incompatible with "'+markOrFacet+'"'+(when?" when "+when:"")+"."}function discreteChannelCannotEncode(channel,
type){return'Using discrete channel "'+channel+'" to encode "'+type+'" field can be misleading as it does not encode '+("ordinal"===type?"order":"magnitude")+"."}function scalePropertyNotWorkWithScaleType(scaleType,propName,channel){return channel+"-scale's \""+propName+'" is dropped as it does not work with '+scaleType+" scale."}function stepDropped(channel){return'The step for "'+channel+'" is dropped because the '+("width"===channel?"x":"y")+" is continuous."}function invalidTimeUnit(unitName,
value){return"Invalid "+unitName+": "+stringify(value)+"."}function errorBand1DNotSupport(property){return"1D error band does not support "+property+"."}function channelRequiredForBinned(channel){return"Channel "+channel+' is required for "binned" bin.'}function warn(args){for(var $jscomp$restParams=[],$jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-0]=arguments[$jscomp$restIndex];current.warn.apply(current,$jscomp.arrayFromIterable($jscomp$restParams))}
function debug(args){for(var $jscomp$restParams=[],$jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-0]=arguments[$jscomp$restIndex];current.debug.apply(current,$jscomp.arrayFromIterable($jscomp$restParams))}function isDateTime(o){if(o&&vegaUtil.isObject(o))for(var $jscomp$iter$343=$jscomp.makeIterator(TIMEUNIT_PARTS),$jscomp$key$part=$jscomp$iter$343.next();!$jscomp$key$part.done;$jscomp$key$part=$jscomp$iter$343.next())if($jscomp$key$part.value in
o)return!0;return!1}function normalizeMonth(m){isNumeric(m)&&(m=+m);if(vegaUtil.isNumber(m))return m-1;var lowerM=m.toLowerCase(),monthIndex=MONTHS.indexOf(lowerM);if(-1!==monthIndex)return monthIndex;lowerM=lowerM.substr(0,3);lowerM=SHORT_MONTHS.indexOf(lowerM);if(-1!==lowerM)return lowerM;throw Error(invalidTimeUnit("month",m));}function normalizeDay(d){isNumeric(d)&&(d=+d);if(vegaUtil.isNumber(d))return d%7;var lowerD=d.toLowerCase(),dayIndex=DAYS.indexOf(lowerD);if(-1!==dayIndex)return dayIndex;
lowerD=lowerD.substr(0,3);lowerD=SHORT_DAYS.indexOf(lowerD);if(-1!==lowerD)return lowerD;throw Error(invalidTimeUnit("day",d));}function dateTimeParts(d,normalize){var parts=[];normalize&&void 0!==d.day&&1<keys$jscomp$0(d).length&&(warn("Dropping day from datetime "+stringify(d)+" as day cannot be combined with other units."),d=duplicate(d),delete d.day);void 0!==d.year?parts.push(d.year):parts.push(2012);if(void 0!==d.month){var month=normalize?normalizeMonth(d.month):d.month;parts.push(month)}else if(void 0!==
d.quarter){if(normalize)if(month=d.quarter,isNumeric(month)&&(month=+month),vegaUtil.isNumber(month))4<month&&warn(invalidTimeUnit("quarter",month)),--month;else throw Error(invalidTimeUnit("quarter",month));else month=d.quarter;parts.push(vegaUtil.isNumber(month)?3*month:month+"*3")}else parts.push(0);void 0!==d.date?parts.push(d.date):void 0!==d.day?(normalize=normalize?normalizeDay(d.day):d.day,parts.push(vegaUtil.isNumber(normalize)?normalize+1:normalize+"+1")):parts.push(1);normalize=$jscomp.makeIterator(["hours",
"minutes","seconds","milliseconds"]);for(month=normalize.next();!month.done;month=normalize.next())month=d[month.value],parts.push("undefined"===typeof month?0:month);return parts}function dateTimeToExpr(d){var string=dateTimeParts(d,!0).join(", ");return d.utc?"utc("+string+")":"datetime("+string+")"}function dateTimeToTimestamp(d){var parts=dateTimeParts(d,!0);return d.utc?+new Date(Date.UTC.apply(Date,$jscomp.arrayFromIterable(parts))):+new (Function.prototype.bind.apply(Date,[null].concat($jscomp.arrayFromIterable(parts))))}
function getTimeUnitParts(timeUnit){return TIMEUNIT_PARTS.filter(function(part){return containsTimeUnit(timeUnit,part)})}function containsTimeUnit(fullTimeUnit,timeUnit){var index=fullTimeUnit.indexOf(timeUnit);return 0>index||0<index&&"seconds"===timeUnit&&"i"===fullTimeUnit.charAt(index-1)||fullTimeUnit.length>index+3&&"day"===timeUnit&&"o"===fullTimeUnit.charAt(index+3)||0<index&&"year"===timeUnit&&"f"===fullTimeUnit.charAt(index-1)?!1:!0}function timeUnitSpecifierExpression(timeUnit){if(timeUnit)return timeUnit=
getTimeUnitParts(timeUnit),"timeUnitSpecifier("+stringify(timeUnit)+", "+stringify(VEGALITE_TIMEFORMAT)+")"}function normalizeTimeUnit(timeUnit){if(timeUnit){var params;vegaUtil.isString(timeUnit)?params={unit:timeUnit}:vegaUtil.isObject(timeUnit)&&(params=Object.assign({},timeUnit,timeUnit.unit?{unit:timeUnit.unit}:{}));params.unit.startsWith("utc")&&(params.utc=!0,params.unit=params.unit.substr(3));return params}}function timeUnitToString(tu){var $jscomp$destructuring$var119=normalizeTimeUnit(tu);
tu=Object.assign({},$jscomp$destructuring$var119);$jscomp$destructuring$var119=$jscomp$destructuring$var119.utc;var rest=(delete tu.utc,tu);return rest.unit?($jscomp$destructuring$var119?"utc":"")+keys$jscomp$0(rest).map(function(p){return varName(("unit"===p?"":"_"+p+"_")+rest[p])}).join(""):($jscomp$destructuring$var119?"utc":"")+"timeunit"+keys$jscomp$0(rest).map(function(p){return varName("_"+p+"_"+rest[p])}).join("")}function isFieldEqualPredicate(predicate){return predicate&&!!predicate.field&&
void 0!==predicate.equal}function isFieldLTPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.lt}function isFieldLTEPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.lte}function isFieldGTPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.gt}function isFieldGTEPredicate(predicate){return predicate&&!!predicate.field&&void 0!==predicate.gte}function isFieldRangePredicate(predicate){return null!==predicate&&void 0!==predicate&&
predicate.field&&(vegaUtil.isArray(predicate.range)&&2===predicate.range.length||isSignalRef(predicate.range))?!0:!1}function isFieldOneOfPredicate(predicate){return predicate&&!!predicate.field&&(vegaUtil.isArray(predicate.oneOf)||vegaUtil.isArray(predicate.in))}function isFieldPredicate(predicate){return isFieldOneOfPredicate(predicate)||isFieldEqualPredicate(predicate)||isFieldRangePredicate(predicate)||isFieldLTPredicate(predicate)||isFieldGTPredicate(predicate)||isFieldLTEPredicate(predicate)||
isFieldGTEPredicate(predicate)}function predicateValueExpr(v,timeUnit){return valueExpr(v,{timeUnit:timeUnit,wrapTime:!0})}function predicateValuesExpr(vals,timeUnit){return vals.map(function(v){return predicateValueExpr(v,timeUnit)})}function fieldFilterExpression(predicate,useInRange){useInRange=void 0===useInRange?!0:useInRange;var _normalizeTimeUnit,field=predicate.field,timeUnit=null===(_normalizeTimeUnit=normalizeTimeUnit(predicate.timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit;
if(timeUnit){field=accessPathWithDatum(field);var utc=timeUnit.startsWith("utc")?"utc":"";_normalizeTimeUnit={};for(var $jscomp$inline_5689=$jscomp.makeIterator(TIMEUNIT_PARTS),$jscomp$key$part=$jscomp$inline_5689.next();!$jscomp$key$part.done;$jscomp$key$part=$jscomp$inline_5689.next())if($jscomp$key$part=$jscomp$key$part.value,containsTimeUnit(timeUnit,$jscomp$key$part)){var JSCompiler_inline_result="quarter"===$jscomp$key$part?"("+utc+"quarter("+field+")-1)":""+utc+$jscomp$key$part+"("+field+")";
_normalizeTimeUnit[$jscomp$key$part]=JSCompiler_inline_result}field=dateTimeParts(_normalizeTimeUnit,!1).join(", ");_normalizeTimeUnit="time("+(_normalizeTimeUnit.utc?"utc("+field+")":"datetime("+field+")")+")"}else _normalizeTimeUnit=vgField(predicate,{expr:"datum"});if(isFieldEqualPredicate(predicate))return _normalizeTimeUnit+"\x3d\x3d\x3d"+predicateValueExpr(predicate.equal,timeUnit);if(isFieldLTPredicate(predicate))return _normalizeTimeUnit+"\x3c"+predicateValueExpr(predicate.lt,timeUnit);if(isFieldGTPredicate(predicate))return _normalizeTimeUnit+
"\x3e"+predicateValueExpr(predicate.gt,timeUnit);if(isFieldLTEPredicate(predicate))return _normalizeTimeUnit+"\x3c\x3d"+predicateValueExpr(predicate.lte,timeUnit);if(isFieldGTEPredicate(predicate))return _normalizeTimeUnit+"\x3e\x3d"+predicateValueExpr(predicate.gte,timeUnit);if(isFieldOneOfPredicate(predicate))return"indexof(["+predicateValuesExpr(predicate.oneOf,timeUnit).join(",")+"], "+_normalizeTimeUnit+") !\x3d\x3d -1";if(predicate&&predicate.field&&void 0!==predicate.valid)return fieldValidPredicate(_normalizeTimeUnit,
predicate.valid);if(isFieldRangePredicate(predicate)){field=predicate.range;predicate=isSignalRef(field)?{signal:field.signal+"[0]"}:field[0];field=isSignalRef(field)?{signal:field.signal+"[1]"}:field[1];if(null!==predicate&&null!==field&&useInRange)return"inrange("+_normalizeTimeUnit+", ["+predicateValueExpr(predicate,timeUnit)+", "+predicateValueExpr(field,timeUnit)+"])";useInRange=[];null!==predicate&&useInRange.push(_normalizeTimeUnit+" \x3e\x3d "+predicateValueExpr(predicate,timeUnit));null!==
field&&useInRange.push(_normalizeTimeUnit+" \x3c\x3d "+predicateValueExpr(field,timeUnit));return 0<useInRange.length?useInRange.join(" \x26\x26 "):"true"}throw Error("Invalid field predicate: "+stringify(predicate));}function fieldValidPredicate(fieldExpr,valid){return void 0===valid||valid?"isValid("+fieldExpr+") \x26\x26 isFinite(+"+fieldExpr+")":"!isValid("+fieldExpr+") || !isFinite(+"+fieldExpr+")"}function normalizePredicate$1(f){if(isFieldPredicate(f)&&f.timeUnit){var _normalizeTimeUnit2;return Object.assign({},
f,{timeUnit:null===(_normalizeTimeUnit2=normalizeTimeUnit(f.timeUnit))||void 0===_normalizeTimeUnit2?void 0:_normalizeTimeUnit2.unit})}return f}function getFullName(type){if(type)switch(type=type.toLowerCase(),type){case "q":case "quantitative":return"quantitative";case "t":case "temporal":return"temporal";case "o":case "ordinal":return"ordinal";case "n":case "nominal":return"nominal";case "geojson":return"geojson"}}function isParameterDomain(domain){return null===domain||void 0===domain?void 0:domain.param}
function scaleTypeSupportProperty(scaleType,propName){switch(propName){case "type":case "domain":case "reverse":case "range":return!0;case "scheme":case "interpolate":return!["point","band","identity"].includes(scaleType);case "bins":return!["point","band","identity","ordinal"].includes(scaleType);case "round":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||"band"===scaleType||"point"===scaleType;case "padding":case "rangeMin":case "rangeMax":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||
["point","band"].includes(scaleType);case "paddingOuter":case "align":return["point","band"].includes(scaleType);case "paddingInner":return"band"===scaleType;case "domainMax":case "domainMid":case "domainMin":case "clamp":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX;case "nice":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||"quantize"===scaleType||"threshold"===scaleType;case "exponent":return"pow"===scaleType;case "base":return"log"===scaleType;case "constant":return"symlog"===scaleType;
case "zero":return scaleType in CONTINUOUS_DOMAIN_INDEX&&!contains(["log","time","utc","threshold","quantile"],scaleType)}}function channelScalePropertyIncompatability(channel,propName){switch(propName){case "interpolate":case "scheme":case "domainMid":if(!isColorChannel(channel))return'Cannot use the scale property "'+channel+'" with non-color channel.'}}function channelSupportScaleType(channel,scaleType){if(!SCALE_CHANNEL_INDEX[channel])return!1;switch(channel){case "x":case "y":case "theta":case "radius":return scaleType in
CONTINUOUS_TO_CONTINUOUS_INDEX||contains(["band","point"],scaleType);case "size":case "strokeWidth":case "opacity":case "fillOpacity":case "strokeOpacity":case "angle":return scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX||scaleType in CONTINUOUS_TO_DISCRETE_INDEX||contains(["band","point","ordinal"],scaleType);case "color":case "fill":case "stroke":return"band"!==scaleType;case "strokeDash":case "shape":return"ordinal"===scaleType||scaleType in CONTINUOUS_TO_DISCRETE_INDEX}}function isPathMark(m){return["line",
"area","trail"].includes(m)}function isMarkDef(mark){return mark.type}function isRelativeBandSize(o){return o&&void 0!=o.band}function midPointRefWithPositionInvalidTest(params){var channel=params.channel,channelDef=params.channelDef,markDef=params.markDef,scale=params.scale,config=params.config;params=midPoint(params);var JSCompiler_temp;if(JSCompiler_temp=isFieldDef(channelDef))JSCompiler_temp=channelDef.aggregate,JSCompiler_temp=!(vegaUtil.isString(JSCompiler_temp)&&COUNTING_OPS.includes(JSCompiler_temp));
return JSCompiler_temp&&scale&&scale.get("type")in CONTINUOUS_TO_CONTINUOUS_INDEX&&!1===scale.get("zero")?wrapPositionInvalidTest({fieldDef:channelDef,channel:channel,markDef:markDef,ref:params,config:config}):params}function wrapPositionInvalidTest($jscomp$destructuring$var126){var fieldDef=$jscomp$destructuring$var126.fieldDef,channel=$jscomp$destructuring$var126.channel,markDef=$jscomp$destructuring$var126.markDef,ref=$jscomp$destructuring$var126.ref;$jscomp$destructuring$var126=$jscomp$destructuring$var126.config;
if(isPathMark(markDef.type)||null===getMarkPropOrConfig("invalid",markDef,$jscomp$destructuring$var126))return ref;fieldDef=fieldInvalidPredicate(fieldDef,!0);channel="y"===getMainRangeChannel(channel)?{field:{group:"height"}}:{value:0};return[Object.assign({},{test:fieldDef},channel),ref]}function fieldInvalidPredicate(field,invalid){invalid=void 0===invalid?!0:invalid;return fieldValidPredicate(vegaUtil.isString(field)?field:vgField(field,{expr:"datum"}),!invalid)}function valueRefForFieldOrDatumDef(fieldDef,
scaleName,opt,encode){var ref={};scaleName&&(ref.scale=scaleName);isDatumDef(fieldDef)?(fieldDef=fieldDef.datum,isDateTime(fieldDef)?ref.signal=dateTimeToExpr(fieldDef):isSignalRef(fieldDef)?ref.signal=fieldDef.signal:isExprRef(fieldDef)?ref.signal=fieldDef.expr:ref.value=fieldDef):ref.field=vgField(fieldDef,opt);encode&&(fieldDef=encode.offset,encode=encode.band,fieldDef&&(ref.offset=fieldDef),encode&&(ref.band=encode));return ref}function interpolatedSignalRef($jscomp$destructuring$var131){var scaleName=
$jscomp$destructuring$var131.scaleName,fieldOrDatumDef=$jscomp$destructuring$var131.fieldOrDatumDef,fieldOrDatumDef2=$jscomp$destructuring$var131.fieldOrDatumDef2,offset=$jscomp$destructuring$var131.offset,bandPosition=void 0===$jscomp$destructuring$var131.bandPosition?.5:$jscomp$destructuring$var131.bandPosition,expr=0<bandPosition&&1>bandPosition?"datum":void 0;$jscomp$destructuring$var131=vgField(fieldOrDatumDef,{expr:expr,suffix:$jscomp$destructuring$var131.startSuffix});fieldOrDatumDef2=void 0!==
fieldOrDatumDef2?vgField(fieldOrDatumDef2,{expr:expr}):vgField(fieldOrDatumDef,{suffix:"end",expr:expr});fieldOrDatumDef={};0===bandPosition||1===bandPosition?(fieldOrDatumDef.scale=scaleName,fieldOrDatumDef.field=0===bandPosition?$jscomp$destructuring$var131:fieldOrDatumDef2):(bandPosition=isSignalRef(bandPosition)?bandPosition.signal+" * "+$jscomp$destructuring$var131+" + (1-"+bandPosition.signal+") * "+fieldOrDatumDef2:bandPosition+" * "+$jscomp$destructuring$var131+" + "+(1-bandPosition)+" * "+
fieldOrDatumDef2,fieldOrDatumDef.signal='scale("'+scaleName+'", '+bandPosition+")");offset&&(fieldOrDatumDef.offset=offset);return fieldOrDatumDef}function midPoint($jscomp$destructuring$var133){var channel=$jscomp$destructuring$var133.channel,channelDef=$jscomp$destructuring$var133.channelDef,channel2Def=$jscomp$destructuring$var133.channel2Def,markDef=$jscomp$destructuring$var133.markDef,config=$jscomp$destructuring$var133.config,scaleName=$jscomp$destructuring$var133.scaleName,scale=$jscomp$destructuring$var133.scale,
stack=$jscomp$destructuring$var133.stack,offset=$jscomp$destructuring$var133.offset,defaultRef=$jscomp$destructuring$var133.defaultRef;$jscomp$destructuring$var133=$jscomp$destructuring$var133.bandPosition;if(channelDef){if(isFieldOrDatumDef(channelDef)){if(isTypedFieldDef(channelDef)){null!=$jscomp$destructuring$var133||($jscomp$destructuring$var133=getBandPosition({fieldDef:channelDef,fieldDef2:channel2Def,markDef:markDef,config:config}));markDef=channelDef.bin;config=channelDef.timeUnit;defaultRef=
channelDef.type;if(isBinning(markDef)||$jscomp$destructuring$var133&&config&&"temporal"===defaultRef)return null!==stack&&void 0!==stack&&stack.impute?valueRefForFieldOrDatumDef(channelDef,scaleName,{binSuffix:"mid"},{offset:offset}):$jscomp$destructuring$var133?interpolatedSignalRef({scaleName:scaleName,fieldOrDatumDef:channelDef,bandPosition:$jscomp$destructuring$var133,offset:offset}):valueRefForFieldOrDatumDef(channelDef,scaleName,binRequiresRange(channelDef,channel)?{binSuffix:"range"}:{},{offset:offset});
if(isBinned(markDef)){if(isFieldDef(channel2Def))return interpolatedSignalRef({scaleName:scaleName,fieldOrDatumDef:channelDef,fieldOrDatumDef2:channel2Def,bandPosition:$jscomp$destructuring$var133,offset:offset});warn(channelRequiredForBinned("x"===channel?"x2":"y2"))}}channel=null===scale||void 0===scale?void 0:scale.get("type");var $jscomp$nullish$tmp4,$jscomp$nullish$tmp5;return valueRefForFieldOrDatumDef(channelDef,scaleName,channel in DISCRETE_DOMAIN_INDEX?{binSuffix:"range"}:{},{offset:offset,
band:"band"===channel?null!=($jscomp$nullish$tmp5=null!=($jscomp$nullish$tmp4=$jscomp$destructuring$var133)?$jscomp$nullish$tmp4:channelDef.bandPosition)?$jscomp$nullish$tmp5:.5:void 0})}if(isValueDef(channelDef))return scaleName=offset?{offset:offset}:{},Object.assign({},widthHeightValueOrSignalRef(channel,channelDef.value),scaleName)}vegaUtil.isFunction(defaultRef)&&(defaultRef=defaultRef());return defaultRef?Object.assign({},defaultRef,offset?{offset:offset}:{}):defaultRef}function widthHeightValueOrSignalRef(channel,
value){return contains(["x","x2"],channel)&&"width"===value?{field:{group:"width"}}:contains(["y","y2"],channel)&&"height"===value?{field:{group:"height"}}:signalOrValueRef(value)}function isCustomFormatType(formatType){return formatType&&"number"!==formatType&&"time"!==formatType}function formatSignalRef($jscomp$destructuring$var136){var fieldOrDatumDef=$jscomp$destructuring$var136.fieldOrDatumDef,format=$jscomp$destructuring$var136.format,formatType=$jscomp$destructuring$var136.formatType,expr=
$jscomp$destructuring$var136.expr,normalizeStack=$jscomp$destructuring$var136.normalizeStack;$jscomp$destructuring$var136=$jscomp$destructuring$var136.config;if(isCustomFormatType(formatType))return formatCustomType({fieldOrDatumDef:fieldOrDatumDef,format:format,formatType:formatType,expr:expr,config:$jscomp$destructuring$var136});normalizeStack=fieldToFormat(fieldOrDatumDef,expr,normalizeStack);if(isFieldOrDatumDefForTimeFormat(fieldOrDatumDef)){var _normalizeTimeUnit,_fieldOrDatumDef$scal;formatType=
isFieldDef(fieldOrDatumDef)?null===(_normalizeTimeUnit=normalizeTimeUnit(fieldOrDatumDef.timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit:void 0;$jscomp$destructuring$var136=$jscomp$destructuring$var136.timeFormat;fieldOrDatumDef=isScaleFieldDef(fieldOrDatumDef)&&(null===(_fieldOrDatumDef$scal=fieldOrDatumDef.scale)||void 0===_fieldOrDatumDef$scal?void 0:_fieldOrDatumDef$scal.type)===ScaleType.UTC;!formatType||format?(format=vegaUtil.isString(format)?format:$jscomp$destructuring$var136,
normalizeStack=(fieldOrDatumDef?"utc":"time")+"Format("+normalizeStack+", '"+format+"')"):formatType?(_fieldOrDatumDef$scal=timeUnitSpecifierExpression(formatType),normalizeStack=(fieldOrDatumDef||formatType.startsWith("utc")?"utc":"time")+"Format("+normalizeStack+", "+_fieldOrDatumDef$scal+")"):normalizeStack=void 0;return normalizeStack?{signal:normalizeStack}:void 0}format=numberFormat(fieldOrDatumDef&&fieldOrDatumDef.type,format,$jscomp$destructuring$var136);return isFieldDef(fieldOrDatumDef)&&
isBinning(fieldOrDatumDef.bin)?(_fieldOrDatumDef$scal=vgField(fieldOrDatumDef,{expr:expr,binSuffix:"end"}),{signal:binFormatExpression(normalizeStack,_fieldOrDatumDef$scal,format,formatType,$jscomp$destructuring$var136)}):format||"quantitative"===(fieldOrDatumDef&&fieldOrDatumDef.type)?{signal:"format("+normalizeStack+', "'+(format||"")+'")'}:{signal:"isValid("+normalizeStack+") ? "+normalizeStack+' : ""+'+normalizeStack}}function fieldToFormat(fieldOrDatumDef,expr,normalizeStack){if(isFieldDef(fieldOrDatumDef))return normalizeStack?
vgField(fieldOrDatumDef,{expr:expr,suffix:"end"})+"-"+vgField(fieldOrDatumDef,{expr:expr,suffix:"start"}):vgField(fieldOrDatumDef,{expr:expr});fieldOrDatumDef=fieldOrDatumDef.datum;fieldOrDatumDef=isDateTime(fieldOrDatumDef)?dateTimeToExpr(fieldOrDatumDef):""+stringify(fieldOrDatumDef);return fieldOrDatumDef}function formatCustomType($jscomp$destructuring$var138){var fieldOrDatumDef=$jscomp$destructuring$var138.fieldOrDatumDef,format=$jscomp$destructuring$var138.format,formatType=$jscomp$destructuring$var138.formatType,
expr=$jscomp$destructuring$var138.expr,normalizeStack=$jscomp$destructuring$var138.normalizeStack,config=$jscomp$destructuring$var138.config;$jscomp$destructuring$var138=$jscomp$destructuring$var138.field;null!=$jscomp$destructuring$var138||($jscomp$destructuring$var138=fieldToFormat(fieldOrDatumDef,expr,normalizeStack));return isFieldDef(fieldOrDatumDef)&&isBinning(fieldOrDatumDef.bin)?(fieldOrDatumDef=vgField(fieldOrDatumDef,{expr:expr,binSuffix:"end"}),{signal:binFormatExpression($jscomp$destructuring$var138,
fieldOrDatumDef,format,formatType,config)}):{signal:formatType+"("+$jscomp$destructuring$var138+(format?", "+stringify(format):"")+")"}}function guideFormat(fieldOrDatumDef,type,format,formatType,config,omitTimeFormatConfig){if(!isCustomFormatType(formatType)){if(isFieldOrDatumDefForTimeFormat(fieldOrDatumDef)){var _normalizeTimeUnit2;fieldOrDatumDef=isFieldDef(fieldOrDatumDef)?null===(_normalizeTimeUnit2=normalizeTimeUnit(fieldOrDatumDef.timeUnit))||void 0===_normalizeTimeUnit2?void 0:_normalizeTimeUnit2.unit:
void 0;format=format?format:fieldOrDatumDef?{signal:timeUnitSpecifierExpression(fieldOrDatumDef)}:omitTimeFormatConfig?void 0:config.timeFormat;return format}return numberFormat(type,format,config)}}function guideFormatType(formatType,fieldOrDatumDef,scaleType){if(formatType&&(isSignalRef(formatType)||"number"===formatType||"time"===formatType))return formatType;if(isFieldOrDatumDefForTimeFormat(fieldOrDatumDef)&&"time"!==scaleType&&"utc"!==scaleType)return"time"}function numberFormat(type,specifiedFormat,
config){if(vegaUtil.isString(specifiedFormat))return specifiedFormat;if("quantitative"===type)return config.numberFormat}function binNumberFormatExpr(field,format,formatType,config){if(isCustomFormatType(formatType))return formatType+"("+field+(format?", "+stringify(format):"")+")";var $jscomp$nullish$tmp7;format=null!=($jscomp$nullish$tmp7=vegaUtil.isString(format)?format:void 0)?$jscomp$nullish$tmp7:config.numberFormat;return"format("+field+', "'+(format||"")+'")'}function binFormatExpression(startField,
endField,format,formatType,config){var start=binNumberFormatExpr(startField,format,formatType,config);endField=binNumberFormatExpr(endField,format,formatType,config);return fieldValidPredicate(startField,!1)+' ? "null" : '+start+' + " â€“ " + '+endField}function isSortField(sort){return!!sort&&("count"===sort.op||!!sort.field)}function isSortArray(sort){return!!sort&&vegaUtil.isArray(sort)}function isFacetMapping(f){return"row"in f||"column"in f}function toFieldDefBase(fieldDef){var timeUnit=fieldDef.timeUnit,
bin=fieldDef.bin,aggregate=fieldDef.aggregate;return Object.assign({},timeUnit?{timeUnit:timeUnit}:{},bin?{bin:bin}:{},aggregate?{aggregate:aggregate}:{},{field:fieldDef.field})}function getBandPosition($jscomp$destructuring$var141){var fieldDef=$jscomp$destructuring$var141.fieldDef,fieldDef2=$jscomp$destructuring$var141.fieldDef2,mark=$jscomp$destructuring$var141.markDef;$jscomp$destructuring$var141=$jscomp$destructuring$var141.config;if(isFieldOrDatumDef(fieldDef)&&void 0!==fieldDef.bandPosition)return fieldDef.bandPosition;
if(isFieldDef(fieldDef)){var bin$766=fieldDef.bin;if(fieldDef.timeUnit&&!fieldDef2)return["rect","bar","image","arc"].includes(mark.type)?0:getMarkConfig("timeUnitBandPosition",mark,$jscomp$destructuring$var141);if(isBinning(bin$766))return.5}}function getBandSize($jscomp$destructuring$var144){var fieldDef=$jscomp$destructuring$var144.fieldDef,fieldDef2=$jscomp$destructuring$var144.fieldDef2,mark=$jscomp$destructuring$var144.markDef,config=$jscomp$destructuring$var144.config,scaleType=$jscomp$destructuring$var144.scaleType,
useVlSizeChannel=$jscomp$destructuring$var144.useVlSizeChannel;$jscomp$destructuring$var144=getSizeChannel$1($jscomp$destructuring$var144.channel);useVlSizeChannel=getMarkPropOrConfig(useVlSizeChannel?"size":$jscomp$destructuring$var144,mark,config,{vgChannel:$jscomp$destructuring$var144});if(void 0!==useVlSizeChannel)return useVlSizeChannel;if(isFieldDef(fieldDef)){useVlSizeChannel=fieldDef.bin;if(fieldDef.timeUnit&&!fieldDef2)return{band:getMarkConfig("timeUnitBandSize",mark,config)};if(isBinning(useVlSizeChannel)&&
!(scaleType in DISCRETE_DOMAIN_INDEX))return{band:1}}if(["rect","bar","image","arc"].includes(mark.type)){var _config$mark$type3;if(scaleType){if(scaleType in DISCRETE_DOMAIN_INDEX){var _config$mark$type;return(null===(_config$mark$type=config[mark.type])||void 0===_config$mark$type?void 0:_config$mark$type.discreteBandSize)||{band:1}}var _config$mark$type2;return null===(_config$mark$type2=config[mark.type])||void 0===_config$mark$type2?void 0:_config$mark$type2.continuousBandSize}return null===
(_config$mark$type3=config[mark.type])||void 0===_config$mark$type3?void 0:_config$mark$type3.discreteBandSize}}function hasBandEnd(fieldDef,fieldDef2,markDef,config){return isBinning(fieldDef.bin)||fieldDef.timeUnit&&isTypedFieldDef(fieldDef)&&"temporal"===fieldDef.type?void 0!==getBandPosition({fieldDef:fieldDef,fieldDef2:fieldDef2,markDef:markDef,config:config}):!1}function isConditionalDef(channelDef){return channelDef&&"condition"in channelDef}function hasConditionalFieldDef(channelDef){channelDef=
channelDef&&channelDef.condition;return!!channelDef&&!vegaUtil.isArray(channelDef)&&isFieldDef(channelDef)}function hasConditionalFieldOrDatumDef(channelDef){channelDef=channelDef&&channelDef.condition;return!!channelDef&&!vegaUtil.isArray(channelDef)&&isFieldOrDatumDef(channelDef)}function isFieldDef(channelDef){return channelDef&&(!!channelDef.field||"count"===channelDef.aggregate)}function isDatumDef(channelDef){return channelDef&&"datum"in channelDef}function isContinuousFieldOrDatumDef(cd){return isTypedFieldDef(cd)&&
!isDiscrete(cd)||isNumericDataDef(cd)}function isNumericDataDef(cd){return isDatumDef(cd)&&vegaUtil.isNumber(cd.datum)}function isFieldOrDatumDef(channelDef){return isFieldDef(channelDef)||isDatumDef(channelDef)}function isTypedFieldDef(channelDef){return channelDef&&("field"in channelDef||"count"===channelDef.aggregate)&&"type"in channelDef}function isValueDef(channelDef){return channelDef&&"value"in channelDef&&"value"in channelDef}function isScaleFieldDef(channelDef){return channelDef&&("scale"in
channelDef||"sort"in channelDef)}function isPositionFieldOrDatumDef(channelDef){return channelDef&&("axis"in channelDef||"stack"in channelDef||"impute"in channelDef)}function isStringFieldOrDatumDef(channelDef){return channelDef&&("format"in channelDef||"formatType"in channelDef)}function toStringFieldDef(fieldDef){return omit(fieldDef,["legend","axis","header","scale"])}function vgField(fieldDef,opt){opt=void 0===opt?{}:opt;var field=fieldDef.field,prefix=opt.prefix,suffix=opt.suffix,argAccessor=
"";if("count"===fieldDef.aggregate)field=internalField("count");else{if(!opt.nofn)if("op"in fieldDef)var fn=fieldDef.op;else{var bin$768=fieldDef.bin,aggregate=fieldDef.aggregate;fieldDef=fieldDef.timeUnit;if(isBinning(bin$768)){fn=binToString(bin$768);var $jscomp$nullish$tmp8,$jscomp$nullish$tmp9;suffix=(null!=($jscomp$nullish$tmp8=opt.binSuffix)?$jscomp$nullish$tmp8:"")+(null!=($jscomp$nullish$tmp9=opt.suffix)?$jscomp$nullish$tmp9:"")}else if(aggregate)isArgmaxDef(aggregate)?(argAccessor='["'+field+
'"]',field="argmax_"+aggregate.argmax):isArgminDef(aggregate)?(argAccessor='["'+field+'"]',field="argmin_"+aggregate.argmin):fn=String(aggregate);else if(fieldDef){fn=timeUnitToString(fieldDef);var $jscomp$nullish$tmp10;suffix=(!["range","mid"].includes(opt.binSuffix)&&opt.binSuffix||"")+(null!=($jscomp$nullish$tmp10=opt.suffix)?$jscomp$nullish$tmp10:"")}}fn&&(field=field?fn+"_"+field:fn)}suffix&&(field=field+"_"+suffix);prefix&&(field=prefix+"_"+field);return opt.forAs?removePathFromField(field):
opt.expr?flatAccessWithDatum(field,opt.expr)+argAccessor:replacePathInField(field)+argAccessor}function isDiscrete(def){switch(def.type){case "nominal":case "ordinal":case "geojson":return!0;case "quantitative":return isFieldDef(def)&&!!def.bin;case "temporal":return!1}throw Error('Invalid field type "'+def.type+'".');}function verbalTitleFormatter(fieldDef,config){var field=fieldDef.field,timeUnit=fieldDef.timeUnit,aggregate=fieldDef.aggregate;if("count"===aggregate)return config.countTitle;if(isBinning(fieldDef.bin))return field+
" (binned)";if(timeUnit){var _normalizeTimeUnit;if(fieldDef=null===(_normalizeTimeUnit=normalizeTimeUnit(timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit)return field+" ("+getTimeUnitParts(fieldDef).join("-")+")"}else if(aggregate)return isArgmaxDef(aggregate)?field+" for max "+aggregate.argmax:isArgminDef(aggregate)?field+" for min "+aggregate.argmin:titleCase(aggregate)+" of "+field;return field}function title$jscomp$0(fieldOrDatumDef,config,$jscomp$destructuring$var150){var allowDisabling=
$jscomp$destructuring$var150.allowDisabling,includeDefault=void 0===$jscomp$destructuring$var150.includeDefault?!0:$jscomp$destructuring$var150.includeDefault,_getGuide;$jscomp$destructuring$var150=null===(_getGuide=getGuide(fieldOrDatumDef))||void 0===_getGuide?void 0:_getGuide.title;if(!isFieldDef(fieldOrDatumDef))return $jscomp$destructuring$var150;config=includeDefault?titleFormatter(fieldOrDatumDef,config):void 0;if(allowDisabling)return getFirstDefined($jscomp$destructuring$var150,fieldOrDatumDef.title,
config);var $jscomp$nullish$tmp12;return null!=($jscomp$nullish$tmp12=null!=$jscomp$destructuring$var150?$jscomp$destructuring$var150:fieldOrDatumDef.title)?$jscomp$nullish$tmp12:config}function getGuide(fieldDef){if(isPositionFieldOrDatumDef(fieldDef)&&fieldDef.axis)return fieldDef.axis;if(fieldDef&&"legend"in fieldDef&&fieldDef.legend)return fieldDef.legend;if(fieldDef&&"header"in fieldDef&&fieldDef.header)return fieldDef.header}function getFormatMixins(fieldDef){if(isStringFieldOrDatumDef(fieldDef))return{format:fieldDef.format,
formatType:fieldDef.formatType};var $jscomp$nullish$tmp13;fieldDef=null!=($jscomp$nullish$tmp13=getGuide(fieldDef))?$jscomp$nullish$tmp13:{};return{format:fieldDef.format,formatType:fieldDef.formatType}}function defaultType$2(fieldDef,channel){var _fieldDef$scale;switch(channel){case "latitude":case "longitude":return"quantitative";case "row":case "column":case "facet":case "shape":case "strokeDash":return"nominal";case "order":return"ordinal"}if("sort"in fieldDef&&vegaUtil.isArray(fieldDef.sort))return"ordinal";
channel=fieldDef.aggregate;if(fieldDef.timeUnit)return"temporal";if(fieldDef.bin||channel&&!isArgmaxDef(channel)&&!isArgminDef(channel))return"quantitative";if(isScaleFieldDef(fieldDef)&&null!==(_fieldDef$scale=fieldDef.scale)&&void 0!==_fieldDef$scale&&_fieldDef$scale.type)switch(SCALE_CATEGORY_INDEX[fieldDef.scale.type]){case "numeric":case "discretizing":return"quantitative";case "time":return"temporal"}return"nominal"}function getFieldDef(channelDef){if(isFieldDef(channelDef))return channelDef;
if(hasConditionalFieldDef(channelDef))return channelDef.condition}function getFieldOrDatumDef(channelDef){if(isFieldOrDatumDef(channelDef))return channelDef;if(hasConditionalFieldOrDatumDef(channelDef))return channelDef.condition}function initChannelDef(channelDef,channel,config,opt){opt=void 0===opt?{}:opt;return vegaUtil.isString(channelDef)||vegaUtil.isNumber(channelDef)||vegaUtil.isBoolean(channelDef)?(config=vegaUtil.isString(channelDef)?"string":vegaUtil.isNumber(channelDef)?"number":"boolean",
warn("Channel "+channel+" is a "+config+". Converted to {value: "+stringify(channelDef)+"}."),{value:channelDef}):isFieldOrDatumDef(channelDef)?initFieldOrDatumDef(channelDef,channel,config,opt):hasConditionalFieldOrDatumDef(channelDef)?Object.assign({},channelDef,{condition:initFieldOrDatumDef(channelDef.condition,channel,config,opt)}):channelDef}function initFieldOrDatumDef(fd,channel,config,opt){if(isStringFieldOrDatumDef(fd)){var $jscomp$destructuring$var156=Object.assign({},fd),formatType=fd.formatType;
$jscomp$destructuring$var156=(delete $jscomp$destructuring$var156.format,delete $jscomp$destructuring$var156.formatType,$jscomp$destructuring$var156);if(isCustomFormatType(formatType)&&!config.customFormatTypes)return warn(customFormatTypeNotAllowed(channel)),initFieldOrDatumDef($jscomp$destructuring$var156,channel,config,opt)}else if((formatType=isPositionFieldOrDatumDef(fd)?"axis":fd&&"legend"in fd?"legend":fd&&"header"in fd?"header":null)&&fd[formatType]){var $jscomp$destructuring$var157=fd[formatType];
$jscomp$destructuring$var156=Object.assign({},$jscomp$destructuring$var157);$jscomp$destructuring$var157=$jscomp$destructuring$var157.formatType;$jscomp$destructuring$var156=(delete $jscomp$destructuring$var156.format,delete $jscomp$destructuring$var156.formatType,$jscomp$destructuring$var156);if(isCustomFormatType($jscomp$destructuring$var157)&&!config.customFormatTypes)return warn(customFormatTypeNotAllowed(channel)),$jscomp$destructuring$var157={},initFieldOrDatumDef(Object.assign({},fd,($jscomp$destructuring$var157[formatType]=
$jscomp$destructuring$var156,$jscomp$destructuring$var157)),channel,config,opt)}if(isFieldDef(fd))return initFieldDef(fd,channel,opt);channel=fd.type;channel||(channel=fd.datum,channel=vegaUtil.isNumber(channel)?"quantitative":vegaUtil.isString(channel)?"nominal":isDateTime(channel)?"temporal":void 0,fd=Object.assign({},fd,{type:channel}));return fd}function initFieldDef(fd,channel,$jscomp$destructuring$var160){$jscomp$destructuring$var160=void 0===$jscomp$destructuring$var160?{}:$jscomp$destructuring$var160;
var compositeMark=void 0===$jscomp$destructuring$var160.compositeMark?!1:$jscomp$destructuring$var160.compositeMark;$jscomp$destructuring$var160=fd.aggregate;var timeUnit=fd.timeUnit,bin=fd.bin,field=fd.field;fd=Object.assign({},fd);compositeMark||!$jscomp$destructuring$var160||isAggregateOp($jscomp$destructuring$var160)||isArgmaxDef($jscomp$destructuring$var160)||isArgminDef($jscomp$destructuring$var160)||(warn('Invalid aggregation operator "'+$jscomp$destructuring$var160+'".'),delete fd.aggregate);
timeUnit&&(fd.timeUnit=normalizeTimeUnit(timeUnit));field&&(fd.field=""+field);isBinning(bin)&&(fd.bin=normalizeBin(bin,channel));!isBinned(bin)||channel in POSITION_SCALE_CHANNEL_INDEX||warn("Channel "+channel+' should not be used with "binned" bin.');isTypedFieldDef(fd)?(compositeMark=fd.type,timeUnit=getFullName(compositeMark),compositeMark!==timeUnit&&(fd.type=timeUnit),"quantitative"!==compositeMark&&vegaUtil.isString($jscomp$destructuring$var160)&&COUNTING_OPS.includes($jscomp$destructuring$var160)&&
(warn('Invalid field type "'+compositeMark+'" for aggregate: "'+$jscomp$destructuring$var160+'", using "quantitative" instead.'),fd.type="quantitative")):isSecondaryRangeChannel(channel)||($jscomp$destructuring$var160=defaultType$2(fd,channel),fd.type=$jscomp$destructuring$var160);isTypedFieldDef(fd)&&(channel=channelCompatibility(fd,channel)||{},$jscomp$destructuring$var160=channel.warning,!1===channel.compatible&&warn($jscomp$destructuring$var160));if("sort"in fd&&vegaUtil.isString(fd.sort)){channel=
fd.sort;if(channel in SORT_BY_CHANNEL_INDEX)return Object.assign({},fd,{sort:{encoding:channel}});$jscomp$destructuring$var160=channel.substr(1);if("-"===channel.charAt(0)&&$jscomp$destructuring$var160 in SORT_BY_CHANNEL_INDEX)return Object.assign({},fd,{sort:{encoding:$jscomp$destructuring$var160,order:"descending"}})}return fd&&"header"in fd&&(channel=fd.header)&&(compositeMark=Object.assign({},channel),$jscomp$destructuring$var160=channel.orient,compositeMark=(delete compositeMark.orient,compositeMark),
$jscomp$destructuring$var160)?Object.assign({},fd,{header:Object.assign({},compositeMark,{labelOrient:channel.labelOrient||$jscomp$destructuring$var160,titleOrient:channel.titleOrient||$jscomp$destructuring$var160})}):fd}function normalizeBin(bin,channel){return vegaUtil.isBoolean(bin)?{maxbins:autoMaxBins(channel)}:"binned"===bin?{binned:!0}:bin.maxbins||bin.step?bin:Object.assign({},bin,{maxbins:autoMaxBins(channel)})}function channelCompatibility(fieldDef,channel){var type=fieldDef.type;if("geojson"===
type&&"shape"!==channel)return{compatible:!1,warning:"Channel "+channel+" should not be used with a geojson data."};switch(channel){case "row":case "column":case "facet":return isDiscrete(fieldDef)?COMPATIBLE:{compatible:!1,warning:channel+" encoding should be discrete (ordinal / nominal / binned)."};case "x":case "y":case "color":case "fill":case "stroke":case "text":case "detail":case "key":case "tooltip":case "href":case "url":case "angle":case "theta":case "radius":case "description":return COMPATIBLE;
case "longitude":case "longitude2":case "latitude":case "latitude2":return"quantitative"!==type?{compatible:!1,warning:"Channel "+channel+" should be used with a quantitative field only, not "+fieldDef.type+" field."}:COMPATIBLE;case "opacity":case "fillOpacity":case "strokeOpacity":case "strokeWidth":case "size":case "theta2":case "radius2":case "x2":case "y2":return"nominal"!==type||fieldDef.sort?COMPATIBLE:{compatible:!1,warning:"Channel "+channel+" should not be used with an unsorted discrete field."};
case "shape":case "strokeDash":if(type=!isDiscrete(fieldDef)){var _def$scale;type=!(isScaleFieldDef(fieldDef)&&(null===(_def$scale=fieldDef.scale)||void 0===_def$scale?void 0:_def$scale.type)in CONTINUOUS_TO_DISCRETE_INDEX)}return type?{compatible:!1,warning:channel+" encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold)."}:COMPATIBLE;case "order":return"nominal"!==fieldDef.type||"sort"in fieldDef?COMPATIBLE:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}
function isFieldOrDatumDefForTimeFormat(fieldOrDatumDef){var formatType=getFormatMixins(fieldOrDatumDef).formatType,JSCompiler_temp;if(!(JSCompiler_temp="time"===formatType)){if(formatType=!formatType)formatType=fieldOrDatumDef&&("temporal"===fieldOrDatumDef.type||isFieldDef(fieldOrDatumDef)&&!!fieldOrDatumDef.timeUnit);JSCompiler_temp=formatType}return JSCompiler_temp}function valueExpr(v,$jscomp$destructuring$var170){var timeUnit=$jscomp$destructuring$var170.timeUnit,type=$jscomp$destructuring$var170.type,
wrapTime=$jscomp$destructuring$var170.wrapTime;$jscomp$destructuring$var170=$jscomp$destructuring$var170.undefinedIfExprNotRequired;var _normalizeTimeUnit2;type=(timeUnit=timeUnit&&(null===(_normalizeTimeUnit2=normalizeTimeUnit(timeUnit))||void 0===_normalizeTimeUnit2?void 0:_normalizeTimeUnit2.unit))||"temporal"===type;if(isExprRef(v))var expr=v.expr;else isSignalRef(v)?expr=v.signal:isDateTime(v)?(type=!0,expr=dateTimeToExpr(v)):(vegaUtil.isString(v)||vegaUtil.isNumber(v))&&type&&(expr="datetime("+
stringify(v)+")",LOCAL_SINGLE_TIMEUNIT_INDEX[timeUnit]&&(vegaUtil.isNumber(v)&&1E4>v||vegaUtil.isString(v)&&isNaN(Date.parse(v)))&&(expr={},expr=dateTimeToExpr((expr[timeUnit]=v,expr))));return expr?wrapTime&&type?"time("+expr+")":expr:$jscomp$destructuring$var170?void 0:stringify(v)}function valueArray(fieldOrDatumDef,values){var type=fieldOrDatumDef.type;return values.map(function(v){var expr=valueExpr(v,{timeUnit:isFieldDef(fieldOrDatumDef)?fieldOrDatumDef.timeUnit:void 0,type:type,undefinedIfExprNotRequired:!0});
return void 0!==expr?{signal:expr}:v})}function binRequiresRange(fieldDef,channel){return isBinning(fieldDef.bin)?!!SCALE_CHANNEL_INDEX[channel]&&["ordinal","nominal"].includes(fieldDef.type):(console.warn("Only call this method for binned field defs."),!1)}function isConditionalAxisValue(v){return v&&v.condition}function isUnitSpec(spec){return"mark"in spec}function channelHasField(encoding,channel){return(encoding=encoding&&encoding[channel])?vegaUtil.isArray(encoding)?some(encoding,function(fieldDef){return!!fieldDef.field}):
isFieldDef(encoding)||hasConditionalFieldDef(encoding):!1}function isAggregate$1(encoding){return some(CHANNELS,function(channel){return channelHasField(encoding,channel)?(channel=encoding[channel],vegaUtil.isArray(channel)?some(channel,function(fieldDef){return!!fieldDef.aggregate}):(channel=getFieldDef(channel))&&!!channel.aggregate):!1})}function extractTransformsFromEncoding(oldEncoding,config){var groupby=[],bins=[],timeUnits=[],aggregate=[],encoding={};forEach(oldEncoding,function(channelDef,
channel){if(isFieldDef(channelDef)){var $jscomp$destructuring$var174=Object.assign({},channelDef),field=channelDef.field,aggOp=channelDef.aggregate,bin$775=channelDef.bin,timeUnit=channelDef.timeUnit;$jscomp$destructuring$var174=(delete $jscomp$destructuring$var174.field,delete $jscomp$destructuring$var174.aggregate,delete $jscomp$destructuring$var174.bin,delete $jscomp$destructuring$var174.timeUnit,$jscomp$destructuring$var174);if(aggOp||timeUnit||bin$775){var guide=getGuide(channelDef),isTitleDefined=
null===guide||void 0===guide?void 0:guide.title;guide=vgField(channelDef,{forAs:!0});$jscomp$destructuring$var174=Object.assign({},isTitleDefined?[]:{title:title$jscomp$0(channelDef,config,{allowDisabling:!0})},$jscomp$destructuring$var174,{field:guide});if(aggOp){if(isArgmaxDef(aggOp)){var op="argmax";guide=vgField({op:"argmax",field:aggOp.argmax},{forAs:!0});$jscomp$destructuring$var174.field=guide+"."+field}else isArgminDef(aggOp)?(op="argmin",guide=vgField({op:"argmin",field:aggOp.argmin},{forAs:!0}),
$jscomp$destructuring$var174.field=guide+"."+field):"boxplot"!==aggOp&&"errorbar"!==aggOp&&"errorband"!==aggOp&&(op=aggOp);op&&(channelDef={op:op,as:guide},field&&(channelDef.field=field),aggregate.push(channelDef))}else groupby.push(guide),isTypedFieldDef(channelDef)&&isBinning(bin$775)?(bins.push({bin:bin$775,field:field,as:guide}),groupby.push(vgField(channelDef,{binSuffix:"end"})),binRequiresRange(channelDef,channel)&&groupby.push(vgField(channelDef,{binSuffix:"range"})),channel in POSITION_SCALE_CHANNEL_INDEX&&
(encoding[channel+"2"]={field:guide+"_end"}),$jscomp$destructuring$var174.bin="binned",isSecondaryRangeChannel(channel)||($jscomp$destructuring$var174.type="quantitative")):timeUnit&&(timeUnits.push({timeUnit:timeUnit,field:field,as:guide}),(field=isTypedFieldDef(channelDef)&&"temporal"!==channelDef.type&&"time")&&("text"===channel||"tooltip"===channel?$jscomp$destructuring$var174.formatType=field:NONPOSITION_CHANNEL_INDEX[channel]?$jscomp$destructuring$var174.legend=Object.assign({},{formatType:field},
$jscomp$destructuring$var174.legend):channel in POSITION_SCALE_CHANNEL_INDEX&&($jscomp$destructuring$var174.axis=Object.assign({},{formatType:field},$jscomp$destructuring$var174.axis))));encoding[channel]=$jscomp$destructuring$var174}else groupby.push(field),encoding[channel]=oldEncoding[channel]}else encoding[channel]=oldEncoding[channel]});return{bins:bins,timeUnits:timeUnits,aggregate:aggregate,groupby:groupby,encoding:encoding}}function markChannelCompatible(encoding,channel,mark){mark=getSupportedMark(channel)[mark];
return mark&&("binned"!==mark||(mark=encoding["x2"===channel?"x":"y"],isFieldDef(mark)&&isFieldDef(encoding[channel])&&isBinned(mark.bin)))?!0:!1}function initEncoding(encoding,mark,filled,config){return keys$jscomp$0(encoding).reduce(function(normalizedEncoding,channel){if(!CHANNEL_INDEX[channel])return warn(channel+"-encoding is dropped as "+channel+" is not a valid encoding channel."),normalizedEncoding;var channelDef=encoding[channel];"angle"!==channel||"arc"!==mark||encoding.theta||(warn("Arc marks uses theta channel rather than angle, replacing angle with theta."),
channel="theta");if(!markChannelCompatible(encoding,channel,mark))return warn(incompatibleChannel(channel,mark)),normalizedEncoding;if("size"===channel&&"line"===mark){var fieldDef$jscomp$0=getFieldDef(encoding[channel]);if(null!==fieldDef$jscomp$0&&void 0!==fieldDef$jscomp$0&&fieldDef$jscomp$0.aggregate)return warn("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),normalizedEncoding}if("color"===channel&&(filled?"fill"in encoding:"stroke"in encoding))return warn(droppingColor("encoding",
{fill:"fill"in encoding,stroke:"stroke"in encoding})),normalizedEncoding;if("detail"===channel||"order"===channel&&!vegaUtil.isArray(channelDef)&&!isValueDef(channelDef)||"tooltip"===channel&&vegaUtil.isArray(channelDef))channelDef&&(normalizedEncoding[channel]=vegaUtil.array(channelDef).reduce(function(defs,fieldDef){isFieldDef(fieldDef)?defs.push(initFieldDef(fieldDef,channel)):warn(emptyFieldDef(fieldDef,channel));return defs},[]));else{if("tooltip"===channel&&null===channelDef)normalizedEncoding[channel]=
null;else if(!(isFieldDef(channelDef)||isDatumDef(channelDef)||isValueDef(channelDef)||isConditionalDef(channelDef)||isSignalRef(channelDef)))return warn(emptyFieldDef(channelDef,channel)),normalizedEncoding;normalizedEncoding[channel]=initChannelDef(channelDef,channel,config)}return normalizedEncoding},{})}function normalizeEncoding(encoding,config){for(var normalizedEncoding={},$jscomp$iter$346=$jscomp.makeIterator(keys$jscomp$0(encoding)),$jscomp$key$channel=$jscomp$iter$346.next();!$jscomp$key$channel.done;$jscomp$key$channel=
$jscomp$iter$346.next()){$jscomp$key$channel=$jscomp$key$channel.value;var newChannelDef=initChannelDef(encoding[$jscomp$key$channel],$jscomp$key$channel,config,{compositeMark:!0});normalizedEncoding[$jscomp$key$channel]=newChannelDef}return normalizedEncoding}function fieldDefs(encoding){for(var arr=[],$jscomp$iter$348=$jscomp.makeIterator(keys$jscomp$0(encoding)),$jscomp$key$channel=$jscomp$iter$348.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$348.next())if($jscomp$key$channel=
$jscomp$key$channel.value,channelHasField(encoding,$jscomp$key$channel)){$jscomp$key$channel=vegaUtil.array(encoding[$jscomp$key$channel]);$jscomp$key$channel=$jscomp.makeIterator($jscomp$key$channel);for(var $jscomp$key$def=$jscomp$key$channel.next();!$jscomp$key$def.done;$jscomp$key$def=$jscomp$key$channel.next())$jscomp$key$def=$jscomp$key$def.value,isFieldDef($jscomp$key$def)?arr.push($jscomp$key$def):hasConditionalFieldDef($jscomp$key$def)&&arr.push($jscomp$key$def.condition)}return arr}function forEach(mapping,
f,thisArg){if(mapping)for(var $jscomp$iter$350=$jscomp.makeIterator(keys$jscomp$0(mapping)),$jscomp$key$channel=$jscomp$iter$350.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$350.next()){$jscomp$key$channel=$jscomp$key$channel.value;var el=mapping[$jscomp$key$channel];if(vegaUtil.isArray(el)){el=$jscomp.makeIterator(el);for(var $jscomp$key$channelDef=el.next();!$jscomp$key$channelDef.done;$jscomp$key$channelDef=el.next())f.call(thisArg,$jscomp$key$channelDef.value,$jscomp$key$channel)}else f.call(thisArg,
el,$jscomp$key$channel)}}function reduce(mapping,f,init,thisArg){return mapping?keys$jscomp$0(mapping).reduce(function(r,channel){var map=mapping[channel];return vegaUtil.isArray(map)?map.reduce(function(r1,channelDef){return f.call(thisArg,r1,channelDef,channel)},r):f.call(thisArg,r,map,channel)},init):init}function pathGroupingFields(mark,encoding){return keys$jscomp$0(encoding).reduce(function(details,channel){switch(channel){case "x":case "y":case "href":case "description":case "url":case "x2":case "y2":case "theta":case "theta2":case "radius":case "radius2":case "latitude":case "longitude":case "latitude2":case "longitude2":case "text":case "shape":case "angle":case "tooltip":return details;
case "order":if("line"===mark||"trail"===mark)return details;case "detail":case "key":channel=encoding[channel];if(vegaUtil.isArray(channel)||isFieldDef(channel)){channel=$jscomp.makeIterator(vegaUtil.array(channel));for(var $jscomp$key$fieldDef=channel.next();!$jscomp$key$fieldDef.done;$jscomp$key$fieldDef=channel.next())$jscomp$key$fieldDef=$jscomp$key$fieldDef.value,$jscomp$key$fieldDef.aggregate||details.push(vgField($jscomp$key$fieldDef,{}))}return details;case "size":if("trail"===mark)return details;
case "color":case "fill":case "stroke":case "opacity":case "fillOpacity":case "strokeOpacity":case "strokeDash":case "strokeWidth":return(channel=getFieldDef(encoding[channel]))&&!channel.aggregate&&details.push(vgField(channel,{})),details}},[])}function getCompositeMarkTooltip(tooltipSummary,continuousAxisChannelDef,encodingWithoutContinuousAxis,withFieldName){withFieldName=void 0===withFieldName?!0:withFieldName;if("tooltip"in encodingWithoutContinuousAxis)return{tooltip:encodingWithoutContinuousAxis.tooltip};
tooltipSummary=tooltipSummary.map(function($jscomp$destructuring$var177){var fieldPrefix=$jscomp$destructuring$var177.fieldPrefix;$jscomp$destructuring$var177=$jscomp$destructuring$var177.titlePrefix;var mainTitle=withFieldName?" of "+getFirstDefined(continuousAxisChannelDef.title,continuousAxisChannelDef.field):"";return{field:fieldPrefix+continuousAxisChannelDef.field,type:continuousAxisChannelDef.type,title:isSignalRef($jscomp$destructuring$var177)?{signal:$jscomp$destructuring$var177+'"'+escape(mainTitle)+
'"'}:$jscomp$destructuring$var177+mainTitle}});encodingWithoutContinuousAxis=fieldDefs(encodingWithoutContinuousAxis).map(toStringFieldDef);return{tooltip:[].concat($jscomp.arrayFromIterable(tooltipSummary),$jscomp.arrayFromIterable(unique(encodingWithoutContinuousAxis,hash)))}}function makeCompositeAggregatePartFactory(compositeMarkDef,continuousAxis,continuousAxisChannelDef,sharedEncoding,compositeMarkConfig){var scale=continuousAxisChannelDef.scale,axis=continuousAxisChannelDef.axis;return function($jscomp$destructuring$var181){var partName=
$jscomp$destructuring$var181.partName,mark=$jscomp$destructuring$var181.mark,positionPrefix=$jscomp$destructuring$var181.positionPrefix,endPositionPrefix=void 0===$jscomp$destructuring$var181.endPositionPrefix?void 0:$jscomp$destructuring$var181.endPositionPrefix;$jscomp$destructuring$var181=void 0===$jscomp$destructuring$var181.extraEncoding?{}:$jscomp$destructuring$var181.extraEncoding;var title=getFirstDefined(continuousAxisChannelDef.title,continuousAxisChannelDef.field),$jscomp$compprop218={},
$jscomp$compprop219={};return partLayerMixins(compositeMarkDef,partName,compositeMarkConfig,{mark:mark,encoding:Object.assign({},($jscomp$compprop218[continuousAxis]=Object.assign({},{field:positionPrefix+"_"+continuousAxisChannelDef.field,type:continuousAxisChannelDef.type},void 0!==title?{title:title}:{},void 0!==scale?{scale:scale}:{},void 0!==axis?{axis:axis}:{}),$jscomp$compprop218),vegaUtil.isString(endPositionPrefix)?($jscomp$compprop219[continuousAxis+"2"]={field:endPositionPrefix+"_"+continuousAxisChannelDef.field},
$jscomp$compprop219):{},sharedEncoding,$jscomp$destructuring$var181)})}}function partLayerMixins(markDef,part,compositeMarkConfig,partBaseSpec){var clip=markDef.clip,color=markDef.color,opacity=markDef.opacity,mark=markDef.type;return markDef[part]||void 0===markDef[part]&&compositeMarkConfig[part]?[Object.assign({},partBaseSpec,{mark:Object.assign({},compositeMarkConfig[part],clip?{clip:clip}:{},color?{color:color}:{},opacity?{opacity:opacity}:{},isMarkDef(partBaseSpec.mark)?partBaseSpec.mark:{type:partBaseSpec.mark},
{style:mark+"-"+part},vegaUtil.isBoolean(markDef[part])?{}:markDef[part])})]:[]}function compositeMarkContinuousAxis(spec,orient,compositeMark){spec=spec.encoding;orient="vertical"===orient?"y":"x";var continuousAxisChannelDef2=spec[orient+"2"],continuousAxisChannelDefError=spec[orient+"Error"],continuousAxisChannelDefError2=spec[orient+"Error2"];return{continuousAxisChannelDef:filterAggregateFromChannelDef(spec[orient],compositeMark),continuousAxisChannelDef2:filterAggregateFromChannelDef(continuousAxisChannelDef2,
compositeMark),continuousAxisChannelDefError:filterAggregateFromChannelDef(continuousAxisChannelDefError,compositeMark),continuousAxisChannelDefError2:filterAggregateFromChannelDef(continuousAxisChannelDefError2,compositeMark),continuousAxis:orient}}function filterAggregateFromChannelDef(continuousAxisChannelDef,compositeMark){if(null!==continuousAxisChannelDef&&void 0!==continuousAxisChannelDef&&continuousAxisChannelDef.aggregate){var $jscomp$destructuring$var186=Object.assign({},continuousAxisChannelDef);
continuousAxisChannelDef=continuousAxisChannelDef.aggregate;$jscomp$destructuring$var186=(delete $jscomp$destructuring$var186.aggregate,$jscomp$destructuring$var186);continuousAxisChannelDef!==compositeMark&&warn("Continuous axis should not have customized aggregation function "+continuousAxisChannelDef+"; "+compositeMark+" already agregates the axis.");return $jscomp$destructuring$var186}return continuousAxisChannelDef}function compositeMarkOrient(spec,compositeMark){var mark=spec.mark,$jscomp$destructuring$var188=
spec.encoding;spec=$jscomp$destructuring$var188.x;$jscomp$destructuring$var188=$jscomp$destructuring$var188.y;if(isMarkDef(mark)&&mark.orient)return mark.orient;if(isContinuousFieldOrDatumDef(spec)){if(isContinuousFieldOrDatumDef($jscomp$destructuring$var188)){mark=isFieldDef(spec)&&spec.aggregate;var yAggregate=isFieldDef($jscomp$destructuring$var188)&&$jscomp$destructuring$var188.aggregate;if(!mark&&yAggregate===compositeMark)return"vertical";if(yAggregate||mark!==compositeMark){if(mark===compositeMark&&
yAggregate===compositeMark)throw Error("Both x and y cannot have aggregate");return isFieldOrDatumDefForTimeFormat($jscomp$destructuring$var188)&&!isFieldOrDatumDefForTimeFormat(spec)?"horizontal":"vertical"}}return"horizontal"}if(isContinuousFieldOrDatumDef($jscomp$destructuring$var188))return"vertical";throw Error("Need a valid continuous axis for "+compositeMark+"s");}function normalizeBoxPlot(spec$jscomp$0,$jscomp$destructuring$var189){var config=$jscomp$destructuring$var189.config,$jscomp$destructuring$var191=
spec$jscomp$0=Object.assign({},spec$jscomp$0,{encoding:normalizeEncoding(spec$jscomp$0.encoding,config)});$jscomp$destructuring$var189=Object.assign({},$jscomp$destructuring$var191);var mark=$jscomp$destructuring$var191.mark;$jscomp$destructuring$var191=$jscomp$destructuring$var191.params;$jscomp$destructuring$var189=(delete $jscomp$destructuring$var189.mark,delete $jscomp$destructuring$var189.encoding,delete $jscomp$destructuring$var189.params,delete $jscomp$destructuring$var189.projection,$jscomp$destructuring$var189);
mark=isMarkDef(mark)?mark:{type:mark};$jscomp$destructuring$var191&&warn(selectionNotSupported("boxplot"));var $jscomp$nullish$tmp14;$jscomp$destructuring$var191=null!=($jscomp$nullish$tmp14=mark.extent)?$jscomp$nullish$tmp14:config.boxplot.extent;var sizeValue=getMarkPropOrConfig("size",mark,config),boxPlotType=vegaUtil.isNumber($jscomp$destructuring$var191)?"tukey":$jscomp$destructuring$var191,spec=spec$jscomp$0,orient=compositeMarkOrient(spec,"boxplot");$jscomp$nullish$tmp14=compositeMarkContinuousAxis(spec,
orient,"boxplot");spec$jscomp$0=$jscomp$nullish$tmp14.continuousAxisChannelDef;$jscomp$nullish$tmp14=$jscomp$nullish$tmp14.continuousAxis;var continuousFieldName=spec$jscomp$0.field,boxPlotType$jscomp$0=vegaUtil.isNumber($jscomp$destructuring$var191)?"tukey":$jscomp$destructuring$var191,boxplotSpecificAggregate=[].concat($jscomp.arrayFromIterable(boxParamsQuartiles(continuousFieldName)),[{op:"median",field:continuousFieldName,as:"mid_box_"+continuousFieldName},{op:"min",field:continuousFieldName,
as:("min-max"===boxPlotType$jscomp$0?"lower_whisker_":"min_")+continuousFieldName},{op:"max",field:continuousFieldName,as:("min-max"===boxPlotType$jscomp$0?"upper_whisker_":"max_")+continuousFieldName}]);continuousFieldName="min-max"===boxPlotType$jscomp$0||"tukey"===boxPlotType$jscomp$0?[]:[{calculate:'datum["upper_box_'+continuousFieldName+'"] - datum["lower_box_'+continuousFieldName+'"]',as:"iqr_"+continuousFieldName},{calculate:'min(datum["upper_box_'+continuousFieldName+'"] + datum["iqr_'+continuousFieldName+
'"] * '+$jscomp$destructuring$var191+', datum["max_'+continuousFieldName+'"])',as:"upper_whisker_"+continuousFieldName},{calculate:'max(datum["lower_box_'+continuousFieldName+'"] - datum["iqr_'+continuousFieldName+'"] * '+$jscomp$destructuring$var191+', datum["min_'+continuousFieldName+'"])',as:"lower_whisker_"+continuousFieldName}];spec=Object.assign({},spec.encoding);var JSCompiler_inline_result;boxPlotType$jscomp$0=(delete spec[$jscomp$nullish$tmp14],spec);spec=Object.assign({},boxPlotType$jscomp$0);
boxPlotType$jscomp$0=boxPlotType$jscomp$0.tooltip;spec=(delete spec.tooltip,spec);if(boxPlotType$jscomp$0){var customTooltipWithoutAggregatedField;if(vegaUtil.isArray(boxPlotType$jscomp$0)){boxPlotType$jscomp$0=$jscomp.makeIterator(boxPlotType$jscomp$0);for(var $jscomp$inline_5721=boxPlotType$jscomp$0.next();!$jscomp$inline_5721.done;$jscomp$inline_5721=boxPlotType$jscomp$0.next())$jscomp$inline_5721=$jscomp$inline_5721.value,$jscomp$inline_5721.aggregate?(JSCompiler_inline_result||(JSCompiler_inline_result=
[]),JSCompiler_inline_result.push($jscomp$inline_5721)):(customTooltipWithoutAggregatedField||(customTooltipWithoutAggregatedField=[]),customTooltipWithoutAggregatedField.push($jscomp$inline_5721));JSCompiler_inline_result&&(spec.tooltip=JSCompiler_inline_result)}else boxPlotType$jscomp$0.aggregate?spec.tooltip=boxPlotType$jscomp$0:customTooltipWithoutAggregatedField=boxPlotType$jscomp$0;vegaUtil.isArray(customTooltipWithoutAggregatedField)&&1===customTooltipWithoutAggregatedField.length&&(customTooltipWithoutAggregatedField=
customTooltipWithoutAggregatedField[0]);JSCompiler_inline_result={customTooltipWithoutAggregatedField:customTooltipWithoutAggregatedField,filteredEncoding:spec}}else JSCompiler_inline_result={filteredEncoding:spec};customTooltipWithoutAggregatedField=JSCompiler_inline_result;JSCompiler_inline_result=customTooltipWithoutAggregatedField.customTooltipWithoutAggregatedField;var $jscomp$inline_5725=extractTransformsFromEncoding(customTooltipWithoutAggregatedField.filteredEncoding,config);customTooltipWithoutAggregatedField=
$jscomp$inline_5725.bins;spec=$jscomp$inline_5725.timeUnits;boxPlotType$jscomp$0=$jscomp$inline_5725.aggregate;$jscomp$inline_5721=$jscomp$inline_5725.groupby;var encodingWithoutContinuousAxis=$jscomp$inline_5725.encoding,ticksOrient="vertical"===orient?"horizontal":"vertical";boxplotSpecificAggregate=[].concat($jscomp.arrayFromIterable(customTooltipWithoutAggregatedField),$jscomp.arrayFromIterable(spec),[{aggregate:[].concat($jscomp.arrayFromIterable(boxPlotType$jscomp$0),$jscomp.arrayFromIterable(boxplotSpecificAggregate)),
groupby:$jscomp$inline_5721}],$jscomp.arrayFromIterable(continuousFieldName));$jscomp$inline_5725=Object.assign({},encodingWithoutContinuousAxis);continuousFieldName=encodingWithoutContinuousAxis.color;var size=encodingWithoutContinuousAxis.size;$jscomp$inline_5725=(delete $jscomp$inline_5725.color,delete $jscomp$inline_5725.size,$jscomp$inline_5725);var makeBoxPlotExtent=makeCompositeAggregatePartFactory(mark,$jscomp$nullish$tmp14,spec$jscomp$0,$jscomp$inline_5725,config.boxplot),makeBoxPlotBox=
makeCompositeAggregatePartFactory(mark,$jscomp$nullish$tmp14,spec$jscomp$0,encodingWithoutContinuousAxis,config.boxplot);size=makeCompositeAggregatePartFactory(mark,$jscomp$nullish$tmp14,spec$jscomp$0,Object.assign({},$jscomp$inline_5725,size?{size:size}:{}),config.boxplot);var fiveSummaryTooltipEncoding=getCompositeMarkTooltip([{fieldPrefix:"min-max"===boxPlotType?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},
{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===boxPlotType?"lower_whisker_":"min_",titlePrefix:"Min"}],spec$jscomp$0,encodingWithoutContinuousAxis),endTick={type:"tick",color:"black",opacity:1,orient:ticksOrient,invalid:null,aria:!1};encodingWithoutContinuousAxis="min-max"===boxPlotType?fiveSummaryTooltipEncoding:getCompositeMarkTooltip([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],spec$jscomp$0,encodingWithoutContinuousAxis);
encodingWithoutContinuousAxis=[].concat($jscomp.arrayFromIterable(makeBoxPlotExtent({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:encodingWithoutContinuousAxis})),$jscomp.arrayFromIterable(makeBoxPlotExtent({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:encodingWithoutContinuousAxis})),$jscomp.arrayFromIterable(makeBoxPlotExtent({partName:"ticks",
mark:endTick,positionPrefix:"lower_whisker",extraEncoding:encodingWithoutContinuousAxis})),$jscomp.arrayFromIterable(makeBoxPlotExtent({partName:"ticks",mark:endTick,positionPrefix:"upper_whisker",extraEncoding:encodingWithoutContinuousAxis})));sizeValue=[].concat($jscomp.arrayFromIterable("tukey"!==boxPlotType?encodingWithoutContinuousAxis:[]),$jscomp.arrayFromIterable(makeBoxPlotBox({partName:"box",mark:Object.assign({},{type:"bar"},sizeValue?{size:sizeValue}:{},{orient:orient,invalid:null,ariaRoleDescription:"box"}),
positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:fiveSummaryTooltipEncoding})),$jscomp.arrayFromIterable(size({partName:"median",mark:Object.assign({},{type:"tick",invalid:null},vegaUtil.isObject(config.boxplot.median)&&config.boxplot.median.color?{color:config.boxplot.median.color}:{},sizeValue?{size:sizeValue}:{},{orient:ticksOrient,aria:!1}),positionPrefix:"mid_box",extraEncoding:fiveSummaryTooltipEncoding})));if("min-max"===boxPlotType){var $jscomp$nullish$tmp15;return Object.assign({},
$jscomp$destructuring$var189,{transform:(null!=($jscomp$nullish$tmp15=$jscomp$destructuring$var189.transform)?$jscomp$nullish$tmp15:[]).concat(boxplotSpecificAggregate),layer:sizeValue})}$jscomp$nullish$tmp15='datum["lower_box_'+spec$jscomp$0.field+'"]';boxPlotType='datum["upper_box_'+spec$jscomp$0.field+'"]';orient="("+boxPlotType+" - "+$jscomp$nullish$tmp15+")";$jscomp$nullish$tmp15=$jscomp$nullish$tmp15+" - "+$jscomp$destructuring$var191+" * "+orient;boxPlotType=boxPlotType+" + "+$jscomp$destructuring$var191+
" * "+orient;orient='datum["'+spec$jscomp$0.field+'"]';$jscomp$destructuring$var191={joinaggregate:boxParamsQuartiles(spec$jscomp$0.field),groupby:$jscomp$inline_5721};boxPlotType$jscomp$0={transform:[{filter:"("+$jscomp$nullish$tmp15+" \x3c\x3d "+orient+") \x26\x26 ("+orient+" \x3c\x3d "+boxPlotType+")"},{aggregate:[{op:"min",field:spec$jscomp$0.field,as:"lower_whisker_"+spec$jscomp$0.field},{op:"max",field:spec$jscomp$0.field,as:"upper_whisker_"+spec$jscomp$0.field},{op:"min",field:"lower_box_"+
spec$jscomp$0.field,as:"lower_box_"+spec$jscomp$0.field},{op:"max",field:"upper_box_"+spec$jscomp$0.field,as:"upper_box_"+spec$jscomp$0.field}].concat($jscomp.arrayFromIterable(boxPlotType$jscomp$0)),groupby:$jscomp$inline_5721}],layer:encodingWithoutContinuousAxis};$jscomp$inline_5721=Object.assign({},$jscomp$inline_5725);$jscomp$inline_5721=(delete $jscomp$inline_5721.tooltip,$jscomp$inline_5721);$jscomp$inline_5725=spec$jscomp$0.scale;encodingWithoutContinuousAxis=spec$jscomp$0.axis;ticksOrient=
getFirstDefined(spec$jscomp$0.title,spec$jscomp$0.field);encodingWithoutContinuousAxis=omit(encodingWithoutContinuousAxis,["title"]);makeBoxPlotBox={};config=partLayerMixins(mark,"outliers",config.boxplot,{transform:[{filter:"("+orient+" \x3c "+$jscomp$nullish$tmp15+") || ("+orient+" \x3e "+boxPlotType+")"}],mark:"point",encoding:Object.assign({},(makeBoxPlotBox[$jscomp$nullish$tmp14]=Object.assign({},{field:spec$jscomp$0.field,type:spec$jscomp$0.type},void 0!==ticksOrient?{title:ticksOrient}:{},
void 0!==$jscomp$inline_5725?{scale:$jscomp$inline_5725}:{},isEmpty(encodingWithoutContinuousAxis)?{}:{axis:encodingWithoutContinuousAxis}),makeBoxPlotBox),$jscomp$inline_5721,continuousFieldName?{color:continuousFieldName}:{},JSCompiler_inline_result?{tooltip:JSCompiler_inline_result}:{})})[0];mark=[].concat($jscomp.arrayFromIterable(customTooltipWithoutAggregatedField),$jscomp.arrayFromIterable(spec),[$jscomp$destructuring$var191]);config?config={transform:mark,layer:[config,boxPlotType$jscomp$0]}:
(config=boxPlotType$jscomp$0,config.transform.unshift.apply(config.transform,$jscomp.arrayFromIterable(mark)));return Object.assign({},$jscomp$destructuring$var189,{layer:[config,{transform:boxplotSpecificAggregate,layer:sizeValue}]})}function boxParamsQuartiles(continousAxisField){return[{op:"q1",field:continousAxisField,as:"lower_box_"+continousAxisField},{op:"q3",field:continousAxisField,as:"upper_box_"+continousAxisField}]}function normalizeErrorBar(spec,$jscomp$destructuring$var205){var config=
$jscomp$destructuring$var205.config;spec=Object.assign({},spec,{encoding:normalizeEncoding(spec.encoding,config)});var $jscomp$destructuring$var207=errorBarParams(spec,"errorbar",config);spec=$jscomp$destructuring$var207.transform;var continuousAxisChannelDef=$jscomp$destructuring$var207.continuousAxisChannelDef,continuousAxis=$jscomp$destructuring$var207.continuousAxis,encodingWithoutContinuousAxis=$jscomp$destructuring$var207.encodingWithoutContinuousAxis,ticksOrient=$jscomp$destructuring$var207.ticksOrient,
markDef=$jscomp$destructuring$var207.markDef;$jscomp$destructuring$var205=$jscomp$destructuring$var207.outerSpec;$jscomp$destructuring$var207=$jscomp$destructuring$var207.tooltipEncoding;delete encodingWithoutContinuousAxis.size;config=makeCompositeAggregatePartFactory(markDef,continuousAxis,continuousAxisChannelDef,encodingWithoutContinuousAxis,config.errorbar);continuousAxisChannelDef=markDef.thickness;markDef=markDef.size;ticksOrient=Object.assign({},{type:"tick",orient:ticksOrient,aria:!1},void 0!==
continuousAxisChannelDef?{thickness:continuousAxisChannelDef}:{},void 0!==markDef?{size:markDef}:{});ticksOrient=[].concat($jscomp.arrayFromIterable(config({partName:"ticks",mark:ticksOrient,positionPrefix:"lower",extraEncoding:$jscomp$destructuring$var207})),$jscomp.arrayFromIterable(config({partName:"ticks",mark:ticksOrient,positionPrefix:"upper",extraEncoding:$jscomp$destructuring$var207})),$jscomp.arrayFromIterable(config({partName:"rule",mark:Object.assign({},{type:"rule",ariaRoleDescription:"errorbar"},
void 0!==continuousAxisChannelDef?{size:continuousAxisChannelDef}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:$jscomp$destructuring$var207})));return Object.assign({},$jscomp$destructuring$var205,{transform:spec},1<ticksOrient.length?{layer:ticksOrient}:Object.assign({},ticksOrient[0]))}function errorBarOrientAndInputType(spec,compositeMark){var encoding=spec.encoding;if(!(!isFieldOrDatumDef(encoding.x)&&!isFieldOrDatumDef(encoding.y)||isFieldOrDatumDef(encoding.x2)||isFieldOrDatumDef(encoding.y2)||
isFieldOrDatumDef(encoding.xError)||isFieldOrDatumDef(encoding.xError2)||isFieldOrDatumDef(encoding.yError)||isFieldOrDatumDef(encoding.yError2)))return{orient:compositeMarkOrient(spec,compositeMark),inputType:"raw"};var isTypeAggregatedUpperLower=isFieldOrDatumDef(encoding.x2)||isFieldOrDatumDef(encoding.y2),isTypeAggregatedError=isFieldOrDatumDef(encoding.xError)||isFieldOrDatumDef(encoding.xError2)||isFieldOrDatumDef(encoding.yError)||isFieldOrDatumDef(encoding.yError2);spec=encoding.x;var y=encoding.y;
if(isTypeAggregatedUpperLower){if(isTypeAggregatedError)throw Error(compositeMark+" cannot be both type aggregated-upper-lower and aggregated-error");isTypeAggregatedUpperLower=encoding.x2;encoding=encoding.y2;if(isFieldOrDatumDef(isTypeAggregatedUpperLower)&&isFieldOrDatumDef(encoding))throw Error(compositeMark+" cannot have both x2 and y2");if(isFieldOrDatumDef(isTypeAggregatedUpperLower)){if(isContinuousFieldOrDatumDef(spec))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw Error("Both x and x2 have to be quantitative in "+
compositeMark);}if(isFieldOrDatumDef(encoding)){if(isContinuousFieldOrDatumDef(y))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw Error("Both y and y2 have to be quantitative in "+compositeMark);}}else{isTypeAggregatedUpperLower=encoding.xError;isTypeAggregatedError=encoding.yError;var yError2=encoding.yError2;if(isFieldOrDatumDef(encoding.xError2)&&!isFieldOrDatumDef(isTypeAggregatedUpperLower))throw Error(compositeMark+" cannot have xError2 without xError");if(isFieldOrDatumDef(yError2)&&
!isFieldOrDatumDef(isTypeAggregatedError))throw Error(compositeMark+" cannot have yError2 without yError");if(isFieldOrDatumDef(isTypeAggregatedUpperLower)&&isFieldOrDatumDef(isTypeAggregatedError))throw Error(compositeMark+" cannot have both xError and yError with both are quantiative");if(isFieldOrDatumDef(isTypeAggregatedUpperLower)){if(isContinuousFieldOrDatumDef(spec))return{orient:"horizontal",inputType:"aggregated-error"};throw Error("All x, xError, and xError2 (if exist) have to be quantitative");
}if(isFieldOrDatumDef(isTypeAggregatedError)){if(isContinuousFieldOrDatumDef(y))return{orient:"vertical",inputType:"aggregated-error"};throw Error("All y, yError, and yError2 (if exist) have to be quantitative");}}throw Error("No ranged axis");}function errorBarParams(spec,compositeMark,config){var $jscomp$destructuring$var210=Object.assign({},spec),mark=spec.mark,encoding=spec.encoding,params=spec.params;$jscomp$destructuring$var210=(delete $jscomp$destructuring$var210.mark,delete $jscomp$destructuring$var210.encoding,
delete $jscomp$destructuring$var210.params,delete $jscomp$destructuring$var210.projection,$jscomp$destructuring$var210);mark=isMarkDef(mark)?mark:{type:mark};params&&warn(selectionNotSupported(compositeMark));var $jscomp$destructuring$var211=errorBarOrientAndInputType(spec,compositeMark);params=$jscomp$destructuring$var211.orient;$jscomp$destructuring$var211=$jscomp$destructuring$var211.inputType;var $jscomp$destructuring$var212=compositeMarkContinuousAxis(spec,params,compositeMark);spec=$jscomp$destructuring$var212.continuousAxisChannelDef;
var continuousAxisChannelDef2=$jscomp$destructuring$var212.continuousAxisChannelDef2,continuousAxisChannelDefError=$jscomp$destructuring$var212.continuousAxisChannelDefError,continuousAxisChannelDefError2=$jscomp$destructuring$var212.continuousAxisChannelDefError2;$jscomp$destructuring$var212=$jscomp$destructuring$var212.continuousAxis;var JSCompiler_object_inline_errorBarSpecificAggregate_5099=[];var JSCompiler_object_inline_postAggregateCalculates_5098=[];var continuousFieldName=spec.field,tooltipTitleWithFieldName=
!1;if("raw"===$jscomp$destructuring$var211){var JSCompiler_object_inline_tooltipSummary_5100=mark.center?mark.center:mark.extent?"iqr"===mark.extent?"median":"mean":config.errorbar.center;continuousAxisChannelDef2=mark.extent?mark.extent:"mean"===JSCompiler_object_inline_tooltipSummary_5100?"stderr":"iqr";"median"===JSCompiler_object_inline_tooltipSummary_5100!==("iqr"===continuousAxisChannelDef2)&&warn(JSCompiler_object_inline_tooltipSummary_5100+" is not usually used with "+continuousAxisChannelDef2+
" for "+compositeMark+".");"stderr"===continuousAxisChannelDef2||"stdev"===continuousAxisChannelDef2?(JSCompiler_object_inline_errorBarSpecificAggregate_5099=[{op:continuousAxisChannelDef2,field:continuousFieldName,as:"extent_"+continuousFieldName},{op:JSCompiler_object_inline_tooltipSummary_5100,field:continuousFieldName,as:"center_"+continuousFieldName}],JSCompiler_object_inline_postAggregateCalculates_5098=[{calculate:'datum["center_'+continuousFieldName+'"] + datum["extent_'+continuousFieldName+
'"]',as:"upper_"+continuousFieldName},{calculate:'datum["center_'+continuousFieldName+'"] - datum["extent_'+continuousFieldName+'"]',as:"lower_"+continuousFieldName}],JSCompiler_object_inline_tooltipSummary_5100=[{fieldPrefix:"center_",titlePrefix:titleCase(JSCompiler_object_inline_tooltipSummary_5100)},{fieldPrefix:"upper_",titlePrefix:titleCase(JSCompiler_object_inline_tooltipSummary_5100)+" + "+continuousAxisChannelDef2},{fieldPrefix:"lower_",titlePrefix:titleCase(JSCompiler_object_inline_tooltipSummary_5100)+
" - "+continuousAxisChannelDef2}],tooltipTitleWithFieldName=!0):("ci"===continuousAxisChannelDef2?(JSCompiler_object_inline_tooltipSummary_5100="mean",compositeMark="ci0",continuousAxisChannelDef2="ci1"):(JSCompiler_object_inline_tooltipSummary_5100="median",compositeMark="q1",continuousAxisChannelDef2="q3"),JSCompiler_object_inline_errorBarSpecificAggregate_5099=[{op:compositeMark,field:continuousFieldName,as:"lower_"+continuousFieldName},{op:continuousAxisChannelDef2,field:continuousFieldName,as:"upper_"+
continuousFieldName},{op:JSCompiler_object_inline_tooltipSummary_5100,field:continuousFieldName,as:"center_"+continuousFieldName}],JSCompiler_object_inline_tooltipSummary_5100=[{fieldPrefix:"upper_",titlePrefix:title$jscomp$0({field:continuousFieldName,aggregate:continuousAxisChannelDef2,type:"quantitative"},config,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:title$jscomp$0({field:continuousFieldName,aggregate:compositeMark,type:"quantitative"},config,{allowDisabling:!1})},{fieldPrefix:"center_",
titlePrefix:title$jscomp$0({field:continuousFieldName,aggregate:JSCompiler_object_inline_tooltipSummary_5100,type:"quantitative"},config,{allowDisabling:!1})}])}else{if(mark.center||mark.extent){compositeMark=mark.center;var extent=mark.extent;warn((extent?"extent ":"")+(extent&&compositeMark?"and ":"")+(compositeMark?"center ":"")+(extent&&compositeMark?"are ":"is ")+"not needed when data are aggregated.")}"aggregated-upper-lower"===$jscomp$destructuring$var211?(JSCompiler_object_inline_tooltipSummary_5100=
[],JSCompiler_object_inline_postAggregateCalculates_5098=[{calculate:'datum["'+continuousAxisChannelDef2.field+'"]',as:"upper_"+continuousFieldName},{calculate:'datum["'+continuousFieldName+'"]',as:"lower_"+continuousFieldName}]):"aggregated-error"===$jscomp$destructuring$var211&&(JSCompiler_object_inline_tooltipSummary_5100=[{fieldPrefix:"",titlePrefix:continuousFieldName}],JSCompiler_object_inline_postAggregateCalculates_5098=[{calculate:'datum["'+continuousFieldName+'"] + datum["'+continuousAxisChannelDefError.field+
'"]',as:"upper_"+continuousFieldName}],continuousAxisChannelDefError2?JSCompiler_object_inline_postAggregateCalculates_5098.push({calculate:'datum["'+continuousFieldName+'"] + datum["'+continuousAxisChannelDefError2.field+'"]',as:"lower_"+continuousFieldName}):JSCompiler_object_inline_postAggregateCalculates_5098.push({calculate:'datum["'+continuousFieldName+'"] - datum["'+continuousAxisChannelDefError.field+'"]',as:"lower_"+continuousFieldName}));compositeMark=$jscomp.makeIterator(JSCompiler_object_inline_postAggregateCalculates_5098);
for(continuousFieldName=compositeMark.next();!continuousFieldName.done;continuousFieldName=compositeMark.next())continuousFieldName=continuousFieldName.value,JSCompiler_object_inline_tooltipSummary_5100.push({fieldPrefix:continuousFieldName.as.substring(0,6),titlePrefix:replaceAll(replaceAll(continuousFieldName.calculate,'datum["',""),'"]',"")})}encoding=Object.assign({},encoding);compositeMark="x"===$jscomp$destructuring$var212?"x2":"y2";continuousFieldName="x"===$jscomp$destructuring$var212?"xError":
"yError";continuousAxisChannelDef2="x"===$jscomp$destructuring$var212?"xError2":"yError2";encoding=(delete encoding[$jscomp$destructuring$var212],delete encoding[compositeMark],delete encoding[continuousFieldName],delete encoding[continuousAxisChannelDef2],encoding);continuousAxisChannelDef2=extractTransformsFromEncoding(encoding,config);config=continuousAxisChannelDef2.bins;encoding=continuousAxisChannelDef2.timeUnits;continuousFieldName=continuousAxisChannelDef2.groupby;compositeMark=continuousAxisChannelDef2.encoding;
JSCompiler_object_inline_errorBarSpecificAggregate_5099=[].concat($jscomp.arrayFromIterable(continuousAxisChannelDef2.aggregate),$jscomp.arrayFromIterable(JSCompiler_object_inline_errorBarSpecificAggregate_5099));$jscomp$destructuring$var211="raw"!==$jscomp$destructuring$var211?[]:continuousFieldName;JSCompiler_object_inline_tooltipSummary_5100=getCompositeMarkTooltip(JSCompiler_object_inline_tooltipSummary_5100,spec,compositeMark,tooltipTitleWithFieldName);var $jscomp$nullish$tmp16;return{transform:[].concat($jscomp.arrayFromIterable(null!=
($jscomp$nullish$tmp16=$jscomp$destructuring$var210.transform)?$jscomp$nullish$tmp16:[]),$jscomp.arrayFromIterable(config),$jscomp.arrayFromIterable(encoding),$jscomp.arrayFromIterable(0===JSCompiler_object_inline_errorBarSpecificAggregate_5099.length?[]:[{aggregate:JSCompiler_object_inline_errorBarSpecificAggregate_5099,groupby:$jscomp$destructuring$var211}]),$jscomp.arrayFromIterable(JSCompiler_object_inline_postAggregateCalculates_5098)),groupby:$jscomp$destructuring$var211,continuousAxisChannelDef:spec,
continuousAxis:$jscomp$destructuring$var212,encodingWithoutContinuousAxis:compositeMark,ticksOrient:"vertical"===params?"horizontal":"vertical",markDef:mark,outerSpec:$jscomp$destructuring$var210,tooltipEncoding:JSCompiler_object_inline_tooltipSummary_5100}}function normalizeErrorBand(spec,$jscomp$destructuring$var221){var config=$jscomp$destructuring$var221.config;spec=Object.assign({},spec,{encoding:normalizeEncoding(spec.encoding,config)});var $jscomp$destructuring$var223=errorBarParams(spec,"errorband",
config);$jscomp$destructuring$var221=$jscomp$destructuring$var223.transform;var outerSpec=$jscomp$destructuring$var223.outerSpec,tooltipEncoding=$jscomp$destructuring$var223.tooltipEncoding,errorBandDef=$jscomp$destructuring$var223.markDef;config=makeCompositeAggregatePartFactory(errorBandDef,$jscomp$destructuring$var223.continuousAxis,$jscomp$destructuring$var223.continuousAxisChannelDef,$jscomp$destructuring$var223.encodingWithoutContinuousAxis,config.errorband);spec=void 0!==spec.encoding.x&&void 0!==
spec.encoding.y;$jscomp$destructuring$var223={type:spec?"area":"rect"};var bordersMark={type:spec?"line":"rule"},interpolate=Object.assign({},errorBandDef.interpolate?{interpolate:errorBandDef.interpolate}:{},errorBandDef.tension&&errorBandDef.interpolate?{tension:errorBandDef.tension}:{});spec?($jscomp$destructuring$var223=Object.assign({},$jscomp$destructuring$var223,interpolate,{ariaRoleDescription:"errorband"}),bordersMark=Object.assign({},bordersMark,interpolate,{aria:!1})):errorBandDef.interpolate?
warn(errorBand1DNotSupport("interpolate")):errorBandDef.tension&&warn(errorBand1DNotSupport("tension"));return Object.assign({},outerSpec,{transform:$jscomp$destructuring$var221,layer:[].concat($jscomp.arrayFromIterable(config({partName:"band",mark:$jscomp$destructuring$var223,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:tooltipEncoding})),$jscomp.arrayFromIterable(config({partName:"borders",mark:bordersMark,positionPrefix:"lower",extraEncoding:tooltipEncoding})),$jscomp.arrayFromIterable(config({partName:"borders",
mark:bordersMark,positionPrefix:"upper",extraEncoding:tooltipEncoding})))})}function add$jscomp$0(mark,run,parts){run=new CompositeMarkNormalizer(mark,run);compositeMarkRegistry[mark]={normalizer:run,parts:parts}}function isLegendBinding(bind){return!!bind&&("legend"===bind||!!bind.legend)}function isLegendStreamBinding(bind){return isLegendBinding(bind)&&vegaUtil.isObject(bind)}function assembleParameterSignals(params){var signals=[];params=$jscomp.makeIterator(params||[]);for(var $jscomp$key$param=
params.next();!$jscomp$key$param.done;$jscomp$key$param=params.next())if($jscomp$key$param=$jscomp$key$param.value,!$jscomp$key$param.select){var $jscomp$destructuring$var224=$jscomp$key$param,$jscomp$destructuring$var225=Object.assign({},$jscomp$destructuring$var224);$jscomp$key$param=$jscomp$destructuring$var224.expr;$jscomp$destructuring$var224=$jscomp$destructuring$var224.bind;$jscomp$destructuring$var225=(delete $jscomp$destructuring$var225.expr,delete $jscomp$destructuring$var225.bind,$jscomp$destructuring$var225);
$jscomp$destructuring$var224&&$jscomp$key$param?($jscomp$key$param=Object.assign({},$jscomp$destructuring$var225,{bind:$jscomp$destructuring$var224,init:$jscomp$key$param}),signals.push($jscomp$key$param)):($jscomp$key$param=Object.assign({},$jscomp$destructuring$var225,$jscomp$key$param?{update:$jscomp$key$param}:{},$jscomp$destructuring$var224?{bind:$jscomp$destructuring$var224}:{}),signals.push($jscomp$key$param))}return signals}function extractTopLevelProperties(t,includeParams){for(var o={},
$jscomp$iter$355=$jscomp.makeIterator(TOP_LEVEL_PROPERTIES),$jscomp$key$p=$jscomp$iter$355.next();!$jscomp$key$p.done;$jscomp$key$p=$jscomp$iter$355.next())$jscomp$key$p=$jscomp$key$p.value,t&&void 0!==t[$jscomp$key$p]&&(o[$jscomp$key$p]=signalRefOrValue(t[$jscomp$key$p]));includeParams&&(o.params=t.params);return o}function isStep(size){return vegaUtil.isObject(size)&&void 0!==size.step}function isFrameMixins(o){return o.view||o.width||o.height}function extractCompositionLayout(spec,specType,config){var layout=
{};config=config[specType];specType=config.spacing;config=config.columns;void 0!==specType&&(layout.spacing=specType);void 0!==config&&("facet"in spec&&!isFacetMapping(spec.facet)||"concat"in spec)&&(layout.columns=config);"vconcat"in spec&&(layout.columns=1);config=$jscomp.makeIterator(COMPOSITION_LAYOUT_PROPERTIES);for(var $jscomp$key$prop=config.next();!$jscomp$key$prop.done;$jscomp$key$prop=config.next())if($jscomp$key$prop=$jscomp$key$prop.value,void 0!==spec[$jscomp$key$prop])if("spacing"===
$jscomp$key$prop){var spacing=spec[$jscomp$key$prop],$jscomp$nullish$tmp17=void 0,$jscomp$nullish$tmp18=void 0;layout[$jscomp$key$prop]=vegaUtil.isNumber(spacing)?spacing:{row:null!=($jscomp$nullish$tmp17=spacing.row)?$jscomp$nullish$tmp17:specType,column:null!=($jscomp$nullish$tmp18=spacing.column)?$jscomp$nullish$tmp18:specType}}else layout[$jscomp$key$prop]=spec[$jscomp$key$prop];return layout}function getViewConfigContinuousSize(viewConfig,channel){var $jscomp$nullish$tmp19;return null!=($jscomp$nullish$tmp19=
viewConfig[channel])?$jscomp$nullish$tmp19:viewConfig["width"===channel?"continuousWidth":"continuousHeight"]}function getViewConfigDiscreteStep(viewConfig,channel){viewConfig=getViewConfigDiscreteSize(viewConfig,channel);return isStep(viewConfig)?viewConfig.step:20}function getViewConfigDiscreteSize(viewConfig,channel){var $jscomp$nullish$tmp20;channel=null!=($jscomp$nullish$tmp20=viewConfig[channel])?$jscomp$nullish$tmp20:viewConfig["width"===channel?"discreteWidth":"discreteHeight"];return getFirstDefined(channel,
{step:viewConfig.step})}function colorSignalConfig(color){color=void 0===color?{}:color;return{signals:[{name:"color",value:vegaUtil.isObject(color)?Object.assign({},DEFAULT_COLOR,color):DEFAULT_COLOR}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},
axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function getAxisConfigInternal(axisConfig){var props=keys$jscomp$0(axisConfig||{}),axisConfigInternal={};props=$jscomp.makeIterator(props);for(var $jscomp$key$prop=
props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next()){$jscomp$key$prop=$jscomp$key$prop.value;var val=axisConfig[$jscomp$key$prop];axisConfigInternal[$jscomp$key$prop]=isConditionalAxisValue(val)?signalOrValueRefWithCondition(val):signalRefOrValue(val)}return axisConfigInternal}function initConfig(specifiedConfig){var $jscomp$destructuring$var227=specifiedConfig=void 0===specifiedConfig?{}:specifiedConfig,$jscomp$destructuring$var228=Object.assign({},$jscomp$destructuring$var227);specifiedConfig=
$jscomp$destructuring$var227.color;var font=$jscomp$destructuring$var227.font,fontSize=$jscomp$destructuring$var227.fontSize;$jscomp$destructuring$var227=$jscomp$destructuring$var227.selection;$jscomp$destructuring$var228=(delete $jscomp$destructuring$var228.color,delete $jscomp$destructuring$var228.font,delete $jscomp$destructuring$var228.fontSize,delete $jscomp$destructuring$var228.selection,$jscomp$destructuring$var228);specifiedConfig=vegaUtil.mergeConfig({},duplicate(defaultConfig),font?{text:{font:font},
style:{"guide-label":{font:font},"guide-title":{font:font},"group-title":{font:font},"group-subtitle":{font:font}}}:{},specifiedConfig?colorSignalConfig(specifiedConfig):{},fontSize?{signals:[{name:"fontSize",value:vegaUtil.isObject(fontSize)?Object.assign({},DEFAULT_FONT_SIZE,fontSize):DEFAULT_FONT_SIZE}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},
"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}:{},$jscomp$destructuring$var228||{});$jscomp$destructuring$var227&&vega.writeConfig(specifiedConfig,"selection",$jscomp$destructuring$var227,!0);font=omit(specifiedConfig,configPropsWithExpr);fontSize=$jscomp.makeIterator(["background","lineBreak","padding"]);for($jscomp$destructuring$var227=fontSize.next();!$jscomp$destructuring$var227.done;$jscomp$destructuring$var227=fontSize.next())$jscomp$destructuring$var227=$jscomp$destructuring$var227.value,
specifiedConfig[$jscomp$destructuring$var227]&&(font[$jscomp$destructuring$var227]=signalRefOrValue(specifiedConfig[$jscomp$destructuring$var227]));fontSize=$jscomp.makeIterator(MARK_CONFIGS);for($jscomp$destructuring$var227=fontSize.next();!$jscomp$destructuring$var227.done;$jscomp$destructuring$var227=fontSize.next())$jscomp$destructuring$var227=$jscomp$destructuring$var227.value,specifiedConfig[$jscomp$destructuring$var227]&&(font[$jscomp$destructuring$var227]=replaceExprRef(specifiedConfig[$jscomp$destructuring$var227]));
fontSize=$jscomp.makeIterator(AXIS_CONFIGS);for($jscomp$destructuring$var227=fontSize.next();!$jscomp$destructuring$var227.done;$jscomp$destructuring$var227=fontSize.next())$jscomp$destructuring$var227=$jscomp$destructuring$var227.value,specifiedConfig[$jscomp$destructuring$var227]&&(font[$jscomp$destructuring$var227]=getAxisConfigInternal(specifiedConfig[$jscomp$destructuring$var227]));fontSize=$jscomp.makeIterator(HEADER_CONFIGS);for($jscomp$destructuring$var227=fontSize.next();!$jscomp$destructuring$var227.done;$jscomp$destructuring$var227=
fontSize.next())$jscomp$destructuring$var227=$jscomp$destructuring$var227.value,specifiedConfig[$jscomp$destructuring$var227]&&(font[$jscomp$destructuring$var227]=replaceExprRef(specifiedConfig[$jscomp$destructuring$var227]));specifiedConfig.legend&&(font.legend=replaceExprRef(specifiedConfig.legend));specifiedConfig.scale&&(font.scale=replaceExprRef(specifiedConfig.scale));if(specifiedConfig.style){fontSize=specifiedConfig.style;$jscomp$destructuring$var228=keys$jscomp$0(fontSize);$jscomp$destructuring$var227=
{};$jscomp$destructuring$var228=$jscomp.makeIterator($jscomp$destructuring$var228);for(var $jscomp$key$prop=$jscomp$destructuring$var228.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$destructuring$var228.next())$jscomp$key$prop=$jscomp$key$prop.value,$jscomp$destructuring$var227[$jscomp$key$prop]=getAxisConfigInternal(fontSize[$jscomp$key$prop]);font.style=$jscomp$destructuring$var227}specifiedConfig.title&&(font.title=replaceExprRef(specifiedConfig.title));specifiedConfig.view&&(font.view=
replaceExprRef(specifiedConfig.view));return font}function stripAndRedirectConfig(config$jscomp$0){config$jscomp$0=duplicate(config$jscomp$0);for(var $jscomp$iter$363=$jscomp.makeIterator(VL_ONLY_CONFIG_PROPERTIES),$jscomp$key$prop=$jscomp$iter$363.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$363.next())delete config$jscomp$0[$jscomp$key$prop.value];if(config$jscomp$0.axis)for(var prop$778 in config$jscomp$0.axis)isConditionalAxisValue(config$jscomp$0.axis[prop$778])&&delete config$jscomp$0.axis[prop$778];
if(config$jscomp$0.legend)for($jscomp$iter$363=$jscomp.makeIterator(VL_ONLY_LEGEND_CONFIG),$jscomp$key$prop=$jscomp$iter$363.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$363.next())delete config$jscomp$0.legend[$jscomp$key$prop.value];if(config$jscomp$0.mark){$jscomp$iter$363=$jscomp.makeIterator(VL_ONLY_MARK_CONFIG_PROPERTIES);for($jscomp$key$prop=$jscomp$iter$363.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$363.next())delete config$jscomp$0.mark[$jscomp$key$prop.value];
config$jscomp$0.mark.tooltip&&vegaUtil.isObject(config$jscomp$0.mark.tooltip)&&delete config$jscomp$0.mark.tooltip}config$jscomp$0.params&&(config$jscomp$0.signals=(config$jscomp$0.signals||[]).concat(assembleParameterSignals(config$jscomp$0.params)),delete config$jscomp$0.params);$jscomp$iter$363=$jscomp.makeIterator(MARK_STYLES);for(prop$778=$jscomp$iter$363.next();!prop$778.done;prop$778=$jscomp$iter$363.next()){prop$778=prop$778.value;var $jscomp$iter$366=$jscomp.makeIterator(VL_ONLY_MARK_CONFIG_PROPERTIES);
for($jscomp$key$prop=$jscomp$iter$366.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$366.next())delete config$jscomp$0[prop$778][$jscomp$key$prop.value];if($jscomp$key$prop=VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX[prop$778])for($jscomp$iter$366=$jscomp.makeIterator($jscomp$key$prop),$jscomp$key$prop=$jscomp$iter$366.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$iter$366.next())delete config$jscomp$0[prop$778][$jscomp$key$prop.value];$jscomp$iter$366=$jscomp$key$prop=void 0;
var config=config$jscomp$0,toProp=void 0,propConfig=config[prop$778];"view"===prop$778&&(toProp="cell");propConfig=Object.assign({},propConfig,config.style[null!=($jscomp$iter$366=toProp)?$jscomp$iter$366:prop$778]);isEmpty(propConfig)||(config.style[null!=($jscomp$key$prop=toProp)?$jscomp$key$prop:prop$778]=propConfig);delete config[prop$778]}$jscomp$iter$363=$jscomp.makeIterator(keys$jscomp$0(compositeMarkRegistry));for(prop$778=$jscomp$iter$363.next();!prop$778.done;prop$778=$jscomp$iter$363.next())delete config$jscomp$0[prop$778.value];
$jscomp$iter$363=config$jscomp$0;$jscomp$iter$366=extractTitleConfig($jscomp$iter$363.title);prop$778=$jscomp$iter$366.titleMarkConfig;$jscomp$key$prop=$jscomp$iter$366.subtitleMarkConfig;$jscomp$iter$366=$jscomp$iter$366.subtitle;isEmpty(prop$778)||($jscomp$iter$363.style["group-title"]=Object.assign({},$jscomp$iter$363.style["group-title"],prop$778));isEmpty($jscomp$key$prop)||($jscomp$iter$363.style["group-subtitle"]=Object.assign({},$jscomp$iter$363.style["group-subtitle"],$jscomp$key$prop));
isEmpty($jscomp$iter$366)?delete $jscomp$iter$363.title:$jscomp$iter$363.title=$jscomp$iter$366;for(var prop$783 in config$jscomp$0)vegaUtil.isObject(config$jscomp$0[prop$783])&&isEmpty(config$jscomp$0[prop$783])&&delete config$jscomp$0[prop$783];return isEmpty(config$jscomp$0)?void 0:config$jscomp$0}function isUnbinnedQuantitative(channelDef){return isFieldDef(channelDef)&&"quantitative"===(channelDef&&channelDef.type)&&!channelDef.bin}function potentialStackedChannel(encoding,x){var y="x"===x?"y":
"radius",xDef=encoding[x];encoding=encoding[y];if(isFieldDef(xDef)&&isFieldDef(encoding))if(isUnbinnedQuantitative(xDef)&&isUnbinnedQuantitative(encoding)){if(xDef.stack)return x;if(encoding.stack)return y;var xAggregate=isFieldDef(xDef)&&!!xDef.aggregate,yAggregate=isFieldDef(encoding)&&!!encoding.aggregate;if(xAggregate!==yAggregate)return xAggregate?x:y;var _xDef$scale,_yDef$scale;xDef=null===(_xDef$scale=xDef.scale)||void 0===_xDef$scale?void 0:_xDef$scale.type;_xDef$scale=null===(_yDef$scale=
encoding.scale)||void 0===_yDef$scale?void 0:_yDef$scale.type;if(xDef&&"linear"!==xDef)return y;if(_xDef$scale&&"linear"!==_xDef$scale)return x}else{if(isUnbinnedQuantitative(xDef))return x;if(isUnbinnedQuantitative(encoding))return y}else{if(isUnbinnedQuantitative(xDef))return x;if(isUnbinnedQuantitative(encoding))return y}}function getDimensionChannel(channel){switch(channel){case "x":return"y";case "y":return"x";case "theta":return"radius";case "radius":return"theta"}}function stack$jscomp$0(m,
encoding,opt){opt=void 0===opt?{}:opt;var _stackedFieldDef$scal,_stackedFieldDef$scal2;m=isMarkDef(m)?m.type:m;if(!STACKABLE_MARKS.has(m))return null;var fieldChannel=potentialStackedChannel(encoding,"x")||potentialStackedChannel(encoding,"theta");if(!fieldChannel)return null;var stackedFieldDef=encoding[fieldChannel],stackedField=isFieldDef(stackedFieldDef)?vgField(stackedFieldDef,{}):void 0,dimensionChannel=getDimensionChannel(fieldChannel),dimensionDef=encoding[dimensionChannel],dimensionField=
isFieldDef(dimensionDef)?vgField(dimensionDef,{}):void 0;dimensionField===stackedField&&(dimensionChannel=dimensionDef=dimensionField=void 0);stackedField=NONPOSITION_CHANNELS.reduce(function(sc,channel){if("tooltip"!==channel&&channelHasField(encoding,channel))for(var $jscomp$iter$370=$jscomp.makeIterator(vegaUtil.array(encoding[channel])),$jscomp$key$cDef=$jscomp$iter$370.next();!$jscomp$key$cDef.done;$jscomp$key$cDef=$jscomp$iter$370.next())if($jscomp$key$cDef=getFieldDef($jscomp$key$cDef.value),
!$jscomp$key$cDef.aggregate){var f=vgField($jscomp$key$cDef,{});f&&f===dimensionField||sc.push({channel:channel,fieldDef:$jscomp$key$cDef})}return sc},[]);var offset;void 0!==stackedFieldDef.stack?offset=vegaUtil.isBoolean(stackedFieldDef.stack)?stackedFieldDef.stack?"zero":null:stackedFieldDef.stack:STACK_BY_DEFAULT_MARKS.has(m)&&(offset="zero");if(!(offset&&offset in STACK_OFFSET_INDEX)||isAggregate$1(encoding)&&0===stackedField.length)return null;if(null!==stackedFieldDef&&void 0!==stackedFieldDef&&
null!==(_stackedFieldDef$scal=stackedFieldDef.scale)&&void 0!==_stackedFieldDef$scal&&_stackedFieldDef$scal.type&&(null===stackedFieldDef||void 0===stackedFieldDef?void 0:null===(_stackedFieldDef$scal2=stackedFieldDef.scale)||void 0===_stackedFieldDef$scal2?void 0:_stackedFieldDef$scal2.type)!==ScaleType.LINEAR){if(opt.disallowNonLinearStack)return null;warn("Cannot stack non-linear scale ("+stackedFieldDef.scale.type+").")}if(isFieldOrDatumDef(encoding[getSecondaryRangeChannel(fieldChannel)]))return void 0!==
stackedFieldDef.stack&&warn('Cannot stack "'+fieldChannel+'" if there is already "'+fieldChannel+'2".'),null;isFieldDef(stackedFieldDef)&&stackedFieldDef.aggregate&&!SUM_OPS.includes(stackedFieldDef.aggregate)&&warn('Stacking is applied even though the aggregate function is non-summative ("'+stackedFieldDef.aggregate+'").');return{groupbyChannel:dimensionDef?dimensionChannel:void 0,groupbyField:dimensionField,fieldChannel:fieldChannel,impute:null===stackedFieldDef.impute?!1:isPathMark(m),stackBy:stackedField,
offset:offset}}function dropLineAndPoint(markDef){markDef=Object.assign({},markDef);markDef=(delete markDef.point,delete markDef.line,markDef);return 1<keys$jscomp$0(markDef).length?markDef:markDef.type}function dropLineAndPointFromConfig(config){for(var $jscomp$iter$371=$jscomp.makeIterator(["line","area","rule","trail"]),$jscomp$key$mark=$jscomp$iter$371.next();!$jscomp$key$mark.done;$jscomp$key$mark=$jscomp$iter$371.next())if($jscomp$key$mark=$jscomp$key$mark.value,config[$jscomp$key$mark]){var $jscomp$compprop221=
{};config=Object.assign({},config,($jscomp$compprop221[$jscomp$key$mark]=omit(config[$jscomp$key$mark],["point","line"]),$jscomp$compprop221))}return config}function getPointOverlay(markDef,markConfig,encoding){markConfig=void 0===markConfig?{}:markConfig;if("transparent"===markDef.point)return{opacity:0};if(markDef.point)return vegaUtil.isObject(markDef.point)?markDef.point:{};if(void 0!==markDef.point)return null;if(markConfig.point||encoding.shape)return vegaUtil.isObject(markConfig.point)?markConfig.point:
{}}function getLineOverlay(markDef,markConfig){markConfig=void 0===markConfig?{}:markConfig;if(markDef.line)return!0===markDef.line?{}:markDef.line;if(void 0!==markDef.line)return null;if(markConfig.line)return!0===markConfig.line?{}:markConfig.line}function replaceRepeaterInEncoding(encoding,repeater){return repeater?replaceRepeaterInMapping(encoding,repeater):encoding}function replaceRepeatInProp(prop,o,repeater){var val=o[prop];if(val&&!vegaUtil.isString(val)&&"repeat"in val){if(val.repeat in repeater){var $jscomp$compprop223=
{};return Object.assign({},o,($jscomp$compprop223[prop]=repeater[val.repeat],$jscomp$compprop223))}warn('Unknown repeated value "'+val.repeat+'".')}else return o}function replaceRepeaterInFieldDef(fieldDef,repeater){fieldDef=replaceRepeatInProp("field",fieldDef,repeater);if(void 0!==fieldDef){if(null===fieldDef)return null;"sort"in fieldDef&&isSortField(fieldDef.sort)&&(repeater=replaceRepeatInProp("field",fieldDef.sort,repeater),fieldDef=Object.assign({},fieldDef,repeater?{sort:repeater}:{}));return fieldDef}}
function replaceRepeaterInFieldOrDatumDef(def,repeater){if(isFieldDef(def))return replaceRepeaterInFieldDef(def,repeater);repeater=replaceRepeatInProp("datum",def,repeater);repeater===def||repeater.type||(repeater.type="nominal");return repeater}function replaceRepeaterInChannelDef(channelDef,repeater){if(isFieldOrDatumDef(channelDef)){if(repeater=replaceRepeaterInFieldOrDatumDef(channelDef,repeater))return repeater;if(isConditionalDef(channelDef))return{condition:channelDef.condition}}else{if(hasConditionalFieldOrDatumDef(channelDef)){if(repeater=
replaceRepeaterInFieldOrDatumDef(channelDef.condition,repeater))return Object.assign({},channelDef,{condition:repeater});channelDef=Object.assign({},channelDef);return delete channelDef.condition,channelDef}return channelDef}}function replaceRepeaterInMapping(mapping,repeater){var out={},channel;for(channel in mapping)if(vegaUtil.hasOwnProperty(mapping,channel)){var channelDef=mapping[channel];vegaUtil.isArray(channelDef)?out[channel]=channelDef.map(function(cd){return replaceRepeaterInChannelDef(cd,
repeater)}).filter(function(cd){return cd}):(channelDef=replaceRepeaterInChannelDef(channelDef,repeater),void 0!==channelDef&&(out[channel]=channelDef))}return out}function mergeEncoding($jscomp$destructuring$var269){var parentEncoding=$jscomp$destructuring$var269.parentEncoding,encoding=void 0===$jscomp$destructuring$var269.encoding?{}:$jscomp$destructuring$var269.encoding;$jscomp$destructuring$var269=$jscomp$destructuring$var269.layer;var merged={};if(parentEncoding){var channels=new Set([].concat($jscomp.arrayFromIterable(keys$jscomp$0(parentEncoding)),
$jscomp.arrayFromIterable(keys$jscomp$0(encoding))));channels=$jscomp.makeIterator(channels);for(var $jscomp$key$channel=channels.next();!$jscomp$key$channel.done;$jscomp$key$channel=channels.next()){$jscomp$key$channel=$jscomp$key$channel.value;var channelDef=encoding[$jscomp$key$channel],parentChannelDef=parentEncoding[$jscomp$key$channel];if(isFieldOrDatumDef(channelDef))channelDef=Object.assign({},parentChannelDef,channelDef),merged[$jscomp$key$channel]=channelDef;else if(hasConditionalFieldOrDatumDef(channelDef))merged[$jscomp$key$channel]=
Object.assign({},channelDef,{condition:Object.assign({},parentChannelDef,channelDef.condition)});else if(channelDef||null===channelDef)merged[$jscomp$key$channel]=channelDef;else if($jscomp$destructuring$var269||isValueDef(parentChannelDef)||isSignalRef(parentChannelDef)||isFieldOrDatumDef(parentChannelDef)||vegaUtil.isArray(parentChannelDef))merged[$jscomp$key$channel]=parentChannelDef}}else merged=encoding;return!merged||isEmpty(merged)?void 0:merged}function mergeProjection(opt){var parentProjection=
opt.parentProjection;opt=opt.projection;if(parentProjection&&opt){var JSCompiler_inline_result="Layer's shared projection "+stringify(parentProjection)+" is overridden by a child projection "+stringify(opt)+".";warn(JSCompiler_inline_result)}return null!=opt?opt:parentProjection}function normalizeTransform(transform){return transform.map(function(t){return"filter"in t?{filter:normalizeLogicalComposition(t.filter,normalizePredicate$1)}:t})}function normalizeTransforms(spec,normParams){var $jscomp$destructuring$var281=
Object.assign({},spec),tx=spec.transform;$jscomp$destructuring$var281=(delete $jscomp$destructuring$var281.transform,$jscomp$destructuring$var281);return tx?(spec=tx.map(function(t){if("filter"in t)return{filter:normalizePredicate(t,normParams)};if("bin"in t&&vegaUtil.isObject(t.bin))return Object.assign({},t,{bin:normalizeBinExtent(t.bin)});if("lookup"in t){var $jscomp$destructuring$var282=t.from,$jscomp$destructuring$var283=Object.assign({},$jscomp$destructuring$var282);$jscomp$destructuring$var282=
$jscomp$destructuring$var282.selection;$jscomp$destructuring$var283=(delete $jscomp$destructuring$var283.selection,$jscomp$destructuring$var283);return $jscomp$destructuring$var282?Object.assign({},t,{from:Object.assign({},{param:$jscomp$destructuring$var282},$jscomp$destructuring$var283)}):t}return t}),Object.assign({},$jscomp$destructuring$var281,{transform:spec})):spec}function normalizeChannelDef(obj,normParams){var _enc$scale,_enc$scale$domain;obj=duplicate(obj);isFieldDef(obj)&&vegaUtil.isObject(obj.bin)&&
(obj.bin=normalizeBinExtent(obj.bin));isScaleFieldDef(obj)&&null!==(_enc$scale=obj.scale)&&void 0!==_enc$scale&&null!==(_enc$scale$domain=_enc$scale.domain)&&void 0!==_enc$scale$domain&&_enc$scale$domain.selection&&(_enc$scale$domain=obj.scale.domain,_enc$scale=Object.assign({},_enc$scale$domain),_enc$scale$domain=_enc$scale$domain.selection,_enc$scale=(delete _enc$scale.selection,_enc$scale),obj.scale.domain=Object.assign({},_enc$scale,_enc$scale$domain?{param:_enc$scale$domain}:{}));isConditionalDef(obj)&&
(vega.isArray(obj.condition)?obj.condition=obj.condition.map(function(c){var $jscomp$destructuring$var287=Object.assign({},c),param=c.param;$jscomp$destructuring$var287=(delete $jscomp$destructuring$var287.selection,delete $jscomp$destructuring$var287.param,delete $jscomp$destructuring$var287.test,$jscomp$destructuring$var287);return param?c:Object.assign({},$jscomp$destructuring$var287,{test:normalizePredicate(c,normParams)})}):(_enc$scale$domain=normalizeChannelDef(obj.condition,normParams),_enc$scale=
Object.assign({},_enc$scale$domain),_enc$scale$domain=_enc$scale$domain.param,_enc$scale=(delete _enc$scale.selection,delete _enc$scale.param,delete _enc$scale.test,_enc$scale),obj.condition=_enc$scale$domain?obj.condition:Object.assign({},_enc$scale,{test:normalizePredicate(obj.condition,normParams)})));return obj}function normalizeBinExtent(bin){var ext=bin.extent;if(null!==ext&&void 0!==ext&&ext.selection){var $jscomp$destructuring$var291=Object.assign({},ext);ext=ext.selection;$jscomp$destructuring$var291=
(delete $jscomp$destructuring$var291.selection,$jscomp$destructuring$var291);return Object.assign({},bin,{extent:Object.assign({},$jscomp$destructuring$var291,{param:ext})})}return bin}function normalizePredicate(op,normParams){var normalizeSelectionComposition=function(o){return normalizeLogicalComposition(o,function(param){var _normParams$selection,$jscomp$nullish$tmp29,empty=null!=($jscomp$nullish$tmp29=normParams.emptySelections[param])?$jscomp$nullish$tmp29:!0;$jscomp$nullish$tmp29={param:param,
empty:empty};null!=(_normParams$selection=normParams.selectionPredicates)[param]||(_normParams$selection[param]=[]);normParams.selectionPredicates[param].push($jscomp$nullish$tmp29);return $jscomp$nullish$tmp29})};return op.selection?normalizeSelectionComposition(op.selection):normalizeLogicalComposition(op.test||op.filter,function(o){return o.selection?normalizeSelectionComposition(o.selection):o})}function addSpecNameToParams(spec,params){var $jscomp$nullish$tmp33;return spec.name?Object.assign({},
params,{path:(null!=($jscomp$nullish$tmp33=params.path)?$jscomp$nullish$tmp33:[]).concat(spec.name)}):params}function normalize$jscomp$0(spec,config$jscomp$0){void 0===config$jscomp$0&&(config$jscomp$0=initConfig(spec.config));var JSCompiler_inline_result=config$jscomp$0;JSCompiler_inline_result=void 0===JSCompiler_inline_result?{}:JSCompiler_inline_result;JSCompiler_inline_result={config:JSCompiler_inline_result};JSCompiler_inline_result=topLevelSelectionNormalizer.map(coreNormalizer.map(selectionCompatNormalizer.map(spec,
JSCompiler_inline_result),JSCompiler_inline_result),JSCompiler_inline_result);var config=config$jscomp$0;config$jscomp$0=spec.width;spec=spec.height;var isFitCompatible=isUnitSpec(JSCompiler_inline_result)||"layer"in JSCompiler_inline_result,autosizeDefault={};isFitCompatible?"container"==config$jscomp$0&&"container"==spec?(autosizeDefault.type="fit",autosizeDefault.contains="padding"):"container"==config$jscomp$0?(autosizeDefault.type="fit-x",autosizeDefault.contains="padding"):"container"==spec&&
(autosizeDefault.type="fit-y",autosizeDefault.contains="padding"):("container"==config$jscomp$0&&(warn(containerSizeNonSingle("width")),config$jscomp$0=void 0),"container"==spec&&(warn(containerSizeNonSingle("height")),spec=void 0));config=Object.assign({},{type:"pad"},autosizeDefault,config?_normalizeAutoSize(config.autosize):{},_normalizeAutoSize(JSCompiler_inline_result.autosize));"fit"!==config.type||isFitCompatible||(warn('Autosize "fit" only works for single views and layered views.'),config.type=
"pad");"container"==config$jscomp$0&&"fit"!=config.type&&"fit-x"!=config.type&&warn(containerSizeNotCompatibleWithAutosize("width"));"container"==spec&&"fit"!=config.type&&"fit-y"!=config.type&&warn(containerSizeNotCompatibleWithAutosize("height"));config$jscomp$0=deepEqual(config,{type:"pad"})?void 0:config;return Object.assign({},JSCompiler_inline_result,config$jscomp$0?{autosize:config$jscomp$0}:{})}function _normalizeAutoSize(autosize){return vegaUtil.isString(autosize)?{type:autosize}:null!=
autosize?autosize:{}}function makeExplicit(value){return{explicit:!0,value:value}}function makeImplicit(value){return{explicit:!1,value:value}}function tieBreakByComparing(compare){return function(v1,v2,property,propertyOf){var diff=compare(v1.value,v2.value);return 0<diff?v1:0>diff?v2:defaultTieBreaker(v1,v2,property,propertyOf)}}function defaultTieBreaker(v1$jscomp$0,v2,property,propertyOf){if(v1$jscomp$0.explicit&&v2.explicit){var v1=v1$jscomp$0.value;v2=v2.value;property="Conflicting "+propertyOf.toString()+
' property "'+property.toString()+'" ('+stringify(v1)+" and "+stringify(v2)+"). Using "+stringify(v1)+".";warn(property)}return v1$jscomp$0}function mergeValuesWithExplicit(v1,v2,property,propertyOf,tieBreaker){tieBreaker=void 0===tieBreaker?defaultTieBreaker:tieBreaker;return void 0===v1||void 0===v1.value?v2:v1.explicit&&!v2.explicit?v1:v2.explicit&&!v1.explicit?v2:deepEqual(v1.value,v2.value)?v1:tieBreaker(v1,v2,property,propertyOf)}function isNamedData(data){return"name"in data&&!("url"in data)&&
!("values"in data)&&!isGenerator(data)}function isGenerator(data){return data&&("sequence"in data||"sphere"in data||"graticule"in data)}function eventSelector(selector,source,marks){DEFAULT_SOURCE=source||"view";MARKS=marks||DEFAULT_MARKS;return parseMerge(selector.trim()).map(parseSelector)}function find$jscomp$0(s,i,endChar,pushChar,popChar){for(var n=s.length,count=0,c;i<n;++i)if(c=s[i],count||c!==endChar)popChar&&0<=popChar.indexOf(c)?--count:pushChar&&0<=pushChar.indexOf(c)&&++count;else break;
return i}function parseMerge(s){for(var output=[],n=s.length,start=0,i=0;i<n;)i=find$jscomp$0(s,i,",","[{","]}"),output.push(s.substring(start,i).trim()),start=++i;if(0===output.length)throw"Empty event selector: "+s;return output}function parseSelector(s){if("["===s[0]){var JSCompiler_temp=s;var n=JSCompiler_temp.length;s=find$jscomp$0(JSCompiler_temp,1,"]","[","]");if(s===n)throw"Empty between selector: "+JSCompiler_temp;n=parseMerge(JSCompiler_temp.substring(1,s));if(2!==n.length)throw"Between selector must have two elements: "+
JSCompiler_temp;JSCompiler_temp=JSCompiler_temp.slice(s+1).trim();if("\x3e"!==JSCompiler_temp[0])throw"Expected '\x3e' after between selector: "+JSCompiler_temp;n=n.map(parseSelector);JSCompiler_temp=parseSelector(JSCompiler_temp.slice(1).trim());JSCompiler_temp.between?JSCompiler_temp={between:n,stream:JSCompiler_temp}:JSCompiler_temp.between=n}else{n={source:DEFAULT_SOURCE};var source=[],throttle=[0,0],markname=0,start=0,n$jscomp$0=s.length,i=0;if("}"===s[n$jscomp$0-1]){i=s.lastIndexOf("{");if(0<=
i){try{throttle=parseThrottle(s.substring(i+1,n$jscomp$0-1))}catch(e){throw"Invalid throttle specification: "+s;}s=s.slice(0,i).trim();n$jscomp$0=s.length}else throw"Unmatched right brace: "+s;i=0}if(!n$jscomp$0)throw s;"@"===s[0]&&(markname=++i);var j=find$jscomp$0(s,i,":");j<n$jscomp$0&&(source.push(s.substring(start,j).trim()),start=i=++j);i=find$jscomp$0(s,i,"[");if(i===n$jscomp$0)source.push(s.substring(start,n$jscomp$0).trim());else if(source.push(s.substring(start,i).trim()),JSCompiler_temp=
[],start=++i,start===n$jscomp$0)throw"Unmatched left bracket: "+s;for(;i<n$jscomp$0;){i=find$jscomp$0(s,i,"]");if(i===n$jscomp$0)throw"Unmatched left bracket: "+s;JSCompiler_temp.push(s.substring(start,i).trim());if(i<n$jscomp$0-1&&"["!==s[++i])throw"Expected left bracket: "+s;start=++i}if(!(n$jscomp$0=source.length)||ILLEGAL$1.test(source[n$jscomp$0-1]))throw"Invalid event selector: "+s;1<n$jscomp$0?(n.type=source[1],markname?n.markname=source[0].slice(1):MARKS[source[0]]?n.marktype=source[0]:n.source=
source[0]):n.type=source[0];"!"===n.type.slice(-1)&&(n.consume=!0,n.type=n.type.slice(0,-1));null!=JSCompiler_temp&&(n.filter=JSCompiler_temp);throttle[0]&&(n.throttle=throttle[0]);throttle[1]&&(n.debounce=throttle[1]);JSCompiler_temp=n}return JSCompiler_temp}function parseThrottle(s){var a=s.split(",");if(!s.length||2<a.length)throw s;return a.map(function(_){_=+_;if(_!==_)throw s;return _})}function assembleInit(init,isExpr,wrap){isExpr=void 0===isExpr?!0:isExpr;wrap=void 0===wrap?vegaUtil.identity:
wrap;return vegaUtil.isArray(init)?(init=init.map(function(v){return assembleInit(v,isExpr,wrap)}),isExpr?"["+init.join(", ")+"]":init):isDateTime(init)?isExpr?wrap(dateTimeToExpr(init)):wrap(dateTimeToTimestamp(init)):isExpr?wrap(stringify(init)):init}function assembleUnitSelectionSignals(model,signals){var $jscomp$nullish$tmp35,$jscomp$iter$388=$jscomp.makeIterator(vals$jscomp$0(null!=($jscomp$nullish$tmp35=model.component.selection)?$jscomp$nullish$tmp35:{}));for($jscomp$nullish$tmp35=$jscomp$iter$388.next();!$jscomp$nullish$tmp35.done;$jscomp$nullish$tmp35=
$jscomp$iter$388.next()){$jscomp$nullish$tmp35=$jscomp$nullish$tmp35.value;for(var name$794=$jscomp$nullish$tmp35.name,modifyExpr=""+name$794+"_tuple, "+("global"===$jscomp$nullish$tmp35.resolve?"true":"{unit: "+unitName(model)+"}"),$jscomp$iter$387=$jscomp.makeIterator(selectionCompilers),$jscomp$key$c=$jscomp$iter$387.next();!$jscomp$key$c.done;$jscomp$key$c=$jscomp$iter$387.next())$jscomp$key$c=$jscomp$key$c.value,$jscomp$key$c.defined($jscomp$nullish$tmp35)&&($jscomp$key$c.signals&&(signals=$jscomp$key$c.signals(model,
$jscomp$nullish$tmp35,signals)),$jscomp$key$c.modifyExpr&&(modifyExpr=$jscomp$key$c.modifyExpr(model,$jscomp$nullish$tmp35,modifyExpr)));signals.push({name:name$794+"_modify",on:[{events:{signal:$jscomp$nullish$tmp35.name+"_tuple"},update:"modify("+vegaUtil.stringValue($jscomp$nullish$tmp35.name+"_store")+", "+modifyExpr+")"}]})}return cleanupEmptyOnArray(signals)}function assembleFacetSignals(model,signals){model.component.selection&&keys$jscomp$0(model.component.selection).length&&(model=vegaUtil.stringValue(model.getName("cell")),
signals.unshift({name:"facet",value:{},on:[{events:eventSelector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+model+").datum"}]}));return cleanupEmptyOnArray(signals)}function assembleTopLevelSignals(model,signals){var hasSelections=!1,$jscomp$nullish$tmp36,$jscomp$loop$1659={},$jscomp$iter$390=$jscomp.makeIterator(vals$jscomp$0(null!=($jscomp$nullish$tmp36=model.component.selection)?$jscomp$nullish$tmp36:{}));for($jscomp$nullish$tmp36=$jscomp$iter$390.next();!$jscomp$nullish$tmp36.done;$jscomp$loop$1659=
{$jscomp$loop$prop$name$796$1660:$jscomp$loop$1659.$jscomp$loop$prop$name$796$1660},$jscomp$nullish$tmp36=$jscomp$iter$390.next()){$jscomp$nullish$tmp36=$jscomp$nullish$tmp36.value;$jscomp$loop$1659.$jscomp$loop$prop$name$796$1660=$jscomp$nullish$tmp36.name;hasSelections=vegaUtil.stringValue($jscomp$loop$1659.$jscomp$loop$prop$name$796$1660+"_store");if(0===signals.filter(function($jscomp$loop$1659){return function(s){return s.name===$jscomp$loop$1659.$jscomp$loop$prop$name$796$1660}}($jscomp$loop$1659)).length){var isPoint=
"point"===$jscomp$nullish$tmp36.type?", true, true)":")";signals.push({name:$jscomp$nullish$tmp36.name,update:"vlSelectionResolve("+hasSelections+", "+vegaUtil.stringValue("global"===$jscomp$nullish$tmp36.resolve?"union":$jscomp$nullish$tmp36.resolve)+isPoint})}hasSelections=!0;isPoint=$jscomp.makeIterator(selectionCompilers);for(var $jscomp$key$c=isPoint.next();!$jscomp$key$c.done;$jscomp$key$c=isPoint.next())$jscomp$key$c=$jscomp$key$c.value,$jscomp$key$c.defined($jscomp$nullish$tmp36)&&$jscomp$key$c.topLevelSignals&&
(signals=$jscomp$key$c.topLevelSignals(model,$jscomp$nullish$tmp36,signals))}hasSelections&&0===signals.filter(function(s){return"unit"===s.name}).length&&signals.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]});return cleanupEmptyOnArray(signals)}function assembleUnitSelectionData(model,data){data=[].concat($jscomp.arrayFromIterable(data));var $jscomp$nullish$tmp37,$jscomp$loop$1661={},$jscomp$iter$391=$jscomp.makeIterator(vals$jscomp$0(null!=($jscomp$nullish$tmp37=
model.component.selection)?$jscomp$nullish$tmp37:{}));for($jscomp$nullish$tmp37=$jscomp$iter$391.next();!$jscomp$nullish$tmp37.done;$jscomp$loop$1661={$jscomp$loop$prop$fields$1662:$jscomp$loop$1661.$jscomp$loop$prop$fields$1662,$jscomp$loop$prop$selCmpt$1663:$jscomp$loop$1661.$jscomp$loop$prop$selCmpt$1663},$jscomp$nullish$tmp37=$jscomp$iter$391.next())$jscomp$loop$1661.$jscomp$loop$prop$selCmpt$1663=$jscomp$nullish$tmp37.value,$jscomp$nullish$tmp37={name:$jscomp$loop$1661.$jscomp$loop$prop$selCmpt$1663.name+
"_store"},$jscomp$loop$1661.$jscomp$loop$prop$selCmpt$1663.init&&($jscomp$loop$1661.$jscomp$loop$prop$fields$1662=$jscomp$loop$1661.$jscomp$loop$prop$selCmpt$1663.project.items.map(function(proj){proj=Object.assign({},proj);return delete proj.signals,proj}),$jscomp$nullish$tmp37.values=$jscomp$loop$1661.$jscomp$loop$prop$selCmpt$1663.init.map(function($jscomp$loop$1661){return function(i){return{unit:unitName(model,{escape:!1}),fields:$jscomp$loop$1661.$jscomp$loop$prop$fields$1662,values:assembleInit(i,
!1)}}}($jscomp$loop$1661))),data.filter(function($jscomp$loop$1661){return function(d){return d.name===$jscomp$loop$1661.$jscomp$loop$prop$selCmpt$1663.name+"_store"}}($jscomp$loop$1661)).length||data.push($jscomp$nullish$tmp37);return data}function assembleUnitSelectionMarks(model,marks){var $jscomp$nullish$tmp38,$jscomp$iter$393=$jscomp.makeIterator(vals$jscomp$0(null!=($jscomp$nullish$tmp38=model.component.selection)?$jscomp$nullish$tmp38:{}));for($jscomp$nullish$tmp38=$jscomp$iter$393.next();!$jscomp$nullish$tmp38.done;$jscomp$nullish$tmp38=
$jscomp$iter$393.next()){$jscomp$nullish$tmp38=$jscomp$nullish$tmp38.value;for(var $jscomp$iter$392=$jscomp.makeIterator(selectionCompilers),$jscomp$key$c=$jscomp$iter$392.next();!$jscomp$key$c.done;$jscomp$key$c=$jscomp$iter$392.next())$jscomp$key$c=$jscomp$key$c.value,$jscomp$key$c.defined($jscomp$nullish$tmp38)&&$jscomp$key$c.marks&&(marks=$jscomp$key$c.marks(model,$jscomp$nullish$tmp38,marks))}return marks}function assembleLayerSelectionMarks(model,marks){model=$jscomp.makeIterator(model.children);
for(var $jscomp$key$child=model.next();!$jscomp$key$child.done;$jscomp$key$child=model.next())$jscomp$key$child=$jscomp$key$child.value,isUnitModel($jscomp$key$child)&&(marks=assembleUnitSelectionMarks($jscomp$key$child,marks));return marks}function cleanupEmptyOnArray(signals){return signals.map(function(s){s.on&&!s.on.length&&delete s.on;return s})}function domain$jscomp$0(model,channel){return"domain("+vegaUtil.stringValue(model.scaleName(channel))+")"}function isTopLevelLayer(model){var $jscomp$nullish$tmp42;
return model.parent&&isLayerModel(model.parent)&&(null!=($jscomp$nullish$tmp42=!model.parent.parent)?$jscomp$nullish$tmp42:isTopLevelLayer(model.parent.parent))}function channelSignals(model,selCmpt,proj,init){var channel=proj.channel,vname=proj.signals.visual;proj=proj.signals.data;var hasScales=scaleBindings.defined(selCmpt),scaleName=vegaUtil.stringValue(model.scaleName(channel)),scale=model.getScaleComponent(channel);scale=scale?scale.get("type"):void 0;var scaled=function(str){return"scale("+
scaleName+", "+str+")"},size=model.getSizeSignalRef("x"===channel?"width":"height").signal,coord=channel+"(unit)";model=events$jscomp$0(selCmpt,function(def,evt){return[].concat($jscomp.arrayFromIterable(def),[{events:evt.between[0],update:"["+coord+", "+coord+"]"},{events:evt,update:"["+vname+"[0], clamp("+coord+", 0, "+size+")]"}])});model.push({events:{signal:selCmpt.name+"_scale_trigger"},update:scale in CONTINUOUS_DOMAIN_INDEX?"["+scaled(proj+"[0]")+", "+scaled(proj+"[1]")+"]":"[0, 0]"});return hasScales?
[{name:proj,on:[]}]:[Object.assign({},{name:vname},init?{init:assembleInit(init,!0,scaled)}:{value:[]},{on:model}),Object.assign({},{name:proj},init?{init:assembleInit(init)}:{},{on:[{events:{signal:vname},update:vname+"[0] \x3d\x3d\x3d "+vname+"[1] ? null : invert("+scaleName+", "+vname+")"}]})]}function events$jscomp$0(selCmpt,cb){return selCmpt.events.reduce(function(on,evt){return evt.between?cb(on,evt):(warn(evt+" is not an ordered event stream for interval selections."),on)},[])}function wrapCondition(model,
channelDef,vgChannel,refFn){var condition=isConditionalDef(channelDef)&&channelDef.condition;channelDef=refFn(channelDef);if(condition){condition=vegaUtil.array(condition).map(function(c){var conditionValueRef=refFn(c);if(c.param)return c=parseSelectionPredicate(model,{param:c.param,empty:c.empty}),Object.assign({},{test:c},conditionValueRef);c=expression$jscomp$0(model,c.test);return Object.assign({},{test:c},conditionValueRef)});var $jscomp$compprop226={};return $jscomp$compprop226[vgChannel]=[].concat($jscomp.arrayFromIterable(condition),
$jscomp.arrayFromIterable(void 0!==channelDef?[channelDef]:[])),$jscomp$compprop226}condition={};return void 0!==channelDef?(condition[vgChannel]=channelDef,condition):{}}function text$1(model,channel){channel=void 0===channel?"text":channel;return wrapCondition(model,model.encoding[channel],channel,function(cDef){return textRef(cDef,model.config)})}function textRef(channelDef,config,expr){expr=void 0===expr?"datum":expr;if(channelDef){if(isValueDef(channelDef))return signalOrValueRef(channelDef.value);
if(isFieldOrDatumDef(channelDef)){var $jscomp$destructuring$var315=getFormatMixins(channelDef);return formatSignalRef({fieldOrDatumDef:channelDef,format:$jscomp$destructuring$var315.format,formatType:$jscomp$destructuring$var315.formatType,expr:expr,config:config})}}}function tooltip(model,opt){opt=void 0===opt?{}:opt;var encoding=model.encoding,markDef=model.markDef,config=model.config,stack=model.stack,channelDef=encoding.tooltip;if(vegaUtil.isArray(channelDef))return{tooltip:tooltipRefForEncoding({tooltip:channelDef},
stack,config,opt)};var datum=opt.reactiveGeom?"datum.datum":"datum";return wrapCondition(model,channelDef,"tooltip",function(cDef){var tooltipRefFromChannelDef=textRef(cDef,config,datum);if(tooltipRefFromChannelDef)return tooltipRefFromChannelDef;if(null!==cDef){cDef=getMarkPropOrConfig("tooltip",markDef,config);!0===cDef&&(cDef={content:"encoding"});if(vegaUtil.isString(cDef))return{value:cDef};if(vegaUtil.isObject(cDef))return isSignalRef(cDef)?cDef:"encoding"===cDef.content?tooltipRefForEncoding(encoding,
stack,config,opt):{signal:datum}}})}function tooltipData(encoding,stack,config,$jscomp$destructuring$var317){function add(fDef,channel){var mainChannel=getMainRangeChannel(channel);fDef=isTypedFieldDef(fDef)?fDef:Object.assign({},fDef,{type:encoding[mainChannel].type});mainChannel=fDef.title||titleFormatter(fDef,config);mainChannel=vegaUtil.array(mainChannel).join(", ");if(channel in POSITION_SCALE_CHANNEL_INDEX){var channel2="x"===channel?"x2":"y2",fieldDef2=getFieldDef(encoding[channel2]);if(isBinned(fDef.bin)&&
fieldDef2){var value=vgField(fDef,{expr:expr});fieldDef2=vgField(fieldDef2,{expr:expr});var $jscomp$destructuring$var319=getFormatMixins(fDef);value=binFormatExpression(value,fieldDef2,$jscomp$destructuring$var319.format,$jscomp$destructuring$var319.formatType,config);toSkip[channel2]=!0}else stack&&stack.fieldChannel===channel&&"normalize"===stack.offset&&(value=getFormatMixins(fDef),value=formatSignalRef({fieldOrDatumDef:fDef,format:value.format,formatType:value.formatType,expr:expr,config:config,
normalizeStack:!0}).signal)}null!=value||(value=textRef(fDef,config,expr).signal);tuples.push({channel:channel,key:mainChannel,value:value})}var toSkip={},expr=(void 0===$jscomp$destructuring$var317?{}:$jscomp$destructuring$var317).reactiveGeom?"datum.datum":"datum",tuples=[];forEach(encoding,function(channelDef,channel){isFieldDef(channelDef)?add(channelDef,channel):hasConditionalFieldDef(channelDef)&&add(channelDef.condition,channel)});$jscomp$destructuring$var317={};for(var $jscomp$iter$408=$jscomp.makeIterator(tuples),
$jscomp$key$=$jscomp$iter$408.next();!$jscomp$key$.done;$jscomp$key$=$jscomp$iter$408.next()){$jscomp$key$=$jscomp$key$.value;var key=$jscomp$key$.key,value$jscomp$0=$jscomp$key$.value;toSkip[$jscomp$key$.channel]||$jscomp$destructuring$var317[key]||($jscomp$destructuring$var317[key]=value$jscomp$0)}return $jscomp$destructuring$var317}function tooltipRefForEncoding(encoding,stack,config,$jscomp$destructuring$var323){encoding=tooltipData(encoding,stack,config,{reactiveGeom:(void 0===$jscomp$destructuring$var323?
{}:$jscomp$destructuring$var323).reactiveGeom});encoding=entries$1(encoding).map(function($jscomp$destructuring$var325){var $jscomp$destructuring$var326=$jscomp.makeIterator($jscomp$destructuring$var325);$jscomp$destructuring$var325=$jscomp$destructuring$var326.next().value;$jscomp$destructuring$var326=$jscomp$destructuring$var326.next().value;return'"'+$jscomp$destructuring$var325+'": '+$jscomp$destructuring$var326});return 0<encoding.length?{signal:"{"+encoding.join(", ")+"}"}:void 0}function aria(model){var enableAria=
getMarkPropOrConfig("aria",model.markDef,model.config);return!1===enableAria?{}:Object.assign({},enableAria?{aria:enableAria}:{},ariaRoleDescription(model),description(model))}function ariaRoleDescription(model){var mark=model.mark,config=model.config;if(!1===config.aria)return{};model=getMarkPropOrConfig("ariaRoleDescription",model.markDef,config);return null!=model?{ariaRoleDescription:{value:model}}:mark in VG_MARK_INDEX?{}:{ariaRoleDescription:{value:mark}}}function description(model){var encoding=
model.encoding,markDef=model.markDef,config=model.config,stack=model.stack,channelDef=encoding.description;if(channelDef)return wrapCondition(model,channelDef,"description",function(cDef){return textRef(cDef,model.config)});markDef=getMarkPropOrConfig("description",markDef,config);if(null!=markDef)return{description:signalOrValueRef(markDef)};if(!1===config.aria)return{};encoding=tooltipData(encoding,stack,config);if(!isEmpty(encoding))return{description:{signal:entries$1(encoding).map(function($jscomp$destructuring$var330,
index){var $jscomp$destructuring$var331=$jscomp.makeIterator($jscomp$destructuring$var330);$jscomp$destructuring$var330=$jscomp$destructuring$var331.next().value;$jscomp$destructuring$var331=$jscomp$destructuring$var331.next().value;return'"'+(0<index?"; ":"")+$jscomp$destructuring$var330+': " + ('+$jscomp$destructuring$var331+")"}).join(" + ")}}}function nonPosition(channel,model,opt){opt=void 0===opt?{}:opt;var markDef=model.markDef,encoding=model.encoding,config=model.config,vgChannel=opt.vgChannel,
defaultRef=opt.defaultRef;opt=opt.defaultValue;void 0===defaultRef&&(null!=opt||(opt=getMarkPropOrConfig(channel,markDef,config,{vgChannel:vgChannel,ignoreVgConfig:!0})),void 0!==opt&&(defaultRef=signalOrValueRef(opt)));return wrapCondition(model,encoding[channel],null!=vgChannel?vgChannel:channel,function(cDef){return midPoint({channel:channel,channelDef:cDef,markDef:markDef,config:config,scaleName:model.scaleName(channel),scale:model.getScaleComponent(channel),stack:null,defaultRef:defaultRef})})}
function color$jscomp$0(model,opt){opt=void 0===opt?{filled:void 0}:opt;var markDef=model.markDef,encoding=model.encoding,config=model.config,markType=markDef.type,$jscomp$nullish$tmp48;opt=null!=($jscomp$nullish$tmp48=opt.filled)?$jscomp$nullish$tmp48:getMarkPropOrConfig("filled",markDef,config);markType=contains(["bar","point","circle","square","geoshape"],markType)?"transparent":void 0;var $jscomp$nullish$tmp49,$jscomp$nullish$tmp50;markType=null!=($jscomp$nullish$tmp50=null!=($jscomp$nullish$tmp49=
getMarkPropOrConfig(!0===opt?"color":void 0,markDef,config,{vgChannel:"fill"}))?$jscomp$nullish$tmp49:config.mark[!0===opt&&"color"])?$jscomp$nullish$tmp50:markType;var $jscomp$nullish$tmp51;config=null!=($jscomp$nullish$tmp51=getMarkPropOrConfig(!1===opt?"color":void 0,markDef,config,{vgChannel:"stroke"}))?$jscomp$nullish$tmp51:config.mark[!1===opt&&"color"];$jscomp$nullish$tmp51=opt?"fill":"stroke";$jscomp$nullish$tmp49=Object.assign({},markType?{fill:signalOrValueRef(markType)}:{},config?{stroke:signalOrValueRef(config)}:
{});markDef.color&&(opt?markDef.fill:markDef.stroke)&&warn(droppingColor("property",{fill:"fill"in markDef,stroke:"stroke"in markDef}));return Object.assign({},$jscomp$nullish$tmp49,nonPosition("color",model,{vgChannel:$jscomp$nullish$tmp51,defaultValue:opt?markType:config}),nonPosition("fill",model,{defaultValue:encoding.fill?markType:void 0}),nonPosition("stroke",model,{defaultValue:encoding.stroke?config:void 0}))}function zindex(model){var order=model.encoding.order;return!isPathMark(model.mark)&&
isValueDef(order)?wrapCondition(model,order,"zindex",function(cd){return signalOrValueRef(cd.value)}):{}}function getOffset(channel,markDef){channel=getOffsetChannel(channel);if(markDef=markDef[channel])return markDef}function pointPosition(channel,model,$jscomp$destructuring$var338){var defaultPos=$jscomp$destructuring$var338.defaultPos;$jscomp$destructuring$var338=$jscomp$destructuring$var338.vgChannel;var encoding=model.encoding,markDef=model.markDef,config=model.config,stack=model.stack,channelDef=
encoding[channel],channel2Def=encoding[getSecondaryRangeChannel(channel)],scaleName=model.scaleName(channel),scale=model.getScaleComponent(channel),offset=getOffset(channel,markDef);defaultPos=pointPositionDefaultRef({model:model,defaultPos:defaultPos,channel:channel,scaleName:scaleName,scale:scale});if(!channelDef&&channel in POSITION_SCALE_CHANNEL_INDEX&&(encoding.latitude||encoding.longitude))model={field:model.getName(channel)};else a:if(stack={channel:channel,channelDef:channelDef,channel2Def:channel2Def,
markDef:markDef,config:config,scaleName:scaleName,scale:scale,stack:stack,offset:offset,defaultRef:defaultPos},model=stack.channel,defaultPos=stack.channelDef,encoding=stack.scaleName,channelDef=stack.stack,markDef=stack.offset,config=stack.markDef,isFieldOrDatumDef(defaultPos)&&channelDef&&model===channelDef.fieldChannel){if(isFieldDef(defaultPos)&&(stack=defaultPos.bandPosition,void 0!==stack||"text"!==config.type||"radius"!==model&&"theta"!==model||(stack=.5),void 0!==stack)){model=interpolatedSignalRef({scaleName:encoding,
fieldOrDatumDef:defaultPos,startSuffix:"start",bandPosition:stack,offset:markDef});break a}model=valueRefForFieldOrDatumDef(defaultPos,encoding,{suffix:"end"},{offset:markDef})}else model=midPointRefWithPositionInvalidTest(stack);defaultPos={};return model?(defaultPos[$jscomp$destructuring$var338||channel]=model,defaultPos):void 0}function pointPositionDefaultRef($jscomp$destructuring$var342){var model=$jscomp$destructuring$var342.model,defaultPos=$jscomp$destructuring$var342.defaultPos,channel=$jscomp$destructuring$var342.channel,
scaleName=$jscomp$destructuring$var342.scaleName,scale=$jscomp$destructuring$var342.scale,markDef=model.markDef,config=model.config;return function(){var mainChannel=getMainRangeChannel(channel),vgChannel=getVgPositionChannel(channel);vgChannel=getMarkPropOrConfig(channel,markDef,config,{vgChannel:vgChannel});if(void 0!==vgChannel)return widthHeightValueOrSignalRef(channel,vgChannel);switch(defaultPos){case "zeroOrMin":case "zeroOrMax":if(scaleName&&(vgChannel=scale.get("type"),!contains([ScaleType.LOG,
ScaleType.TIME,ScaleType.UTC],vgChannel)&&scale.domainDefinitelyIncludesZero()))return{scale:scaleName,value:0};if("zeroOrMin"===defaultPos)return"y"===mainChannel?{field:{group:"height"}}:{value:0};switch(mainChannel){case "radius":return{signal:"min("+model.width.signal+","+model.height.signal+")/2"};case "theta":return{signal:"2*PI"};case "x":return{field:{group:"width"}};case "y":return{value:0}}break;case "mid":return mainChannel=model[getSizeChannel$1(channel)],Object.assign({},mainChannel,
{mult:.5})}}}function vgAlignedPositionChannel(channel,markDef,config,defaultAlign){defaultAlign=void 0===defaultAlign?"middle":defaultAlign;if("radius"===channel||"theta"===channel)return getVgPositionChannel(channel);var alignChannel="x"===channel?"align":"baseline";markDef=getMarkPropOrConfig(alignChannel,markDef,config);isSignalRef(markDef)?(warn("The "+alignChannel+" for range marks cannot be an expression"),alignChannel=void 0):alignChannel=markDef;return"x"===channel?ALIGNED_X_CHANNEL[alignChannel||
("top"===defaultAlign?"left":"center")]:BASELINED_Y_CHANNEL[alignChannel||defaultAlign]}function pointOrRangePosition(channel,model,$jscomp$destructuring$var345){var defaultPos=$jscomp$destructuring$var345.defaultPos,defaultPos2=$jscomp$destructuring$var345.defaultPos2;return $jscomp$destructuring$var345.range?rangePosition(channel,model,{defaultPos:defaultPos,defaultPos2:defaultPos2}):pointPosition(channel,model,{defaultPos:defaultPos})}function rangePosition(channel,model,$jscomp$destructuring$var347){var defaultPos=
$jscomp$destructuring$var347.defaultPos,defaultPos2=$jscomp$destructuring$var347.defaultPos2;$jscomp$destructuring$var347=model.markDef;var config=model.config,channel2=getSecondaryRangeChannel(channel),sizeChannel=getSizeChannel$1(channel);var encoding=model.encoding,mark=model.mark,markDef=model.markDef,stack=model.stack,config$jscomp$0=model.config,baseChannel=getMainRangeChannel(channel2),sizeChannel$jscomp$0=getSizeChannel$1(channel2);var JSCompiler_inline_result=getVgPositionChannel(channel2);
var channelDef=encoding[baseChannel],scaleName=model.scaleName(baseChannel),scale=model.getScaleComponent(baseChannel);baseChannel=channel2 in encoding||channel2 in markDef?getOffset(channel2,model.markDef):getOffset(baseChannel,model.markDef);channelDef||"x2"!==channel2&&"y2"!==channel2||!encoding.latitude&&!encoding.longitude?(encoding=encoding[channel2],stack=isFieldOrDatumDef(channelDef)&&stack&&channel2.charAt(0)===stack.fieldChannel.charAt(0)?valueRefForFieldOrDatumDef(channelDef,scaleName,
{suffix:"start"},{offset:baseChannel}):midPointRefWithPositionInvalidTest({channel:channel2,channelDef:encoding,scaleName:scaleName,scale:scale,stack:stack,markDef:markDef,config:config$jscomp$0,offset:baseChannel,defaultRef:void 0}),void 0!==stack?(channel2={},JSCompiler_inline_result=(channel2[JSCompiler_inline_result]=stack,channel2)):(stack={},channelDef={},JSCompiler_inline_result=position2orSize(channel2,markDef)||position2orSize(channel2,(stack[channel2]=getMarkStyleConfig(channel2,markDef,
config$jscomp$0.style),stack[sizeChannel$jscomp$0]=getMarkStyleConfig(sizeChannel$jscomp$0,markDef,config$jscomp$0.style),stack))||position2orSize(channel2,config$jscomp$0[mark])||position2orSize(channel2,config$jscomp$0.mark)||(channelDef[JSCompiler_inline_result]=pointPositionDefaultRef({model:model,defaultPos:defaultPos2,channel:channel2,scaleName:scaleName,scale:scale})(),channelDef))):(defaultPos2=getSizeChannel$1(channel2),mark=model.markDef[defaultPos2],null!=mark?(JSCompiler_inline_result=
{},JSCompiler_inline_result=(JSCompiler_inline_result[defaultPos2]={value:mark},JSCompiler_inline_result)):(defaultPos2={},JSCompiler_inline_result=(defaultPos2[JSCompiler_inline_result]={field:model.getName(channel2)},defaultPos2)));$jscomp$destructuring$var347=JSCompiler_inline_result[sizeChannel]?vgAlignedPositionChannel(channel,$jscomp$destructuring$var347,config):getVgPositionChannel(channel);return Object.assign({},pointPosition(channel,model,{defaultPos:defaultPos,vgChannel:$jscomp$destructuring$var347}),
JSCompiler_inline_result)}function position2orSize(channel,markDef){var sizeChannel=getSizeChannel$1(channel),vgChannel=getVgPositionChannel(channel);if(void 0!==markDef[vgChannel])return sizeChannel={},sizeChannel[vgChannel]=widthHeightValueOrSignalRef(channel,markDef[vgChannel]),sizeChannel;if(void 0!==markDef[channel])return sizeChannel={},sizeChannel[vgChannel]=widthHeightValueOrSignalRef(channel,markDef[channel]),sizeChannel;if(markDef[sizeChannel])if(markDef=markDef[sizeChannel],isRelativeBandSize(markDef))warn("Position range does not support relative band size for "+
sizeChannel+".");else return vgChannel={},vgChannel[sizeChannel]=widthHeightValueOrSignalRef(channel,markDef),vgChannel}function rectPosition(model,channel,mark){var config=model.config,encoding=model.encoding,markDef=model.markDef,channel2=getSecondaryRangeChannel(channel),sizeChannel=getSizeChannel$1(channel),channelDef=encoding[channel],channelDef2=encoding[channel2],scale=model.getScaleComponent(channel),scaleType=scale?scale.get("type"):void 0;channel2=model.scaleName(channel);var orient=markDef.orient,
$jscomp$nullish$tmp52,$jscomp$nullish$tmp53;encoding=null!=($jscomp$nullish$tmp53=null!=($jscomp$nullish$tmp52=encoding[sizeChannel])?$jscomp$nullish$tmp52:encoding.size)?$jscomp$nullish$tmp53:getMarkPropOrConfig("size",markDef,config,{vgChannel:sizeChannel});mark="bar"===mark&&("x"===channel?"vertical"===orient:"horizontal"===orient);if(!isFieldDef(channelDef)||!(isBinning(channelDef.bin)||isBinned(channelDef.bin)||channelDef.timeUnit&&!channelDef2)||encoding&&!isRelativeBandSize(encoding)||scaleType in
DISCRETE_DOMAIN_INDEX){if((isFieldOrDatumDef(channelDef)&&scaleType in DISCRETE_DOMAIN_INDEX||mark)&&!channelDef2){channelDef2=model.markDef;markDef=model.encoding;scale=model.config;var stack=model.stack;scaleType=channelDef2.orient;var scaleName=model.scaleName(channel);mark=model.getScaleComponent(channel);channel2=getSizeChannel$1(channel);config=getSecondaryRangeChannel(channel);scaleType="horizontal"===scaleType&&"y"===channel||"vertical"===scaleType&&"x"===channel;var sizeMixins;if(markDef.size||
channelDef2.size)scaleType?sizeMixins=nonPosition("size",model,{vgChannel:channel2,defaultRef:signalOrValueRef(channelDef2.size)}):warn('Cannot apply size to non-oriented mark "'+channelDef2.type+'".');$jscomp$nullish$tmp52=getBandSize({channel:channel,fieldDef:channelDef,markDef:channelDef2,config:scale,scaleType:null===mark||void 0===mark?void 0:mark.get("type"),useVlSizeChannel:scaleType});markDef={};sizeMixins=sizeMixins||(markDef[channel2]=defaultSizeRef(channel2,scaleName,mark,scale,$jscomp$nullish$tmp52),
markDef);markDef="band"===(null===mark||void 0===mark?void 0:mark.get("type"))&&"band"in sizeMixins[channel2]?"top":"middle";markDef=vgAlignedPositionChannel(channel,channelDef2,scale,markDef);$jscomp$nullish$tmp53="xc"===markDef||"yc"===markDef;scaleType=getOffset(channel,channelDef2);channel=midPointRefWithPositionInvalidTest({channel:channel,channelDef:channelDef,markDef:channelDef2,config:scale,scaleName:scaleName,scale:mark,stack:stack,offset:scaleType,defaultRef:pointPositionDefaultRef({model:model,
defaultPos:"mid",channel:channel,scaleName:scaleName,scale:mark}),bandPosition:$jscomp$nullish$tmp53?.5:isSignalRef($jscomp$nullish$tmp52)?{signal:"(1-"+$jscomp$nullish$tmp52+")/2"}:isRelativeBandSize($jscomp$nullish$tmp52)?(1-$jscomp$nullish$tmp52.band)/2:0});channel2?(channelDef={},channel=Object.assign({},(channelDef[markDef]=channel,channelDef),sizeMixins)):(channelDef=getVgPositionChannel(config),sizeMixins=sizeMixins[channel2],sizeMixins=scaleType?Object.assign({},sizeMixins,{offset:scaleType}):
sizeMixins,model={},channel=(model[markDef]=channel,model[channelDef]=vegaUtil.isArray(channel)?[channel[0],Object.assign({},channel[1],{offset:sizeMixins})]:Object.assign({},channel,{offset:sizeMixins}),model));return channel}return rangePosition(channel,model,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}mark=getBandSize({channel:channel,fieldDef:channelDef,markDef:markDef,config:config,scaleType:scaleType});sizeMixins=null===(scaleName=model.component.axes[channel])||void 0===scaleName?void 0:
scaleName[0];sizeMixins=null!=(stack=null===sizeMixins||void 0===sizeMixins?void 0:sizeMixins.get("translate"))?stack:.5;a:if(stack=channel in POSITION_SCALE_CHANNEL_INDEX?getMarkPropOrConfig("binSpacing",markDef,config):void 0,model=scale.get("reverse"),scale=void 0===stack?0:stack,$jscomp$nullish$tmp52=getSecondaryRangeChannel(channel),stack=getVgPositionChannel(channel),scaleName=getVgPositionChannel($jscomp$nullish$tmp52),scaleType=getOffset(channel,markDef),mark=isSignalRef(mark)?{signal:"(1-"+
mark.signal+")/2"}:isRelativeBandSize(mark)?(1-mark.band)/2:.5,isBinning(channelDef.bin)||channelDef.timeUnit)channelDef2={},channel=(channelDef2[scaleName]=rectBinRef({channel:channel,fieldDef:channelDef,scaleName:channel2,markDef:markDef,bandPosition:mark,offset:getBinSpacing($jscomp$nullish$tmp52,scale,model,sizeMixins,scaleType),config:config}),channelDef2[stack]=rectBinRef({channel:channel,fieldDef:channelDef,scaleName:channel2,markDef:markDef,bandPosition:isSignalRef(mark)?{signal:"1-"+mark.signal}:
1-mark,offset:getBinSpacing(channel,scale,model,sizeMixins,scaleType),config:config}),channelDef2);else{if(isBinned(channelDef.bin)){config=valueRefForFieldOrDatumDef(channelDef,channel2,{},{offset:getBinSpacing($jscomp$nullish$tmp52,scale,model,sizeMixins,scaleType)});if(isFieldDef(channelDef2)){channelDef={};channel=(channelDef[scaleName]=config,channelDef[stack]=valueRefForFieldOrDatumDef(channelDef2,channel2,{},{offset:getBinSpacing(channel,scale,model,sizeMixins,scaleType)}),channelDef);break a}if(vegaUtil.isObject(channelDef.bin)&&
channelDef.bin.step){markDef={};channel=(markDef[scaleName]=config,markDef[stack]={signal:'scale("'+channel2+'", '+vgField(channelDef,{expr:"datum"})+" + "+channelDef.bin.step+")",offset:getBinSpacing(channel,scale,model,sizeMixins,scaleType)},markDef);break a}}warn(channelRequiredForBinned($jscomp$nullish$tmp52));channel=void 0}return channel}function defaultSizeRef(sizeChannel,scaleName,scale,config,bandSize){if(isRelativeBandSize(bandSize))if(scale){var scaleType$807=scale.get("type");if("band"===
scaleType$807)return{scale:scaleName,band:bandSize.band};1!==bandSize.band&&warn("Cannot use the relative band size with "+scaleType$807+" scale.")}else return{mult:bandSize.band,field:{group:sizeChannel}};else{if(isSignalRef(bandSize))return bandSize;if(bandSize)return{value:bandSize}}return scale&&(scaleName=scale.get("range"),isVgRangeStep(scaleName)&&vegaUtil.isNumber(scaleName.step))?{value:scaleName.step-2}:{value:getViewConfigDiscreteStep(config.view,sizeChannel)-2}}function getBinSpacing(channel,
spacing,reverse,translate,offset){if(channel in POLAR_POSITION_CHANNEL_INDEX)return 0;channel="x"===channel||"y2"===channel?-spacing/2:spacing/2;if(isSignalRef(reverse)||isSignalRef(offset)||isSignalRef(translate))return reverse=signalOrStringValue(reverse),offset=signalOrStringValue(offset),translate=signalOrStringValue(translate),{signal:(translate?translate+" + ":"")+(reverse?"("+reverse+" ? -1 : 1) * ":"")+(offset?"("+offset+" + "+channel+")":channel)};offset=offset||0;return translate+(reverse?
-offset-channel:+offset+channel)}function rectBinRef($jscomp$destructuring$var357){var channel=$jscomp$destructuring$var357.channel,fieldDef=$jscomp$destructuring$var357.fieldDef,markDef=$jscomp$destructuring$var357.markDef,config=$jscomp$destructuring$var357.config;$jscomp$destructuring$var357=interpolatedSignalRef({scaleName:$jscomp$destructuring$var357.scaleName,fieldOrDatumDef:fieldDef,bandPosition:$jscomp$destructuring$var357.bandPosition,offset:$jscomp$destructuring$var357.offset});return wrapPositionInvalidTest({fieldDef:fieldDef,
channel:channel,markDef:markDef,ref:$jscomp$destructuring$var357,config:config})}function baseEncodeEntry(model,ignore){var $jscomp$destructuring$var359="include"===ignore.color?color$jscomp$0(model):{},fill=void 0===$jscomp$destructuring$var359.fill?void 0:$jscomp$destructuring$var359.fill;$jscomp$destructuring$var359=void 0===$jscomp$destructuring$var359.stroke?void 0:$jscomp$destructuring$var359.stroke;return Object.assign({},markDefProperties(model.markDef,ignore),wrapAllFieldsInvalid(model,"fill",
fill),wrapAllFieldsInvalid(model,"stroke",$jscomp$destructuring$var359),nonPosition("opacity",model),nonPosition("fillOpacity",model),nonPosition("strokeOpacity",model),nonPosition("strokeWidth",model),nonPosition("strokeDash",model),zindex(model),tooltip(model),text$1(model,"href"),aria(model))}function wrapAllFieldsInvalid(model,channel,valueRef){var mark=model.mark;if("hide"===getMarkPropOrConfig("invalid",model.markDef,model.config)&&valueRef&&!isPathMark(mark)&&(model=allFieldsInvalidPredicate$1(model,
{invalid:!0,channels:SCALE_CHANNELS})))return mark={},mark[channel]=[{test:model,value:null}].concat($jscomp.arrayFromIterable(vegaUtil.array(valueRef))),mark;model={};return valueRef?(model[channel]=valueRef,model):{}}function markDefProperties(mark,ignore){return VG_MARK_CONFIGS.reduce(function(m,prop){ALWAYS_IGNORE.has(prop)||void 0===mark[prop]||"ignore"===ignore[prop]||(m[prop]=signalOrValueRef(mark[prop]));return m},{})}function allFieldsInvalidPredicate$1(model,$jscomp$destructuring$var361){var invalid=
void 0===$jscomp$destructuring$var361.invalid?!1:$jscomp$destructuring$var361.invalid;$jscomp$destructuring$var361=$jscomp$destructuring$var361.channels.reduce(function(aggregator,channel){var scaleComponent=model.getScaleComponent(channel);scaleComponent&&(scaleComponent=scaleComponent.get("type"),(channel=model.vgField(channel,{expr:"datum"}))&&scaleComponent in CONTINUOUS_DOMAIN_INDEX&&(aggregator[channel]=!0));return aggregator},{});$jscomp$destructuring$var361=keys$jscomp$0($jscomp$destructuring$var361);
if(0<$jscomp$destructuring$var361.length){var op=invalid?"||":"\x26\x26";return $jscomp$destructuring$var361.map(function(field){return fieldInvalidPredicate(field,invalid)}).join(" "+op+" ")}}function defined(model){return getMarkPropOrConfig("invalid",model.markDef,model.config)&&(model=allFieldsInvalidPredicate(model,{channels:POSITION_SCALE_CHANNELS}))?{defined:{signal:model}}:{}}function allFieldsInvalidPredicate(model,$jscomp$destructuring$var364){var invalid=void 0===$jscomp$destructuring$var364.invalid?
!1:$jscomp$destructuring$var364.invalid;$jscomp$destructuring$var364=$jscomp$destructuring$var364.channels.reduce(function(aggregator,channel){var scaleComponent=model.getScaleComponent(channel);scaleComponent&&(scaleComponent=scaleComponent.get("type"),(channel=model.vgField(channel,{expr:"datum"}))&&scaleComponent in CONTINUOUS_DOMAIN_INDEX&&(aggregator[channel]=!0));return aggregator},{});$jscomp$destructuring$var364=keys$jscomp$0($jscomp$destructuring$var364);if(0<$jscomp$destructuring$var364.length){var op=
invalid?"||":"\x26\x26";return $jscomp$destructuring$var364.map(function(field){return fieldInvalidPredicate(field,invalid)}).join(" "+op+" ")}}function valueIfDefined(prop,value){if(void 0!==value){var $jscomp$compprop245={};return $jscomp$compprop245[prop]=signalOrValueRef(value),$jscomp$compprop245}}function onDelta$1(model,selCmpt,proj,size,signals){var name=selCmpt.name,anchor=name+"_translate_anchor";name+="_translate_delta";var channel=proj.channel,hasScales=scaleBindings.defined(selCmpt);
selCmpt=signals.filter(function(s){return s.name===proj.signals[hasScales?"data":"visual"]})[0];size=model.getSizeSignalRef(size).signal;model=model.getScaleComponent(channel);signals=model.get("type");var reversed=model.get("reverse");anchor=anchor+".extent_"+channel;channel=(hasScales?"x"===channel?reversed?"":"-":reversed?"-":"":"")+name+"."+channel+" / "+(hasScales?""+size:"span("+anchor+")");reversed=hasScales?"log"===signals?"panLog":"symlog"===signals?"panSymlog":"pow"===signals?"panPow":"panLinear":
"panLinear";var $jscomp$nullish$tmp62,$jscomp$nullish$tmp63;model=hasScales?"pow"===signals?", "+(null!=($jscomp$nullish$tmp62=model.get("exponent"))?$jscomp$nullish$tmp62:1):"symlog"===signals?", "+(null!=($jscomp$nullish$tmp63=model.get("constant"))?$jscomp$nullish$tmp63:1):"":"";$jscomp$nullish$tmp62=reversed+"("+anchor+", "+channel+model+")";selCmpt.on.push({events:{signal:name},update:hasScales?$jscomp$nullish$tmp62:"clampRange("+$jscomp$nullish$tmp62+", 0, "+size+")"})}function onDelta(model,
selCmpt,proj,size,signals){var name=selCmpt.name,channel=proj.channel,hasScales=scaleBindings.defined(selCmpt);selCmpt=signals.filter(function(s){return s.name===proj.signals[hasScales?"data":"visual"]})[0];size=model.getSizeSignalRef(size).signal;signals=model.getScaleComponent(channel);var scaleType=signals.get("type"),base=hasScales?domain$jscomp$0(model,channel):selCmpt.name;model=name+"_zoom_delta";name=""+name+"_zoom_anchor."+channel;channel=hasScales?"log"===scaleType?"zoomLog":"symlog"===
scaleType?"zoomSymlog":"pow"===scaleType?"zoomPow":"zoomLinear":"zoomLinear";var $jscomp$nullish$tmp64,$jscomp$nullish$tmp65;signals=hasScales?"pow"===scaleType?", "+(null!=($jscomp$nullish$tmp64=signals.get("exponent"))?$jscomp$nullish$tmp64:1):"symlog"===scaleType?", "+(null!=($jscomp$nullish$tmp65=signals.get("constant"))?$jscomp$nullish$tmp65:1):"":"";$jscomp$nullish$tmp64=channel+"("+base+", "+name+", "+model+signals+")";selCmpt.on.push({events:{signal:model},update:hasScales?$jscomp$nullish$tmp64:
"clampRange("+$jscomp$nullish$tmp64+", 0, "+size+")"})}function unitName(model,$jscomp$destructuring$var369){$jscomp$destructuring$var369=(void 0===$jscomp$destructuring$var369?{escape:!0}:$jscomp$destructuring$var369).escape?vegaUtil.stringValue(model.name):model.name;for(model=model.parent;model&&!isFacetModel(model);)model=model.parent;if(model)for(var facet=model.facet,$jscomp$iter$415=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$415.next();!$jscomp$key$channel.done;$jscomp$key$channel=
$jscomp$iter$415.next())$jscomp$key$channel=$jscomp$key$channel.value,facet[$jscomp$key$channel]&&($jscomp$destructuring$var369+=" + '__facet_"+$jscomp$key$channel+"_' + (facet["+vegaUtil.stringValue(model.vgField($jscomp$key$channel))+"])");return $jscomp$destructuring$var369}function requiresSelectionId(model){var $jscomp$nullish$tmp66;return vals$jscomp$0(null!=($jscomp$nullish$tmp66=model.component.selection)?$jscomp$nullish$tmp66:{}).reduce(function(identifier,selCmpt){return identifier||selCmpt.project.items.some(function(proj){return"_vgsid_"===
proj.field})},!1)}function disableDirectManipulation(selCmpt,selDef){!vega.isString(selDef.select)&&selDef.select.on||delete selCmpt.events;!vega.isString(selDef.select)&&selDef.select.clear||delete selCmpt.clear;!vega.isString(selDef.select)&&selDef.select.toggle||delete selCmpt.toggle}function ASTNode(type){this.type=type}function children$jscomp$0(node){switch(node.type){case "ArrayExpression":return node.elements;case "BinaryExpression":case "LogicalExpression":return[node.left,node.right];case "CallExpression":return[node.callee].concat(node.arguments);
case "ConditionalExpression":return[node.test,node.consequent,node.alternate];case "MemberExpression":return[node.object,node.property];case "ObjectExpression":return node.properties;case "Property":return[node.key,node.value];case "UnaryExpression":return[node.argument];default:return[]}}function assert(condition,message){if(!condition)throw Error("ASSERT: "+message);}function isDecimalDigit(ch){return 48<=ch&&57>=ch}function isHexDigit(ch){return 0<="0123456789abcdefABCDEF".indexOf(ch)}function isOctalDigit(ch){return 0<=
"01234567".indexOf(ch)}function isLineTerminator(ch){return 10===ch||13===ch||8232===ch||8233===ch}function isIdentifierStart(ch){return 36===ch||95===ch||65<=ch&&90>=ch||97<=ch&&122>=ch||92===ch||128<=ch&&RegexNonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return 36===ch||95===ch||65<=ch&&90>=ch||97<=ch&&122>=ch||48<=ch&&57>=ch||92===ch||128<=ch&&RegexNonAsciiIdentifierPart.test(String.fromCharCode(ch))}function skipComment(){for(;index$jscomp$0<length$jscomp$0;){var ch=
source$jscomp$0.charCodeAt(index$jscomp$0);if(32===ch||9===ch||11===ch||12===ch||160===ch||5760<=ch&&0<=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)||isLineTerminator(ch))++index$jscomp$0;else break}}function scanHexEscape(prefix){var code=0;var len="u"===prefix?4:2;for(prefix=0;prefix<len;++prefix)if(index$jscomp$0<length$jscomp$0&&isHexDigit(source$jscomp$0[index$jscomp$0])){var ch=source$jscomp$0[index$jscomp$0++];code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase())}else throwError({},
"Unexpected token %0","ILLEGAL");return String.fromCharCode(code)}function getEscapedIdentifier(){var ch=source$jscomp$0.charCodeAt(index$jscomp$0++);var id=String.fromCharCode(ch);92===ch&&(117!==source$jscomp$0.charCodeAt(index$jscomp$0)&&throwError({},"Unexpected token %0","ILLEGAL"),++index$jscomp$0,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierStart(ch.charCodeAt(0))||throwError({},"Unexpected token %0","ILLEGAL"),id=ch);for(;index$jscomp$0<length$jscomp$0;){ch=source$jscomp$0.charCodeAt(index$jscomp$0);
if(!isIdentifierPart(ch))break;++index$jscomp$0;id+=String.fromCharCode(ch);92===ch&&(id=id.substr(0,id.length-1),117!==source$jscomp$0.charCodeAt(index$jscomp$0)&&throwError({},"Unexpected token %0","ILLEGAL"),++index$jscomp$0,(ch=scanHexEscape("u"))&&"\\"!==ch&&isIdentifierPart(ch.charCodeAt(0))||throwError({},"Unexpected token %0","ILLEGAL"),id+=ch)}return id}function scanPunctuator(){var start=index$jscomp$0,code=source$jscomp$0.charCodeAt(index$jscomp$0),ch1=source$jscomp$0[index$jscomp$0];switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++index$jscomp$0,
{type:7,value:String.fromCharCode(code),start:start,end:index$jscomp$0};default:var code2=source$jscomp$0.charCodeAt(index$jscomp$0+1);if(61===code2)switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return index$jscomp$0+=2,{type:7,value:String.fromCharCode(code)+String.fromCharCode(code2),start:start,end:index$jscomp$0};case 33:case 61:return index$jscomp$0+=2,61===source$jscomp$0.charCodeAt(index$jscomp$0)&&++index$jscomp$0,{type:7,value:source$jscomp$0.slice(start,
index$jscomp$0),start:start,end:index$jscomp$0}}}code=source$jscomp$0.substr(index$jscomp$0,4);if("\x3e\x3e\x3e\x3d"===code)return index$jscomp$0+=4,{type:7,value:code,start:start,end:index$jscomp$0};code=code.substr(0,3);if("\x3e\x3e\x3e"===code||"\x3c\x3c\x3d"===code||"\x3e\x3e\x3d"===code)return index$jscomp$0+=3,{type:7,value:code,start:start,end:index$jscomp$0};code=code.substr(0,2);if(ch1===code[1]&&0<="+-\x3c\x3e\x26|".indexOf(ch1)||"\x3d\x3e"===code)return index$jscomp$0+=2,{type:7,value:code,
start:start,end:index$jscomp$0};"//"===code&&throwError({},"Unexpected token %0","ILLEGAL");if(0<="\x3c\x3e\x3d!+-*%\x26|^/".indexOf(ch1))return++index$jscomp$0,{type:7,value:ch1,start:start,end:index$jscomp$0};throwError({},"Unexpected token %0","ILLEGAL")}function scanNumericLiteral(){var ch=source$jscomp$0[index$jscomp$0];assert(isDecimalDigit(ch.charCodeAt(0))||"."===ch,"Numeric literal must start with a decimal digit or a decimal point");var start=index$jscomp$0;var number="";if("."!==ch){number=
source$jscomp$0[index$jscomp$0++];ch=source$jscomp$0[index$jscomp$0];if("0"===number){if("x"===ch||"X"===ch){++index$jscomp$0;for(number="";index$jscomp$0<length$jscomp$0&&isHexDigit(source$jscomp$0[index$jscomp$0]);)number+=source$jscomp$0[index$jscomp$0++];0===number.length&&throwError({},"Unexpected token %0","ILLEGAL");isIdentifierStart(source$jscomp$0.charCodeAt(index$jscomp$0))&&throwError({},"Unexpected token %0","ILLEGAL");return{type:6,value:parseInt("0x"+number,16),start:start,end:index$jscomp$0}}if(isOctalDigit(ch)){for(number=
"0"+source$jscomp$0[index$jscomp$0++];index$jscomp$0<length$jscomp$0&&isOctalDigit(source$jscomp$0[index$jscomp$0]);)number+=source$jscomp$0[index$jscomp$0++];(isIdentifierStart(source$jscomp$0.charCodeAt(index$jscomp$0))||isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0)))&&throwError({},"Unexpected token %0","ILLEGAL");return{type:6,value:parseInt(number,8),octal:!0,start:start,end:index$jscomp$0}}ch&&isDecimalDigit(ch.charCodeAt(0))&&throwError({},"Unexpected token %0","ILLEGAL")}for(;isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0));)number+=
source$jscomp$0[index$jscomp$0++];ch=source$jscomp$0[index$jscomp$0]}if("."===ch){for(number+=source$jscomp$0[index$jscomp$0++];isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0));)number+=source$jscomp$0[index$jscomp$0++];ch=source$jscomp$0[index$jscomp$0]}if("e"===ch||"E"===ch){number+=source$jscomp$0[index$jscomp$0++];ch=source$jscomp$0[index$jscomp$0];if("+"===ch||"-"===ch)number+=source$jscomp$0[index$jscomp$0++];if(isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0)))for(;isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0));)number+=
source$jscomp$0[index$jscomp$0++];else throwError({},"Unexpected token %0","ILLEGAL")}isIdentifierStart(source$jscomp$0.charCodeAt(index$jscomp$0))&&throwError({},"Unexpected token %0","ILLEGAL");return{type:6,value:parseFloat(number),start:start,end:index$jscomp$0}}function testRegExp(pattern,flags){var tmp=pattern;0<=flags.indexOf("u")&&(tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}/g,function($0,$1){if(1114111>=parseInt($1,16))return"x";throwError({},"Invalid regular expression")}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,
"x"));try{new RegExp(tmp)}catch(e){throwError({},"Invalid regular expression")}try{return new RegExp(pattern,flags)}catch(exception){return null}}function advance(){skipComment();if(index$jscomp$0>=length$jscomp$0)return{type:2,start:index$jscomp$0,end:index$jscomp$0};var ch=source$jscomp$0.charCodeAt(index$jscomp$0);if(isIdentifierStart(ch)){ch=index$jscomp$0;if(92===source$jscomp$0.charCodeAt(index$jscomp$0))var id=getEscapedIdentifier();else a:{for(id=index$jscomp$0++;index$jscomp$0<length$jscomp$0;){var ch$jscomp$0=
source$jscomp$0.charCodeAt(index$jscomp$0);if(92===ch$jscomp$0){index$jscomp$0=id;id=getEscapedIdentifier();break a}if(isIdentifierPart(ch$jscomp$0))++index$jscomp$0;else break}id=source$jscomp$0.slice(id,index$jscomp$0)}return{type:1===id.length?3:keywords.hasOwnProperty(id)?4:"null"===id?5:"true"===id||"false"===id?1:3,value:id,start:ch,end:index$jscomp$0}}if(40===ch||41===ch||59===ch)return scanPunctuator();if(39===ch||34===ch){var str="";ch$jscomp$0=!1;ch=source$jscomp$0[index$jscomp$0];assert("'"===
ch||'"'===ch,"String literal must starts with a quote");id=index$jscomp$0;for(++index$jscomp$0;index$jscomp$0<length$jscomp$0;){var ch$jscomp$1=source$jscomp$0[index$jscomp$0++];if(ch$jscomp$1===ch){ch="";break}else if("\\"===ch$jscomp$1)if((ch$jscomp$1=source$jscomp$0[index$jscomp$0++])&&isLineTerminator(ch$jscomp$1.charCodeAt(0)))"\r"===ch$jscomp$1&&"\n"===source$jscomp$0[index$jscomp$0]&&++index$jscomp$0;else switch(ch$jscomp$1){case "u":case "x":if("{"===source$jscomp$0[index$jscomp$0]){++index$jscomp$0;
var code=source$jscomp$0[index$jscomp$0];ch$jscomp$1=0;for("}"===code&&throwError({},"Unexpected token %0","ILLEGAL");index$jscomp$0<length$jscomp$0;){code=source$jscomp$0[index$jscomp$0++];if(!isHexDigit(code))break;ch$jscomp$1=16*ch$jscomp$1+"0123456789abcdef".indexOf(code.toLowerCase())}(1114111<ch$jscomp$1||"}"!==code)&&throwError({},"Unexpected token %0","ILLEGAL");ch$jscomp$1=65535>=ch$jscomp$1?String.fromCharCode(ch$jscomp$1):String.fromCharCode((ch$jscomp$1-65536>>10)+55296,(ch$jscomp$1-65536&
1023)+56320);str+=ch$jscomp$1}else str+=scanHexEscape(ch$jscomp$1);break;case "n":str+="\n";break;case "r":str+="\r";break;case "t":str+="\t";break;case "b":str+="\b";break;case "f":str+="\f";break;case "v":str+="\x0B";break;default:isOctalDigit(ch$jscomp$1)?(code="01234567".indexOf(ch$jscomp$1),0!==code&&(ch$jscomp$0=!0),index$jscomp$0<length$jscomp$0&&isOctalDigit(source$jscomp$0[index$jscomp$0])&&(ch$jscomp$0=!0,code=8*code+"01234567".indexOf(source$jscomp$0[index$jscomp$0++]),0<="0123".indexOf(ch$jscomp$1)&&
index$jscomp$0<length$jscomp$0&&isOctalDigit(source$jscomp$0[index$jscomp$0])&&(code=8*code+"01234567".indexOf(source$jscomp$0[index$jscomp$0++]))),str+=String.fromCharCode(code)):str+=ch$jscomp$1}else if(isLineTerminator(ch$jscomp$1.charCodeAt(0)))break;else str+=ch$jscomp$1}""!==ch&&throwError({},"Unexpected token %0","ILLEGAL");return{type:8,value:str,octal:ch$jscomp$0,start:id,end:index$jscomp$0}}return 46===ch?isDecimalDigit(source$jscomp$0.charCodeAt(index$jscomp$0+1))?scanNumericLiteral():
scanPunctuator():isDecimalDigit(ch)?scanNumericLiteral():scanPunctuator()}function lex(){var token=lookahead;index$jscomp$0=token.end;lookahead=advance();index$jscomp$0=token.end;return token}function finishBinaryExpression(operator,left,right){var node=new ASTNode("||"===operator||"\x26\x26"===operator?"LogicalExpression":"BinaryExpression");node.operator=operator;node.left=left;node.right=right;return node}function finishIdentifier(name){var node=new ASTNode("Identifier");node.name=name;return node}
function finishLiteral(token){var node=new ASTNode("Literal");node.value=token.value;node.raw=source$jscomp$0.slice(token.start,token.end);token.regex&&("//"===node.raw&&(node.raw="/(?:)/"),node.regex=token.regex);return node}function finishMemberExpression(accessor,object,property){var node=new ASTNode("MemberExpression");node.computed="["===accessor;node.object=object;node.property=property;node.computed||(property.member=!0);return node}function finishProperty(kind,key,value){var node=new ASTNode("Property");
node.key=key;node.value=value;node.kind=kind;return node}function throwError(token,messageFormat){var args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){assert(index<args.length,"Message reference must be in range");return args[index]});var error=Error(msg);error.index=index$jscomp$0;error.description=msg;throw error;}function throwUnexpected(token){2===token.type&&throwError(token,"Unexpected end of input");6===token.type&&throwError(token,"Unexpected number");
8===token.type&&throwError(token,"Unexpected string");3===token.type&&throwError(token,"Unexpected identifier");4===token.type&&throwError(token,"Unexpected reserved word");throwError(token,"Unexpected token %0",token.value)}function expect(value){var token=lex();7===token.type&&token.value===value||throwUnexpected(token)}function match(value){return 7===lookahead.type&&lookahead.value===value}function parseObjectPropertyKey(){index$jscomp$0=lookahead.start;var token=lex();return 8===token.type||
6===token.type?(token.octal&&throwError(token,"Octal literals are not allowed in strict mode."),finishLiteral(token)):finishIdentifier(token.value)}function parsePrimaryExpression(){if(match("(")){expect("(");var token=parseExpression$1();expect(")");return token}if(match("[")){token=[];index$jscomp$0=lookahead.start;for(expect("[");!match("]");)match(",")?(lex(),token.push(null)):(token.push(parseConditionalExpression()),match("]")||expect(","));lex();var JSCompiler_object_inline_value_5999=new ASTNode("ArrayExpression");
JSCompiler_object_inline_value_5999.elements=token;return JSCompiler_object_inline_value_5999}if(match("{")){token=[];JSCompiler_object_inline_value_5999={};var JSCompiler_object_inline_literal_6000=String;index$jscomp$0=lookahead.start;for(expect("{");!match("}");){index$jscomp$0=lookahead.start;var JSCompiler_object_inline_value_6001=lookahead;if(3===JSCompiler_object_inline_value_6001.type){var JSCompiler_object_inline_literal_6002=parseObjectPropertyKey();expect(":");JSCompiler_object_inline_value_6001=
parseConditionalExpression();JSCompiler_object_inline_value_6001=finishProperty("init",JSCompiler_object_inline_literal_6002,JSCompiler_object_inline_value_6001)}else 2===JSCompiler_object_inline_value_6001.type||7===JSCompiler_object_inline_value_6001.type?(throwUnexpected(JSCompiler_object_inline_value_6001),JSCompiler_object_inline_value_6001=void 0):(JSCompiler_object_inline_literal_6002=parseObjectPropertyKey(),expect(":"),JSCompiler_object_inline_value_6001=parseConditionalExpression(),JSCompiler_object_inline_value_6001=
finishProperty("init",JSCompiler_object_inline_literal_6002,JSCompiler_object_inline_value_6001));JSCompiler_object_inline_literal_6002="Identifier"===JSCompiler_object_inline_value_6001.key.type?JSCompiler_object_inline_value_6001.key.name:JSCompiler_object_inline_literal_6000(JSCompiler_object_inline_value_6001.key.value);JSCompiler_object_inline_literal_6002="$"+JSCompiler_object_inline_literal_6002;Object.prototype.hasOwnProperty.call(JSCompiler_object_inline_value_5999,JSCompiler_object_inline_literal_6002)?
throwError({},"Duplicate data property in object literal not allowed in strict mode"):JSCompiler_object_inline_value_5999[JSCompiler_object_inline_literal_6002]=!0;token.push(JSCompiler_object_inline_value_6001);match("}")||expect(",")}expect("}");JSCompiler_object_inline_value_5999=new ASTNode("ObjectExpression");JSCompiler_object_inline_value_5999.properties=token;return JSCompiler_object_inline_value_5999}JSCompiler_object_inline_value_5999=lookahead.type;index$jscomp$0=lookahead.start;if(3===
JSCompiler_object_inline_value_5999||legalKeywords[lookahead.value])token=finishIdentifier(lex().value);else if(8===JSCompiler_object_inline_value_5999||6===JSCompiler_object_inline_value_5999)lookahead.octal&&throwError(lookahead,"Octal literals are not allowed in strict mode."),token=finishLiteral(lex());else{if(4===JSCompiler_object_inline_value_5999)throw Error("Disabled.");if(1===JSCompiler_object_inline_value_5999)token=lex(),token.value="true"===token.value,token=finishLiteral(token);else if(5===
JSCompiler_object_inline_value_5999)token=lex(),token.value=null,token=finishLiteral(token);else if(match("/")||match("/\x3d")){var value;lookahead=null;skipComment();token=index$jscomp$0;JSCompiler_object_inline_value_5999=source$jscomp$0[index$jscomp$0];assert("/"===JSCompiler_object_inline_value_5999,"Regular expression literal must start with a slash");JSCompiler_object_inline_literal_6000=source$jscomp$0[index$jscomp$0++];for(JSCompiler_object_inline_literal_6002=JSCompiler_object_inline_value_6001=
!1;index$jscomp$0<length$jscomp$0;)if(JSCompiler_object_inline_value_5999=source$jscomp$0[index$jscomp$0++],JSCompiler_object_inline_literal_6000+=JSCompiler_object_inline_value_5999,"\\"===JSCompiler_object_inline_value_5999)JSCompiler_object_inline_value_5999=source$jscomp$0[index$jscomp$0++],isLineTerminator(JSCompiler_object_inline_value_5999.charCodeAt(0))&&throwError({},"Invalid regular expression: missing /"),JSCompiler_object_inline_literal_6000+=JSCompiler_object_inline_value_5999;else if(isLineTerminator(JSCompiler_object_inline_value_5999.charCodeAt(0)))throwError({},
"Invalid regular expression: missing /");else if(JSCompiler_object_inline_value_6001)"]"===JSCompiler_object_inline_value_5999&&(JSCompiler_object_inline_value_6001=!1);else if("/"===JSCompiler_object_inline_value_5999){JSCompiler_object_inline_literal_6002=!0;break}else"["===JSCompiler_object_inline_value_5999&&(JSCompiler_object_inline_value_6001=!0);JSCompiler_object_inline_literal_6002||throwError({},"Invalid regular expression: missing /");JSCompiler_object_inline_value_5999=JSCompiler_object_inline_literal_6000.substr(1,
JSCompiler_object_inline_literal_6000.length-2);for(value=JSCompiler_object_inline_literal_6002="";index$jscomp$0<length$jscomp$0;){JSCompiler_object_inline_value_6001=source$jscomp$0[index$jscomp$0];if(!isIdentifierPart(JSCompiler_object_inline_value_6001.charCodeAt(0)))break;++index$jscomp$0;"\\"===JSCompiler_object_inline_value_6001&&index$jscomp$0<length$jscomp$0?throwError({},"Unexpected token %0","ILLEGAL"):(value+=JSCompiler_object_inline_value_6001,JSCompiler_object_inline_literal_6002+=JSCompiler_object_inline_value_6001)}0<=
value.search(/[^gimuy]/g)&&throwError({},"Invalid regular expression",value);JSCompiler_object_inline_value_6001=value;value=testRegExp(JSCompiler_object_inline_value_5999,JSCompiler_object_inline_value_6001);token=finishLiteral({literal:JSCompiler_object_inline_literal_6000+JSCompiler_object_inline_literal_6002,value:value,regex:{pattern:JSCompiler_object_inline_value_5999,flags:JSCompiler_object_inline_value_6001},start:token,end:index$jscomp$0});JSCompiler_object_inline_value_5999=index$jscomp$0;
lookahead=advance();index$jscomp$0=JSCompiler_object_inline_value_5999}else throwUnexpected(lex())}return token}function parsePostfixExpression(){var JSCompiler_inline_result;for(JSCompiler_inline_result=parsePrimaryExpression();;)if(match(".")){expect(".");index$jscomp$0=lookahead.start;var args=lex();3===args.type||4===args.type||1===args.type||5===args.type||throwUnexpected(args);args=finishIdentifier(args.value);JSCompiler_inline_result=finishMemberExpression(".",JSCompiler_inline_result,args)}else if(match("(")){args=
[];expect("(");if(!match(")"))for(;index$jscomp$0<length$jscomp$0;){args.push(parseConditionalExpression());if(match(")"))break;expect(",")}expect(")");var node=new ASTNode("CallExpression");node.callee=JSCompiler_inline_result;node.arguments=args;JSCompiler_inline_result=node}else if(match("["))expect("["),args=parseExpression$1(),expect("]"),JSCompiler_inline_result=finishMemberExpression("[",JSCompiler_inline_result,args);else break;if(7===lookahead.type&&(match("++")||match("--")))throw Error("Disabled.");
return JSCompiler_inline_result}function parseUnaryExpression(){if(7!==lookahead.type&&4!==lookahead.type)var expr=parsePostfixExpression();else{if(match("++")||match("--"))throw Error("Disabled.");if(match("+")||match("-")||match("~")||match("!")){var token=lex();expr=parseUnaryExpression();token=token.value;var node=new ASTNode("UnaryExpression");node.operator=token;node.argument=expr;node.prefix=!0;expr=node}else{if(4===lookahead.type&&"delete"===lookahead.value||4===lookahead.type&&"void"===lookahead.value||
4===lookahead.type&&"typeof"===lookahead.value)throw Error("Disabled.");expr=parsePostfixExpression()}}return expr}function binaryPrecedence(token){var prec=0;if(7!==token.type&&4!==token.type)return 0;switch(token.value){case "||":prec=1;break;case "\x26\x26":prec=2;break;case "|":prec=3;break;case "^":prec=4;break;case "\x26":prec=5;break;case "\x3d\x3d":case "!\x3d":case "\x3d\x3d\x3d":case "!\x3d\x3d":prec=6;break;case "\x3c":case "\x3e":case "\x3c\x3d":case "\x3e\x3d":case "instanceof":case "in":prec=
7;break;case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":prec=8;break;case "+":case "-":prec=9;break;case "*":case "/":case "%":prec=11}return prec}function parseConditionalExpression(){var consequent=lookahead;var expr=parseUnaryExpression();var token=lookahead;var alternate=binaryPrecedence(token);if(0===alternate)var expr$jscomp$0=expr;else{token.prec=alternate;lex();consequent=[consequent,lookahead];var right=parseUnaryExpression();for(expr$jscomp$0=[expr,token,right];0<(alternate=binaryPrecedence(lookahead));){for(;2<
expr$jscomp$0.length&&alternate<=expr$jscomp$0[expr$jscomp$0.length-2].prec;)right=expr$jscomp$0.pop(),token=expr$jscomp$0.pop().value,expr=expr$jscomp$0.pop(),consequent.pop(),expr=finishBinaryExpression(token,expr,right),expr$jscomp$0.push(expr);token=lex();token.prec=alternate;expr$jscomp$0.push(token);consequent.push(lookahead);expr=parseUnaryExpression();expr$jscomp$0.push(expr)}alternate=expr$jscomp$0.length-1;expr=expr$jscomp$0[alternate];for(consequent.pop();1<alternate;)consequent.pop(),
expr=finishBinaryExpression(expr$jscomp$0[alternate-1].value,expr$jscomp$0[alternate-2],expr),alternate-=2;expr$jscomp$0=expr}match("?")&&(lex(),consequent=parseConditionalExpression(),expect(":"),alternate=parseConditionalExpression(),expr=new ASTNode("ConditionalExpression"),expr.test=expr$jscomp$0,expr.consequent=consequent,expr.alternate=alternate,expr$jscomp$0=expr);return expr$jscomp$0}function parseExpression$1(){var expr=parseConditionalExpression();if(match(","))throw Error("Disabled.");
return expr}function parser(code){source$jscomp$0=code;index$jscomp$0=0;length$jscomp$0=source$jscomp$0.length;lookahead=null;code=index$jscomp$0;lookahead=advance();index$jscomp$0=code;code=parseExpression$1();if(2!==lookahead.type)throw Error("Unexpect token after expression.");return code}function getName(node){var name=[];if("Identifier"===node.type)return[node.name];if("Literal"===node.type)return[node.value];"MemberExpression"===node.type&&(name.push.apply(name,$jscomp.arrayFromIterable(getName(node.object))),
name.push.apply(name,$jscomp.arrayFromIterable(getName(node.property))));return name}function startsWithDatum(node){return"MemberExpression"===node.object.type?startsWithDatum(node.object):"datum"===node.object.name}function getDependentFields(expression){expression=parser(expression);var dependents=new Set;expression.visit(function(node){"MemberExpression"===node.type&&startsWithDatum(node)&&dependents.add(getName(node).slice(1).join("."))});return dependents}function parseSelectionPredicate(model,
pred,dfnode,datum){datum=void 0===datum?"datum":datum;var name=vegaUtil.isString(pred)?pred:pred.param,vname=varName(name),store=vegaUtil.stringValue(vname+"_store");try{var selCmpt=model.getSelectionComponent(vname,name)}catch(e){return"!!"+vname}selCmpt.project.timeUnit&&(model=null!=dfnode?dfnode:model.component.data.raw,dfnode=selCmpt.project.timeUnit.clone(),model.parent?dfnode.insertAsParentOf(model):model.parent=dfnode);datum="vlSelectionTest("+store+", "+datum+("global"===selCmpt.resolve?
")":", "+vegaUtil.stringValue(selCmpt.resolve)+")");store="length(data("+store+"))";return!1===pred.empty?store+" \x26\x26 "+datum:"!"+store+" || "+datum}function parseSelectionExtent(model,name,extent){var vname=varName(name),encoding=extent.encoding,field=extent.field;try{var selCmpt=model.getSelectionComponent(vname,name)}catch(e){return vname}encoding||field?encoding&&!field&&(model=selCmpt.project.items.filter(function(p){return p.channel===encoding}),!model.length||1<model.length?(field=selCmpt.project.items[0].field,
warn((model.length?"Multiple ":"No ")+("matching "+vegaUtil.stringValue(encoding)+" encoding found for selection "+vegaUtil.stringValue(extent.param)+'. Using "field": ')+(vegaUtil.stringValue(field)+"."))):field=model[0].field):(field=selCmpt.project.items[0].field,1<selCmpt.project.items.length&&warn('A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": '+(vegaUtil.stringValue(field)+".")));return selCmpt.name+"["+vegaUtil.stringValue(replacePathInField(field))+
"]"}function expression$jscomp$0(model,filterOp,node){return logicalExpr(filterOp,function(predicate){return vegaUtil.isString(predicate)?predicate:(null===predicate||void 0===predicate?0:predicate.param)?parseSelectionPredicate(model,predicate,node):fieldFilterExpression(predicate)})}function assembleTitle(title,config){if(title)return vegaUtil.isArray(title)&&!isText(title)?title.map(function(fieldDef){return titleFormatter(fieldDef,config)}).join(", "):title}function setAxisEncode(axis,part,vgProp,
vgRef){var _axis$encode,_axis$encode$part;null!=axis.encode||(axis.encode={});null!=(_axis$encode=axis.encode)[part]||(_axis$encode[part]={});null!=(_axis$encode$part=axis.encode[part]).update||(_axis$encode$part.update={});axis.encode[part].update[vgProp]=vgRef}function assembleAxis(axisCmpt,kind,config,opt){opt=void 0===opt?{header:!1}:opt;var $jscomp$destructuring$var374=axisCmpt.combine(),$jscomp$destructuring$var375=Object.assign({},$jscomp$destructuring$var374),disable=$jscomp$destructuring$var374.disable,
orient=$jscomp$destructuring$var374.orient,scale=$jscomp$destructuring$var374.scale,labelExpr=$jscomp$destructuring$var374.labelExpr,title=$jscomp$destructuring$var374.title;$jscomp$destructuring$var374=$jscomp$destructuring$var374.zindex;$jscomp$destructuring$var375=(delete $jscomp$destructuring$var375.disable,delete $jscomp$destructuring$var375.orient,delete $jscomp$destructuring$var375.scale,delete $jscomp$destructuring$var375.labelExpr,delete $jscomp$destructuring$var375.title,delete $jscomp$destructuring$var375.zindex,
$jscomp$destructuring$var375);if(!disable){for(var prop in $jscomp$destructuring$var375){var propType=AXIS_PROPERTY_TYPE[prop];disable=$jscomp$destructuring$var375[prop];if(propType&&propType!==kind&&"both"!==propType)delete $jscomp$destructuring$var375[prop];else if(isConditionalAxisValue(disable)){propType=disable;disable=Object.assign({},propType);propType=propType.condition;disable=(delete disable.condition,disable);propType=vegaUtil.array(propType);var propIndex=CONDITIONAL_AXIS_PROP_INDEX[prop];
if(propIndex){var $jscomp$destructuring$var378=propIndex;propIndex=$jscomp$destructuring$var378.vgProp;$jscomp$destructuring$var378=$jscomp$destructuring$var378.part;disable=[].concat($jscomp.arrayFromIterable(propType.map(function(c){var $jscomp$destructuring$var380=Object.assign({},c);c=c.test;$jscomp$destructuring$var380=(delete $jscomp$destructuring$var380.test,$jscomp$destructuring$var380);return Object.assign({},{test:expression$jscomp$0(null,c)},$jscomp$destructuring$var380)})),[disable]);
setAxisEncode($jscomp$destructuring$var375,$jscomp$destructuring$var378,propIndex,disable);delete $jscomp$destructuring$var375[prop]}else null===propIndex&&(disable={signal:propType.map(function(c){var $jscomp$destructuring$var382=Object.assign({},c);c=c.test;$jscomp$destructuring$var382=(delete $jscomp$destructuring$var382.test,$jscomp$destructuring$var382);return expression$jscomp$0(null,c)+" ? "+(isSignalRef($jscomp$destructuring$var382)?$jscomp$destructuring$var382.signal:vegaUtil.stringValue($jscomp$destructuring$var382.value))+
" : "}).join("")+(isSignalRef(disable)?disable.signal:vegaUtil.stringValue(disable.value))},$jscomp$destructuring$var375[prop]=disable)}else isSignalRef(disable)&&(propType=CONDITIONAL_AXIS_PROP_INDEX[prop])&&(setAxisEncode($jscomp$destructuring$var375,propType.part,propType.vgProp,disable),delete $jscomp$destructuring$var375[prop]);contains(["labelAlign","labelBaseline"],prop)&&null===$jscomp$destructuring$var375[prop]&&delete $jscomp$destructuring$var375[prop]}if("grid"===kind){if($jscomp$destructuring$var375.grid)return $jscomp$destructuring$var375.encode&&
(config=$jscomp$destructuring$var375.encode.grid,$jscomp$destructuring$var375.encode=Object.assign({},config?{grid:config}:{}),isEmpty($jscomp$destructuring$var375.encode)&&delete $jscomp$destructuring$var375.encode),Object.assign({},{scale:scale,orient:orient},$jscomp$destructuring$var375,{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:getFirstDefined($jscomp$destructuring$var374,0)})}else if(opt.header||!axisCmpt.mainExtracted){if(void 0!==labelExpr){var _axis$encode2,_axis$encode2$labels;
kind=labelExpr;null!==(_axis$encode2=$jscomp$destructuring$var375.encode)&&void 0!==_axis$encode2&&null!==(_axis$encode2$labels=_axis$encode2.labels)&&void 0!==_axis$encode2$labels&&_axis$encode2$labels.update&&isSignalRef($jscomp$destructuring$var375.encode.labels.update.text)&&(kind=replaceAll(labelExpr,"datum.label",$jscomp$destructuring$var375.encode.labels.update.text.signal));setAxisEncode($jscomp$destructuring$var375,"labels","text",{signal:kind})}null===$jscomp$destructuring$var375.labelAlign&&
delete $jscomp$destructuring$var375.labelAlign;if($jscomp$destructuring$var375.encode){labelExpr=$jscomp.makeIterator(AXIS_PARTS);for(_axis$encode2=labelExpr.next();!_axis$encode2.done;_axis$encode2=labelExpr.next())_axis$encode2=_axis$encode2.value,axisCmpt.hasAxisPart(_axis$encode2)||delete $jscomp$destructuring$var375.encode[_axis$encode2];isEmpty($jscomp$destructuring$var375.encode)&&delete $jscomp$destructuring$var375.encode}axisCmpt=assembleTitle(title,config);return Object.assign({},{scale:scale,
orient:orient,grid:!1},axisCmpt?{title:axisCmpt}:{},$jscomp$destructuring$var375,!1===config.aria?{aria:!1}:{},{zindex:getFirstDefined($jscomp$destructuring$var374,0)})}}}function assembleAxisSignals(model){for(var axes=model.component.axes,signals=[],$jscomp$iter$421=$jscomp.makeIterator(POSITION_SCALE_CHANNELS),$jscomp$key$channel=$jscomp$iter$421.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$421.next())if($jscomp$key$channel=$jscomp$key$channel.value,axes[$jscomp$key$channel])for(var $jscomp$iter$420=
$jscomp.makeIterator(axes[$jscomp$key$channel]),$jscomp$key$axis=$jscomp$iter$420.next();!$jscomp$key$axis.done;$jscomp$key$axis=$jscomp$iter$420.next())if($jscomp$key$axis=$jscomp$key$axis.value,!$jscomp$key$axis.get("disable")&&!$jscomp$key$axis.get("gridScale")){$jscomp$key$axis="x"===$jscomp$key$channel?"height":"width";var update=model.getSizeSignalRef($jscomp$key$axis).signal;$jscomp$key$axis!==update&&signals.push({name:$jscomp$key$axis,update:update})}return signals}function assembleAxes(axisComponents,
config){var x=void 0===axisComponents.x?[]:axisComponents.x;axisComponents=void 0===axisComponents.y?[]:axisComponents.y;return[].concat($jscomp.arrayFromIterable(x.map(function(a){return assembleAxis(a,"grid",config)})),$jscomp.arrayFromIterable(axisComponents.map(function(a){return assembleAxis(a,"grid",config)})),$jscomp.arrayFromIterable(x.map(function(a){return assembleAxis(a,"main",config)})),$jscomp.arrayFromIterable(axisComponents.map(function(a){return assembleAxis(a,"main",config)}))).filter(function(a){return a})}
function getAxisConfigFromConfigTypes(configTypes,config,channel,orient){return Object.assign.apply(null,[{}].concat($jscomp.arrayFromIterable(configTypes.map(function(configType){if("axisOrient"===configType){configType="x"===channel?"bottom":"left";var orientConfig1=config["x"===channel?"axisBottom":"axisLeft"]||{},orientConfig2=config["x"===channel?"axisTop":"axisRight"]||{},props=new Set([].concat($jscomp.arrayFromIterable(keys$jscomp$0(orientConfig1)),$jscomp.arrayFromIterable(keys$jscomp$0(orientConfig2)))),
conditionalOrientAxisConfig={};props=$jscomp.makeIterator(props.values());for(var $jscomp$key$prop=props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next())$jscomp$key$prop=$jscomp$key$prop.value,conditionalOrientAxisConfig[$jscomp$key$prop]={signal:orient.signal+' \x3d\x3d\x3d "'+configType+'" ? '+signalOrStringValue(orientConfig1[$jscomp$key$prop])+" : "+signalOrStringValue(orientConfig2[$jscomp$key$prop])};return conditionalOrientAxisConfig}return config[configType]}))))}function getAxisConfigs(channel,
scaleType,orient,config){var typeBasedConfigTypes="band"===scaleType?["axisDiscrete","axisBand"]:"point"===scaleType?["axisDiscrete","axisPoint"]:scaleType in QUANTITATIVE_SCALES_INDEX?["axisQuantitative"]:"time"===scaleType||"utc"===scaleType?["axisTemporal"]:[],axisChannel="x"===channel?"axisX":"axisY";scaleType=isSignalRef(orient)?"axisOrient":"axis"+titleCase(orient);typeBasedConfigTypes=[].concat($jscomp.arrayFromIterable(typeBasedConfigTypes),$jscomp.arrayFromIterable(typeBasedConfigTypes.map(function(c){return axisChannel+
c.substr(4)})));scaleType=["axis",scaleType,axisChannel];return{vlOnlyAxisConfig:getAxisConfigFromConfigTypes(typeBasedConfigTypes,config,channel,orient),vgAxisConfig:getAxisConfigFromConfigTypes(scaleType,config,channel,orient),axisConfigStyle:getAxisConfigStyle([].concat($jscomp.arrayFromIterable(scaleType),$jscomp.arrayFromIterable(typeBasedConfigTypes)),config)}}function getAxisConfigStyle(axisConfigTypes,config){var toMerge=[{}];axisConfigTypes=$jscomp.makeIterator(axisConfigTypes);for(var $jscomp$key$configType=
axisConfigTypes.next();!$jscomp$key$configType.done;$jscomp$key$configType=axisConfigTypes.next()){var _config$configType;if($jscomp$key$configType=null===(_config$configType=config[$jscomp$key$configType.value])||void 0===_config$configType?void 0:_config$configType.style){$jscomp$key$configType=vegaUtil.array($jscomp$key$configType);$jscomp$key$configType=$jscomp.makeIterator($jscomp$key$configType);for(var $jscomp$key$s=$jscomp$key$configType.next();!$jscomp$key$s.done;$jscomp$key$s=$jscomp$key$configType.next())toMerge.push(config.style[$jscomp$key$s.value])}}return Object.assign.apply(null,
toMerge)}function getAxisConfig(property,styleConfigIndex,style,axisConfigs){axisConfigs=void 0===axisConfigs?{}:axisConfigs;styleConfigIndex=getStyleConfig(property,style,styleConfigIndex);if(void 0!==styleConfigIndex)return{configFrom:"style",configValue:styleConfigIndex};styleConfigIndex=$jscomp.makeIterator(["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"]);for(style=styleConfigIndex.next();!style.done;style=styleConfigIndex.next()){style=style.value;var _axisConfigs$configFr;if(void 0!==
(null===(_axisConfigs$configFr=axisConfigs[style])||void 0===_axisConfigs$configFr?void 0:_axisConfigs$configFr[property]))return{configFrom:style,configValue:axisConfigs[style][property]}}return{}}function getLabelAngle(fieldOrDatumDef,axis,channel,styleConfig,axisConfigs){var labelAngle=null===axis||void 0===axis?void 0:axis.labelAngle;if(void 0!==labelAngle)return isSignalRef(labelAngle)?labelAngle:normalizeAngle(labelAngle);axis=getAxisConfig("labelAngle",styleConfig,null===axis||void 0===axis?
void 0:axis.style,axisConfigs).configValue;if(void 0!==axis)return normalizeAngle(axis);if("x"===channel&&contains(["nominal","ordinal"],fieldOrDatumDef.type)&&(!isFieldDef(fieldOrDatumDef)||!fieldOrDatumDef.timeUnit))return 270}function normalizeAngleExpr(angle){return"((("+angle.signal+" % 360) + 360) % 360)"}function defaultLabelBaseline(angle,orient,channel,alwaysIncludeMiddle){if(void 0!==angle)return"x"===channel?isSignalRef(angle)?(alwaysIncludeMiddle=normalizeAngleExpr(angle),orient=isSignalRef(orient)?
"("+orient.signal+' \x3d\x3d\x3d "top")':"top"===orient,{signal:"(45 \x3c "+alwaysIncludeMiddle+" \x26\x26 "+alwaysIncludeMiddle+" \x3c 135) || (225 \x3c "+alwaysIncludeMiddle+" \x26\x26 "+alwaysIncludeMiddle+' \x3c 315) ? "middle" :('+(alwaysIncludeMiddle+" \x3c\x3d 45 || 315 \x3c\x3d "+alwaysIncludeMiddle+") \x3d\x3d\x3d "+orient+' ? "bottom" : "top"')}):45<angle&&135>angle||225<angle&&315>angle?"middle":isSignalRef(orient)?{signal:orient.signal+" "+(45>=angle||315<=angle?"\x3d\x3d\x3d":"!\x3d\x3d")+
' "top" ? "bottom" : "top"'}:(45>=angle||315<=angle)===("top"===orient)?"bottom":"top":isSignalRef(angle)?(angle=normalizeAngleExpr(angle),orient=isSignalRef(orient)?"("+orient.signal+' \x3d\x3d\x3d "left")':"left"===orient,{signal:angle+" \x3c\x3d 45 || 315 \x3c\x3d "+angle+" || (135 \x3c\x3d "+angle+" \x26\x26 "+angle+" \x3c\x3d 225) ? "+(alwaysIncludeMiddle?'"middle"':"null")+" : (45 \x3c\x3d "+angle+" \x26\x26 "+angle+" \x3c\x3d 135) \x3d\x3d\x3d "+orient+' ? "top" : "bottom"'}):45>=angle||315<=
angle||135<=angle&&225>=angle?alwaysIncludeMiddle?"middle":null:isSignalRef(orient)?{signal:orient.signal+" "+(45<=angle&&135>=angle?"\x3d\x3d\x3d":"!\x3d\x3d")+' "left" ? "top" : "bottom"'}:(45<=angle&&135>=angle)===("left"===orient)?"top":"bottom"}function defaultLabelAlign(angle,orient,channel){if(void 0!==angle){var startAngle=(channel="x"===channel)?0:90,mainOrient=channel?"bottom":"left";return isSignalRef(angle)?(angle=normalizeAngleExpr(angle),orient=isSignalRef(orient)?"("+orient.signal+
' \x3d\x3d\x3d "'+mainOrient+'")':orient===mainOrient,{signal:"("+(startAngle?"("+angle+" + 90)":angle)+" % 180 \x3d\x3d\x3d 0) ? "+(channel?null:'"center"')+" :("+(startAngle+" \x3c "+angle+" \x26\x26 "+angle+" \x3c "+(180+startAngle)+") \x3d\x3d\x3d "+orient+' ? "left" : "right"')}):0===(angle+startAngle)%180?channel?null:"center":isSignalRef(orient)?{signal:orient.signal+" "+(startAngle<angle&&angle<180+startAngle?"\x3d\x3d\x3d":"!\x3d\x3d")+' "'+mainOrient+'" ? "left" : "right"'}:(startAngle<
angle&&angle<180+startAngle)===(orient===mainOrient)?"left":"right"}}function getFieldDefTitle(model,channel){var channel2="x"===channel?"x2":"y2";channel=model.fieldDef(channel);model=model.fieldDef(channel2);channel2=channel?channel.title:void 0;model=model?model.title:void 0;if(channel2&&model)return mergeTitle(channel2,model);if(channel2)return channel2;if(model)return model;if(void 0!==channel2)return channel2;if(void 0!==model)return model}function sortArrayIndexField(fieldDef,channel,opt){return vgField(fieldDef,
Object.assign({},{prefix:channel,suffix:"sort_index"},null!=opt?opt:{}))}function getHeaderChannel(channel,orient){return contains(["top","bottom"],orient)?"column":contains(["left","right"],orient)?"row":"row"===channel?"row":"column"}function getHeaderProperty(prop,header,config,channel){return getFirstDefined((header||{})[prop],("row"===channel?config.headerRow:"column"===channel?config.headerColumn:config.headerFacet)[prop],config.header[prop])}function getHeaderProperties(properties,header,config,
channel){var props={};properties=$jscomp.makeIterator(properties);for(var $jscomp$key$prop=properties.next();!$jscomp$key$prop.done;$jscomp$key$prop=properties.next()){$jscomp$key$prop=$jscomp$key$prop.value;var value=getHeaderProperty($jscomp$key$prop,header||{},config,channel);void 0!==value&&(props[$jscomp$key$prop]=value)}return props}function assembleTitleGroup(model,channel){var title=model.component.layoutHeaders[channel].title,config=model.config?model.config:void 0;model=model.component.layoutHeaders[channel].facetFieldDef?
model.component.layoutHeaders[channel].facetFieldDef:void 0;var $jscomp$destructuring$var423=getHeaderProperties(["titleAnchor","titleAngle","titleOrient"],model.header,config,channel),titleAnchor=$jscomp$destructuring$var423.titleAnchor,ta=$jscomp$destructuring$var423.titleAngle;$jscomp$destructuring$var423=getHeaderChannel(channel,$jscomp$destructuring$var423.titleOrient);ta=normalizeAngle(ta);return{name:channel+"-title",type:"group",role:$jscomp$destructuring$var423+"-title",title:Object.assign({},
{text:title},"row"===channel?{orient:"left"}:{},{style:"guide-title"},defaultHeaderGuideBaseline(ta,$jscomp$destructuring$var423),defaultHeaderGuideAlign($jscomp$destructuring$var423,ta,titleAnchor),assembleHeaderProperties(config,model,channel,HEADER_TITLE_PROPERTIES,HEADER_TITLE_PROPERTIES_MAP))}}function defaultHeaderGuideAlign(headerChannel,angle,anchor){switch(void 0===anchor?"middle":anchor){case "start":return{align:"left"};case "end":return{align:"right"}}return(headerChannel=defaultLabelAlign(angle,
"row"===headerChannel?"left":"top","row"===headerChannel?"y":"x"))?{align:headerChannel}:{}}function defaultHeaderGuideBaseline(angle,channel){return(angle=defaultLabelBaseline(angle,"row"===channel?"left":"top","row"===channel?"y":"x",!0))?{baseline:angle}:{}}function assembleHeaderGroups(model$jscomp$0,channel$jscomp$0){for(var layoutHeader=model$jscomp$0.component.layoutHeaders[channel$jscomp$0],groups=[],$jscomp$iter$428=$jscomp.makeIterator(HEADER_TYPES),$jscomp$key$headerType=$jscomp$iter$428.next();!$jscomp$key$headerType.done;$jscomp$key$headerType=
$jscomp$iter$428.next())if($jscomp$key$headerType=$jscomp$key$headerType.value,layoutHeader[$jscomp$key$headerType])for(var $jscomp$iter$427=$jscomp.makeIterator(layoutHeader[$jscomp$key$headerType]),$jscomp$key$headerComponent=$jscomp$iter$427.next();!$jscomp$key$headerComponent.done;$jscomp$key$headerComponent=$jscomp$iter$427.next()){$jscomp$key$headerComponent=$jscomp$key$headerComponent.value;a:{var model=model$jscomp$0,channel=channel$jscomp$0;if($jscomp$key$headerComponent){var title$821=null,
facetFieldDef=layoutHeader.facetFieldDef,config=model.config?model.config:void 0;if(facetFieldDef&&$jscomp$key$headerComponent.labels){var labelOrient=getHeaderProperties(["labelOrient"],facetFieldDef.header,config,channel).labelOrient;if("row"===channel&&!contains(["top","bottom"],labelOrient)||"column"===channel&&!contains(["left","right"],labelOrient))title$821=assembleLabelTitle(facetFieldDef,channel,config)}config=isFacetModel(model)&&!isFacetMapping(model.facet);labelOrient=$jscomp$key$headerComponent.axes;
var hasAxes=0<(null===labelOrient||void 0===labelOrient?void 0:labelOrient.length);if(title$821||hasAxes){var sizeChannel="row"===channel?"height":"width",$jscomp$inline_4518={};$jscomp$key$headerComponent=Object.assign({},{name:model.getName(channel+"_"+$jscomp$key$headerType),type:"group",role:channel+"-"+$jscomp$key$headerType},layoutHeader.facetFieldDef?{from:{data:model.getName(channel+"_domain")},sort:getSort$1(facetFieldDef,channel)}:{},hasAxes&&config?{from:{data:model.getName("facet_domain_"+
channel)}}:{},title$821?{title:title$821}:{},$jscomp$key$headerComponent.sizeSignal?{encode:{update:($jscomp$inline_4518[sizeChannel]=$jscomp$key$headerComponent.sizeSignal,$jscomp$inline_4518)}}:{},hasAxes?{axes:labelOrient}:{});break a}}$jscomp$key$headerComponent=null}null!=$jscomp$key$headerComponent&&groups.push($jscomp$key$headerComponent)}return groups}function getSort$1(facetFieldDef,channel){var sort=facetFieldDef.sort;if(isSortField(sort)){var $jscomp$nullish$tmp79;return{field:vgField(sort,
{expr:"datum"}),order:null!=($jscomp$nullish$tmp79=sort.order)?$jscomp$nullish$tmp79:"ascending"}}return vegaUtil.isArray(sort)?{field:sortArrayIndexField(facetFieldDef,channel,{expr:"datum"}),order:"ascending"}:{field:vgField(facetFieldDef,{expr:"datum"}),order:null!=sort?sort:"ascending"}}function assembleLabelTitle(facetFieldDef,channel,config){var $jscomp$destructuring$var425=getHeaderProperties("format formatType labelAngle labelAnchor labelOrient labelExpr".split(" "),facetFieldDef.header,config,
channel),labelAngle=$jscomp$destructuring$var425.labelAngle,labelAnchor=$jscomp$destructuring$var425.labelAnchor,labelOrient=$jscomp$destructuring$var425.labelOrient,labelExpr=$jscomp$destructuring$var425.labelExpr;$jscomp$destructuring$var425=formatSignalRef({fieldOrDatumDef:facetFieldDef,format:$jscomp$destructuring$var425.format,formatType:$jscomp$destructuring$var425.formatType,expr:"parent",config:config}).signal;labelOrient=getHeaderChannel(channel,labelOrient);return Object.assign({},{text:{signal:labelExpr?
replaceAll(replaceAll(labelExpr,"datum.label",$jscomp$destructuring$var425),"datum.value",vgField(facetFieldDef,{expr:"parent"})):$jscomp$destructuring$var425}},"row"===channel?{orient:"left"}:{},{style:"guide-label",frame:"group"},defaultHeaderGuideBaseline(labelAngle,labelOrient),defaultHeaderGuideAlign(labelOrient,labelAngle,labelAnchor),assembleHeaderProperties(config,facetFieldDef,channel,HEADER_LABEL_PROPERTIES,HEADER_LABEL_PROPERTIES_MAP))}function assembleHeaderProperties(config,facetFieldDef,
channel,properties,propertiesMap){var props={};properties=$jscomp.makeIterator(properties);for(var $jscomp$key$prop=properties.next();!$jscomp$key$prop.done;$jscomp$key$prop=properties.next())if($jscomp$key$prop=$jscomp$key$prop.value,propertiesMap[$jscomp$key$prop]){var value=getHeaderProperty($jscomp$key$prop,null===facetFieldDef||void 0===facetFieldDef?void 0:facetFieldDef.header,config,channel);void 0!==value&&(props[propertiesMap[$jscomp$key$prop]]=value)}return props}function assembleLayoutSignals(model){return[].concat($jscomp.arrayFromIterable(sizeSignals(model,
"width")),$jscomp.arrayFromIterable(sizeSignals(model,"height")),$jscomp.arrayFromIterable(sizeSignals(model,"childWidth")),$jscomp.arrayFromIterable(sizeSignals(model,"childHeight")))}function sizeSignals(model,sizeType){var channel="width"===sizeType?"x":"y",size=model.component.layoutSize.get(sizeType);if(!size||"merged"===size)return[];sizeType=model.getSizeSignalRef(sizeType).signal;if("step"===size){if(size=model.getScaleComponent(channel)){var type$822=size.get("type"),range$823=size.get("range");
if(type$822 in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(range$823))return type$822=model.scaleName(channel),isFacetModel(model.parent)&&"independent"===model.parent.component.resolve.scale[channel]?[{name:type$822+"_step",value:range$823.step}]:[{name:type$822+"_step",value:range$823.step},{name:sizeType,update:sizeExpr(type$822,size,"domain('"+type$822+"').length")}]}throw Error("layout size is step although width/height is not step.");}return"container"==size?(channel=(size=sizeType.endsWith("width"))?
"containerSize()[0]":"containerSize()[1]",model=getViewConfigContinuousSize(model.config.view,size?"width":"height"),model="isFinite("+channel+") ? "+channel+" : "+model,[{name:sizeType,init:model,on:[{update:model,events:"window:resize"}]}]):[{name:sizeType,value:size}]}function sizeExpr(scaleName,scaleComponent,cardinality){var type=scaleComponent.get("type"),padding=scaleComponent.get("padding"),paddingOuter=getFirstDefined(scaleComponent.get("paddingOuter"),padding);scaleComponent=scaleComponent.get("paddingInner");
return"bandspace("+cardinality+", "+signalOrStringValue("band"===type?void 0!==scaleComponent?scaleComponent:padding:1)+", "+signalOrStringValue(paddingOuter)+") * "+scaleName+"_step"}function getSizeTypeFromLayoutSizeType(layoutSizeType){return"childWidth"===layoutSizeType?"width":"childHeight"===layoutSizeType?"height":layoutSizeType}function guideEncodeEntry(encoding,model){return keys$jscomp$0(encoding).reduce(function(encode,channel){return Object.assign({},encode,wrapCondition(model,encoding[channel],
channel,function(def){return signalOrValueRef(def.value)}))},{})}function defaultScaleResolve(channel,model){if(isFacetModel(model))return"theta"===channel?"independent":"shared";if(isLayerModel(model))return"shared";if(isConcatModel(model))return channel in POSITION_SCALE_CHANNEL_INDEX||"theta"===channel||"radius"===channel?"independent":"shared";throw Error("invalid model type for resolve");}function parseGuideResolve(resolve,channel){var guide=channel in POSITION_SCALE_CHANNEL_INDEX?"axis":"legend";
return"independent"===resolve.scale[channel]?("shared"===resolve[guide][channel]&&warn('Setting the scale to be independent for "'+channel+'" means we also have to set the guide (axis or legend) to be independent.'),"independent"):resolve[guide][channel]||"shared"}function getMaxValue(channelDef){return getConditionValue(channelDef,function(v,conditionalDef){return Math.max(v,conditionalDef.value)})}function getFirstConditionValue(channelDef){return getConditionValue(channelDef,function(v,conditionalDef){return getFirstDefined(v,
conditionalDef.value)})}function getConditionValue(channelDef,reducer){var condition=channelDef&&channelDef.condition;if(condition&&(vegaUtil.isArray(condition)||isValueDef(condition)))return vegaUtil.array(channelDef.condition).reduce(reducer,channelDef.value);if(isValueDef(channelDef))return channelDef.value}function selectedCondition(model,legendCmpt,fieldDef){model=legendCmpt.get("selections");if(null!==model&&void 0!==model&&model.length){var field=vegaUtil.stringValue(fieldDef.field);return model.map(function(name){return"(!length(data("+
vegaUtil.stringValue(varName(name)+"_store")+")) || ("+name+"["+field+"] \x26\x26 indexof("+name+"["+field+"], datum.value) \x3e\x3d 0))"}).join(" || ")}}function parseLegend(model$jscomp$0){if(isUnitModel(model$jscomp$0)){var JSCompiler_temp=model$jscomp$0.encoding;for(var legendComponent={},$jscomp$inline_4527=$jscomp.makeIterator(["color"].concat($jscomp.arrayFromIterable(LEGEND_SCALE_CHANNELS))),$jscomp$key$channel=$jscomp$inline_4527.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_4527.next()){$jscomp$key$channel=
$jscomp$key$channel.value;var def=getFieldOrDatumDef(JSCompiler_temp[$jscomp$key$channel]);if(def&&model$jscomp$0.getScaleComponent($jscomp$key$channel)&&("shape"!==$jscomp$key$channel||!isFieldDef(def)||"geojson"!==def.type)){var $jscomp$inline_5851=def=void 0,$jscomp$inline_5841=void 0,$jscomp$inline_5818=void 0,_model$fieldDef=void 0,_legend=void 0;var JSCompiler_inline_result=void 0;var model=model$jscomp$0,legend=model.legend($jscomp$key$channel),markDef=model.markDef,encoding=model.encoding,
config=model.config,legendConfig=config.legend,legendCmpt=new LegendComponent({},getLegendDefWithScale(model,$jscomp$key$channel)),field=null===(_model$fieldDef=model.fieldDef($jscomp$key$channel))||void 0===_model$fieldDef?void 0:_model$fieldDef.field;_model$fieldDef=$jscomp.makeIterator(vals$jscomp$0(null!=($jscomp$inline_5818=model.component.selection)?$jscomp$inline_5818:{}));for($jscomp$inline_5818=_model$fieldDef.next();!$jscomp$inline_5818.done;$jscomp$inline_5818=_model$fieldDef.next()){$jscomp$inline_5818=
$jscomp$inline_5818.value;var $jscomp$inline_5822=void 0,proj=null!=($jscomp$inline_5822=$jscomp$inline_5818.project.hasField[field])?$jscomp$inline_5822:$jscomp$inline_5818.project.hasChannel[$jscomp$key$channel];if(proj&&legendBindings.defined($jscomp$inline_5818)){$jscomp$inline_5822=void 0;var $jscomp$inline_5842=null!=($jscomp$inline_5822=legendCmpt.get("selections"))?$jscomp$inline_5822:[];$jscomp$inline_5842.push($jscomp$inline_5818.name);legendCmpt.set("selections",$jscomp$inline_5842,!1);
proj.hasLegend=!0}}field=void 0!==legend?!legend:legendConfig.disable;legendCmpt.set("disable",field,void 0!==legend);if(!field){legend=legend||{};_model$fieldDef=model.getScaleComponent($jscomp$key$channel).get("type");field=getFieldOrDatumDef(encoding[$jscomp$key$channel]);proj=isFieldDef(field)?null===(JSCompiler_inline_result=normalizeTimeUnit(field.timeUnit))||void 0===JSCompiler_inline_result?void 0:JSCompiler_inline_result.unit:void 0;$jscomp$inline_5818=legend.orient||config.legend.orient||
"right";JSCompiler_inline_result=legend.type;b:{$jscomp$inline_5822=_model$fieldDef;if(isColorChannel($jscomp$key$channel)){if(contains(["quarter","month","day"],proj)){proj="symbol";break b}if($jscomp$inline_5822 in CONTINUOUS_TO_CONTINUOUS_INDEX){proj="gradient";break b}}proj="symbol"}JSCompiler_inline_result=getFirstDefined(JSCompiler_inline_result,proj);$jscomp$inline_5842=legendConfig;proj=JSCompiler_inline_result;$jscomp$inline_5822=$jscomp$inline_5818;if(null!=($jscomp$inline_5842=null!=($jscomp$inline_5841=
legend.direction)?$jscomp$inline_5841:$jscomp$inline_5842[proj?"gradientDirection":"symbolDirection"]))$jscomp$inline_5841=$jscomp$inline_5842;else b:{switch($jscomp$inline_5822){case "top":case "bottom":$jscomp$inline_5841="horizontal";break b;case "left":case "right":case "none":case void 0:break;default:$jscomp$inline_5841="gradient"===proj?"horizontal":void 0;break b}$jscomp$inline_5841=void 0}markDef={legend:legend,channel:$jscomp$key$channel,model:model,markDef:markDef,encoding:encoding,fieldOrDatumDef:field,
legendConfig:legendConfig,config:config,scaleType:_model$fieldDef,orient:$jscomp$inline_5818,legendType:JSCompiler_inline_result,direction:$jscomp$inline_5841};encoding=$jscomp.makeIterator(LEGEND_COMPONENT_PROPERTIES);for(legendConfig=encoding.next();!legendConfig.done;legendConfig=encoding.next())if(legendConfig=legendConfig.value,!("gradient"===JSCompiler_inline_result&&legendConfig.startsWith("symbol")||"symbol"===JSCompiler_inline_result&&legendConfig.startsWith("gradient"))&&($jscomp$inline_5841=
legendConfig in legendRules?legendRules[legendConfig](markDef):legend[legendConfig],void 0!==$jscomp$inline_5841)){b:{_model$fieldDef=model.fieldDef($jscomp$key$channel);switch(legendConfig){case "disable":_model$fieldDef=void 0!==legend;break b;case "values":_model$fieldDef=!(null===legend||void 0===legend||!legend.values);break b;case "title":if("title"===legendConfig&&$jscomp$inline_5841===(null===_model$fieldDef||void 0===_model$fieldDef?void 0:_model$fieldDef.title)){_model$fieldDef=!0;break b}}_model$fieldDef=
$jscomp$inline_5841===(legend||{})[legendConfig]}(_model$fieldDef||void 0===config.legend[legendConfig])&&legendCmpt.set(legendConfig,$jscomp$inline_5841,_model$fieldDef)}config=null!=($jscomp$inline_5851=null===(_legend=legend)||void 0===_legend?void 0:_legend.encoding)?$jscomp$inline_5851:{};$jscomp$inline_5851=legendCmpt.get("selections");_legend={};markDef={fieldOrDatumDef:field,model:model,channel:$jscomp$key$channel,legendCmpt:legendCmpt,legendType:JSCompiler_inline_result};encoding=$jscomp.makeIterator("labels legend title symbols gradient entries".split(" "));
for(legendConfig=encoding.next();!legendConfig.done;legendConfig=encoding.next())legendConfig=legendConfig.value,$jscomp$inline_5841=void 0,JSCompiler_inline_result=guideEncodeEntry(null!=($jscomp$inline_5841=config[legendConfig])?$jscomp$inline_5841:{},model),$jscomp$inline_5841=legendConfig in legendEncodeRules?legendEncodeRules[legendConfig](JSCompiler_inline_result,markDef):JSCompiler_inline_result,void 0===$jscomp$inline_5841||isEmpty($jscomp$inline_5841)||(_legend[legendConfig]=Object.assign({},
null!==$jscomp$inline_5851&&void 0!==$jscomp$inline_5851&&$jscomp$inline_5851.length&&isFieldDef(field)?{name:varName(field.field)+"_legend_"+legendConfig}:{},null!==$jscomp$inline_5851&&void 0!==$jscomp$inline_5851&&$jscomp$inline_5851.length?{interactive:!!$jscomp$inline_5851}:{},{update:$jscomp$inline_5841}));isEmpty(_legend)||legendCmpt.set("encode",_legend,!(null===(def=legend)||void 0===def||!def.encoding))}def=legendCmpt;legendComponent[$jscomp$key$channel]=def}}JSCompiler_temp=legendComponent}else{legendComponent=
model$jscomp$0.component;JSCompiler_temp=legendComponent.legends;legendComponent=legendComponent.resolve;$jscomp$inline_4527=$jscomp.makeIterator(model$jscomp$0.children);for($jscomp$key$channel=$jscomp$inline_4527.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_4527.next())for($jscomp$key$channel=$jscomp$key$channel.value,parseLegend($jscomp$key$channel),def=$jscomp.makeIterator(keys$jscomp$0($jscomp$key$channel.component.legends)),model=def.next();!model.done;model=def.next())model=
model.value,legendComponent.legend[model]=parseGuideResolve(model$jscomp$0.component.resolve,model),"shared"===legendComponent.legend[model]&&(JSCompiler_temp[model]=mergeLegendComponent(JSCompiler_temp[model],$jscomp$key$channel.component.legends[model]),JSCompiler_temp[model]||(legendComponent.legend[model]="independent",delete JSCompiler_temp[model]));$jscomp$inline_4527=$jscomp.makeIterator(keys$jscomp$0(JSCompiler_temp));for(model=$jscomp$inline_4527.next();!model.done;model=$jscomp$inline_4527.next())for(def=
model.value,model=$jscomp.makeIterator(model$jscomp$0.children),$jscomp$key$channel=model.next();!$jscomp$key$channel.done;$jscomp$key$channel=model.next())$jscomp$key$channel=$jscomp$key$channel.value,$jscomp$key$channel.component.legends[def]&&"shared"===legendComponent.legend[def]&&delete $jscomp$key$channel.component.legends[def]}return model$jscomp$0.component.legends=JSCompiler_temp}function getLegendDefWithScale(model,channel){var scale=model.scaleName(channel);if("trail"===model.mark){if("color"===
channel)return{stroke:scale};if("size"===channel)return{strokeWidth:scale}}if("color"===channel)return model.markDef.filled?{fill:scale}:{stroke:scale};model={};return model[channel]=scale,model}function mergeLegendComponent(mergedLegend,childLegend){if(!mergedLegend)return childLegend.clone();var mergedOrient=mergedLegend.getWithExplicit("orient"),childOrient=childLegend.getWithExplicit("orient");if(!mergedOrient.explicit||!childOrient.explicit||mergedOrient.value===childOrient.value){var typeMerged=
!1;mergedOrient={};childOrient=$jscomp.makeIterator(LEGEND_COMPONENT_PROPERTIES);for(var $jscomp$key$prop=childOrient.next();!$jscomp$key$prop.done;mergedOrient={$jscomp$loop$prop$prop$1674:mergedOrient.$jscomp$loop$prop$prop$1674},$jscomp$key$prop=childOrient.next())mergedOrient.$jscomp$loop$prop$prop$1674=$jscomp$key$prop.value,$jscomp$key$prop=mergeValuesWithExplicit(mergedLegend.getWithExplicit(mergedOrient.$jscomp$loop$prop$prop$1674),childLegend.getWithExplicit(mergedOrient.$jscomp$loop$prop$prop$1674),
mergedOrient.$jscomp$loop$prop$prop$1674,"legend",function($jscomp$loop$1673){return function(v1,v2){switch($jscomp$loop$1673.$jscomp$loop$prop$prop$1674){case "symbolType":return v1="circle"===v2.value?v2:v1,v1;case "title":return mergeTitleComponent(v1,v2);case "type":return typeMerged=!0,makeImplicit("symbol")}return defaultTieBreaker(v1,v2,$jscomp$loop$1673.$jscomp$loop$prop$prop$1674,"legend")}}(mergedOrient)),mergedLegend.setWithExplicit(mergedOrient.$jscomp$loop$prop$prop$1674,$jscomp$key$prop);
if(typeMerged){var _mergedLegend$implici,_mergedLegend$implici2,_mergedLegend$explici,_mergedLegend$explici2;null!==(_mergedLegend$implici=mergedLegend.implicit)&&void 0!==_mergedLegend$implici&&null!==(_mergedLegend$implici2=_mergedLegend$implici.encode)&&void 0!==_mergedLegend$implici2&&_mergedLegend$implici2.gradient&&deleteNestedProperty(mergedLegend.implicit,["encode","gradient"]);null!==(_mergedLegend$explici=mergedLegend.explicit)&&void 0!==_mergedLegend$explici&&null!==(_mergedLegend$explici2=
_mergedLegend$explici.encode)&&void 0!==_mergedLegend$explici2&&_mergedLegend$explici2.gradient&&deleteNestedProperty(mergedLegend.explicit,["encode","gradient"])}return mergedLegend}}function assembleLegends(model){for(var legendComponentIndex=model.component.legends,legendByDomain={},$jscomp$iter$440=$jscomp.makeIterator(keys$jscomp$0(legendComponentIndex)),$jscomp$key$channel=$jscomp$iter$440.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$440.next()){$jscomp$key$channel=$jscomp$key$channel.value;
var scaleComponent=model.getScaleComponent($jscomp$key$channel);scaleComponent=stringify(scaleComponent.get("domains"));if(legendByDomain[scaleComponent])for(var $jscomp$iter$439=$jscomp.makeIterator(legendByDomain[scaleComponent]),$jscomp$key$mergedLegendComponent=$jscomp$iter$439.next();!$jscomp$key$mergedLegendComponent.done;$jscomp$key$mergedLegendComponent=$jscomp$iter$439.next())mergeLegendComponent($jscomp$key$mergedLegendComponent.value,legendComponentIndex[$jscomp$key$channel])||legendByDomain[scaleComponent].push(legendComponentIndex[$jscomp$key$channel]);
else legendByDomain[scaleComponent]=[legendComponentIndex[$jscomp$key$channel].clone()]}return vals$jscomp$0(legendByDomain).flat().map(function(l){var config=model.config,_legend$encode2;l=l.combine();var $jscomp$inline_4586=Object.assign({},l),disable=l.disable;l=l.labelExpr;$jscomp$inline_4586=(delete $jscomp$inline_4586.disable,delete $jscomp$inline_4586.labelExpr,delete $jscomp$inline_4586.selections,$jscomp$inline_4586);if(disable)var JSCompiler_inline_result=void 0;else{!1===config.aria&&void 0==
$jscomp$inline_4586.aria&&($jscomp$inline_4586.aria=!1);if(null!==(_legend$encode2=$jscomp$inline_4586.encode)&&void 0!==_legend$encode2&&_legend$encode2.symbols)for(config=$jscomp$inline_4586.encode.symbols.update,!config.fill||"transparent"===config.fill.value||config.stroke||$jscomp$inline_4586.stroke||(config.stroke={value:"transparent"}),_legend$encode2=$jscomp.makeIterator(LEGEND_SCALE_CHANNELS),disable=_legend$encode2.next();!disable.done;disable=_legend$encode2.next())disable=disable.value,
$jscomp$inline_4586[disable]&&delete config[disable];$jscomp$inline_4586.title||delete $jscomp$inline_4586.title;if(void 0!==l){var _legend$encode3,_legend$encode3$label;config=l;null!==(_legend$encode3=$jscomp$inline_4586.encode)&&void 0!==_legend$encode3&&null!==(_legend$encode3$label=_legend$encode3.labels)&&void 0!==_legend$encode3$label&&_legend$encode3$label.update&&isSignalRef($jscomp$inline_4586.encode.labels.update.text)&&(config=replaceAll(l,"datum.label",$jscomp$inline_4586.encode.labels.update.text.signal));
_legend$encode3={signal:config};var _legend$encode$part;null!=$jscomp$inline_4586.encode||($jscomp$inline_4586.encode={});null!=(JSCompiler_inline_result=$jscomp$inline_4586.encode).labels||(JSCompiler_inline_result.labels={});null!=(_legend$encode$part=$jscomp$inline_4586.encode.labels).update||(_legend$encode$part.update={});$jscomp$inline_4586.encode.labels.update.text=_legend$encode3}JSCompiler_inline_result=$jscomp$inline_4586}return JSCompiler_inline_result}).filter(function(l){return void 0!==
l})}function assembleProjectionsForModelAndChildren(model){return model.children.reduce(function(projections,child){return projections.concat(child.assembleProjections())},assembleProjectionForModel(model))}function assembleProjectionForModel(model){var component=model.component.projection;if(!component||component.merged)return[];var projection=component.combine(),name=projection.name;if(component.data){var size={signal:"["+component.size.map(function(ref){return ref.signal}).join(", ")+"]"};component=
component.data.reduce(function(sources,data){data=isSignalRef(data)?data.signal:"data('"+model.lookupDataSource(data)+"')";sources.includes(data)||sources.push(data);return sources},[]);if(0>=component.length)throw Error("Projection's fit didn't find any data sources");return[Object.assign({},{name:name,size:size,fit:{signal:1<component.length?"["+component.join(", ")+"]":component[0]}},projection)]}return[Object.assign({},{name:name},{translate:{signal:"[width / 2, height / 2]"}},projection)]}function parseUnitProjection(model){if(model.hasProjection){var proj=
replaceExprRef(model.specifiedProjection),fit=!(proj&&(null!=proj.scale||null!=proj.translate)),size=fit?[model.getSizeSignalRef("width"),model.getSizeSignalRef("height")]:void 0;if(fit){fit=[];for(var encoding=model.encoding,$jscomp$inline_4603=$jscomp.makeIterator([["longitude","latitude"],["longitude2","latitude2"]]),$jscomp$inline_4604=$jscomp$inline_4603.next();!$jscomp$inline_4604.done;$jscomp$inline_4604=$jscomp$inline_4603.next())$jscomp$inline_4604=$jscomp$inline_4604.value,(getFieldOrDatumDef(encoding[$jscomp$inline_4604[0]])||
getFieldOrDatumDef(encoding[$jscomp$inline_4604[1]]))&&fit.push({signal:model.getName("geojson_"+fit.length)});model.channelHasField("shape")&&"geojson"===model.typedFieldDef("shape").type&&fit.push({signal:model.getName("geojson_"+fit.length)});0===fit.length&&fit.push(model.requestDataName(DataSourceType.Main))}else fit=void 0;var $jscomp$nullish$tmp105;model=new ProjectionComponent(model.projectionName(!0),Object.assign({},null!=($jscomp$nullish$tmp105=replaceExprRef(model.config.projection))?
$jscomp$nullish$tmp105:{},null!=proj?proj:{}),size,fit);model.get("type")||model.set("type","equalEarth",!1);return model}}function mergeIfNoConflict(first,second){var allPropertiesShared=every(PROJECTION_PROPERTIES,function(prop){return!vegaUtil.hasOwnProperty(first.explicit,prop)&&!vegaUtil.hasOwnProperty(second.explicit,prop)||vegaUtil.hasOwnProperty(first.explicit,prop)&&vegaUtil.hasOwnProperty(second.explicit,prop)&&deepEqual(first.get(prop),second.get(prop))?!0:!1});if(deepEqual(first.size,
second.size)){if(allPropertiesShared)return first;if(deepEqual(first.explicit,{}))return second;if(deepEqual(second.explicit,{}))return first}return null}function parseNonUnitProjections(model){if(0!==model.children.length){for(var nonUnitProjection,$jscomp$iter$443=$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$iter$443.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$443.next()){var child$jscomp$0=$jscomp$key$child.value;child$jscomp$0.component.projection=isUnitModel(child$jscomp$0)?
parseUnitProjection(child$jscomp$0):parseNonUnitProjections(child$jscomp$0)}$jscomp$iter$443=every(model.children,function(child){if(child=child.component.projection){if(nonUnitProjection)return(child=mergeIfNoConflict(nonUnitProjection,child))&&(nonUnitProjection=child),!!child;nonUnitProjection=child}return!0});if(nonUnitProjection&&$jscomp$iter$443){$jscomp$iter$443=model.projectionName(!0);child$jscomp$0=new ProjectionComponent($jscomp$iter$443,nonUnitProjection.specifiedProjection,nonUnitProjection.size,
duplicate(nonUnitProjection.data));model=$jscomp.makeIterator(model.children);for($jscomp$key$child=model.next();!$jscomp$key$child.done;$jscomp$key$child=model.next()){$jscomp$key$child=$jscomp$key$child.value;var projection=$jscomp$key$child.component.projection;projection&&(projection.isFit&&child$jscomp$0.data.push.apply(child$jscomp$0.data,$jscomp.arrayFromIterable($jscomp$key$child.component.projection.data)),$jscomp$key$child.renameProjection(projection.get("name"),$jscomp$iter$443),projection.merged=
!0)}return child$jscomp$0}}}function rangeFormula(model,fieldDef,channel,config){if(binRequiresRange(fieldDef,channel)){var $jscomp$nullish$tmp107,$jscomp$nullish$tmp108;model=isUnitModel(model)?null!=($jscomp$nullish$tmp108=null!=($jscomp$nullish$tmp107=model.axis(channel))?$jscomp$nullish$tmp107:model.legend(channel))?$jscomp$nullish$tmp108:{}:{};$jscomp$nullish$tmp107=vgField(fieldDef,{expr:"datum"});$jscomp$nullish$tmp108=vgField(fieldDef,{expr:"datum",binSuffix:"end"});return{formulaAs:vgField(fieldDef,
{binSuffix:"range",forAs:!0}),formula:binFormatExpression($jscomp$nullish$tmp107,$jscomp$nullish$tmp108,model.format,model.formatType,config)}}return{}}function getBinSignalName(model,field,bin){var $jscomp$nullish$tmp109;bin=null!=($jscomp$nullish$tmp109=normalizeBin(bin,void 0))?$jscomp$nullish$tmp109:{};field=binToString(bin)+"_"+field;return model.getName(field+"_bins")}function createBinComponent(t,bin,model){var as="as"in t?vegaUtil.isString(t.as)?[t.as,t.as+"_end"]:[t.as[0],t.as[1]]:[vgField(t,
{forAs:!0}),vgField(t,{binSuffix:"end",forAs:!0})];bin=Object.assign({},normalizeBin(bin,void 0));var JSCompiler_inline_result=t.field;JSCompiler_inline_result=binToString(bin)+"_"+JSCompiler_inline_result;var JSCompiler_object_inline_signal_5111=model.getName(JSCompiler_inline_result+"_bins");var extentSignal=model.getName(JSCompiler_inline_result+"_extent");if(isParameterExtent(bin.extent)){var span=bin.extent;span=parseSelectionExtent(model,span.param,span);delete bin.extent}t=Object.assign({},
{bin:bin,field:t.field,as:[as]},JSCompiler_object_inline_signal_5111?{signal:JSCompiler_object_inline_signal_5111}:{},extentSignal?{extentSignal:extentSignal}:{},span?{span:span}:{});return{key:JSCompiler_inline_result,binComponent:t}}function unquote(pattern){return"'"===pattern[0]&&"'"===pattern[pattern.length-1]||'"'===pattern[0]&&'"'===pattern[pattern.length-1]?pattern.slice(1,-1):pattern}function parseExpression(field,parse){field=accessPathWithDatum(field);if("number"===parse)return"toNumber("+
field+")";if("boolean"===parse)return"toBoolean("+field+")";if("string"===parse)return"toString("+field+")";if("date"===parse)return"toDate("+field+")";if("flatten"===parse)return field;if(parse.startsWith("date:"))return parse=unquote(parse.slice(5,parse.length)),"timeParse("+field+",'"+parse+"')";if(parse.startsWith("utc:"))return parse=unquote(parse.slice(4,parse.length)),"utcParse("+field+",'"+parse+"')";warn('Unrecognized parse "'+parse+'".');return null}function getImplicitFromFilterTransform(transform){var implicit=
{};forEachLeaf(transform.filter,function(filter){if(isFieldPredicate(filter)){var val=null;if(isFieldEqualPredicate(filter))val=signalRefOrValue(filter.equal);else if(isFieldLTEPredicate(filter))val=signalRefOrValue(filter.lte);else if(isFieldLTPredicate(filter))val=signalRefOrValue(filter.lt);else if(isFieldGTPredicate(filter))val=signalRefOrValue(filter.gt);else if(isFieldGTEPredicate(filter))val=signalRefOrValue(filter.gte);else if(isFieldRangePredicate(filter))val=filter.range[0];else if(isFieldOneOfPredicate(filter)){var $jscomp$nullish$tmp122;
val=(null!=($jscomp$nullish$tmp122=filter.oneOf)?$jscomp$nullish$tmp122:filter["in"])[0]}val&&(isDateTime(val)?implicit[filter.field]="date":vegaUtil.isNumber(val)?implicit[filter.field]="number":vegaUtil.isString(val)&&(implicit[filter.field]="string"));filter.timeUnit&&(implicit[filter.field]="date")}});return implicit}function getImplicitFromEncoding(model){function add(fieldDef){if(isFieldOrDatumDefForTimeFormat(fieldDef))implicit[fieldDef.field]="date";else{var JSCompiler_temp;if(JSCompiler_temp=
"quantitative"===fieldDef.type)JSCompiler_temp=fieldDef.aggregate,JSCompiler_temp=vegaUtil.isString(JSCompiler_temp)&&contains(["min","max"],JSCompiler_temp);JSCompiler_temp?implicit[fieldDef.field]="number":1<accessPathDepth(fieldDef.field)?fieldDef.field in implicit||(implicit[fieldDef.field]="flatten"):isScaleFieldDef(fieldDef)&&isSortField(fieldDef.sort)&&1<accessPathDepth(fieldDef.sort.field)&&(fieldDef.sort.field in implicit||(implicit[fieldDef.sort.field]="flatten"))}}var implicit={};(isUnitModel(model)||
isFacetModel(model))&&model.forEachFieldDef(function(fieldDef,channel){isTypedFieldDef(fieldDef)?add(fieldDef):(channel=getMainRangeChannel(channel),channel=model.fieldDef(channel),add(Object.assign({},fieldDef,{type:channel.type})))});if(isUnitModel(model)){var markDef=model.markDef,encoding=model.encoding;isPathMark(model.mark)&&!model.encoding.order&&(markDef=encoding["horizontal"===markDef.orient?"y":"x"],!isFieldDef(markDef)||"quantitative"!==markDef.type||markDef.field in implicit||(implicit[markDef.field]=
"number"))}return implicit}function isDataSourceNode(node){return node instanceof SourceNode||node instanceof GraticuleNode||node instanceof SequenceNode}function getStackByFields(model){return model.stack.stackBy.reduce(function(fields,by){(by=vgField(by.fieldDef))&&fields.push(by);return fields},[])}function isValidAsArray(as){return vegaUtil.isArray(as)&&as.every(function(s){return vegaUtil.isString(s)})&&1<as.length}function cloneSubtree(facet){function clone(node){if(!(node instanceof FacetNode)){var copy=
node.clone();if(copy instanceof OutputNode){var newName="scale_"+copy.getSource();copy.setSource(newName);facet.model.component.data.outputNodes[newName]=copy}else(copy instanceof AggregateNode||copy instanceof StackNode||copy instanceof WindowTransformNode||copy instanceof JoinAggregateTransformNode)&&copy.addDimensions(facet.fields);node=$jscomp.makeIterator(node.children.flatMap(clone));for(newName=node.next();!newName.done;newName=node.next())newName.value.parent=copy;return[copy]}return node.children.flatMap(clone)}
return clone}function moveFacetDown(node){if(node instanceof FacetNode)if(1!==node.numChildren()||node.children[0]instanceof OutputNode){var facetMain=node.model.component.data.main;moveMainDownToFacet(facetMain);var cloner=cloneSubtree(node);node=node.children.map(cloner).flat();node=$jscomp.makeIterator(node);for(cloner=node.next();!cloner.done;cloner=node.next())cloner.value.parent=facetMain}else facetMain=node.children[0],(facetMain instanceof AggregateNode||facetMain instanceof StackNode||facetMain instanceof
WindowTransformNode||facetMain instanceof JoinAggregateTransformNode)&&facetMain.addDimensions(node.fields),facetMain.swapWithParent(),moveFacetDown(node);else node.children.map(moveFacetDown)}function moveMainDownToFacet(node){if(node instanceof OutputNode&&node.type===DataSourceType.Main&&1===node.numChildren()){var child=node.children[0];child instanceof FacetNode||(child.swapWithParent(),moveMainDownToFacet(node))}}function checkLinks(nodes){nodes=$jscomp.makeIterator(nodes);for(var $jscomp$key$node=
nodes.next();!$jscomp$key$node.done;$jscomp$key$node=nodes.next()){$jscomp$key$node=$jscomp$key$node.value;for(var $jscomp$iter$499=$jscomp.makeIterator($jscomp$key$node.children),$jscomp$key$child=$jscomp$iter$499.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$499.next())if($jscomp$key$child.value.parent!==$jscomp$key$node)return!1;if(!checkLinks($jscomp$key$node.children))return!1}return!0}function runOptimizer(optimizer,nodes){var modified=!1;nodes=$jscomp.makeIterator(nodes);for(var $jscomp$key$node=
nodes.next();!$jscomp$key$node.done;$jscomp$key$node=nodes.next())modified=optimizer.optimize($jscomp$key$node.value)||modified;return modified}function optimizationDataflowHelper(dataComponent,model,firstPass){var roots=dataComponent.sources,modified=!1;modified=runOptimizer(new RemoveUnnecessaryOutputNodes,roots)||modified;modified=runOptimizer(new RemoveUnnecessaryIdentifierNodes(model),roots)||modified;roots=roots.filter(function(r){return 0<r.numChildren()});modified=runOptimizer(new RemoveUnusedSubtrees,
roots)||modified;roots=roots.filter(function(r){return 0<r.numChildren()});firstPass||(modified=runOptimizer(new MoveParseUp,roots)||modified,modified=runOptimizer(new MergeBins(model),roots)||modified,modified=runOptimizer(new RemoveDuplicateTimeUnits,roots)||modified,modified=runOptimizer(new MergeParse,roots)||modified,modified=runOptimizer(new MergeAggregates,roots)||modified,modified=runOptimizer(new MergeTimeUnits,roots)||modified,modified=runOptimizer(new MergeIdenticalNodes,roots)||modified,
modified=runOptimizer(new MergeOutputs,roots)||modified);dataComponent.sources=roots;return modified}function parseUnitScaleDomain(model$jscomp$0){for(var localScaleComponents=model$jscomp$0.component.scales,$jscomp$iter$503=$jscomp.makeIterator(keys$jscomp$0(localScaleComponents)),$jscomp$key$channel=$jscomp$iter$503.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$503.next()){$jscomp$key$channel=$jscomp$key$channel.value;var model=model$jscomp$0,scaleType=model.getScaleComponent($jscomp$key$channel).get("type"),
encoding=model.encoding;var JSCompiler_inline_result=model.scaleDomain($jscomp$key$channel);var fieldDef=model.typedFieldDef($jscomp$key$channel),scaleConfig=model.config.scale;"unaggregated"===JSCompiler_inline_result?(fieldDef=canUseUnaggregatedDomain(fieldDef,scaleType),scaleConfig=fieldDef.reason,fieldDef.valid||(warn(scaleConfig),JSCompiler_inline_result=void 0)):void 0===JSCompiler_inline_result&&scaleConfig.useUnaggregatedDomain&&canUseUnaggregatedDomain(fieldDef,scaleType).valid&&(JSCompiler_inline_result=
"unaggregated");JSCompiler_inline_result!==model.scaleDomain($jscomp$key$channel)&&(model.specifiedScales[$jscomp$key$channel]=Object.assign({},model.specifiedScales[$jscomp$key$channel],{domain:JSCompiler_inline_result}));model="x"===$jscomp$key$channel&&getFieldOrDatumDef(encoding.x2)?getFieldOrDatumDef(encoding.x)?mergeValuesWithExplicit(parseSingleChannelDomain(scaleType,JSCompiler_inline_result,model,"x"),parseSingleChannelDomain(scaleType,JSCompiler_inline_result,model,"x2"),"domain","scale",
domainsTieBreaker):parseSingleChannelDomain(scaleType,JSCompiler_inline_result,model,"x2"):"y"===$jscomp$key$channel&&getFieldOrDatumDef(encoding.y2)?getFieldOrDatumDef(encoding.y)?mergeValuesWithExplicit(parseSingleChannelDomain(scaleType,JSCompiler_inline_result,model,"y"),parseSingleChannelDomain(scaleType,JSCompiler_inline_result,model,"y2"),"domain","scale",domainsTieBreaker):parseSingleChannelDomain(scaleType,JSCompiler_inline_result,model,"y2"):parseSingleChannelDomain(scaleType,JSCompiler_inline_result,
model,$jscomp$key$channel);localScaleComponents[$jscomp$key$channel].setWithExplicit("domains",model);fieldDef=scaleType=void 0;encoding=model$jscomp$0.component.scales[$jscomp$key$channel];scaleConfig=model$jscomp$0.specifiedScales[$jscomp$key$channel].domain;JSCompiler_inline_result=null===(fieldDef=model$jscomp$0.fieldDef($jscomp$key$channel))||void 0===fieldDef?void 0:fieldDef.bin;fieldDef=isParameterDomain(scaleConfig)&&scaleConfig;JSCompiler_inline_result=vegaUtil.isObject(JSCompiler_inline_result)&&
isParameterExtent(JSCompiler_inline_result.extent)&&JSCompiler_inline_result.extent;(fieldDef||JSCompiler_inline_result)&&encoding.set("selectionExtent",null!=(scaleType=fieldDef)?scaleType:JSCompiler_inline_result,!0);if(model$jscomp$0.component.data.isFaceted){for(scaleType=model$jscomp$0;!isFacetModel(scaleType)&&scaleType.parent;)scaleType=scaleType.parent;if("shared"===scaleType.component.resolve.scale[$jscomp$key$channel])for($jscomp$key$channel=$jscomp.makeIterator(model.value),model=$jscomp$key$channel.next();!model.done;model=
$jscomp$key$channel.next())model=model.value,isDataRefDomain(model)&&(model.data="scale_"+model.data.replace("scale_",""))}}}function parseNonUnitScaleDomain(model$jscomp$0){for(var $jscomp$iter$504=$jscomp.makeIterator(model$jscomp$0.children),$jscomp$key$child=$jscomp$iter$504.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$504.next()){var model=$jscomp$key$child.value;isUnitModel(model)?parseUnitScaleDomain(model):parseNonUnitScaleDomain(model)}$jscomp$iter$504=model$jscomp$0.component.scales;
model=$jscomp.makeIterator(keys$jscomp$0($jscomp$iter$504));for(var $jscomp$key$channel=model.next();!$jscomp$key$channel.done;$jscomp$key$channel=model.next()){$jscomp$key$channel=$jscomp$key$channel.value;var domains=void 0,selectionExtent=null,$jscomp$iter$505=$jscomp.makeIterator(model$jscomp$0.children);for($jscomp$key$child=$jscomp$iter$505.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$505.next())if($jscomp$key$child=$jscomp$key$child.value.component.scales[$jscomp$key$channel])domains=
void 0===domains?$jscomp$key$child.getWithExplicit("domains"):mergeValuesWithExplicit(domains,$jscomp$key$child.getWithExplicit("domains"),"domains","scale",domainsTieBreaker),$jscomp$key$child=$jscomp$key$child.get("selectionExtent"),selectionExtent&&$jscomp$key$child&&selectionExtent.param!==$jscomp$key$child.param&&warn("The same selection must be used to override scale domains in a layered view."),selectionExtent=$jscomp$key$child;$jscomp$iter$504[$jscomp$key$channel].setWithExplicit("domains",
domains);selectionExtent&&$jscomp$iter$504[$jscomp$key$channel].set("selectionExtent",selectionExtent,!0)}}function mapDomainToDataSignal(domain,type,timeUnit){return domain.map(function(v){return{signal:"{data: "+valueExpr(v,{timeUnit:timeUnit,type:type})+"}"}})}function convertDomainIfItIsDateTime(domain,type,timeUnit){var _normalizeTimeUnit;timeUnit=null===(_normalizeTimeUnit=normalizeTimeUnit(timeUnit))||void 0===_normalizeTimeUnit?void 0:_normalizeTimeUnit.unit;return"temporal"===type||timeUnit?
mapDomainToDataSignal(domain,type,timeUnit):[domain]}function parseSingleChannelDomain(scaleType,domain,model,channel){var fieldOrDatumDef=getFieldOrDatumDef(model.encoding[channel]),type=fieldOrDatumDef.type,timeUnit=fieldOrDatumDef.timeUnit;if(domain&&domain.unionWith)return channel=parseSingleChannelDomain(scaleType,void 0,model,channel),fieldOrDatumDef=convertDomainIfItIsDateTime(domain.unionWith,type,timeUnit),makeExplicit([].concat($jscomp.arrayFromIterable(channel.value),$jscomp.arrayFromIterable(fieldOrDatumDef)));
if(isSignalRef(domain))return makeExplicit([domain]);if(domain&&"unaggregated"!==domain&&!isParameterDomain(domain))return makeExplicit(convertDomainIfItIsDateTime(domain,type,timeUnit));var stack=model.stack;if(stack&&channel===stack.fieldChannel){if("normalize"===stack.offset)return makeImplicit([[0,1]]);fieldOrDatumDef=model.requestDataName(DataSourceType.Main);return makeImplicit([{data:fieldOrDatumDef,field:model.vgField(channel,{suffix:"start"})},{data:fieldOrDatumDef,field:model.vgField(channel,
{suffix:"end"})}])}stack=SCALE_CHANNEL_INDEX[channel]&&isFieldDef(fieldOrDatumDef)?domainSort(model,channel,scaleType):void 0;if(isDatumDef(fieldOrDatumDef))return channel=convertDomainIfItIsDateTime([fieldOrDatumDef.datum],type,timeUnit),makeImplicit(channel);if("unaggregated"===domain)return channel=model.requestDataName(DataSourceType.Main),fieldOrDatumDef=fieldOrDatumDef.field,makeImplicit([{data:channel,field:vgField({field:fieldOrDatumDef,aggregate:"min"})},{data:channel,field:vgField({field:fieldOrDatumDef,
aggregate:"max"})}]);if(isBinning(fieldOrDatumDef.bin)){if(scaleType in DISCRETE_DOMAIN_INDEX)return"bin-ordinal"===scaleType?makeImplicit([]):makeImplicit([{data:isBoolean(stack)?model.requestDataName(DataSourceType.Main):model.requestDataName(DataSourceType.Raw),field:model.vgField(channel,binRequiresRange(fieldOrDatumDef,channel)?{binSuffix:"range"}:{}),sort:!0!==stack&&vegaUtil.isObject(stack)?stack:{field:model.vgField(channel,{}),op:"min"}}]);domain=fieldOrDatumDef.bin;if(isBinning(domain)){var binSignal=
getBinSignalName(model,fieldOrDatumDef.field,domain);return makeImplicit([new SignalRefWrapper(function(){var signal=model.getSignalName(binSignal);return"["+signal+".start, "+signal+".stop]"})])}return makeImplicit([{data:model.requestDataName(DataSourceType.Main),field:model.vgField(channel,{})}])}return fieldOrDatumDef.timeUnit&&contains(["time","utc"],scaleType)&&hasBandEnd(fieldOrDatumDef,isUnitModel(model)?model.encoding[getSecondaryRangeChannel(channel)]:void 0,model.markDef,model.config)?
(fieldOrDatumDef=model.requestDataName(DataSourceType.Main),makeImplicit([{data:fieldOrDatumDef,field:model.vgField(channel)},{data:fieldOrDatumDef,field:model.vgField(channel,{suffix:"end"})}])):stack?makeImplicit([{data:isBoolean(stack)?model.requestDataName(DataSourceType.Main):model.requestDataName(DataSourceType.Raw),field:model.vgField(channel),sort:stack}]):makeImplicit([{data:model.requestDataName(DataSourceType.Main),field:model.vgField(channel)}])}function normalizeSortField(sort,isStackedMeasure){var field=
sort.field,order=sort.order,$jscomp$nullish$tmp131;return Object.assign({},{op:null!=($jscomp$nullish$tmp131=sort.op)?$jscomp$nullish$tmp131:isStackedMeasure?"sum":"min"},field?{field:replacePathInField(field)}:{},order?{order:order}:{})}function domainSort(model,channel,scaleType){if(scaleType in DISCRETE_DOMAIN_INDEX){scaleType=model.fieldDef(channel);var sort=scaleType.sort;if(isSortArray(sort))return{op:"min",field:sortArrayIndexField(scaleType,channel),order:"ascending"};var stackDimensions=
(scaleType=model.stack)?[].concat($jscomp.arrayFromIterable(scaleType.groupbyField?[scaleType.groupbyField]:[]),$jscomp.arrayFromIterable(scaleType.stackBy.map(function(s){return s.fieldDef.field}))):void 0;if(isSortField(sort))return scaleType=scaleType&&!stackDimensions.includes(sort.field),normalizeSortField(sort,scaleType);if(sort&&sort.encoding){channel=sort.order;model=model.fieldDef(sort.encoding);sort=model.aggregate;var field=model.field;scaleType=scaleType&&!stackDimensions.includes(field);
if(isArgminDef(sort)||isArgmaxDef(sort))return normalizeSortField({field:vgField(model),order:channel},scaleType);if(isAggregateOp(sort)||!sort)return normalizeSortField({op:sort,field:field,order:channel},scaleType)}else{if("descending"===sort)return{op:"min",field:model.vgField(channel),order:"descending"};if(contains(["ascending",void 0],sort))return!0}}}function canUseUnaggregatedDomain(fieldDef,scaleType){var aggregate=fieldDef.aggregate,type=fieldDef.type;return aggregate?vegaUtil.isString(aggregate)&&
!SHARED_DOMAIN_OP_INDEX[aggregate]?{valid:!1,reason:'Unaggregated domain not applicable for "'+aggregate+'" since it produces values outside the origin domain of the source data.'}:"quantitative"===type&&"log"===scaleType?{valid:!1,reason:"Unaggregated domain is currently unsupported for log scale ("+stringify(fieldDef)+")."}:{valid:!0}:{valid:!1,reason:"Using unaggregated domain with raw field has no effect ("+stringify(fieldDef)+")."}}function domainsTieBreaker(v1,v2$jscomp$0,property,propertyOf){if(v1.explicit&&
v2$jscomp$0.explicit){var v2=v2$jscomp$0.value;property="Conflicting "+propertyOf.toString()+' property "'+property.toString()+'" ('+stringify(v1.value)+" and "+stringify(v2)+"). Using the union of the two domains.";warn(property)}return{explicit:v1.explicit,value:[].concat($jscomp.arrayFromIterable(v1.value),$jscomp.arrayFromIterable(v2$jscomp$0.value))}}function mergeDomains(domains){var uniqueDomains=unique(domains.map(function(domain){return isDataRefDomain(domain)?(domain=Object.assign({},domain),
delete domain.sort,domain):domain}),hash),sorts=unique(domains.map(function(d){if(isDataRefDomain(d))return d=d.sort,void 0===d||isBoolean(d)||("op"in d&&"count"===d.op&&delete d.field,"ascending"===d.order&&delete d.order),d}).filter(function(s){return void 0!==s}),hash);if(0!==uniqueDomains.length){if(1===uniqueDomains.length){uniqueDomains=domains[0];if(isDataRefDomain(uniqueDomains)&&0<sorts.length){var sort$853=sorts[0];1<sorts.length?(warn("Domains that should be unioned has conflicting sort properties. Sort will be set to true."),
sort$853=!0):vegaUtil.isObject(sort$853)&&"field"in sort$853&&uniqueDomains.field===sort$853.field&&(sort$853=sort$853.order?{order:sort$853.order}:!0);return Object.assign({},uniqueDomains,{sort:sort$853})}return uniqueDomains}sorts=unique(sorts.map(function(s){if(isBoolean(s)||!("op"in s)||vegaUtil.isString(s.op)&&s.op in MULTIDOMAIN_SORT_OP_INDEX)return s;warn("Dropping sort property "+stringify(s)+' as unioned domains only support boolean or op "count", "min", and "max".');return!0}),hash);1===
sorts.length?sort$853=sorts[0]:1<sorts.length&&(warn("Domains that should be unioned has conflicting sort properties. Sort will be set to true."),sort$853=!0);sorts=unique(domains.map(function(d){return isDataRefDomain(d)?d.data:null}),function(x){return x});return 1===sorts.length&&null!==sorts[0]?Object.assign({},{data:sorts[0],fields:uniqueDomains.map(function(d){return d.field})},sort$853?{sort:sort$853}:{}):Object.assign({},{fields:uniqueDomains},sort$853?{sort:sort$853}:{})}}function getFieldFromDomain(domain){if(isDataRefDomain(domain)&&
vegaUtil.isString(domain.field))return domain.field;var JSCompiler_inline_result=vegaUtil.isArray(domain)?!1:"fields"in domain&&!("data"in domain);if(JSCompiler_inline_result){domain=$jscomp.makeIterator(domain.fields);for(JSCompiler_inline_result=domain.next();!JSCompiler_inline_result.done;JSCompiler_inline_result=domain.next())if(JSCompiler_inline_result=JSCompiler_inline_result.value,isDataRefDomain(JSCompiler_inline_result)&&vegaUtil.isString(JSCompiler_inline_result.field))if(!field)var field=
JSCompiler_inline_result.field;else if(field!==JSCompiler_inline_result.field)return warn("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),field;warn("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.");
return field}field=vegaUtil.isArray(domain)?!1:"fields"in domain&&"data"in domain;if(field)return warn("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect."),field=domain.fields[0],vegaUtil.isString(field)?field:void 0}function assembleDomain(model,channel){channel=model.component.scales[channel].get("domains").map(function(domain){isDataRefDomain(domain)&&(domain.data=model.lookupDataSource(domain.data));
return domain});return mergeDomains(channel)}function assembleScales(model){return isLayerModel(model)||isConcatModel(model)?model.children.reduce(function(scales,child){return scales.concat(assembleScales(child))},assembleScalesForModel(model)):assembleScalesForModel(model)}function assembleScalesForModel(model){return keys$jscomp$0(model.component.scales).reduce(function(scales,channel){var scaleComponent=model.component.scales[channel];if(scaleComponent.merged)return scales;var scale=scaleComponent.combine(),
$jscomp$destructuring$var512=Object.assign({},scale),name=scale.name,type=scale.type,selectionExtent=scale.selectionExtent,reverse=scale.reverse;$jscomp$destructuring$var512=(delete $jscomp$destructuring$var512.name,delete $jscomp$destructuring$var512.type,delete $jscomp$destructuring$var512.selectionExtent,delete $jscomp$destructuring$var512.domains,delete $jscomp$destructuring$var512.range,delete $jscomp$destructuring$var512.reverse,$jscomp$destructuring$var512);scale=scale.range;channel in POSITION_SCALE_CHANNEL_INDEX?
isVgRangeStep(scale)&&(scale={step:{signal:name+"_step"}}):vegaUtil.isObject(scale)&&isDataRefDomain(scale)&&(scale=Object.assign({},scale,{data:model.lookupDataSource(scale.data)}));channel=assembleDomain(model,channel);selectionExtent?(selectionExtent=parseSelectionExtent(model,selectionExtent.param,selectionExtent),scaleComponent={signal:scaleComponent.get("type")in CONTINUOUS_DOMAIN_INDEX&&vegaUtil.isArray(channel)&&channel[0]>channel[1]?"isValid("+selectionExtent+") \x26\x26 reverse("+selectionExtent+
")":selectionExtent}):scaleComponent=null;scales.push(Object.assign({},{name:name,type:type},channel?{domain:channel}:{},scaleComponent?{domainRaw:scaleComponent}:{},{range:scale},void 0!==reverse?{reverse:reverse}:{},$jscomp$destructuring$var512));return scales},[])}function getSizeChannel(channel){return"x"===channel?"width":"y"===channel?"height":void 0}function getBinStepSignal(model,channel){var fieldDef=model.fieldDef(channel);if(null!==fieldDef&&void 0!==fieldDef&&fieldDef.bin){var bin$856=
fieldDef.bin;fieldDef=fieldDef.field;var sizeType=getSizeChannel(channel),sizeSignal=model.getName(sizeType);if(vegaUtil.isObject(bin$856)&&bin$856.binned&&void 0!==bin$856.step)return new SignalRefWrapper(function(){var scaleName=model.scaleName(channel);scaleName='(domain("'+scaleName+'")[1] - domain("'+scaleName+'")[0]) / '+bin$856.step;return model.getSignalName(sizeSignal)+" / ("+scaleName+")"});if(isBinning(bin$856)){var binSignal=getBinSignalName(model,fieldDef,bin$856);return new SignalRefWrapper(function(){var updatedName=
model.getSignalName(binSignal);updatedName="("+updatedName+".stop - "+updatedName+".start) / "+updatedName+".step";return model.getSignalName(sizeSignal)+" / ("+updatedName+")"})}}}function parseRangeForChannel(channel,model){for(var specifiedScale=model.specifiedScales[channel],size=model.size,scaleType=model.getScaleComponent(channel).get("type"),$jscomp$iter$509=$jscomp.makeIterator(RANGE_PROPERTIES),$jscomp$key$property=$jscomp$iter$509.next();!$jscomp$key$property.done;$jscomp$key$property=$jscomp$iter$509.next())if($jscomp$key$property=
$jscomp$key$property.value,void 0!==specifiedScale[$jscomp$key$property]){var supportedByScaleType=scaleTypeSupportProperty(scaleType,$jscomp$key$property),channelIncompatability=channelScalePropertyIncompatability(channel,$jscomp$key$property);if(supportedByScaleType)if(channelIncompatability)warn(channelIncompatability);else switch($jscomp$key$property){case "range":scaleType=specifiedScale.range;if(vegaUtil.isArray(scaleType)){if(channel in POSITION_SCALE_CHANNEL_INDEX)return makeExplicit(scaleType.map(function(v){if("width"===
v||"height"===v){v=model.getName(v);var getSignalName=model.getSignalName.bind(model);return SignalRefWrapper.fromName(getSignalName,v)}return v}))}else if(vegaUtil.isObject(scaleType))return makeExplicit({data:model.requestDataName(DataSourceType.Main),field:scaleType.field,sort:{op:"min",field:model.vgField(channel)}});return makeExplicit(scaleType);case "scheme":return makeExplicit(parseScheme(specifiedScale[$jscomp$key$property]))}else warn(scalePropertyNotWorkWithScaleType(scaleType,$jscomp$key$property,
channel))}if("x"===channel||"y"===channel)if($jscomp$iter$509="x"===channel?"width":"height",size=size[$jscomp$iter$509],isStep(size)){if(scaleType in DISCRETE_DOMAIN_INDEX)return makeExplicit({step:size.step});warn(stepDropped($jscomp$iter$509))}size=specifiedScale.rangeMin;specifiedScale=specifiedScale.rangeMax;channel=defaultRange(channel,model);return(void 0!==size||void 0!==specifiedScale)&&scaleTypeSupportProperty(scaleType,"rangeMin")&&vegaUtil.isArray(channel)&&2===channel.length?makeExplicit([null!=
size?size:channel[0],null!=specifiedScale?specifiedScale:channel[1]]):makeImplicit(channel)}function parseScheme(scheme){return!vegaUtil.isString(scheme)&&scheme.name?Object.assign({},{scheme:scheme.name},omit(scheme,["name"])):{scheme:scheme}}function defaultRange(channel,model){var size=model.size,config=model.config,mark=model.mark,encoding=model.encoding,getSignalName=model.getSignalName.bind(model),type=getFieldOrDatumDef(encoding[channel]).type;encoding=model.getScaleComponent(channel).get("type");
var $jscomp$destructuring$var518=model.specifiedScales[channel],domain=$jscomp$destructuring$var518.domain;$jscomp$destructuring$var518=$jscomp$destructuring$var518.domainMid;switch(channel){case "x":case "y":if(contains(["point","band"],encoding))if("x"===channel&&!size.width){if(config=getViewConfigDiscreteSize(config.view,"width"),isStep(config))return config}else if("y"===channel&&!size.height&&(config=getViewConfigDiscreteSize(config.view,"height"),isStep(config)))return config;config=getSizeChannel(channel);
config=model.getName(config);return"y"===channel&&encoding in CONTINUOUS_DOMAIN_INDEX?[SignalRefWrapper.fromName(getSignalName,config),0]:[0,SignalRefWrapper.fromName(getSignalName,config)];case "size":return getSignalName=model.component.scales[channel].get("zero"),getSignalName=sizeRangeMin(mark,getSignalName,config),size=sizeRangeMax(mark,size,model,config),encoding in CONTINUOUS_TO_DISCRETE_INDEX?interpolateRange(getSignalName,size,defaultContinuousToDiscreteCount(encoding,config,domain,channel)):
[getSignalName,size];case "theta":return[0,2*Math.PI];case "angle":return[0,360];case "radius":return[0,new SignalRefWrapper(function(){var w=model.getSignalName("width"),h=model.getSignalName("height");return"min("+w+","+h+")/2"})];case "strokeWidth":return[config.scale.minStrokeWidth,config.scale.maxStrokeWidth];case "strokeDash":return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case "shape":return"symbol";case "color":case "fill":case "stroke":return"ordinal"===encoding?"nominal"===type?"category":"ordinal":
void 0!==$jscomp$destructuring$var518?"diverging":"rect"===mark||"geoshape"===mark?"heatmap":"ramp";case "opacity":case "fillOpacity":case "strokeOpacity":return[config.scale.minOpacity,config.scale.maxOpacity]}throw Error("Scale range undefined for channel "+channel);}function defaultContinuousToDiscreteCount(scaleType,config,domain,channel){switch(scaleType){case "quantile":return config.scale.quantileCount;case "quantize":return config.scale.quantizeCount;case "threshold":if(void 0!==domain&&vegaUtil.isArray(domain))return domain.length+
1;warn("Domain for "+channel+" is required for threshold scale.");return 3}}function interpolateRange(rangeMin,rangeMax,cardinality){var f=function(){var rMax=signalOrStringValue(rangeMax),rMin=signalOrStringValue(rangeMin),step="("+rMax+" - "+rMin+") / ("+cardinality+" - 1)";return"sequence("+rMin+", "+rMax+" + "+step+", "+step+")"};return isSignalRef(rangeMax)?new SignalRefWrapper(f):{signal:f()}}function sizeRangeMin(mark,zero,config){if(zero)return isSignalRef(zero)?{signal:zero.signal+" ? 0 : "+
sizeRangeMin(mark,!1,config)}:0;switch(mark){case "bar":case "tick":return config.scale.minBandSize;case "line":case "trail":case "rule":return config.scale.minStrokeWidth;case "text":return config.scale.minFontSize;case "point":case "square":case "circle":return config.scale.minSize}throw Error(incompatibleChannel("size",mark));}function sizeRangeMax(mark,size,model,config){model={x:getBinStepSignal(model,"x"),y:getBinStepSignal(model,"y")};switch(mark){case "bar":case "tick":if(void 0!==config.scale.maxBandSize)return config.scale.maxBandSize;
var min=minXYStep(size,model,config.view);return vegaUtil.isNumber(min)?min-1:new SignalRefWrapper(function(){return min.signal+" - 1"});case "line":case "trail":case "rule":return config.scale.maxStrokeWidth;case "text":return config.scale.maxFontSize;case "point":case "square":case "circle":if(config.scale.maxSize)return config.scale.maxSize;var pointStep=minXYStep(size,model,config.view);return vegaUtil.isNumber(pointStep)?Math.pow(.95*pointStep,2):new SignalRefWrapper(function(){return"pow(0.95 * "+
pointStep.signal+", 2)"})}throw Error(incompatibleChannel("size",mark));}function minXYStep(size,xyStepSignals,viewConfig){var widthStep=isStep(size.width)?size.width.step:getViewConfigDiscreteStep(viewConfig,"width"),heightStep=isStep(size.height)?size.height.step:getViewConfigDiscreteStep(viewConfig,"height");return xyStepSignals.x||xyStepSignals.y?new SignalRefWrapper(function(){return"min("+[xyStepSignals.x?xyStepSignals.x.signal:widthStep,xyStepSignals.y?xyStepSignals.y.signal:heightStep].join(", ")+
")"}):Math.min(widthStep,heightStep)}function parseScaleProperty(model,property){if(isUnitModel(model))for(var localScaleComponents=model.component.scales,config=model.config,encoding=model.encoding,markDef=model.markDef,specifiedScales=model.specifiedScales,$jscomp$inline_4670=$jscomp.makeIterator(keys$jscomp$0(localScaleComponents)),$jscomp$key$channel=$jscomp$inline_4670.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_4670.next()){var channel=$jscomp$key$channel.value,specifiedScale=
specifiedScales[channel];$jscomp$key$channel=localScaleComponents[channel];var mergedScaleCmpt=model.getScaleComponent(channel),fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]),specifiedValue=specifiedScale[property],scaleType$861=mergedScaleCmpt.get("type"),scalePadding=mergedScaleCmpt.get("padding");mergedScaleCmpt=mergedScaleCmpt.get("paddingInner");var supportedByScaleType=scaleTypeSupportProperty(scaleType$861,property),channelIncompatability=channelScalePropertyIncompatability(channel,
property);void 0!==specifiedValue&&(supportedByScaleType?channelIncompatability&&warn(channelIncompatability):warn(scalePropertyNotWorkWithScaleType(scaleType$861,property,channel)));if(supportedByScaleType&&void 0===channelIncompatability)if(void 0!==specifiedValue)switch(channel=fieldOrDatumDef.timeUnit,fieldOrDatumDef=fieldOrDatumDef.type,property){case "domainMax":case "domainMin":isDateTime(specifiedScale[property])||"temporal"===fieldOrDatumDef||channel?$jscomp$key$channel.set(property,{signal:valueExpr(specifiedScale[property],
{type:fieldOrDatumDef,timeUnit:channel})},!0):$jscomp$key$channel.set(property,specifiedScale[property],!0);break;default:$jscomp$key$channel.copyKeyFromObject(property,specifiedScale)}else specifiedScale=property in scaleRules?scaleRules[property]({model:model,channel:channel,fieldOrDatumDef:fieldOrDatumDef,scaleType:scaleType$861,scalePadding:scalePadding,scalePaddingInner:mergedScaleCmpt,domain:specifiedScale.domain,markDef:markDef,config:config}):config.scale[property],void 0!==specifiedScale&&
$jscomp$key$channel.set(property,specifiedScale,!1)}else parseNonUnitScaleProperty(model,property)}function parseScaleRange(model){if(isUnitModel(model))for(var localScaleComponents=model.component.scales,$jscomp$inline_4689=$jscomp.makeIterator(SCALE_CHANNELS),$jscomp$key$channel=$jscomp$inline_4689.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_4689.next()){var channel=$jscomp$key$channel.value;if($jscomp$key$channel=localScaleComponents[channel])channel=parseRangeForChannel(channel,
model),$jscomp$key$channel.setWithExplicit("range",channel)}else parseNonUnitScaleProperty(model,"range")}function parseNonUnitScaleProperty(model,property){for(var localScaleComponents=model.component.scales,$jscomp$iter$511=$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$iter$511.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$511.next()){var child=$jscomp$key$child.value;"range"===property?parseScaleRange(child):parseScaleProperty(child,property)}$jscomp$iter$511=$jscomp.makeIterator(keys$jscomp$0(localScaleComponents));
for(child=$jscomp$iter$511.next();!child.done;child=$jscomp$iter$511.next()){child=child.value;var valueWithExplicit=void 0,$jscomp$iter$512=$jscomp.makeIterator(model.children);for($jscomp$key$child=$jscomp$iter$512.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$512.next())if($jscomp$key$child=$jscomp$key$child.value.component.scales[child])$jscomp$key$child=$jscomp$key$child.getWithExplicit(property),valueWithExplicit=mergeValuesWithExplicit(valueWithExplicit,$jscomp$key$child,property,
"scale",tieBreakByComparing(function(v1,v2){switch(property){case "range":if(v1.step&&v2.step)return v1.step-v2.step}return 0}));localScaleComponents[child].setWithExplicit(property,valueWithExplicit)}}function bins$jscomp$0(model,fieldDef){var bin=fieldDef.bin;if(isBinning(bin)){var binSignal=getBinSignalName(model,fieldDef.field,bin);return new SignalRefWrapper(function(){return model.getSignalName(binSignal)})}if(isBinned(bin)&&vegaUtil.isObject(bin)&&void 0!==bin.step)return{step:bin.step}}function defaultType(channel,
fieldDef,mark){switch(fieldDef.type){case "nominal":case "ordinal":var _fieldDef$axis;if(isColorChannel(channel)||"discrete"===rangeType(channel))return"shape"===channel&&"ordinal"===fieldDef.type&&warn(discreteChannelCannotEncode(channel,"ordinal")),"ordinal";if(channel in POSITION_SCALE_CHANNEL_INDEX){if(contains(["rect","bar","image","rule"],mark.type))return"band"}else if("arc"===mark.type&&channel in POLAR_POSITION_SCALE_CHANNEL_INDEX)return"band";channel=mark[getSizeChannel$1(channel)];return isRelativeBandSize(channel)||
isPositionFieldOrDatumDef(fieldDef)&&null!==(_fieldDef$axis=fieldDef.axis)&&void 0!==_fieldDef$axis&&_fieldDef$axis.tickBand?"band":"point";case "temporal":if(!isColorChannel(channel)){if("discrete"===rangeType(channel))return warn(discreteChannelCannotEncode(channel,"temporal")),"ordinal";if(isFieldDef(fieldDef)&&fieldDef.timeUnit&&normalizeTimeUnit(fieldDef.timeUnit).utc)return"utc"}return"time";case "quantitative":if(isColorChannel(channel)){if(isFieldDef(fieldDef)&&isBinning(fieldDef.bin))return"bin-ordinal"}else if("discrete"===
rangeType(channel))return warn(discreteChannelCannotEncode(channel,"quantitative")),"ordinal";return"linear";case "geojson":return}throw Error('Invalid field type "'+fieldDef.type+'".');}function parseScaleCore(model){if(isUnitModel(model))model.component.scales=parseUnitScaleCore(model);else{for(var JSCompiler_temp_const=model.component,scaleComponents=model.component.scales={},scaleTypeWithExplicitIndex={},resolve=model.component.resolve,$jscomp$inline_4699=$jscomp.makeIterator(model.children),
$jscomp$key$child=$jscomp$inline_4699.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_4699.next()){$jscomp$key$child=$jscomp$key$child.value;parseScaleCore($jscomp$key$child);for(var $jscomp$inline_4702=$jscomp.makeIterator(keys$jscomp$0($jscomp$key$child.component.scales)),$jscomp$key$channel=$jscomp$inline_4702.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_4702.next()){$jscomp$key$channel=$jscomp$key$channel.value;var _resolve$scale;null!=(_resolve$scale=resolve.scale)[$jscomp$key$channel]||
(_resolve$scale[$jscomp$key$channel]=defaultScaleResolve($jscomp$key$channel,model));if("shared"===resolve.scale[$jscomp$key$channel]){var explicitScaleType=scaleTypeWithExplicitIndex[$jscomp$key$channel],childScaleType=$jscomp$key$child.component.scales[$jscomp$key$channel].getWithExplicit("type");if(explicitScaleType){var scaleCategory1=SCALE_CATEGORY_INDEX[explicitScaleType.value],scaleCategory2=SCALE_CATEGORY_INDEX[childScaleType.value];scaleCategory1===scaleCategory2||"ordinal-position"===scaleCategory1&&
"time"===scaleCategory2||"ordinal-position"===scaleCategory2&&"time"===scaleCategory1?scaleTypeWithExplicitIndex[$jscomp$key$channel]=mergeValuesWithExplicit(explicitScaleType,childScaleType,"type","scale",scaleTypeTieBreaker):(resolve.scale[$jscomp$key$channel]="independent",delete scaleTypeWithExplicitIndex[$jscomp$key$channel])}else scaleTypeWithExplicitIndex[$jscomp$key$channel]=childScaleType}}}resolve=$jscomp.makeIterator(keys$jscomp$0(scaleTypeWithExplicitIndex));for($jscomp$key$channel=resolve.next();!$jscomp$key$channel.done;$jscomp$key$channel=
resolve.next())for($jscomp$inline_4699=$jscomp$key$channel.value,_resolve$scale=model.scaleName($jscomp$inline_4699,!0),scaleComponents[$jscomp$inline_4699]=new ScaleComponent(_resolve$scale,scaleTypeWithExplicitIndex[$jscomp$inline_4699]),$jscomp$inline_4702=$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$inline_4702.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_4702.next())if($jscomp$key$child=$jscomp$key$child.value,$jscomp$key$channel=$jscomp$key$child.component.scales[$jscomp$inline_4699])$jscomp$key$child.renameScale($jscomp$key$channel.get("name"),
_resolve$scale),$jscomp$key$channel.merged=!0;JSCompiler_temp_const.scales=scaleComponents}}function parseUnitScaleCore(model){var encoding=model.encoding,mark=model.mark,markDef=model.markDef;return SCALE_CHANNELS.reduce(function(scaleComponents,channel){var fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]);if(fieldOrDatumDef&&mark===GEOSHAPE&&"shape"===channel&&"geojson"===fieldOrDatumDef.type)return scaleComponents;var specifiedScale=fieldOrDatumDef&&fieldOrDatumDef.scale;if(fieldOrDatumDef&&
null!==specifiedScale&&!1!==specifiedScale){null!=specifiedScale||(specifiedScale={});var specifiedScale$jscomp$0=specifiedScale;var JSCompiler_inline_result=defaultType(channel,fieldOrDatumDef,markDef);specifiedScale$jscomp$0=specifiedScale$jscomp$0.type;if(SCALE_CHANNEL_INDEX[channel]){if(void 0!==specifiedScale$jscomp$0)if(channelSupportScaleType(channel,specifiedScale$jscomp$0)){var JSCompiler_temp;if(JSCompiler_temp=isFieldDef(fieldOrDatumDef))fieldOrDatumDef=fieldOrDatumDef.type,JSCompiler_temp=
!(contains(["ordinal","nominal"],fieldOrDatumDef)?void 0===specifiedScale$jscomp$0||specifiedScale$jscomp$0 in DISCRETE_DOMAIN_INDEX:"temporal"===fieldOrDatumDef?contains([ScaleType.TIME,ScaleType.UTC,void 0],specifiedScale$jscomp$0):"quantitative"===fieldOrDatumDef?contains([ScaleType.LOG,ScaleType.POW,ScaleType.SQRT,ScaleType.SYMLOG,ScaleType.QUANTILE,ScaleType.QUANTIZE,ScaleType.THRESHOLD,ScaleType.LINEAR,void 0],specifiedScale$jscomp$0):1);JSCompiler_temp?warn('FieldDef does not work with "'+
specifiedScale$jscomp$0+'" scale. We are using "'+JSCompiler_inline_result+'" scale instead.'):JSCompiler_inline_result=specifiedScale$jscomp$0}else warn('Channel "'+channel+'" does not work with "'+specifiedScale$jscomp$0+'" scale. We are using "'+JSCompiler_inline_result+'" scale instead.')}else JSCompiler_inline_result=null;scaleComponents[channel]=new ScaleComponent(model.scaleName(""+channel,!0),{value:JSCompiler_inline_result,explicit:specifiedScale.type===JSCompiler_inline_result})}return scaleComponents},
{})}function isUnitModel(model){return"unit"===(null===model||void 0===model?void 0:model.type)}function isFacetModel(model){return"facet"===(null===model||void 0===model?void 0:model.type)}function isConcatModel(model){return"concat"===(null===model||void 0===model?void 0:model.type)}function isLayerModel(model){return"layer"===(null===model||void 0===model?void 0:model.type)}function makeWalkTree(data){function walkTree(node,dataSource){node instanceof SourceNode&&!(node.isGenerator||"url"in node.data)&&
(data.push(dataSource),dataSource={name:null,source:dataSource.name,transform:[]});if(node instanceof ParseNode)if(node.parent instanceof SourceNode&&!dataSource.source){var $jscomp$nullish$tmp167;dataSource.format=Object.assign({},null!=($jscomp$nullish$tmp167=dataSource.format)?$jscomp$nullish$tmp167:{},{parse:node.assembleFormatParse()});dataSource.transform.push.apply(dataSource.transform,$jscomp.arrayFromIterable(node.assembleTransforms(!0)))}else dataSource.transform.push.apply(dataSource.transform,
$jscomp.arrayFromIterable(node.assembleTransforms()));if(node instanceof FacetNode)dataSource.name||(dataSource.name="data_"+datasetIndex++),!dataSource.source||0<dataSource.transform.length?(data.push(dataSource),node.data=dataSource.name):node.data=dataSource.source,data.push.apply(data,$jscomp.arrayFromIterable(node.assemble()));else switch((node instanceof GraticuleNode||node instanceof SequenceNode||node instanceof FilterInvalidNode||node instanceof FilterNode||node instanceof CalculateNode||
node instanceof GeoPointNode||node instanceof AggregateNode||node instanceof LookupNode||node instanceof WindowTransformNode||node instanceof JoinAggregateTransformNode||node instanceof FoldTransformNode||node instanceof FlattenTransformNode||node instanceof DensityTransformNode||node instanceof LoessTransformNode||node instanceof QuantileTransformNode||node instanceof RegressionTransformNode||node instanceof IdentifierNode||node instanceof SampleTransformNode||node instanceof PivotTransformNode)&&
dataSource.transform.push(node.assemble()),(node instanceof BinNode||node instanceof TimeUnitNode||node instanceof ImputeNode||node instanceof StackNode||node instanceof GeoJSONNode)&&dataSource.transform.push.apply(dataSource.transform,$jscomp.arrayFromIterable(node.assemble())),node instanceof OutputNode&&(dataSource.source&&0===dataSource.transform.length?node.setSource(dataSource.source):node.parent instanceof OutputNode?node.setSource(dataSource.name):(dataSource.name||(dataSource.name="data_"+
datasetIndex++),node.setSource(dataSource.name),1===node.numChildren()&&(data.push(dataSource),dataSource={name:null,source:dataSource.name,transform:[]}))),node.numChildren()){case 0:node instanceof OutputNode&&(!dataSource.source||0<dataSource.transform.length)&&data.push(dataSource);break;case 1:walkTree(node.children[0],dataSource);break;default:for(dataSource.name||(dataSource.name="data_"+datasetIndex++),$jscomp$nullish$tmp167=dataSource.name,!dataSource.source||0<dataSource.transform.length?
data.push(dataSource):$jscomp$nullish$tmp167=dataSource.source,node=$jscomp.makeIterator(node.children),dataSource=node.next();!dataSource.done;dataSource=node.next())walkTree(dataSource.value,{name:null,source:$jscomp$nullish$tmp167,transform:[]})}}var datasetIndex=0;return walkTree}function assembleFacetData(root){for(var data=[],walkTree=makeWalkTree(data),$jscomp$iter$525=$jscomp.makeIterator(root.children),$jscomp$key$child=$jscomp$iter$525.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$525.next())walkTree($jscomp$key$child.value,
{source:root.name,name:null,transform:[]});return data}function assembleRootData(dataComponent,datasets){for(var data=[],walkTree=makeWalkTree(data),sourceIndex=0,$jscomp$iter$526=$jscomp.makeIterator(dataComponent.sources),$jscomp$key$root=$jscomp$iter$526.next();!$jscomp$key$root.done;$jscomp$key$root=$jscomp$iter$526.next()){$jscomp$key$root=$jscomp$key$root.value;$jscomp$key$root.hasName()||($jscomp$key$root.dataName="source_"+sourceIndex++);var newData=$jscomp$key$root.assemble();walkTree($jscomp$key$root,
newData)}walkTree=$jscomp.makeIterator(data);for(sourceIndex=walkTree.next();!sourceIndex.done;sourceIndex=walkTree.next())sourceIndex=sourceIndex.value,0===sourceIndex.transform.length&&delete sourceIndex.transform;walkTree=0;sourceIndex=$jscomp.makeIterator(data.entries());for($jscomp$iter$526=sourceIndex.next();!$jscomp$iter$526.done;$jscomp$iter$526=sourceIndex.next())$jscomp$key$root=$jscomp.makeIterator($jscomp$iter$526.value),$jscomp$iter$526=$jscomp$key$root.next().value,$jscomp$key$root=
$jscomp$key$root.next().value,newData=void 0,0!==(null!=(newData=$jscomp$key$root.transform)?newData:[]).length||$jscomp$key$root.source||data.splice(walkTree++,0,data.splice($jscomp$iter$526,1)[0]);walkTree=$jscomp.makeIterator(data);for(sourceIndex=walkTree.next();!sourceIndex.done;sourceIndex=walkTree.next())for($jscomp$iter$526=void 0,sourceIndex=$jscomp.makeIterator(null!=($jscomp$iter$526=sourceIndex.value.transform)?$jscomp$iter$526:[]),$jscomp$iter$526=sourceIndex.next();!$jscomp$iter$526.done;$jscomp$iter$526=
sourceIndex.next())$jscomp$iter$526=$jscomp$iter$526.value,"lookup"===$jscomp$iter$526.type&&($jscomp$iter$526.from=dataComponent.outputNodes[$jscomp$iter$526.from].getSource());dataComponent=$jscomp.makeIterator(data);for(sourceIndex=dataComponent.next();!sourceIndex.done;sourceIndex=dataComponent.next())walkTree=sourceIndex.value,walkTree.name in datasets&&(walkTree.values=datasets[walkTree.name]);return data}function makeHeaderComponent(model,channel,labels){channel="row"===channel?"height":"width";
return{labels:labels,sizeSignal:model.child.component.layoutSize.get(channel)?model.child.getSizeSignalRef(channel):void 0,axes:[]}}function mergeChildAxis(model,channel){var child=model.child;if(child.component.axes[channel]){var $jscomp$destructuring$var573=model.component,layoutHeaders=$jscomp$destructuring$var573.layoutHeaders;$jscomp$destructuring$var573=$jscomp$destructuring$var573.resolve;$jscomp$destructuring$var573.axis[channel]=parseGuideResolve($jscomp$destructuring$var573,channel);if("shared"===
$jscomp$destructuring$var573.axis[channel])for($jscomp$destructuring$var573="x"===channel?"column":"row",layoutHeaders=layoutHeaders[$jscomp$destructuring$var573],channel=$jscomp.makeIterator(child.component.axes[channel]),child=channel.next();!child.done;child=channel.next()){child=child.value;var JSCompiler_inline_result=child.get("orient");JSCompiler_inline_result="top"===JSCompiler_inline_result||"left"===JSCompiler_inline_result||isSignalRef(JSCompiler_inline_result)?"header":"footer";null!=
layoutHeaders[JSCompiler_inline_result]||(layoutHeaders[JSCompiler_inline_result]=[makeHeaderComponent(model,$jscomp$destructuring$var573,!1)]);var mainAxis=assembleAxis(child,"main",model.config,{header:!0});mainAxis&&layoutHeaders[JSCompiler_inline_result][0].axes.push(mainAxis);child.mainExtracted=!0}}}function parseChildrenLayoutSize(model){model=$jscomp.makeIterator(model.children);for(var $jscomp$key$child=model.next();!$jscomp$key$child.done;$jscomp$key$child=model.next())$jscomp$key$child.value.parseLayoutSize()}
function parseNonUnitLayoutSizeForChannel(model,layoutSizeType){for(var sizeType=getSizeTypeFromLayoutSizeType(layoutSizeType),channel=getPositionScaleChannel(sizeType),resolve=model.component.resolve,layoutSizeCmpt=model.component.layoutSize,mergedSize,$jscomp$iter$535=$jscomp.makeIterator(model.children),$jscomp$key$child=$jscomp$iter$535.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$535.next()){$jscomp$key$child=$jscomp$key$child.value.component.layoutSize.getWithExplicit(sizeType);
var $jscomp$nullish$tmp171=void 0,scaleResolve=null!=($jscomp$nullish$tmp171=resolve.scale[channel])?$jscomp$nullish$tmp171:defaultScaleResolve(channel,model);if("independent"===scaleResolve&&"step"===$jscomp$key$child.value){mergedSize=void 0;break}if(mergedSize){if("independent"===scaleResolve&&mergedSize.value!==$jscomp$key$child.value){mergedSize=void 0;break}mergedSize=mergeValuesWithExplicit(mergedSize,$jscomp$key$child,sizeType,"")}else mergedSize=$jscomp$key$child}if(mergedSize){channel=$jscomp.makeIterator(model.children);
for($jscomp$key$child=channel.next();!$jscomp$key$child.done;$jscomp$key$child=channel.next())resolve=$jscomp$key$child.value,model.renameSignal(resolve.getName(sizeType),model.getName(layoutSizeType)),resolve.component.layoutSize.set(sizeType,"merged",!1);layoutSizeCmpt.setWithExplicit(layoutSizeType,mergedSize)}else layoutSizeCmpt.setWithExplicit(layoutSizeType,{explicit:!1,value:void 0})}function defaultUnitSize(model,sizeType){var config=model.config,scaleComponent=model.getScaleComponent("width"===
sizeType?"x":"y");if(scaleComponent)return model=scaleComponent.get("type"),scaleComponent=scaleComponent.get("range"),model in DISCRETE_DOMAIN_INDEX?(sizeType=getViewConfigDiscreteSize(config.view,sizeType),isVgRangeStep(scaleComponent)||isStep(sizeType)?"step":sizeType):getViewConfigContinuousSize(config.view,sizeType);if(model.hasProjection||"arc"===model.mark)return getViewConfigContinuousSize(config.view,sizeType);sizeType=getViewConfigDiscreteSize(config.view,sizeType);return isStep(sizeType)?
sizeType.step:sizeType}function facetSortFieldName(fieldDef,sort,opt){return vgField(sort,Object.assign({},{suffix:"by_"+vgField(fieldDef)},null!=opt?opt:{}))}function findSource(data,sources){sources=$jscomp.makeIterator(sources);for(var $jscomp$key$other=sources.next();!$jscomp$key$other.done;$jscomp$key$other=sources.next()){$jscomp$key$other=$jscomp$key$other.value;var _data$format,_otherData$format,_data$format2,_otherData$format2,otherData=$jscomp$key$other.data;if(!data.name||!$jscomp$key$other.hasName()||
data.name===$jscomp$key$other.dataName){var formatMesh=null===(_data$format=data.format)||void 0===_data$format?void 0:_data$format.mesh,otherFeature=null===(_otherData$format=otherData.format)||void 0===_otherData$format?void 0:_otherData$format.feature;if(!formatMesh||!otherFeature){var formatFeature=null===(_data$format2=data.format)||void 0===_data$format2?void 0:_data$format2.feature;if(!formatFeature&&!otherFeature||formatFeature===otherFeature)if(otherFeature=null===(_otherData$format2=otherData.format)||
void 0===_otherData$format2?void 0:_otherData$format2.mesh,!formatMesh&&!otherFeature||formatMesh===otherFeature)if("values"in data&&"values"in otherData){if(deepEqual(data.values,otherData.values))return $jscomp$key$other}else if("url"in data&&"url"in otherData){if(data.url===otherData.url)return $jscomp$key$other}else if(isNamedData(data)&&data.name===$jscomp$key$other.dataName)return $jscomp$key$other}}}return null}function parseRoot(model,sources){if(model.data||!model.parent){if(null===model.data)return model=
new SourceNode({values:[]}),sources.push(model),model;var existingSource=findSource(model.data,sources);if(existingSource)return isGenerator(model.data)||(existingSource.data.format=mergeDeep({},model.data.format,existingSource.data.format)),!existingSource.hasName()&&model.data.name&&(existingSource.dataName=model.data.name),existingSource;model=new SourceNode(model.data);sources.push(model);return model}return model.parent.component.data.facetRoot?model.parent.component.data.facetRoot:model.parent.component.data.main}
function parseData(model){var _data$format3,head=parseRoot(model,model.component.data.sources),$jscomp$destructuring$var589=model.component.data,outputNodes=$jscomp$destructuring$var589.outputNodes;$jscomp$destructuring$var589=$jscomp$destructuring$var589.outputNodeRefCounts;var data=model.data,ancestorParse=data&&(isGenerator(data)||"url"in data||"values"in data)||!model.parent?new AncestorParse:model.parent.component.data.ancestorParse.clone();isGenerator(data)?("sequence"in data?head=new SequenceNode(head,
data.sequence):"graticule"in data&&(head=new GraticuleNode(head,data.graticule)),ancestorParse.parseNothing=!0):null===(null===data||void 0===data?void 0:null===(_data$format3=data.format)||void 0===_data$format3?void 0:_data$format3.parse)&&(ancestorParse.parseNothing=!0);var $jscomp$nullish$tmp178;head=null!=($jscomp$nullish$tmp178=ParseNode.makeExplicit(head,model,ancestorParse))?$jscomp$nullish$tmp178:head;head=new IdentifierNode(head);_data$format3=model.parent&&isLayerModel(model.parent);if((isUnitModel(model)||
isFacetModel(model))&&_data$format3){var $jscomp$nullish$tmp179;head=null!=($jscomp$nullish$tmp179=BinNode.makeFromEncoding(head,model))?$jscomp$nullish$tmp179:head}if(0<model.transforms.length)for($jscomp$nullish$tmp179=0,$jscomp$nullish$tmp178=$jscomp.makeIterator(model.transforms),data=$jscomp$nullish$tmp178.next();!data.done;data=$jscomp$nullish$tmp178.next()){var t=data.value,transformNode=data=void 0;if("calculate"in t)transformNode=head=new CalculateNode(head,t),data="derived";else if("filter"in
t){transformNode=getImplicitFromFilterTransform(t);var $jscomp$inline_4737=void 0;transformNode=head=null!=($jscomp$inline_4737=ParseNode.makeWithAncestors(head,{},transformNode,ancestorParse))?$jscomp$inline_4737:head;head=new FilterNode(head,model,t.filter)}else if("bin"in t)transformNode=head=BinNode.makeFromTransform(head,t,model),data="number";else if("timeUnit"in t)data="date",void 0===ancestorParse.getWithExplicit(t.field).value&&(transformNode={},head=new ParseNode(head,(transformNode[t.field]=
data,transformNode)),ancestorParse.set(t.field,data,!1)),transformNode=head=TimeUnitNode.makeFromTransform(head,t);else if("aggregate"in t)transformNode=head=AggregateNode.makeFromTransform(head,t),data="number",requiresSelectionId(model)&&(head=new IdentifierNode(head));else if("lookup"in t)transformNode=head=LookupNode.make(head,model,t,$jscomp$nullish$tmp179++),data="derived";else if("window"in t)transformNode=head=new WindowTransformNode(head,t),data="number";else if("joinaggregate"in t)transformNode=
head=new JoinAggregateTransformNode(head,t),data="number";else if("stack"in t)transformNode=head=StackNode.makeFromTransform(head,t),data="derived";else if("fold"in t)transformNode=head=new FoldTransformNode(head,t),data="derived";else if("flatten"in t)transformNode=head=new FlattenTransformNode(head,t),data="derived";else if("pivot"in t)transformNode=head=new PivotTransformNode(head,t),data="derived";else if("sample"in t)head=new SampleTransformNode(head,t);else if("impute"in t)transformNode=head=
ImputeNode.makeFromTransform(head,t),data="derived";else if("density"in t)transformNode=head=new DensityTransformNode(head,t),data="derived";else if("quantile"in t)transformNode=head=new QuantileTransformNode(head,t),data="derived";else if("regression"in t)transformNode=head=new RegressionTransformNode(head,t),data="derived";else if("loess"in t)transformNode=head=new LoessTransformNode(head,t),data="derived";else{warn("Ignoring an invalid transform: "+stringify(t)+".");continue}if(transformNode&&
void 0!==data)for(t=void 0,transformNode=$jscomp.makeIterator(null!=(t=transformNode.producedFields())?t:[]),t=transformNode.next();!t.done;t=transformNode.next())ancestorParse.set(t.value,data,!1)}$jscomp$nullish$tmp179={};if(isUnitModel(model)&&model.component.selection)for($jscomp$nullish$tmp178=$jscomp.makeIterator(keys$jscomp$0(model.component.selection)),data=$jscomp$nullish$tmp178.next();!data.done;data=$jscomp$nullish$tmp178.next())for(data=$jscomp.makeIterator(model.component.selection[data.value].project.items),
t=data.next();!t.done;t=data.next())t=t.value,!t.channel&&1<accessPathDepth(t.field)&&($jscomp$nullish$tmp179[t.field]="flatten");$jscomp$nullish$tmp178=getImplicitFromEncoding(model);var $jscomp$nullish$tmp180;head=null!=($jscomp$nullish$tmp180=ParseNode.makeWithAncestors(head,{},Object.assign({},$jscomp$nullish$tmp179,$jscomp$nullish$tmp178),ancestorParse))?$jscomp$nullish$tmp180:head;isUnitModel(model)&&(head=GeoJSONNode.parseAll(head,model),head=GeoPointNode.parseAll(head,model));if(isUnitModel(model)||
isFacetModel(model)){if(!_data$format3){var $jscomp$nullish$tmp181;head=null!=($jscomp$nullish$tmp181=BinNode.makeFromEncoding(head,model))?$jscomp$nullish$tmp181:head}var $jscomp$nullish$tmp182;head=null!=($jscomp$nullish$tmp182=TimeUnitNode.makeFromEncoding(head,model))?$jscomp$nullish$tmp182:head;head=CalculateNode.parseAllForSortIndex(head,model)}$jscomp$nullish$tmp181=model.getDataName(DataSourceType.Raw);$jscomp$nullish$tmp180=new OutputNode(head,$jscomp$nullish$tmp181,DataSourceType.Raw,$jscomp$destructuring$var589);
head=outputNodes[$jscomp$nullish$tmp181]=$jscomp$nullish$tmp180;if(isUnitModel(model)){if($jscomp$nullish$tmp181=AggregateNode.makeFromEncoding(head,model))head=$jscomp$nullish$tmp181,requiresSelectionId(model)&&(head=new IdentifierNode(head));var $jscomp$nullish$tmp183;head=null!=($jscomp$nullish$tmp183=ImputeNode.makeFromEncoding(head,model))?$jscomp$nullish$tmp183:head;var $jscomp$nullish$tmp184;head=null!=($jscomp$nullish$tmp184=StackNode.makeFromEncoding(head,model))?$jscomp$nullish$tmp184:head}if(isUnitModel(model)){var $jscomp$nullish$tmp185;
head=null!=($jscomp$nullish$tmp185=FilterInvalidNode.make(head,model))?$jscomp$nullish$tmp185:head}$jscomp$nullish$tmp184=model.getDataName(DataSourceType.Main);$jscomp$nullish$tmp183=new OutputNode(head,$jscomp$nullish$tmp184,DataSourceType.Main,$jscomp$destructuring$var589);head=outputNodes[$jscomp$nullish$tmp184]=$jscomp$nullish$tmp183;if(isUnitModel(model)){var $jscomp$inline_4757;$jscomp$nullish$tmp184=$jscomp.makeIterator(entries$1(null!=($jscomp$inline_4757=model.component.selection)?$jscomp$inline_4757:
{}));for($jscomp$inline_4757=$jscomp$nullish$tmp184.next();!$jscomp$inline_4757.done;$jscomp$inline_4757=$jscomp$nullish$tmp184.next())$jscomp$nullish$tmp185=$jscomp.makeIterator($jscomp$inline_4757.value),$jscomp$inline_4757=$jscomp$nullish$tmp185.next().value,$jscomp$nullish$tmp185=$jscomp$nullish$tmp185.next().value,$jscomp$nullish$tmp181=model.getName("lookup_"+$jscomp$inline_4757),model.component.data.outputNodes[$jscomp$nullish$tmp181]=$jscomp$nullish$tmp185.materialized=new OutputNode(new FilterNode($jscomp$nullish$tmp183,
model,{param:$jscomp$inline_4757}),$jscomp$nullish$tmp181,DataSourceType.Lookup,model.component.data.outputNodeRefCounts)}$jscomp$nullish$tmp184=null;if(isFacetModel(model)){$jscomp$inline_4757=model.getName("facet");var $jscomp$nullish$tmp186;$jscomp$nullish$tmp184=head;$jscomp$nullish$tmp185=model.facet;$jscomp$nullish$tmp181=$jscomp$nullish$tmp185.row;$jscomp$nullish$tmp182=$jscomp$nullish$tmp185.column;if($jscomp$nullish$tmp181&&$jscomp$nullish$tmp182){$jscomp$nullish$tmp185=null;$jscomp$nullish$tmp181=
$jscomp.makeIterator([$jscomp$nullish$tmp181,$jscomp$nullish$tmp182]);for($jscomp$nullish$tmp182=$jscomp$nullish$tmp181.next();!$jscomp$nullish$tmp182.done;$jscomp$nullish$tmp182=$jscomp$nullish$tmp181.next())$jscomp$nullish$tmp182=$jscomp$nullish$tmp182.value,isSortField($jscomp$nullish$tmp182.sort)&&($jscomp$nullish$tmp185=$jscomp$nullish$tmp182.sort,$jscomp$nullish$tmp184=$jscomp$nullish$tmp185=new JoinAggregateTransformNode($jscomp$nullish$tmp184,{joinaggregate:[{op:void 0===$jscomp$nullish$tmp185.op?
"min":$jscomp$nullish$tmp185.op,field:$jscomp$nullish$tmp185.field,as:facetSortFieldName($jscomp$nullish$tmp182,$jscomp$nullish$tmp182.sort,{forAs:!0})}],groupby:[vgField($jscomp$nullish$tmp182)]}));$jscomp$nullish$tmp184=$jscomp$nullish$tmp185}else $jscomp$nullish$tmp184=null;head=null!=($jscomp$nullish$tmp186=$jscomp$nullish$tmp184)?$jscomp$nullish$tmp186:head;$jscomp$nullish$tmp184=new FacetNode(head,model,$jscomp$inline_4757,$jscomp$nullish$tmp183.getSource());outputNodes[$jscomp$inline_4757]=
$jscomp$nullish$tmp184}return Object.assign({},model.component.data,{outputNodes:outputNodes,outputNodeRefCounts:$jscomp$destructuring$var589,raw:$jscomp$nullish$tmp180,main:$jscomp$nullish$tmp183,facetRoot:$jscomp$nullish$tmp184,ancestorParse:ancestorParse})}function parseUnitAxes(model){return POSITION_SCALE_CHANNELS.reduce(function(axis,channel){model.component.scales[channel]&&(axis[channel]=[parseAxis(channel,model)]);return axis},{})}function mergeAxisComponents(mergedAxisCmpts,childAxisCmpts){if(mergedAxisCmpts){if(mergedAxisCmpts.length!==
childAxisCmpts.length)return;for(var length$900=mergedAxisCmpts.length,i=0;i<length$900;i++){var merged=mergedAxisCmpts[i],child=childAxisCmpts[i];if(!!merged!==!!child)return;if(merged&&child){var mergedOrient=merged.getWithExplicit("orient"),childOrient=child.getWithExplicit("orient");if(mergedOrient.explicit&&childOrient.explicit&&mergedOrient.value!==childOrient.value)return;mergedAxisCmpts[i]=mergeAxisComponent(merged,child)}}}else return childAxisCmpts.map(function(axisComponent){return axisComponent.clone()});
return mergedAxisCmpts}function mergeAxisComponent(merged,child){for(var $jscomp$loop$1675={},$jscomp$iter$560=$jscomp.makeIterator(AXIS_COMPONENT_PROPERTIES),$jscomp$key$prop=$jscomp$iter$560.next();!$jscomp$key$prop.done;$jscomp$loop$1675={$jscomp$loop$prop$prop$1676:$jscomp$loop$1675.$jscomp$loop$prop$prop$1676},$jscomp$key$prop=$jscomp$iter$560.next())$jscomp$loop$1675.$jscomp$loop$prop$prop$1676=$jscomp$key$prop.value,$jscomp$key$prop=mergeValuesWithExplicit(merged.getWithExplicit($jscomp$loop$1675.$jscomp$loop$prop$prop$1676),
child.getWithExplicit($jscomp$loop$1675.$jscomp$loop$prop$prop$1676),$jscomp$loop$1675.$jscomp$loop$prop$prop$1676,"axis",function($jscomp$loop$1675){return function(v1,v2){switch($jscomp$loop$1675.$jscomp$loop$prop$prop$1676){case "title":return mergeTitleComponent(v1,v2);case "gridScale":return{explicit:v1.explicit,value:getFirstDefined(v1.value,v2.value)}}return defaultTieBreaker(v1,v2,$jscomp$loop$1675.$jscomp$loop$prop$prop$1676,"axis")}}($jscomp$loop$1675)),merged.setWithExplicit($jscomp$loop$1675.$jscomp$loop$prop$prop$1676,
$jscomp$key$prop);return merged}function isExplicit(value,property,axis,model,channel){if("disable"===property)return void 0!==axis;axis=axis||{};switch(property){case "titleAngle":case "labelAngle":return value===(isSignalRef(axis.labelAngle)?axis.labelAngle:normalizeAngle(axis.labelAngle));case "values":return!!axis.values;case "encode":return!!axis.encoding||!!axis.labelAngle;case "title":if(value===getFieldDefTitle(model,channel))return!0}return value===axis[property]}function parseAxis(channel,
model){var _axis,_config,_config$axis,_axis2,axis=model.axis(channel),axisComponent=new AxisComponent,fieldOrDatumDef=getFieldOrDatumDef(model.encoding[channel]),mark=model.mark,config=model.config,orient=(null===(_axis=axis)||void 0===_axis?void 0:_axis.orient)||(null===(_config=config["x"===channel?"axisX":"axisY"])||void 0===_config?void 0:_config.orient)||(null===(_config$axis=config.axis)||void 0===_config$axis?void 0:_config$axis.orient)||("x"===channel?"bottom":"left");_config=model.getScaleComponent(channel).get("type");
_axis=getAxisConfigs(channel,_config,orient,model.config);_config$axis=void 0!==axis?!axis:getAxisConfig("disable",config.style,null===(_axis2=axis)||void 0===_axis2?void 0:_axis2.style,_axis).configValue;axisComponent.set("disable",_config$axis,void 0!==axis);if(_config$axis)return axisComponent;axis=axis||{};_axis2=getLabelAngle(fieldOrDatumDef,axis,channel,config.style,_axis);fieldOrDatumDef={fieldOrDatumDef:fieldOrDatumDef,axis:axis,channel:channel,model:model,scaleType:_config,orient:orient,
labelAngle:_axis2,mark:mark,config:config};mark=$jscomp.makeIterator(AXIS_COMPONENT_PROPERTIES);for(orient=mark.next();!orient.done;orient=mark.next())if(orient=orient.value,_axis2=orient in axisRules?axisRules[orient](fieldOrDatumDef):AXIS_PROPERTIES_INDEX[orient]?axis[orient]:void 0,_config=void 0!==_axis2,_config$axis=isExplicit(_axis2,orient,axis,model,channel),_config&&_config$axis)axisComponent.set(orient,_axis2,_config$axis);else{var $jscomp$destructuring$var595=AXIS_PROPERTIES_INDEX[orient]&&
"values"!==orient?getAxisConfig(orient,config.style,axis.style,_axis):{},configValue=void 0===$jscomp$destructuring$var595.configValue?void 0:$jscomp$destructuring$var595.configValue;$jscomp$destructuring$var595=void 0===$jscomp$destructuring$var595.configFrom?void 0:$jscomp$destructuring$var595.configFrom;var hasConfigValue=void 0!==configValue;_config&&!hasConfigValue?axisComponent.set(orient,_axis2,_config$axis):("vgAxisConfig"!==$jscomp$destructuring$var595||propsToAlwaysIncludeConfig.has(orient)&&
hasConfigValue||isConditionalAxisValue(configValue)||isSignalRef(configValue))&&axisComponent.set(orient,configValue,!1)}var $jscomp$nullish$tmp189,axisEncoding=null!=($jscomp$nullish$tmp189=axis.encoding)?$jscomp$nullish$tmp189:{};config=AXIS_PARTS.reduce(function(e,part){if(!axisComponent.hasAxisPart(part))return e;var $jscomp$nullish$tmp190,axisEncodingPart=guideEncodeEntry(null!=($jscomp$nullish$tmp190=axisEncoding[part])?$jscomp$nullish$tmp190:{},model);if("labels"===part){var encoding=model.encoding;
$jscomp$nullish$tmp190=model.config;var $jscomp$inline_4785;encoding=null!=($jscomp$inline_4785=getFieldOrDatumDef(encoding[channel]))?$jscomp$inline_4785:getFieldOrDatumDef(encoding[getSecondaryRangeChannel(channel)]);var $jscomp$inline_4788=model.axis(channel)||{};$jscomp$inline_4785=$jscomp$inline_4788.format;$jscomp$inline_4788=$jscomp$inline_4788.formatType;axisEncodingPart=isCustomFormatType($jscomp$inline_4788)?Object.assign({},{text:formatCustomType({fieldOrDatumDef:encoding,field:"datum.value",
format:$jscomp$inline_4785,formatType:$jscomp$inline_4788,config:$jscomp$nullish$tmp190})},axisEncodingPart):axisEncodingPart}void 0===axisEncodingPart||isEmpty(axisEncodingPart)||(e[part]={update:axisEncodingPart});return e},{});isEmpty(config)||axisComponent.set("encode",config,!!axis.encoding||void 0!==axis.labelAngle);return axisComponent}function initLayoutSize($jscomp$destructuring$var596){var encoding=$jscomp$destructuring$var596.encoding;$jscomp$destructuring$var596=$jscomp$destructuring$var596.size;
for(var $jscomp$iter$562=$jscomp.makeIterator(POSITION_SCALE_CHANNELS),$jscomp$key$channel=$jscomp$iter$562.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$562.next()){$jscomp$key$channel=$jscomp$key$channel.value;var sizeType=getSizeChannel$1($jscomp$key$channel);isStep($jscomp$destructuring$var596[sizeType])&&isContinuousFieldOrDatumDef(encoding[$jscomp$key$channel])&&(delete $jscomp$destructuring$var596[sizeType],warn(stepDropped(sizeType)))}return $jscomp$destructuring$var596}
function initMarkdef(originalMarkDef,encoding,config){originalMarkDef=replaceExprRef(originalMarkDef);var specifiedOrient=getMarkPropOrConfig("orient",originalMarkDef,config);originalMarkDef.orient=orient$jscomp$0(originalMarkDef.type,encoding,specifiedOrient);void 0!==specifiedOrient&&specifiedOrient!==originalMarkDef.orient&&warn('Specified orient "'+originalMarkDef.orient+'" overridden with "'+specifiedOrient+'".');if("bar"===originalMarkDef.type&&originalMarkDef.orient&&(specifiedOrient=getMarkPropOrConfig("cornerRadiusEnd",
originalMarkDef,config),void 0!==specifiedOrient)){for(var $jscomp$iter$563=$jscomp.makeIterator("horizontal"===originalMarkDef.orient&&encoding.x2||"vertical"===originalMarkDef.orient&&encoding.y2?["cornerRadius"]:BAR_CORNER_RADIUS_INDEX[originalMarkDef.orient]),$jscomp$key$newProp=$jscomp$iter$563.next();!$jscomp$key$newProp.done;$jscomp$key$newProp=$jscomp$iter$563.next())originalMarkDef[$jscomp$key$newProp.value]=specifiedOrient;void 0!==originalMarkDef.cornerRadiusEnd&&delete originalMarkDef.cornerRadiusEnd}void 0===
getMarkPropOrConfig("opacity",originalMarkDef,config)&&(specifiedOrient=contains([POINT,TICK,CIRCLE,SQUARE],originalMarkDef.type)&&!isAggregate$1(encoding)?.7:void 0,originalMarkDef.opacity=specifiedOrient);void 0===getMarkPropOrConfig("cursor",originalMarkDef,config)&&(encoding=encoding.href||originalMarkDef.href||getMarkPropOrConfig("href",originalMarkDef,config)?"pointer":originalMarkDef.cursor,originalMarkDef.cursor=encoding);return originalMarkDef}function defaultFilled(markDef,config,$jscomp$destructuring$var598){if($jscomp$destructuring$var598.graticule)return!1;
config=getMarkConfig("filled",markDef,config);markDef=markDef.type;return getFirstDefined(config,markDef!==POINT&&markDef!==LINE&&markDef!==RULE)}function orient$jscomp$0(mark,encoding,specifiedOrient){switch(mark){case POINT:case CIRCLE:case SQUARE:case TEXT:case RECT:case IMAGE:return}var x=encoding.x,y=encoding.y,x2=encoding.x2;encoding=encoding.y2;switch(mark){case BAR:if(isFieldDef(x)&&(isBinned(x.bin)||isFieldDef(y)&&y.aggregate&&!x.aggregate))break;if(isFieldDef(y)&&(isBinned(y.bin)||isFieldDef(x)&&
x.aggregate&&!y.aggregate))return"horizontal";if(encoding||x2){if(specifiedOrient)return specifiedOrient;if(!x2&&(isFieldDef(x)&&"quantitative"===x.type&&!isBinning(x.bin)||isNumericDataDef(x)))return"horizontal";if(!encoding&&(isFieldDef(y)&&"quantitative"===y.type&&!isBinning(y.bin)||isNumericDataDef(y)))break}case RULE:if(!(!x2||isFieldDef(x)&&isBinned(x.bin)||!encoding||isFieldDef(y)&&isBinned(y.bin)))return;case AREA:if(encoding){if(isFieldDef(y)&&isBinned(y.bin))return"horizontal";break}else if(x2)if(isFieldDef(x)&&
isBinned(x.bin))break;else return"horizontal";else if(mark===RULE)if(x&&!y)break;else if(y&&!x)return"horizontal";case LINE:case TICK:x2=isContinuousFieldOrDatumDef(x);encoding=isContinuousFieldOrDatumDef(y);if(specifiedOrient)return specifiedOrient;if(x2&&!encoding)return"tick"!==mark?"horizontal":"vertical";if(!x2&&encoding)return"tick"!==mark?"vertical":"horizontal";if(x2&&encoding){specifiedOrient="temporal"===x.type;x2="temporal"===y.type;if(specifiedOrient&&!x2)return"tick"!==mark?"vertical":
"horizontal";if(!specifiedOrient&&x2)return"tick"!==mark?"horizontal":"vertical";if(!x.aggregate&&y.aggregate)return"tick"!==mark?"vertical":"horizontal";if(x.aggregate&&!y.aggregate)return"tick"!==mark?"horizontal":"vertical"}else return}return"vertical"}function encodeEntry(model,fixedShape){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),pointPosition("x",model,{defaultPos:"mid"}),pointPosition("y",
model,{defaultPos:"mid"}),nonPosition("size",model),nonPosition("angle",model),fixedShape?{shape:{value:fixedShape}}:nonPosition("shape",model))}function align$jscomp$0(markDef,encoding,config){if(void 0===getMarkPropOrConfig("align",markDef,config))return"center"}function baseline(markDef,encoding,config){if(void 0===getMarkPropOrConfig("baseline",markDef,config))return"middle"}function defaultSize(model){var config=model.config,markDef=model.markDef,orient=markDef.orient,vgSizeChannel="horizontal"===
orient?"width":"height";model=model.getScaleComponent("horizontal"===orient?"x":"y");var $jscomp$nullish$tmp191;markDef=null!=($jscomp$nullish$tmp191=getMarkPropOrConfig("size",markDef,config,{vgChannel:vgSizeChannel}))?$jscomp$nullish$tmp191:config.tick.bandSize;return void 0!==markDef?markDef:($jscomp$nullish$tmp191=model?model.get("range"):void 0)&&isVgRangeStep($jscomp$nullish$tmp191)&&vegaUtil.isNumber($jscomp$nullish$tmp191.step)?3*$jscomp$nullish$tmp191.step/4:3*getViewConfigDiscreteStep(config.view,
vgSizeChannel)/4}function parseMarkGroups(model){if(contains([LINE,AREA,TRAIL],model.mark)){var details=pathGroupingFields(model.mark,model.encoding);if(0<details.length)return getPathGroups(model,details)}else if(model.mark===BAR&&(details=VG_CORNERRADIUS_CHANNELS.some(function(prop){return getMarkPropOrConfig(prop,model.markDef,model.config)}),model.stack&&!model.fieldDef("size")&&details))return getGroupsForStackedBarWithCornerRadius(model);return getMarkGroup(model)}function getPathGroups(model,
details){return[{name:model.getName("pathgroup"),type:"group",from:{facet:{name:"faceted_path_"+model.requestDataName(DataSourceType.Main),data:model.requestDataName(DataSourceType.Main),groupby:details}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:getMarkGroup(model,{fromPrefix:"faceted_path_"})}]}function getGroupsForStackedBarWithCornerRadius(model){var mark=$jscomp.makeIterator(getMarkGroup(model,{fromPrefix:"stack_group_"})).next().value,fieldScale=model.scaleName(model.stack.fieldChannel),
stackField=function(opt){opt=void 0===opt?{}:opt;return model.vgField(model.stack.fieldChannel,opt)},stackFieldGroup=function(func,expr){expr=[stackField({prefix:"min",suffix:"start",expr:expr}),stackField({prefix:"max",suffix:"start",expr:expr}),stackField({prefix:"min",suffix:"end",expr:expr}),stackField({prefix:"max",suffix:"end",expr:expr})];return func+"("+expr.map(function(field){return"scale('"+fieldScale+"',"+field+")"}).join(",")+")"};if("x"===model.stack.fieldChannel){stackFieldGroup=Object.assign({},
pick(mark.encode.update,["y","yc","y2","height"].concat($jscomp.arrayFromIterable(VG_CORNERRADIUS_CHANNELS))),{x:{signal:stackFieldGroup("min","datum")},x2:{signal:stackFieldGroup("max","datum")},clip:{value:!0}});var innerGroupUpdate={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}};mark.encode.update=Object.assign({},omit(mark.encode.update,["y","yc","y2"]),{height:{field:{group:"height"}}})}else stackFieldGroup=Object.assign({},pick(mark.encode.update,["x","xc","x2","width"]),{y:{signal:stackFieldGroup("min",
"datum")},y2:{signal:stackFieldGroup("max","datum")},clip:{value:!0}}),innerGroupUpdate={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},mark.encode.update=Object.assign({},omit(mark.encode.update,["x","xc","x2"]),{width:{field:{group:"width"}}});for(var $jscomp$iter$564=$jscomp.makeIterator(VG_CORNERRADIUS_CHANNELS),$jscomp$key$key=$jscomp$iter$564.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$564.next()){$jscomp$key$key=$jscomp$key$key.value;var configValue=getMarkConfig($jscomp$key$key,
model.markDef,model.config);mark.encode.update[$jscomp$key$key]?(stackFieldGroup[$jscomp$key$key]=mark.encode.update[$jscomp$key$key],delete mark.encode.update[$jscomp$key$key]):configValue&&(stackFieldGroup[$jscomp$key$key]=signalOrValueRef(configValue));configValue&&(mark.encode.update[$jscomp$key$key]={value:0})}$jscomp$iter$564=[];model.stack.groupbyChannel&&($jscomp$key$key=model.fieldDef(model.stack.groupbyChannel),(configValue=vgField($jscomp$key$key))&&$jscomp$iter$564.push(configValue),(null!==
$jscomp$key$key&&void 0!==$jscomp$key$key&&$jscomp$key$key.bin||null!==$jscomp$key$key&&void 0!==$jscomp$key$key&&$jscomp$key$key.timeUnit)&&$jscomp$iter$564.push(vgField($jscomp$key$key,{binSuffix:"end"})));stackFieldGroup="stroke strokeWidth strokeJoin strokeCap strokeDash strokeDashOffset strokeMiterLimit strokeOpacity".split(" ").reduce(function(encode,prop){if(mark.encode.update[prop]){var $jscomp$compprop253={};return Object.assign({},encode,($jscomp$compprop253[prop]=mark.encode.update[prop],
$jscomp$compprop253))}$jscomp$compprop253=getMarkConfig(prop,model.markDef,model.config);if(void 0!==$jscomp$compprop253){var $jscomp$compprop254={};return Object.assign({},encode,($jscomp$compprop254[prop]=signalOrValueRef($jscomp$compprop253),$jscomp$compprop254))}return encode},stackFieldGroup);stackFieldGroup.stroke&&(stackFieldGroup.strokeForeground={value:!0},stackFieldGroup.strokeOffset={value:0});return[{type:"group",from:{facet:{data:model.requestDataName(DataSourceType.Main),name:"stack_group_"+
model.requestDataName(DataSourceType.Main),groupby:$jscomp$iter$564,aggregate:{fields:[stackField({suffix:"start"}),stackField({suffix:"start"}),stackField({suffix:"end"}),stackField({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:stackFieldGroup},marks:[{type:"group",encode:{update:innerGroupUpdate},marks:[mark]}]}]}function getSort(model){var encoding=model.encoding,stack=model.stack,mark=model.mark,markDef=model.markDef,config=model.config,order=encoding.order;if(!(!vegaUtil.isArray(order)&&
isValueDef(order)&&isNullOrFalse(order.value)||!order&&isNullOrFalse(getMarkPropOrConfig("order",markDef,config)))){if((vegaUtil.isArray(order)||isFieldDef(order))&&!stack)return sortParams(order,{expr:"datum"});if(isPathMark(mark)&&(stack="horizontal"===markDef.orient?"y":"x",mark=encoding[stack],isFieldDef(mark))){encoding=mark.sort;if(vegaUtil.isArray(encoding))return{field:vgField(mark,{prefix:stack,suffix:"sort_index",expr:"datum"})};if(isSortField(encoding))return{field:vgField({aggregate:isAggregate$1(model.encoding)?
encoding.op:void 0,field:encoding.field},{expr:"datum"})};if(encoding&&encoding.encoding)return model=model.fieldDef(encoding.encoding),{field:vgField(model,{expr:"datum"}),order:encoding.order};if(null!==encoding){var _model$stack;return{field:vgField(mark,{binSuffix:null!==(_model$stack=model.stack)&&void 0!==_model$stack&&_model$stack.impute?"mid":void 0,expr:"datum"})}}}}}function getMarkGroup(model,opt){opt=void 0===opt?{fromPrefix:""}:opt;var mark=model.mark,markDef=model.markDef,encoding=model.encoding,
config=model.config,JSCompiler_temp_const=markDef.clip;var JSCompiler_inline_result=model.getScaleComponent("x");var yScale=model.getScaleComponent("y");JSCompiler_inline_result=JSCompiler_inline_result&&JSCompiler_inline_result.get("selectionExtent")||yScale&&yScale.get("selectionExtent")?!0:void 0;yScale=model.component.projection;JSCompiler_temp_const=getFirstDefined(JSCompiler_temp_const,JSCompiler_inline_result,yScale&&!yScale.isFit?!0:void 0);JSCompiler_inline_result=getStyles(markDef);encoding=
encoding.key;yScale=getSort(model);var JSCompiler_inline_result$jscomp$0;if(model.component.selection){for(var parentCount=JSCompiler_inline_result$jscomp$0=keys$jscomp$0(model.component.selection).length,parent=model.parent;parent&&0===parentCount;)parentCount=keys$jscomp$0(parent.component.selection).length,parent=parent.parent;JSCompiler_inline_result$jscomp$0=parentCount?{interactive:0<JSCompiler_inline_result$jscomp$0||!!model.encoding.tooltip}:null}else JSCompiler_inline_result$jscomp$0=null;
markDef=getMarkPropOrConfig("aria",markDef,config);config=markCompiler[mark].postEncodingTransform?markCompiler[mark].postEncodingTransform(model):null;return[Object.assign({},{name:model.getName("marks"),type:markCompiler[mark].vgMark},JSCompiler_temp_const?{clip:!0}:{},JSCompiler_inline_result?{style:JSCompiler_inline_result}:{},encoding?{key:encoding.field}:{},yScale?{sort:yScale}:{},JSCompiler_inline_result$jscomp$0?JSCompiler_inline_result$jscomp$0:{},!1===markDef?{aria:markDef}:{},{from:{data:opt.fromPrefix+
model.requestDataName(DataSourceType.Main)},encode:{update:markCompiler[mark].encodeEntry(model)}},config?{transform:config}:{})]}function buildModel(spec,parent,parentGivenName,unitSize,config){if("facet"in spec)return new FacetModel(spec,parent,parentGivenName,config);if("layer"in spec)return new LayerModel(spec,parent,parentGivenName,unitSize,config);if(isUnitSpec(spec))return new UnitModel(spec,parent,parentGivenName,unitSize,config);if("vconcat"in spec||"hconcat"in spec||"concat"in spec)return new ConcatModel(spec,
parent,parentGivenName,config);throw Error(invalidSpec(spec));}function assembleTopLevelModel(model,topLevelProperties,datasets,usermeta){datasets=void 0===datasets?{}:datasets;var vgConfig=model.config?stripAndRedirectConfig(model.config):void 0;datasets=[].concat(model.assembleSelectionData([]),assembleRootData(model.component.data,datasets));var projections=model.assembleProjections(),title=model.assembleTitle(),style=model.assembleGroupStyle(),encodeEntry=model.assembleGroupEncodeEntry(!0),layoutSignals=
model.assembleLayoutSignals();layoutSignals=layoutSignals.filter(function(signal){return"width"!==signal.name&&"height"!==signal.name||void 0===signal.value?!0:(topLevelProperties[signal.name]=+signal.value,!1)});var $jscomp$destructuring$var615=Object.assign({},topLevelProperties),params=topLevelProperties.params;$jscomp$destructuring$var615=(delete $jscomp$destructuring$var615.params,$jscomp$destructuring$var615);return Object.assign({},{$schema:"https://vega.github.io/schema/vega/v5.json"},model.description?
{description:model.description}:{},$jscomp$destructuring$var615,title?{title:title}:{},style?{style:style}:{},encodeEntry?{encode:{update:encodeEntry}}:{},{data:datasets},0<projections.length?{projections:projections}:{},model.assembleGroup([].concat($jscomp.arrayFromIterable(layoutSignals),$jscomp.arrayFromIterable(model.assembleSelectionTopLevelSignals([])),$jscomp.arrayFromIterable(assembleParameterSignals(params)))),vgConfig?{config:vgConfig}:{},usermeta?{usermeta:usermeta}:{})}Array.prototype.flat||
Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function r(JSCompiler_OptimizeArgumentsArray_p4){var t=isNaN(JSCompiler_OptimizeArgumentsArray_p4)?1:Number(JSCompiler_OptimizeArgumentsArray_p4);return t?Array.prototype.reduce.call(this,function(a,e){return Array.isArray(e)?a.push.apply(a,r.call(e,t-1)):a.push(e),a},[]):Array.prototype.slice.call(this)},writable:!0});Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(r){return Array.prototype.map.apply(this,
arguments).flat()},writable:!0});var clone$jscomp$1={exports:{}};(function(module){var clone$jscomp$0=function(){function _instanceof(obj,type){return null!=type&&obj instanceof type}function clone(parent$jscomp$0,circular,depth$jscomp$0,prototype,includeNonEnumerable){function _clone(parent,depth){if(null===parent)return null;if(0===depth||"object"!=typeof parent)return parent;if(_instanceof(parent,nativeMap))var child=new nativeMap;else if(_instanceof(parent,nativeSet))child=new nativeSet;else if(_instanceof(parent,
nativePromise))child=new nativePromise(function(resolve,reject){parent.then(function(value){resolve(_clone(value,depth-1))},function(err){reject(_clone(err,depth-1))})});else if(clone.__isArray(parent))child=[];else if(clone.__isRegExp(parent))child=new RegExp(parent.source,__getRegExpFlags(parent)),parent.lastIndex&&(child.lastIndex=parent.lastIndex);else if(clone.__isDate(parent))child=new Date(parent.getTime());else{if(useBuffer&&Buffer.isBuffer(parent))return child=Buffer.allocUnsafe?Buffer.allocUnsafe(parent.length):
new Buffer(parent.length),parent.copy(child),child;if(_instanceof(parent,Error))child=Object.create(parent);else if("undefined"==typeof prototype){var proto=Object.getPrototypeOf(parent);child=Object.create(proto)}else child=Object.create(prototype),proto=prototype}if(circular){var index=allParents.indexOf(parent);if(-1!=index)return allChildren[index];allParents.push(parent);allChildren.push(child)}_instanceof(parent,nativeMap)&&parent.forEach(function(value,key){key=_clone(key,depth-1);value=_clone(value,
depth-1);child.set(key,value)});_instanceof(parent,nativeSet)&&parent.forEach(function(value){value=_clone(value,depth-1);child.add(value)});for(var i in parent){var attrs;proto&&(attrs=Object.getOwnPropertyDescriptor(proto,i));attrs&&null==attrs.set||(child[i]=_clone(parent[i],depth-1))}if(Object.getOwnPropertySymbols)for(index=Object.getOwnPropertySymbols(parent),i=0;i<index.length;i++)if(attrs=index[i],proto=Object.getOwnPropertyDescriptor(parent,attrs),!proto||proto.enumerable||includeNonEnumerable)child[attrs]=
_clone(parent[attrs],depth-1),proto.enumerable||Object.defineProperty(child,attrs,{enumerable:!1});if(includeNonEnumerable)for(index=Object.getOwnPropertyNames(parent),i=0;i<index.length;i++)attrs=index[i],proto=Object.getOwnPropertyDescriptor(parent,attrs),proto&&proto.enumerable||(child[attrs]=_clone(parent[attrs],depth-1),Object.defineProperty(child,attrs,{enumerable:!1}));return child}"object"===typeof circular&&(depth$jscomp$0=circular.depth,prototype=circular.prototype,includeNonEnumerable=
circular.includeNonEnumerable,circular=circular.circular);var allParents=[],allChildren=[],useBuffer="undefined"!=typeof Buffer;"undefined"==typeof circular&&(circular=!0);"undefined"==typeof depth$jscomp$0&&(depth$jscomp$0=Infinity);return _clone(parent$jscomp$0,depth$jscomp$0)}function __objToStr(o){return Object.prototype.toString.call(o)}function __getRegExpFlags(re){var flags="";re.global&&(flags+="g");re.ignoreCase&&(flags+="i");re.multiline&&(flags+="m");return flags}try{var nativeMap=Map}catch(_){nativeMap=
function(){}}try{var nativeSet=Set}catch(_$751){nativeSet=function(){}}try{var nativePromise=Promise}catch(_$752){nativePromise=function(){}}clone.clonePrototype=function(parent){if(null===parent)return null;var c=function(){};c.prototype=parent;return new c};clone.__objToStr=__objToStr;clone.__isDate=function(o){return"object"===typeof o&&"[object Date]"===__objToStr(o)};clone.__isArray=function(o){return"object"===typeof o&&"[object Array]"===__objToStr(o)};clone.__isRegExp=function(o){return"object"===
typeof o&&"[object RegExp]"===__objToStr(o)};clone.__getRegExpFlags=__getRegExpFlags;return clone}();module.exports&&(module.exports=clone$jscomp$0)})(clone$jscomp$1);var fastJsonStableStringify=function(data,opts){opts||(opts={});"function"===typeof opts&&(opts={cmp:opts});var cycles="boolean"===typeof opts.cycles?opts.cycles:!1,cmp=opts.cmp&&function(f){return function(node){return function(a,b){return f({key:a,value:node[a]},{key:b,value:node[b]})}}}(opts.cmp),seen=[];return function stringify(node){node&&
node.toJSON&&"function"===typeof node.toJSON&&(node=node.toJSON());if(void 0!==node){if("number"==typeof node)return isFinite(node)?""+node:"null";if("object"!==typeof node)return JSON.stringify(node);var i;if(Array.isArray(node)){var out="[";for(i=0;i<node.length;i++)i&&(out+=","),out+=stringify(node[i])||"null";return out+"]"}if(null===node)return"null";if(-1!==seen.indexOf(node)){if(cycles)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var seenIndex=
seen.push(node)-1,keys=Object.keys(node).sort(cmp&&cmp(node));out="";for(i=0;i<keys.length;i++){var key=keys[i],value=stringify(node[key]);value&&(out&&(out+=","),out+=JSON.stringify(key)+":"+value)}seen.splice(seenIndex,1);return"{"+out+"}"}}(data)},deepEqual=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){if(a.constructor!==b.constructor)return!1;var i;if(Array.isArray(a)){var length=a.length;if(length!=b.length)return!1;for(i=length;0!==i--;)if(!equal(a[i],
b[i]))return!1;return!0}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();var keys=Object.keys(a);length=keys.length;if(length!==Object.keys(b).length)return!1;for(i=length;0!==i--;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return!1;for(i=length;0!==i--;)if(length=keys[i],!equal(a[length],b[length]))return!1;return!0}return a!==
a&&b!==b},duplicate=clone$jscomp$1.exports;Set.prototype.toJSON=function(){return"Set("+[].concat($jscomp.arrayFromIterable(this)).map(function(x){return fastJsonStableStringify(x)}).join(",")+")"};var stringify=fastJsonStableStringify,keys$jscomp$0=Object.keys,vals$jscomp$0=Object.values,entries$1=Object.entries,idCounter=42,POLAR_POSITION_CHANNEL_INDEX={theta:1,theta2:1,radius:1,radius2:1},GEO_POSIITON_CHANNEL_INDEX={longitude:1,longitude2:1,latitude:1,latitude2:1},GEOPOSITION_CHANNELS=keys$jscomp$0(GEO_POSIITON_CHANNEL_INDEX),
UNIT_CHANNEL_INDEX=Object.assign({},{x:1,y:1,x2:1,y2:1},POLAR_POSITION_CHANNEL_INDEX,GEO_POSIITON_CHANNEL_INDEX,{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1}),FACET_CHANNEL_INDEX={row:1,column:1,facet:1},FACET_CHANNELS=keys$jscomp$0(FACET_CHANNEL_INDEX),CHANNEL_INDEX=Object.assign({},UNIT_CHANNEL_INDEX,FACET_CHANNEL_INDEX),CHANNELS=keys$jscomp$0(CHANNEL_INDEX),$jscomp$destructuring$var95=
Object.assign({},CHANNEL_INDEX),$jscomp$destructuring$var96=(delete $jscomp$destructuring$var95.order,delete $jscomp$destructuring$var95.detail,delete $jscomp$destructuring$var95.tooltip,$jscomp$destructuring$var95),$jscomp$destructuring$var97=Object.assign({},$jscomp$destructuring$var96),SINGLE_DEF_UNIT_CHANNEL_INDEX=(delete $jscomp$destructuring$var97.row,delete $jscomp$destructuring$var97.column,delete $jscomp$destructuring$var97.facet,$jscomp$destructuring$var97),SECONDARY_RANGE_CHANNEL="x2 y2 latitude2 longitude2 theta2 radius2".split(" "),
$jscomp$destructuring$var99=Object.assign({},UNIT_CHANNEL_INDEX),NONPOSITION_CHANNEL_INDEX=(delete $jscomp$destructuring$var99.x,delete $jscomp$destructuring$var99.y,delete $jscomp$destructuring$var99.x2,delete $jscomp$destructuring$var99.y2,delete $jscomp$destructuring$var99.latitude,delete $jscomp$destructuring$var99.longitude,delete $jscomp$destructuring$var99.latitude2,delete $jscomp$destructuring$var99.longitude2,delete $jscomp$destructuring$var99.theta,delete $jscomp$destructuring$var99.theta2,
delete $jscomp$destructuring$var99.radius,delete $jscomp$destructuring$var99.radius2,$jscomp$destructuring$var99),NONPOSITION_CHANNELS=keys$jscomp$0(NONPOSITION_CHANNEL_INDEX),POSITION_SCALE_CHANNEL_INDEX={x:1,y:1},POSITION_SCALE_CHANNELS=keys$jscomp$0(POSITION_SCALE_CHANNEL_INDEX),POLAR_POSITION_SCALE_CHANNEL_INDEX={theta:1,radius:1},POLAR_POSITION_SCALE_CHANNELS=keys$jscomp$0(POLAR_POSITION_SCALE_CHANNEL_INDEX),$jscomp$destructuring$var101=Object.assign({},NONPOSITION_CHANNEL_INDEX),NONPOSITION_SCALE_CHANNEL_INDEX=
(delete $jscomp$destructuring$var101.text,delete $jscomp$destructuring$var101.tooltip,delete $jscomp$destructuring$var101.href,delete $jscomp$destructuring$var101.url,delete $jscomp$destructuring$var101.description,delete $jscomp$destructuring$var101.detail,delete $jscomp$destructuring$var101.key,delete $jscomp$destructuring$var101.order,$jscomp$destructuring$var101),NONPOSITION_SCALE_CHANNELS=keys$jscomp$0(NONPOSITION_SCALE_CHANNEL_INDEX),SCALE_CHANNEL_INDEX=Object.assign({},POSITION_SCALE_CHANNEL_INDEX,
POLAR_POSITION_SCALE_CHANNEL_INDEX,NONPOSITION_SCALE_CHANNEL_INDEX),SCALE_CHANNELS=keys$jscomp$0(SCALE_CHANNEL_INDEX),ALL_MARKS={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},$jscomp$destructuring$var103=Object.assign({},ALL_MARKS),ALL_MARKS_EXCEPT_GEOSHAPE=(delete $jscomp$destructuring$var103.geoshape,$jscomp$destructuring$var103),AGGREGATE_OP_INDEX=
{argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},MULTIDOMAIN_SORT_OP_INDEX={count:1,min:1,max:1},COUNTING_OPS=["count","valid","missing","distinct"],SUM_OPS=["count","sum","distinct","valid","missing"],SHARED_DOMAIN_OP_INDEX=vegaUtil.toSet("mean average median q1 q3 min max".split(" ")),VG_MARK_CONFIGS=keys$jscomp$0({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,
blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,
cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),VG_MARK_INDEX={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},VG_CORNERRADIUS_CHANNELS=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"],main=vegaUtil.logger(vegaUtil.Warn),current=main,MONTHS="january february march april may june july august september october november december".split(" "),SHORT_MONTHS=
MONTHS.map(function(m){return m.substr(0,3)}),DAYS="sunday monday tuesday wednesday thursday friday saturday".split(" "),SHORT_DAYS=DAYS.map(function(d){return d.substr(0,3)}),LOCAL_SINGLE_TIMEUNIT_INDEX={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},TIMEUNIT_PARTS=keys$jscomp$0(LOCAL_SINGLE_TIMEUNIT_INDEX),VEGALITE_TIMEFORMAT={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "},ScaleType={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",
IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},SCALE_CATEGORY_INDEX={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",
threshold:"discretizing"},SCALE_PRECEDENCE_INDEX={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0},CONTINUOUS_TO_CONTINUOUS_SCALES="linear log pow sqrt symlog time utc".split(" "),CONTINUOUS_TO_CONTINUOUS_INDEX=vegaUtil.toSet(CONTINUOUS_TO_CONTINUOUS_SCALES),QUANTITATIVE_SCALES_INDEX=vegaUtil.toSet(["linear","log","pow","sqrt","symlog"]),CONTINUOUS_TO_DISCRETE_INDEX=vegaUtil.toSet(["quantile","quantize",
"threshold"]),CONTINUOUS_DOMAIN_SCALES=CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["quantile","quantize","threshold","sequential","identity"]),CONTINUOUS_DOMAIN_INDEX=vegaUtil.toSet(CONTINUOUS_DOMAIN_SCALES),DISCRETE_DOMAIN_INDEX=vegaUtil.toSet(["ordinal","bin-ordinal","point","band"]),$jscomp$destructuring$var124=Object.assign({},{type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,
zero:1,padding:1,paddingInner:1,paddingOuter:1}),NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX=(delete $jscomp$destructuring$var124.type,delete $jscomp$destructuring$var124.domain,delete $jscomp$destructuring$var124.range,delete $jscomp$destructuring$var124.rangeMax,delete $jscomp$destructuring$var124.rangeMin,delete $jscomp$destructuring$var124.scheme,$jscomp$destructuring$var124),NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=keys$jscomp$0(NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTY_INDEX),Mark={arc:"arc",
area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},ARC=Mark.arc,AREA=Mark.area,BAR=Mark.bar,IMAGE=Mark.image,LINE=Mark.line,POINT=Mark.point,RECT=Mark.rect,RULE=Mark.rule,TEXT=Mark.text,TICK=Mark.tick,TRAIL=Mark.trail,CIRCLE=Mark.circle,SQUARE=Mark.square,GEOSHAPE=Mark.geoshape,PRIMITIVE_MARKS=keys$jscomp$0(Mark);vegaUtil.toSet(PRIMITIVE_MARKS);var FILL_STROKE_CONFIG=[].concat($jscomp.arrayFromIterable("stroke strokeWidth strokeDash strokeDashOffset strokeOpacity strokeJoin strokeMiterLimit".split(" ")),
$jscomp.arrayFromIterable(["fill","fillOpacity"])),VL_ONLY_MARK_CONFIG_PROPERTIES=keys$jscomp$0({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1}),MARK_CONFIGS=keys$jscomp$0({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),BAR_CORNER_RADIUS_INDEX={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},SORT_BY_CHANNEL_INDEX=
{x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1},defaultTitleFormatter=function(fieldDef,config){switch(config.fieldTitle){case "plain":return fieldDef.field;case "functional":config=fieldDef.aggregate;var bin=fieldDef.bin,timeUnit=fieldDef.timeUnit;fieldDef=fieldDef.field;isArgmaxDef(config)?config=fieldDef+" for argmax("+config.argmax+")":isArgminDef(config)?config=fieldDef+" for argmin("+config.argmin+")":(timeUnit=normalizeTimeUnit(timeUnit),
config=(config=config||(null===timeUnit||void 0===timeUnit?void 0:timeUnit.unit)||(null===timeUnit||void 0===timeUnit?void 0:timeUnit.maxbins)&&"timeunit"||isBinning(bin)&&"bin")?config.toUpperCase()+"("+fieldDef+")":fieldDef);return config;default:return verbalTitleFormatter(fieldDef,config)}},titleFormatter=defaultTitleFormatter,COMPATIBLE={compatible:!0},CONDITIONAL_AXIS_PROP_INDEX={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",
vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},
tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}},AXIS_PARTS=["domain","grid","labels","ticks","title"],AXIS_PROPERTY_TYPE={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",
description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",
labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",
titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},COMMON_AXIS_PROPERTIES_INDEX={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,
labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,
titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},AXIS_PROPERTIES_INDEX=Object.assign({},COMMON_AXIS_PROPERTIES_INDEX,{style:1,labelExpr:1,encoding:1}),AXIS_CONFIGS=keys$jscomp$0({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,
axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),CompositeMarkNormalizer=function(name,run){this.name=name;this.run=run};CompositeMarkNormalizer.prototype.hasMatchingType=function(spec){return isUnitSpec(spec)?(spec=spec.mark,(isMarkDef(spec)?spec.type:spec)===this.name):!1};var boxPlotNormalizer=new CompositeMarkNormalizer("boxplot",normalizeBoxPlot),errorBarNormalizer=new CompositeMarkNormalizer("errorbar",
normalizeErrorBar),errorBandNormalizer=new CompositeMarkNormalizer("errorband",normalizeErrorBand),compositeMarkRegistry={};add$jscomp$0("boxplot",normalizeBoxPlot,["box","median","outliers","rule","ticks"]);add$jscomp$0("errorbar",normalizeErrorBar,["ticks","rule"]);add$jscomp$0("errorband",normalizeErrorBand,["band","borders"]);var VL_ONLY_LEGEND_CONFIG=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],HEADER_TITLE_PROPERTIES_MAP=
{titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},HEADER_LABEL_PROPERTIES_MAP={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",
labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},HEADER_TITLE_PROPERTIES=keys$jscomp$0(HEADER_TITLE_PROPERTIES_MAP),HEADER_LABEL_PROPERTIES=keys$jscomp$0(HEADER_LABEL_PROPERTIES_MAP),HEADER_CONFIGS=keys$jscomp$0({header:1,headerRow:1,headerColumn:1,headerFacet:1}),LEGEND_SCALE_CHANNELS="size shape fill stroke strokeDash strokeWidth opacity".split(" "),TOP_LEVEL_PROPERTIES=["background","padding"],COMPOSITION_LAYOUT_PROPERTIES=keys$jscomp$0({align:1,bounds:1,
center:1,columns:1,spacing:1}),defaultConfig={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:20},mark:{color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},arc:{},area:{},bar:{binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},circle:{},geoshape:{},image:{},line:{},point:{},rect:{binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5},rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},
trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,
gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:{point:{on:"click",fields:["_vgsid_"],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] \x3e window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] \x3e window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}},style:{},
title:{},facet:{spacing:20},concat:{spacing:20}},tab10="#4c78a8 #f58518 #e45756 #72b7b2 #54a24b #eeca3b #b279a2 #ff9da6 #9d755d #bab0ac".split(" "),DEFAULT_FONT_SIZE={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},DEFAULT_COLOR={blue:tab10[0],orange:tab10[1],red:tab10[2],teal:tab10[3],green:tab10[4],yellow:tab10[5],purple:tab10[6],pink:tab10[7],brown:tab10[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",
gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"},configPropsWithExpr=[].concat($jscomp.arrayFromIterable(MARK_CONFIGS),$jscomp.arrayFromIterable(AXIS_CONFIGS),$jscomp.arrayFromIterable(HEADER_CONFIGS),"background padding legend lineBreak scale style title view".split(" ")),MARK_STYLES=["view"].concat($jscomp.arrayFromIterable(PRIMITIVE_MARKS)),VL_ONLY_CONFIG_PROPERTIES="color fontSize background padding facet concat numberFormat timeFormat countTitle header axisQuantitative axisTemporal axisDiscrete axisPoint axisXBand axisXPoint axisXDiscrete axisXQuantitative axisXTemporal axisYBand axisYPoint axisYDiscrete axisYQuantitative axisYTemporal scale selection overlay".split(" "),
VL_ONLY_ALL_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=Object.assign({},{view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]}),SpecMapper=function(){};SpecMapper.prototype.map=function(spec,params){return"facet"in spec?this.mapFacet(spec,params):"repeat"in spec?this.mapRepeat(spec,params):
"hconcat"in spec?this.mapHConcat(spec,params):"vconcat"in spec?this.mapVConcat(spec,params):"concat"in spec?this.mapConcat(spec,params):this.mapLayerOrUnit(spec,params)};SpecMapper.prototype.mapLayerOrUnit=function(spec,params){if("layer"in spec)return this.mapLayer(spec,params);if(isUnitSpec(spec))return this.mapUnit(spec,params);throw Error(invalidSpec(spec));};SpecMapper.prototype.mapLayer=function(spec,params){var $jscomp$this=this;return Object.assign({},spec,{layer:spec.layer.map(function(subspec){return $jscomp$this.mapLayerOrUnit(subspec,
params)})})};SpecMapper.prototype.mapHConcat=function(spec,params){var $jscomp$this=this;return Object.assign({},spec,{hconcat:spec.hconcat.map(function(subspec){return $jscomp$this.map(subspec,params)})})};SpecMapper.prototype.mapVConcat=function(spec,params){var $jscomp$this=this;return Object.assign({},spec,{vconcat:spec.vconcat.map(function(subspec){return $jscomp$this.map(subspec,params)})})};SpecMapper.prototype.mapConcat=function(spec,params){var $jscomp$this=this,$jscomp$destructuring$var231=
Object.assign({},spec);spec=spec.concat;$jscomp$destructuring$var231=(delete $jscomp$destructuring$var231.concat,$jscomp$destructuring$var231);return Object.assign({},$jscomp$destructuring$var231,{concat:spec.map(function(subspec){return $jscomp$this.map(subspec,params)})})};SpecMapper.prototype.mapFacet=function(spec,params){return Object.assign({},spec,{spec:this.map(spec.spec,params)})};SpecMapper.prototype.mapRepeat=function(spec,params){return Object.assign({},spec,{spec:this.map(spec.spec,params)})};
var STACK_OFFSET_INDEX={zero:1,center:1,normalize:1},STACKABLE_MARKS=new Set([ARC,BAR,AREA,RULE,POINT,CIRCLE,SQUARE,LINE,TEXT,TICK]),STACK_BY_DEFAULT_MARKS=new Set([BAR,AREA,ARC]),PathOverlayNormalizer=function(){_defineProperty(this,"name","path-overlay")};PathOverlayNormalizer.prototype.hasMatchingType=function(spec,config){if(isUnitSpec(spec)){var mark=spec.mark;spec=spec.encoding;mark=isMarkDef(mark)?mark:{type:mark};switch(mark.type){case "line":case "rule":case "trail":return!!getPointOverlay(mark,
config[mark.type],spec);case "area":return!!getPointOverlay(mark,config[mark.type],spec)||!!getLineOverlay(mark,config[mark.type])}}return!1};PathOverlayNormalizer.prototype.run=function(spec,normParams,normalize){var config=normParams.config,$jscomp$destructuring$var237=Object.assign({},spec),params=spec.params,projection=spec.projection,mark=spec.mark;spec=spec.encoding;$jscomp$destructuring$var237=(delete $jscomp$destructuring$var237.params,delete $jscomp$destructuring$var237.projection,delete $jscomp$destructuring$var237.mark,
delete $jscomp$destructuring$var237.encoding,$jscomp$destructuring$var237);spec=normalizeEncoding(spec,config);mark=isMarkDef(mark)?mark:{type:mark};var pointOverlay=getPointOverlay(mark,config[mark.type],spec),lineOverlay="area"===mark.type&&getLineOverlay(mark,config[mark.type]);params=[Object.assign({},params?{params:params}:{},{mark:dropLineAndPoint(Object.assign({},"area"===mark.type&&void 0===mark.opacity&&void 0===mark.fillOpacity?{opacity:.7}:{},mark)),encoding:omit(spec,["shape"])})];var stackProps=
stack$jscomp$0(mark,spec),overlayEncoding=spec;if(stackProps){overlayEncoding=stackProps.fieldChannel;stackProps=stackProps.offset;var $jscomp$compprop222={};overlayEncoding=Object.assign({},spec,($jscomp$compprop222[overlayEncoding]=Object.assign({},spec[overlayEncoding],stackProps?{stack:stackProps}:{}),$jscomp$compprop222))}lineOverlay&&params.push(Object.assign({},projection?{projection:projection}:{},{mark:Object.assign({},{type:"line"},pick(mark,["clip","interpolate","tension","tooltip"]),lineOverlay),
encoding:overlayEncoding}));pointOverlay&&params.push(Object.assign({},projection?{projection:projection}:{},{mark:Object.assign({},{type:"point",opacity:1,filled:!0},pick(mark,["clip","tooltip"]),pointOverlay),encoding:overlayEncoding}));return normalize(Object.assign({},$jscomp$destructuring$var237,{layer:params}),Object.assign({},normParams,{config:dropLineAndPointFromConfig(config)}))};var RuleForRangedLineNormalizer=function(){_defineProperty(this,"name","RuleForRangedLine")};RuleForRangedLineNormalizer.prototype.hasMatchingType=
function(spec){if(isUnitSpec(spec)){var encoding=spec.encoding;spec=spec.mark;if("line"===spec||isMarkDef(spec)&&"line"===spec.type){spec=$jscomp.makeIterator(SECONDARY_RANGE_CHANNEL);for(var $jscomp$key$channel=spec.next();!$jscomp$key$channel.done;$jscomp$key$channel=spec.next()){$jscomp$key$channel=$jscomp$key$channel.value;var mainChannel=getMainRangeChannel($jscomp$key$channel);mainChannel=encoding[mainChannel];if(encoding[$jscomp$key$channel]&&(isFieldDef(mainChannel)&&!isBinned(mainChannel.bin)||
isDatumDef(mainChannel)))return!0}}}return!1};RuleForRangedLineNormalizer.prototype.run=function(spec,params,normalize){var encoding=spec.encoding,mark=spec.mark,hasX2=!!encoding.x2;warn("Line mark is for continuous lines and thus cannot be used with "+(hasX2&&encoding.y2?"x2 and y2":hasX2?"x2":"y2")+". We will use the rule mark (line segments) instead.");return normalize(Object.assign({},spec,{mark:vegaUtil.isObject(mark)?Object.assign({},mark,{type:"rule"}):"rule"}),params)};var CoreNormalizer=
function(args){for(var $jscomp$restParams=[],$jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-0]=arguments[$jscomp$restIndex];$jscomp$restParams=SpecMapper.apply(this,[].concat($jscomp.arrayFromIterable($jscomp$restParams)))||this;_defineProperty($jscomp$restParams,"nonFacetUnitNormalizers",[boxPlotNormalizer,errorBarNormalizer,errorBandNormalizer,new PathOverlayNormalizer,new RuleForRangedLineNormalizer]);return $jscomp$restParams};$jscomp.inherits(CoreNormalizer,
SpecMapper);CoreNormalizer.prototype.map=function(spec,params){if(isUnitSpec(spec)){var hasRow=channelHasField(spec.encoding,"row"),hasColumn=channelHasField(spec.encoding,"column"),hasFacet=channelHasField(spec.encoding,"facet");if(hasRow||hasColumn||hasFacet)return this.mapFacetedUnit(spec,params)}return SpecMapper.prototype.map.call(this,spec,params)};CoreNormalizer.prototype.mapUnit=function(spec,params){var parentEncoding=params.parentEncoding,parentProjection=params.parentProjection,encoding=
replaceRepeaterInEncoding(spec.encoding,params.repeater);spec=Object.assign({},spec,encoding?{encoding:encoding}:{});if(parentEncoding||parentProjection)return this.mapUnitWithParentEncodingOrProjection(spec,params);parentEncoding=this.mapLayerOrUnit.bind(this);parentProjection=$jscomp.makeIterator(this.nonFacetUnitNormalizers);for(encoding=parentProjection.next();!encoding.done;encoding=parentProjection.next())if(encoding=encoding.value,encoding.hasMatchingType(spec,params.config))return encoding.run(spec,
params,parentEncoding);return spec};CoreNormalizer.prototype.mapRepeat=function(spec,params){return!vegaUtil.isArray(spec.repeat)&&spec.repeat.layer?this.mapLayerRepeat(spec,params):this.mapNonLayerRepeat(spec,params)};CoreNormalizer.prototype.mapLayerRepeat=function(spec,params){var $jscomp$this=this,$jscomp$destructuring$var245=Object.assign({},spec),repeat=spec.repeat,childSpec=spec.spec;$jscomp$destructuring$var245=(delete $jscomp$destructuring$var245.repeat,delete $jscomp$destructuring$var245.spec,
$jscomp$destructuring$var245);var row=repeat.row,column=repeat.column;repeat=repeat.layer;var repeater=void 0===params.repeater?{}:params.repeater,repeaterPrefix=void 0===params.repeaterPrefix?"":params.repeaterPrefix;return row||column?this.mapRepeat(Object.assign({},spec,{repeat:Object.assign({},row?{row:row}:{},column?{column:column}:{}),spec:{repeat:{layer:repeat},spec:childSpec}}),params):Object.assign({},$jscomp$destructuring$var245,{layer:repeat.map(function(layerValue){var childRepeater=Object.assign({},
repeater,{layer:layerValue});layerValue=(childSpec.name||"")+repeaterPrefix+"child__layer_"+varName(layerValue);childRepeater=$jscomp$this.mapLayerOrUnit(childSpec,Object.assign({},params,{repeater:childRepeater,repeaterPrefix:layerValue}));childRepeater.name=layerValue;return childRepeater})})};CoreNormalizer.prototype.mapNonLayerRepeat=function(spec,params){var $jscomp$destructuring$var248=spec,$jscomp$destructuring$var249=Object.assign({},$jscomp$destructuring$var248),repeat=$jscomp$destructuring$var248.repeat,
childSpec=$jscomp$destructuring$var248.spec;$jscomp$destructuring$var248=$jscomp$destructuring$var248.data;$jscomp$destructuring$var249=(delete $jscomp$destructuring$var249.repeat,delete $jscomp$destructuring$var249.spec,delete $jscomp$destructuring$var249.data,$jscomp$destructuring$var249);!vegaUtil.isArray(repeat)&&spec.columns&&(spec=omit(spec,["columns"]),warn(columnsNotSupportByRowCol("repeat")));var concat=[],repeater=void 0===params.repeater?{}:params.repeater,repeaterPrefix=void 0===params.repeaterPrefix?
"":params.repeaterPrefix,row=!vegaUtil.isArray(repeat)&&repeat.row||[repeater?repeater.row:null],column=!vegaUtil.isArray(repeat)&&repeat.column||[repeater?repeater.column:null],repeatValues=vegaUtil.isArray(repeat)&&repeat||[repeater?repeater.repeat:null];repeatValues=$jscomp.makeIterator(repeatValues);for(var $jscomp$key$repeatValue=repeatValues.next();!$jscomp$key$repeatValue.done;$jscomp$key$repeatValue=repeatValues.next()){$jscomp$key$repeatValue=$jscomp$key$repeatValue.value;for(var $jscomp$iter$375=
$jscomp.makeIterator(row),$jscomp$key$rowValue=$jscomp$iter$375.next();!$jscomp$key$rowValue.done;$jscomp$key$rowValue=$jscomp$iter$375.next()){$jscomp$key$rowValue=$jscomp$key$rowValue.value;for(var $jscomp$iter$374=$jscomp.makeIterator(column),$jscomp$key$columnValue=$jscomp$iter$374.next();!$jscomp$key$columnValue.done;$jscomp$key$columnValue=$jscomp$iter$374.next()){var columnValue=$jscomp$key$columnValue.value;$jscomp$key$columnValue={repeat:$jscomp$key$repeatValue,row:$jscomp$key$rowValue,column:columnValue,
layer:repeater.layer};columnValue=(childSpec.name||"")+repeaterPrefix+"child__"+(vegaUtil.isArray(repeat)?""+varName($jscomp$key$repeatValue):(repeat.row?"row_"+varName($jscomp$key$rowValue):"")+(repeat.column?"column_"+varName(columnValue):""));$jscomp$key$columnValue=this.map(childSpec,Object.assign({},params,{repeater:$jscomp$key$columnValue,repeaterPrefix:columnValue}));$jscomp$key$columnValue.name=columnValue;concat.push(omit($jscomp$key$columnValue,["data"]))}}}spec=vegaUtil.isArray(repeat)?
spec.columns:repeat.column?repeat.column.length:1;var $jscomp$nullish$tmp23;return Object.assign({},{data:null!=($jscomp$nullish$tmp23=childSpec.data)?$jscomp$nullish$tmp23:$jscomp$destructuring$var248,align:"all"},$jscomp$destructuring$var249,{columns:spec,concat:concat})};CoreNormalizer.prototype.mapFacet=function(spec,params){isFacetMapping(spec.facet)&&spec.columns&&(spec=omit(spec,["columns"]),warn(columnsNotSupportByRowCol("facet")));return SpecMapper.prototype.mapFacet.call(this,spec,params)};
CoreNormalizer.prototype.mapUnitWithParentEncodingOrProjection=function(spec,params){var encoding=spec.encoding,parentEncoding=params.parentEncoding,config=params.config,mergedProjection=mergeProjection({parentProjection:params.parentProjection,projection:spec.projection});params=mergeEncoding({parentEncoding:parentEncoding,encoding:replaceRepeaterInEncoding(encoding,params.repeater)});return this.mapUnit(Object.assign({},spec,mergedProjection?{projection:mergedProjection}:{},params?{encoding:params}:
{}),{config:config})};CoreNormalizer.prototype.mapFacetedUnit=function(spec,normParams){var $jscomp$destructuring$var254=spec.encoding,$jscomp$destructuring$var255=Object.assign({},$jscomp$destructuring$var254),row=$jscomp$destructuring$var254.row,column=$jscomp$destructuring$var254.column,facet=$jscomp$destructuring$var254.facet,encoding=(delete $jscomp$destructuring$var255.row,delete $jscomp$destructuring$var255.column,delete $jscomp$destructuring$var255.facet,$jscomp$destructuring$var255),$jscomp$destructuring$var257=
Object.assign({},spec);$jscomp$destructuring$var255=spec.mark;$jscomp$destructuring$var254=spec.width;var projection=spec.projection,height=spec.height,view=spec.view;spec=spec.params;$jscomp$destructuring$var257=(delete $jscomp$destructuring$var257.mark,delete $jscomp$destructuring$var257.width,delete $jscomp$destructuring$var257.projection,delete $jscomp$destructuring$var257.height,delete $jscomp$destructuring$var257.view,delete $jscomp$destructuring$var257.params,delete $jscomp$destructuring$var257.encoding,
$jscomp$destructuring$var257);column=this.getFacetMappingAndLayout({row:row,column:column,facet:facet},normParams);row=column.facetMapping;column=column.layout;encoding=replaceRepeaterInEncoding(encoding,normParams.repeater);return this.mapFacet(Object.assign({},$jscomp$destructuring$var257,column,{facet:row,spec:Object.assign({},$jscomp$destructuring$var254?{width:$jscomp$destructuring$var254}:{},height?{height:height}:{},view?{view:view}:{},projection?{projection:projection}:{},{mark:$jscomp$destructuring$var255,
encoding:encoding},spec?{params:spec}:{})}),normParams)};CoreNormalizer.prototype.getFacetMappingAndLayout=function(facets,params){var row=facets.row,column=facets.column,facet=facets.facet;if(row||column){facet&&(params=[].concat($jscomp.arrayFromIterable(row?["row"]:[]),$jscomp.arrayFromIterable(column?["column"]:[])),params="Facet encoding dropped as "+params.join(" and ")+" "+(1<params.length?"are":"is")+" also specified.",warn(params));params={};row={};column=$jscomp.makeIterator(["row","column"]);
for(facet=column.next();!facet.done;facet=column.next()){facet=facet.value;var def=facets[facet];if(def){var $jscomp$destructuring$var261=Object.assign({},def);$jscomp$destructuring$var261=(delete $jscomp$destructuring$var261.align,delete $jscomp$destructuring$var261.center,delete $jscomp$destructuring$var261.spacing,delete $jscomp$destructuring$var261.columns,$jscomp$destructuring$var261);params[facet]=$jscomp$destructuring$var261;$jscomp$destructuring$var261=$jscomp.makeIterator(["align","center",
"spacing"]);for(var $jscomp$key$prop=$jscomp$destructuring$var261.next();!$jscomp$key$prop.done;$jscomp$key$prop=$jscomp$destructuring$var261.next())$jscomp$key$prop=$jscomp$key$prop.value,void 0!==def[$jscomp$key$prop]&&(null!=row[$jscomp$key$prop]||(row[$jscomp$key$prop]={}),row[$jscomp$key$prop][facet]=def[$jscomp$key$prop])}}return{facetMapping:params,layout:row}}def=Object.assign({},facet);facets=facet.align;row=facet.center;column=facet.spacing;facet=facet.columns;def=(delete def.align,delete def.center,
delete def.spacing,delete def.columns,def);params=(params=params.repeater)?isFacetMapping(def)?replaceRepeaterInMapping(def,params):replaceRepeaterInFieldDef(def,params):def;return{facetMapping:params,layout:Object.assign({},facets?{align:facets}:{},row?{center:row}:{},column?{spacing:column}:{},facet?{columns:facet}:{})}};CoreNormalizer.prototype.mapLayer=function(spec,$jscomp$destructuring$var264){var $jscomp$destructuring$var266=Object.assign({},$jscomp$destructuring$var264),parentEncoding=$jscomp$destructuring$var264.parentEncoding;
$jscomp$destructuring$var264=$jscomp$destructuring$var264.parentProjection;$jscomp$destructuring$var266=(delete $jscomp$destructuring$var266.parentEncoding,delete $jscomp$destructuring$var266.parentProjection,$jscomp$destructuring$var266);var $jscomp$destructuring$var268=Object.assign({},spec),encoding=spec.encoding;spec=spec.projection;$jscomp$destructuring$var268=(delete $jscomp$destructuring$var268.encoding,delete $jscomp$destructuring$var268.projection,$jscomp$destructuring$var268);parentEncoding=
Object.assign({},$jscomp$destructuring$var266,{parentEncoding:mergeEncoding({parentEncoding:parentEncoding,encoding:encoding,layer:!0}),parentProjection:mergeProjection({parentProjection:$jscomp$destructuring$var264,projection:spec})});return SpecMapper.prototype.mapLayer.call(this,$jscomp$destructuring$var268,parentEncoding)};var SelectionCompatibilityNormalizer=function(){return SpecMapper.apply(this,arguments)||this};$jscomp.inherits(SelectionCompatibilityNormalizer,SpecMapper);SelectionCompatibilityNormalizer.prototype.map=
function(spec,normParams){null!=normParams.emptySelections||(normParams.emptySelections={});null!=normParams.selectionPredicates||(normParams.selectionPredicates={});spec=normalizeTransforms(spec,normParams);return SpecMapper.prototype.map.call(this,spec,normParams)};SelectionCompatibilityNormalizer.prototype.mapLayerOrUnit=function(spec,normParams){spec=normalizeTransforms(spec,normParams);if(spec.encoding){for(var encoding={},$jscomp$iter$380=$jscomp.makeIterator(entries$1(spec.encoding)),$jscomp$key$=
$jscomp$iter$380.next();!$jscomp$key$.done;$jscomp$key$=$jscomp$iter$380.next()){var $jscomp$destructuring$var273=$jscomp.makeIterator($jscomp$key$.value);$jscomp$key$=$jscomp$destructuring$var273.next().value;$jscomp$destructuring$var273=$jscomp$destructuring$var273.next().value;encoding[$jscomp$key$]=normalizeChannelDef($jscomp$destructuring$var273,normParams)}spec=Object.assign({},spec,{encoding:encoding})}return SpecMapper.prototype.mapLayerOrUnit.call(this,spec,normParams)};SelectionCompatibilityNormalizer.prototype.mapUnit=
function(spec,normParams){var $jscomp$destructuring$var275=Object.assign({},spec),selection=spec.selection;$jscomp$destructuring$var275=(delete $jscomp$destructuring$var275.selection,$jscomp$destructuring$var275);return selection?Object.assign({},$jscomp$destructuring$var275,{params:entries$1(selection).map(function($jscomp$destructuring$var276){var $jscomp$destructuring$var277=$jscomp.makeIterator($jscomp$destructuring$var276);$jscomp$destructuring$var276=$jscomp$destructuring$var277.next().value;
var $jscomp$destructuring$var278=$jscomp$destructuring$var277.next().value,$jscomp$destructuring$var279=Object.assign({},$jscomp$destructuring$var278);$jscomp$destructuring$var277=$jscomp$destructuring$var278.init;var bind=$jscomp$destructuring$var278.bind;$jscomp$destructuring$var278=$jscomp$destructuring$var278.empty;$jscomp$destructuring$var279=(delete $jscomp$destructuring$var279.init,delete $jscomp$destructuring$var279.bind,delete $jscomp$destructuring$var279.empty,$jscomp$destructuring$var279);
"single"===$jscomp$destructuring$var279.type?($jscomp$destructuring$var279.type="point",$jscomp$destructuring$var279.toggle=!1):"multi"===$jscomp$destructuring$var279.type&&($jscomp$destructuring$var279.type="point");normParams.emptySelections[$jscomp$destructuring$var276]="none"!==$jscomp$destructuring$var278;var $jscomp$nullish$tmp28,$jscomp$iter$381=$jscomp.makeIterator(vals$jscomp$0(null!=($jscomp$nullish$tmp28=normParams.selectionPredicates[$jscomp$destructuring$var276])?$jscomp$nullish$tmp28:
{}));for($jscomp$nullish$tmp28=$jscomp$iter$381.next();!$jscomp$nullish$tmp28.done;$jscomp$nullish$tmp28=$jscomp$iter$381.next())$jscomp$nullish$tmp28.value.empty="none"!==$jscomp$destructuring$var278;return{name:$jscomp$destructuring$var276,value:$jscomp$destructuring$var277,select:$jscomp$destructuring$var279,bind:bind}})}):spec};var TopLevelSelectionsNormalizer=function(){return SpecMapper.apply(this,arguments)||this};$jscomp.inherits(TopLevelSelectionsNormalizer,SpecMapper);TopLevelSelectionsNormalizer.prototype.map=
function(spec,normParams){var $jscomp$nullish$tmp31,selections=null!=($jscomp$nullish$tmp31=normParams.selections)?$jscomp$nullish$tmp31:[];if(spec.params&&!isUnitSpec(spec)){$jscomp$nullish$tmp31=[];for(var $jscomp$iter$382=$jscomp.makeIterator(spec.params),$jscomp$key$param=$jscomp$iter$382.next();!$jscomp$key$param.done;$jscomp$key$param=$jscomp$iter$382.next())$jscomp$key$param=$jscomp$key$param.value,$jscomp$key$param.select?selections.push($jscomp$key$param):$jscomp$nullish$tmp31.push($jscomp$key$param);
spec.params=$jscomp$nullish$tmp31}normParams.selections=selections;return SpecMapper.prototype.map.call(this,spec,addSpecNameToParams(spec,normParams))};TopLevelSelectionsNormalizer.prototype.mapUnit=function(spec,normParams){var selections=normParams.selections;if(!selections||!selections.length)return spec;var $jscomp$nullish$tmp32,path=(null!=($jscomp$nullish$tmp32=normParams.path)?$jscomp$nullish$tmp32:[]).concat(spec.name);normParams=[];selections=$jscomp.makeIterator(selections);for($jscomp$nullish$tmp32=
selections.next();!$jscomp$nullish$tmp32.done;$jscomp$nullish$tmp32=selections.next())if($jscomp$nullish$tmp32=$jscomp$nullish$tmp32.value,$jscomp$nullish$tmp32.views&&$jscomp$nullish$tmp32.views.length)for(var $jscomp$iter$383=$jscomp.makeIterator($jscomp$nullish$tmp32.views),$jscomp$key$view=$jscomp$iter$383.next();!$jscomp$key$view.done;$jscomp$key$view=$jscomp$iter$383.next())$jscomp$key$view=$jscomp$key$view.value,(vega.isString($jscomp$key$view)&&($jscomp$key$view===spec.name||0<=path.indexOf($jscomp$key$view))||
vega.isArray($jscomp$key$view)&&$jscomp$key$view.map(function(v){return path.indexOf(v)}).every(function(v,i,arr){return-1!==v&&(0===i||v>arr[i-1])}))&&normParams.push($jscomp$nullish$tmp32);else normParams.push($jscomp$nullish$tmp32);normParams.length&&(spec.params=normParams);return spec};for(var $jscomp$loop$1657={},$jscomp$iter$385=$jscomp.makeIterator(["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]),$jscomp$key$method=$jscomp$iter$385.next();!$jscomp$key$method.done;$jscomp$loop$1657=
{$jscomp$loop$prop$proto$1658:$jscomp$loop$1657.$jscomp$loop$prop$proto$1658},$jscomp$key$method=$jscomp$iter$385.next()){var method$jscomp$0=$jscomp$key$method.value;$jscomp$loop$1657.$jscomp$loop$prop$proto$1658=TopLevelSelectionsNormalizer.prototype[method$jscomp$0];TopLevelSelectionsNormalizer.prototype[method$jscomp$0]=function($jscomp$loop$1657){return function(spec,params){return $jscomp$loop$1657.$jscomp$loop$prop$proto$1658.call(this,spec,addSpecNameToParams(spec,params))}}($jscomp$loop$1657)}var coreNormalizer=
new CoreNormalizer,selectionCompatNormalizer=new SelectionCompatibilityNormalizer,topLevelSelectionNormalizer=new TopLevelSelectionsNormalizer,Split=function(explicit,implicit){explicit=void 0===explicit?{}:explicit;implicit=void 0===implicit?{}:implicit;this.explicit=explicit;this.implicit=implicit};Split.prototype.clone=function(){return new Split(duplicate(this.explicit),duplicate(this.implicit))};Split.prototype.combine=function(){return Object.assign({},this.explicit,this.implicit)};Split.prototype.get=
function(key){return getFirstDefined(this.explicit[key],this.implicit[key])};Split.prototype.getWithExplicit=function(key){return void 0!==this.explicit[key]?{explicit:!0,value:this.explicit[key]}:void 0!==this.implicit[key]?{explicit:!1,value:this.implicit[key]}:{explicit:!1,value:void 0}};Split.prototype.setWithExplicit=function(key,$jscomp$destructuring$var294){var value=$jscomp$destructuring$var294.value;$jscomp$destructuring$var294=$jscomp$destructuring$var294.explicit;void 0!==value&&this.set(key,
value,$jscomp$destructuring$var294)};Split.prototype.set=function(key,value,explicit){delete this[explicit?"implicit":"explicit"][key];this[explicit?"explicit":"implicit"][key]=value;return this};Split.prototype.copyKeyFromSplit=function(key,$jscomp$destructuring$var296){var explicit=$jscomp$destructuring$var296.explicit;$jscomp$destructuring$var296=$jscomp$destructuring$var296.implicit;void 0!==explicit[key]?this.set(key,explicit[key],!0):void 0!==$jscomp$destructuring$var296[key]&&this.set(key,
$jscomp$destructuring$var296[key],!1)};Split.prototype.copyKeyFromObject=function(key,s){void 0!==s[key]&&this.set(key,s[key],!0)};Split.prototype.copyAll=function(other){for(var $jscomp$iter$386=$jscomp.makeIterator(keys$jscomp$0(other.combine())),$jscomp$key$key=$jscomp$iter$386.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$386.next()){$jscomp$key$key=$jscomp$key$key.value;var val=other.getWithExplicit($jscomp$key$key);this.setWithExplicit($jscomp$key$key,val)}};var AncestorParse=function(explicit,
implicit,parseNothing){explicit=void 0===explicit?{}:explicit;implicit=void 0===implicit?{}:implicit;parseNothing=void 0===parseNothing?!1:parseNothing;var $jscomp$super$this=Split.call(this,explicit,implicit)||this;$jscomp$super$this.explicit=explicit;$jscomp$super$this.implicit=implicit;$jscomp$super$this.parseNothing=parseNothing;return $jscomp$super$this};$jscomp.inherits(AncestorParse,Split);AncestorParse.prototype.clone=function(){var clone=Split.prototype.clone.call(this);clone.parseNothing=
this.parseNothing;return clone};var DataSourceType;(function(DataSourceType){DataSourceType[DataSourceType.Raw=0]="Raw";DataSourceType[DataSourceType.Main=1]="Main";DataSourceType[DataSourceType.Row=2]="Row";DataSourceType[DataSourceType.Column=3]="Column";DataSourceType[DataSourceType.Lookup=4]="Lookup"})(DataSourceType||(DataSourceType={}));var ILLEGAL$1=/[[\]{}]/,DEFAULT_MARKS={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},DEFAULT_SOURCE,MARKS,
DataFlowNode=function(parent,debugName){this.debugName=debugName;_defineProperty(this,"_children",[]);_defineProperty(this,"_parent",null);_defineProperty(this,"_hash",void 0);parent&&(this.parent=parent)};DataFlowNode.prototype.clone=function(){throw Error("Cannot clone node");};DataFlowNode.prototype.numChildren=function(){return this._children.length};DataFlowNode.prototype.addChild=function(child,loc){this._children.includes(child)?warn("Attempt to add the same child twice."):void 0!==loc?this._children.splice(loc,
0,child):this._children.push(child)};DataFlowNode.prototype.removeChild=function(oldChild){oldChild=this._children.indexOf(oldChild);this._children.splice(oldChild,1);return oldChild};DataFlowNode.prototype.remove=function(){for(var loc=this._parent.removeChild(this),$jscomp$iter$395=$jscomp.makeIterator(this._children),$jscomp$key$child=$jscomp$iter$395.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$395.next())$jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child._parent=this._parent,
this._parent.addChild($jscomp$key$child,loc++)};DataFlowNode.prototype.insertAsParentOf=function(other){var parent=other.parent;parent.removeChild(this);this.parent=parent;other.parent=this};DataFlowNode.prototype.swapWithParent=function(){for(var parent=this._parent,newParent=parent.parent,$jscomp$iter$396=$jscomp.makeIterator(this._children),$jscomp$key$child=$jscomp$iter$396.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$396.next())$jscomp$key$child.value.parent=parent;this._children=
[];parent.removeChild(this);parent.parent.removeChild(parent);this.parent=newParent;parent.parent=this};$jscomp.global.Object.defineProperties(DataFlowNode.prototype,{parent:{configurable:!0,enumerable:!0,get:function(){return this._parent},set:function(parent){(this._parent=parent)&&parent.addChild(this)}},children:{configurable:!0,enumerable:!0,get:function(){return this._children}}});var OutputNode=function(parent,source,type,refCounts){parent=DataFlowNode.call(this,parent,source)||this;parent.type=
type;parent.refCounts=refCounts;_defineProperty(parent,"_source",void 0);_defineProperty(parent,"_name",void 0);parent._source=parent._name=source;!parent.refCounts||parent._name in parent.refCounts||(parent.refCounts[parent._name]=0);return parent};$jscomp.inherits(OutputNode,DataFlowNode);OutputNode.prototype.clone=function(){var cloneObj=new this.constructor;cloneObj.debugName="clone_"+this.debugName;cloneObj._source=this._source;cloneObj._name="clone_"+this._name;cloneObj.type=this.type;cloneObj.refCounts=
this.refCounts;cloneObj.refCounts[cloneObj._name]=0;return cloneObj};OutputNode.prototype.dependentFields=function(){return new Set};OutputNode.prototype.producedFields=function(){return new Set};OutputNode.prototype.hash=function(){void 0===this._hash&&(this._hash="Output "+uniqueId());return this._hash};OutputNode.prototype.getSource=function(){this.refCounts[this._name]++;return this._source};OutputNode.prototype.isRequired=function(){return!!this.refCounts[this._name]};OutputNode.prototype.setSource=
function(source){this._source=source};var TimeUnitNode=function(parent,formula){parent=DataFlowNode.call(this,parent)||this;parent.formula=formula;return parent};$jscomp.inherits(TimeUnitNode,DataFlowNode);TimeUnitNode.prototype.clone=function(){return new TimeUnitNode(null,duplicate(this.formula))};TimeUnitNode.makeFromEncoding=function(parent,model){model=model.reduceFieldDef(function(timeUnitComponent,fieldDef){var field=fieldDef.field,timeUnit=fieldDef.timeUnit;timeUnit&&(fieldDef=vgField(fieldDef,
{forAs:!0}),timeUnitComponent[hash({as:fieldDef,field:field,timeUnit:timeUnit})]={as:fieldDef,field:field,timeUnit:timeUnit});return timeUnitComponent},{});return isEmpty(model)?null:new TimeUnitNode(parent,model)};TimeUnitNode.makeFromTransform=function(parent,t){var $jscomp$destructuring$var301=Object.assign({},t);t=Object.assign({},$jscomp$destructuring$var301);$jscomp$destructuring$var301=$jscomp$destructuring$var301.timeUnit;t=(delete t.timeUnit,t);$jscomp$destructuring$var301=normalizeTimeUnit($jscomp$destructuring$var301);
t=Object.assign({},t,{timeUnit:$jscomp$destructuring$var301});$jscomp$destructuring$var301={};return new TimeUnitNode(parent,($jscomp$destructuring$var301[hash(t)]=t,$jscomp$destructuring$var301))};TimeUnitNode.prototype.merge=function(other){this.formula=Object.assign({},this.formula);for(var key in other.formula)this.formula[key]||(this.formula[key]=other.formula[key]);key=$jscomp.makeIterator(other.children);for(var $jscomp$key$child=key.next();!$jscomp$key$child.done;$jscomp$key$child=key.next())$jscomp$key$child=
$jscomp$key$child.value,other.removeChild($jscomp$key$child),$jscomp$key$child.parent=this;other.remove()};TimeUnitNode.prototype.removeFormulas=function(fields){for(var newFormula={},$jscomp$iter$398=$jscomp.makeIterator(entries$1(this.formula)),$jscomp$key$=$jscomp$iter$398.next();!$jscomp$key$.done;$jscomp$key$=$jscomp$iter$398.next()){var $jscomp$destructuring$var304=$jscomp.makeIterator($jscomp$key$.value);$jscomp$key$=$jscomp$destructuring$var304.next().value;$jscomp$destructuring$var304=$jscomp$destructuring$var304.next().value;
fields.has($jscomp$destructuring$var304.as)||(newFormula[$jscomp$key$]=$jscomp$destructuring$var304)}this.formula=newFormula};TimeUnitNode.prototype.producedFields=function(){return new Set(vals$jscomp$0(this.formula).map(function(f){return f.as}))};TimeUnitNode.prototype.dependentFields=function(){return new Set(vals$jscomp$0(this.formula).map(function(f){return f.field}))};TimeUnitNode.prototype.hash=function(){return"TimeUnit "+hash(this.formula)};TimeUnitNode.prototype.assemble=function(){for(var transforms=
[],$jscomp$iter$399=$jscomp.makeIterator(vals$jscomp$0(this.formula)),$jscomp$key$f=$jscomp$iter$399.next();!$jscomp$key$f.done;$jscomp$key$f=$jscomp$iter$399.next()){var $jscomp$destructuring$var305=$jscomp$key$f.value;$jscomp$key$f=$jscomp$destructuring$var305.field;var as=$jscomp$destructuring$var305.as,$jscomp$destructuring$var306=normalizeTimeUnit($jscomp$destructuring$var305.timeUnit),$jscomp$destructuring$var307=Object.assign({},$jscomp$destructuring$var306);$jscomp$destructuring$var305=$jscomp$destructuring$var306.unit;
$jscomp$destructuring$var306=$jscomp$destructuring$var306.utc;$jscomp$destructuring$var307=(delete $jscomp$destructuring$var307.unit,delete $jscomp$destructuring$var307.utc,$jscomp$destructuring$var307);transforms.push(Object.assign({},{field:replacePathInField($jscomp$key$f),type:"timeunit"},$jscomp$destructuring$var305?{units:getTimeUnitParts($jscomp$destructuring$var305)}:{},$jscomp$destructuring$var306?{timezone:"utc"}:{},$jscomp$destructuring$var307,{as:[as,as+"_end"]}))}return transforms};var SelectionProjectionComponent=
function(items){for(var $jscomp$restParams=[],$jscomp$restIndex=0;$jscomp$restIndex<arguments.length;++$jscomp$restIndex)$jscomp$restParams[$jscomp$restIndex-0]=arguments[$jscomp$restIndex];_defineProperty(this,"hasChannel",void 0);_defineProperty(this,"hasField",void 0);_defineProperty(this,"timeUnit",void 0);_defineProperty(this,"items",void 0);this.items=$jscomp$restParams;this.hasChannel={};this.hasField={}},scaleBindings={defined:function(selCmpt){return"interval"===selCmpt.type&&"global"===
selCmpt.resolve&&selCmpt.bind&&"scales"===selCmpt.bind},parse:function(model,selCmpt){for(var bound=selCmpt.scales=[],$jscomp$iter$404=$jscomp.makeIterator(selCmpt.project.items),$jscomp$key$proj=$jscomp$iter$404.next();!$jscomp$key$proj.done;$jscomp$key$proj=$jscomp$iter$404.next()){$jscomp$key$proj=$jscomp$key$proj.value;var channel=$jscomp$key$proj.channel;if(SCALE_CHANNEL_INDEX[channel]){var scaleType$802=(channel=model.getScaleComponent(channel))?channel.get("type"):void 0;channel&&scaleType$802 in
CONTINUOUS_DOMAIN_INDEX?(channel.set("selectionExtent",{param:selCmpt.name,field:$jscomp$key$proj.field},!0),bound.push($jscomp$key$proj)):warn("Scale bindings are currently only supported for scales with unbinned, continuous domains.")}}},topLevelSignals:function(model,selCmpt,signals){var bound=selCmpt.scales.filter(function(proj){return 0===signals.filter(function(s){return s.name===proj.signals.data}).length});if(!model.parent||isTopLevelLayer(model)||0===bound.length)return signals;model=signals.filter(function(s){return s.name===
selCmpt.name})[0];var update=model.update;if(0<=update.indexOf("vlSelectionResolve"))model.update="{"+bound.map(function(proj){return vegaUtil.stringValue(replacePathInField(proj.field))+": "+proj.signals.data}).join(", ")+"}";else{for(var $jscomp$iter$405=$jscomp.makeIterator(bound),$jscomp$key$proj=$jscomp$iter$405.next();!$jscomp$key$proj.done;$jscomp$key$proj=$jscomp$iter$405.next())$jscomp$key$proj=$jscomp$key$proj.value,$jscomp$key$proj=vegaUtil.stringValue(replacePathInField($jscomp$key$proj.field))+
": "+$jscomp$key$proj.signals.data,update.includes($jscomp$key$proj)||(update=update.substring(0,update.length-1)+", "+$jscomp$key$proj+"}");model.update=update}return signals.concat(bound.map(function(proj){return{name:proj.signals.data}}))},signals:function(model,selCmpt,signals){if(model.parent&&!isTopLevelLayer(model)){model={};selCmpt=$jscomp.makeIterator(selCmpt.scales);for(var $jscomp$key$proj=selCmpt.next();!$jscomp$key$proj.done;model={$jscomp$loop$prop$proj$1665:model.$jscomp$loop$prop$proj$1665},
$jscomp$key$proj=selCmpt.next())model.$jscomp$loop$prop$proj$1665=$jscomp$key$proj.value,$jscomp$key$proj=signals.filter(function($jscomp$loop$1664){return function(s){return s.name===$jscomp$loop$1664.$jscomp$loop$prop$proj$1665.signals.data}}(model))[0],$jscomp$key$proj.push="outer",delete $jscomp$key$proj.value,delete $jscomp$key$proj.update}return signals}},ALIGNED_X_CHANNEL={left:"x",center:"xc",right:"x2"},BASELINED_Y_CHANNEL={top:"y",middle:"yc",bottom:"y2"},ALWAYS_IGNORE=new Set(["aria","width",
"height"]),nearest={defined:function(selCmpt){return"point"===selCmpt.type&&selCmpt.nearest},parse:function(model,selCmpt){if(selCmpt.events){selCmpt=$jscomp.makeIterator(selCmpt.events);for(var $jscomp$key$s=selCmpt.next();!$jscomp$key$s.done;$jscomp$key$s=selCmpt.next())$jscomp$key$s.value.markname=model.getName("voronoi")}},marks:function(model,selCmpt,marks){var $jscomp$destructuring$var366=selCmpt.project.hasChannel;selCmpt=$jscomp$destructuring$var366.x;$jscomp$destructuring$var366=$jscomp$destructuring$var366.y;
var markType=model.mark;if(isPathMark(markType))return warn('The "nearest" transform is not supported for '+markType+" marks."),marks;selCmpt={name:model.getName("voronoi"),type:"path",interactive:!0,from:{data:model.getName("marks")},encode:{update:Object.assign({},{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},tooltip(model,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:selCmpt||!$jscomp$destructuring$var366?"datum.datum.x || 0":"0"},
y:{expr:$jscomp$destructuring$var366||!selCmpt?"datum.datum.y || 0":"0"},size:[model.getSizeSignalRef("width"),model.getSizeSignalRef("height")]}]};var index=0,exists=!1;marks.forEach(function(mark,i){var $jscomp$nullish$tmp55;mark=null!=($jscomp$nullish$tmp55=mark.name)?$jscomp$nullish$tmp55:"";mark===model.component.mark[0].name?index=i:0<=mark.indexOf("voronoi")&&(exists=!0)});exists||marks.splice(index+1,0,selCmpt);return marks}},inputBindings={defined:function(selCmpt){return"point"===selCmpt.type&&
"global"===selCmpt.resolve&&selCmpt.bind&&"scales"!==selCmpt.bind&&!isLegendBinding(selCmpt.bind)},parse:function(model,selCmpt,selDef){return disableDirectManipulation(selCmpt,selDef)},topLevelSignals:function(model,selCmpt,signals){var name=selCmpt.name;model=selCmpt.project;var bind=selCmpt.bind,init=selCmpt.init&&selCmpt.init[0],datum=nearest.defined(selCmpt)?"(item().isVoronoi ? datum.datum : datum)":"datum";model.items.forEach(function(p,i){var sgname=varName(name+"_"+p.field);if(!signals.filter(function(s){return s.name===
sgname}).length){var $jscomp$nullish$tmp56,$jscomp$nullish$tmp57;signals.unshift(Object.assign({},{name:sgname},init?{init:assembleInit(init[i])}:{value:null},{on:selCmpt.events?[{events:selCmpt.events,update:"datum \x26\x26 item().mark.marktype !\x3d\x3d 'group' ? "+datum+"["+vegaUtil.stringValue(p.field)+"] : null"}]:[],bind:null!=($jscomp$nullish$tmp57=null!=($jscomp$nullish$tmp56=bind[p.field])?$jscomp$nullish$tmp56:bind[p.channel])?$jscomp$nullish$tmp57:bind}))}});return signals},signals:function(model,
selCmpt,signals){var name=selCmpt.name,proj=selCmpt.project;model=signals.filter(function(s){return s.name===name+"_tuple"})[0];selCmpt=name+"_tuple_fields";proj=proj.items.map(function(p){return varName(name+"_"+p.field)});var valid=proj.map(function(v){return v+" !\x3d\x3d null"}).join(" \x26\x26 ");proj.length&&(model.update=valid+" ? {fields: "+selCmpt+", values: ["+proj.join(", ")+"]} : null");delete model.value;delete model.on;return signals}},toggle={defined:function(selCmpt){return"point"===
selCmpt.type&&!!selCmpt.toggle},signals:function(model,selCmpt,signals){return signals.concat({name:selCmpt.name+"_toggle",value:!1,on:[{events:selCmpt.events,update:selCmpt.toggle}]})},modifyExpr:function(model,selCmpt){var tpl=selCmpt.name+"_tuple",signal=selCmpt.name+"_toggle";return signal+" ? null : "+tpl+", "+("global"===selCmpt.resolve?signal+" ? null : true, ":signal+" ? null : {unit: "+unitName(model)+"}, ")+(signal+" ? "+tpl+" : null")}},legendBindings={defined:function(selCmpt){var spec=
"global"===selCmpt.resolve&&selCmpt.bind&&isLegendBinding(selCmpt.bind);selCmpt=1===selCmpt.project.items.length&&"_vgsid_"!==selCmpt.project.items[0].field;spec&&!selCmpt&&warn("Legend bindings are only supported for selections over an individual field or encoding channel.");return spec&&selCmpt},parse:function(model,selCmpt,selDef){model=duplicate(selDef);model.select=vegaUtil.isString(model.select)?{type:model.select,toggle:selCmpt.toggle}:Object.assign({},model.select,{toggle:selCmpt.toggle});
disableDirectManipulation(selCmpt,model);if(vega.isObject(selDef.select)&&(selDef.select.on||selDef.select.clear))for(selDef=$jscomp.makeIterator(selCmpt.events),model=selDef.next();!model.done;model=selDef.next()){model=model.value;var $jscomp$nullish$tmp58=void 0;model.filter=vegaUtil.array(null!=($jscomp$nullish$tmp58=model.filter)?$jscomp$nullish$tmp58:[]);model.filter.includes('event.item \x26\x26 indexof(event.item.mark.role, "legend") \x3c 0')||model.filter.push('event.item \x26\x26 indexof(event.item.mark.role, "legend") \x3c 0')}selDef=
isLegendStreamBinding(selCmpt.bind)?selCmpt.bind.legend:"click";selDef=vegaUtil.isString(selDef)?eventSelector(selDef,"view"):vegaUtil.array(selDef);selCmpt.bind={legend:{merge:selDef}}},topLevelSignals:function(model,selCmpt,signals){model=selCmpt.name;for(var stream=isLegendStreamBinding(selCmpt.bind)&&selCmpt.bind.legend,markName=function(name){return function(s){s=duplicate(s);s.markname=name;return s}},$jscomp$loop$1671={},$jscomp$iter$413=$jscomp.makeIterator(selCmpt.project.items),$jscomp$key$proj=
$jscomp$iter$413.next();!$jscomp$key$proj.done;$jscomp$loop$1671={$jscomp$loop$prop$sgName$1672:$jscomp$loop$1671.$jscomp$loop$prop$sgName$1672},$jscomp$key$proj=$jscomp$iter$413.next())$jscomp$key$proj=$jscomp$key$proj.value,$jscomp$key$proj.hasLegend&&($jscomp$key$proj=varName($jscomp$key$proj.field)+"_legend",$jscomp$loop$1671.$jscomp$loop$prop$sgName$1672=model+"_"+$jscomp$key$proj,0===signals.filter(function($jscomp$loop$1671){return function(s){return s.name===$jscomp$loop$1671.$jscomp$loop$prop$sgName$1672}}($jscomp$loop$1671)).length&&
($jscomp$key$proj=stream.merge.map(markName($jscomp$key$proj+"_symbols")).concat(stream.merge.map(markName($jscomp$key$proj+"_labels"))).concat(stream.merge.map(markName($jscomp$key$proj+"_entries"))),signals.unshift(Object.assign({},{name:$jscomp$loop$1671.$jscomp$loop$prop$sgName$1672},selCmpt.init?{}:{value:null},{on:[{events:$jscomp$key$proj,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:stream.merge,update:"!event.item || !datum ? null : "+$jscomp$loop$1671.$jscomp$loop$prop$sgName$1672,
force:!0}]}))));return signals},signals:function(model,selCmpt,signals){var name=selCmpt.name,proj=selCmpt.project;model=signals.find(function(s){return s.name===name+"_tuple"});var fields=name+"_tuple_fields";proj=proj.items.filter(function(p){return p.hasLegend}).map(function(p){return varName(name+"_"+varName(p.field)+"_legend")});fields=proj.map(function(v){return v+" !\x3d\x3d null"}).join(" \x26\x26 ")+" ? {fields: "+fields+", values: ["+proj.join(", ")+"]} : null";selCmpt.events&&0<proj.length?
model.on.push({events:proj.map(function(signal){return{signal:signal}}),update:fields}):0<proj.length&&(model.update=fields,delete model.value,delete model.on);model=signals.find(function(s){return s.name===name+"_toggle"});fields=isLegendStreamBinding(selCmpt.bind)&&selCmpt.bind.legend;model&&(selCmpt.events?model.on.push(Object.assign({},model.on[0],{events:fields})):model.on[0].events=fields);return signals}},selectionCompilers=[{defined:function(selCmpt){return"point"===selCmpt.type},signals:function(model,
selCmpt,signals){var name=selCmpt.name,fieldsSg=name+"_tuple_fields",values=selCmpt.project.items.map(function(p){var fieldDef=model.fieldDef(p.channel);return null!==fieldDef&&void 0!==fieldDef&&fieldDef.bin?"[(item().isVoronoi ? datum.datum : datum)["+vegaUtil.stringValue(model.vgField(p.channel,{}))+"], (item().isVoronoi ? datum.datum : datum)["+(vegaUtil.stringValue(model.vgField(p.channel,{binSuffix:"end"}))+"]]"):"(item().isVoronoi ? datum.datum : datum)["+vegaUtil.stringValue(p.field)+"]"}).join(", ");
fieldsSg="unit: "+unitName(model)+", fields: "+fieldsSg+", values";selCmpt=selCmpt.events;var $jscomp$nullish$tmp44,brushes=vals$jscomp$0(null!=($jscomp$nullish$tmp44=model.component.selection)?$jscomp$nullish$tmp44:{}).reduce(function(acc,cmpt){return"interval"===cmpt.type?acc.concat(cmpt.name+"_brush"):acc},[]).map(function(b){return"indexof(item().mark.name, '"+b+"') \x3c 0"}).join(" \x26\x26 ");return signals.concat([{name:name+"_tuple",on:selCmpt?[{events:selCmpt,update:"datum \x26\x26 item().mark.marktype !\x3d\x3d 'group'"+
(brushes?" \x26\x26 "+brushes:"")+" ? {"+fieldsSg+": ["+values+"]} : null",force:!0}]:[]}])}},{defined:function(selCmpt){return"interval"===selCmpt.type},signals:function(model,selCmpt,signals){var name=selCmpt.name,fieldsSg=name+"_tuple_fields",hasScales=scaleBindings.defined(selCmpt),init=selCmpt.init?selCmpt.init[0]:null,dataSignals=[],scaleTriggers=[];if(selCmpt.translate&&!hasScales){var filterExpr="!event.item || event.item.mark.name !\x3d\x3d "+vegaUtil.stringValue(name+"_brush");events$jscomp$0(selCmpt,
function(on,evt){var _evt$between$,$jscomp$nullish$tmp43;evt=vegaUtil.array(null!=($jscomp$nullish$tmp43=(_evt$between$=evt.between[0]).filter)?$jscomp$nullish$tmp43:_evt$between$.filter=[]);evt.includes(filterExpr)||evt.push(filterExpr);return on})}selCmpt.project.items.forEach(function(proj,i){var channel=proj.channel;if("x"!==channel&&"y"!==channel)warn("Interval selections only support x and y encoding channels.");else{i=channelSignals(model,selCmpt,proj,init?init[i]:null);var dname=proj.signals.data;
proj=proj.signals.visual;var scaleName=vegaUtil.stringValue(model.scaleName(channel)),toNum=model.getScaleComponent(channel).get("type")in CONTINUOUS_DOMAIN_INDEX?"+":"";signals.push.apply(signals,$jscomp.arrayFromIterable(i));dataSignals.push(dname);scaleTriggers.push({scaleName:model.scaleName(channel),expr:"(!isArray("+dname+") || ("+(toNum+"invert("+scaleName+", "+proj+")[0] \x3d\x3d\x3d "+toNum+dname+"[0] \x26\x26 ")+(toNum+"invert("+scaleName+", "+proj+")[1] \x3d\x3d\x3d "+toNum+dname+"[1]))")})}});
!hasScales&&scaleTriggers.length&&signals.push({name:name+"_scale_trigger",value:{},on:[{events:scaleTriggers.map(function(t){return{scale:t.scaleName}}),update:scaleTriggers.map(function(t){return t.expr}).join(" \x26\x26 ")+" ? "+(name+"_scale_trigger : {}")}]});fieldsSg="unit: "+unitName(model)+", fields: "+fieldsSg+", values";return signals.concat(Object.assign({},{name:name+"_tuple"},init?{init:"{"+fieldsSg+": "+assembleInit(init)+"}"}:{},dataSignals.length?{on:[{events:[{signal:dataSignals.join(" || ")}],
update:dataSignals.join(" \x26\x26 ")+" ? {"+fieldsSg+": ["+dataSignals+"]} : null"}]}:{}))},marks:function(model,selCmpt,marks){var name=selCmpt.name,$jscomp$destructuring$var311=selCmpt.project.hasChannel,x=$jscomp$destructuring$var311.x,y=$jscomp$destructuring$var311.y,xvname=x&&x.signals.visual,yvname=y&&y.signals.visual,store="data("+vegaUtil.stringValue(selCmpt.name+"_store")+")";if(scaleBindings.defined(selCmpt)||!x&&!y)return marks;$jscomp$destructuring$var311={x:void 0!==x?{signal:xvname+
"[0]"}:{value:0},y:void 0!==y?{signal:yvname+"[0]"}:{value:0},x2:void 0!==x?{signal:xvname+"[1]"}:{field:{group:"width"}},y2:void 0!==y?{signal:yvname+"[1]"}:{field:{group:"height"}}};if("global"===selCmpt.resolve)for(var $jscomp$iter$407=$jscomp.makeIterator(keys$jscomp$0($jscomp$destructuring$var311)),$jscomp$key$key=$jscomp$iter$407.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$407.next())$jscomp$key$key=$jscomp$key$key.value,$jscomp$destructuring$var311[$jscomp$key$key]=[Object.assign({},
{test:store+".length \x26\x26 "+store+"[0].unit \x3d\x3d\x3d "+unitName(model)},$jscomp$destructuring$var311[$jscomp$key$key]),{value:0}];$jscomp$iter$407=selCmpt.mark;store=Object.assign({},$jscomp$iter$407);model=$jscomp$iter$407.fill;selCmpt=$jscomp$iter$407.fillOpacity;$jscomp$iter$407=$jscomp$iter$407.cursor;var stroke=(delete store.fill,delete store.fillOpacity,delete store.cursor,store);store=keys$jscomp$0(stroke).reduce(function(def,k){def[k]=[{test:[void 0!==x&&xvname+"[0] !\x3d\x3d "+xvname+
"[1]",void 0!==y&&yvname+"[0] !\x3d\x3d "+yvname+"[1]"].filter(function(t){return t}).join(" \x26\x26 "),value:stroke[k]},{value:null}];return def},{});return[{name:name+"_brush_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:model},fillOpacity:{value:selCmpt}},update:$jscomp$destructuring$var311}}].concat($jscomp.arrayFromIterable(marks),[{name:name+"_brush",type:"rect",clip:!0,encode:{enter:Object.assign({},$jscomp$iter$407?{cursor:{value:$jscomp$iter$407}}:{},{fill:{value:"transparent"}}),update:Object.assign({},
$jscomp$destructuring$var311,store)}}])}},{defined:function(){return!0},parse:function(model,selCmpt,selDef){var name=selCmpt.name,$jscomp$nullish$tmp39,proj=null!=($jscomp$nullish$tmp39=selCmpt.project)?$jscomp$nullish$tmp39:selCmpt.project=new SelectionProjectionComponent,parsed={};$jscomp$nullish$tmp39={};var signals=new Set,signalName=function(p,range){var suffix="visual"===range?p.channel:p.field;p=varName(name+"_"+suffix);for(var counter=1;signals.has(p);counter++)p=varName(name+"_"+suffix+
"_"+counter);signals.add(p);suffix={};return suffix[range]=p,suffix},type=selCmpt.type,cfg=model.config.selection[type],init=void 0!==selDef.value?vegaUtil.array(selDef.value):null,$jscomp$destructuring$var308=vegaUtil.isObject(selDef.select)?selDef.select:{};selDef=$jscomp$destructuring$var308.fields;$jscomp$destructuring$var308=$jscomp$destructuring$var308.encodings;if(!selDef&&!$jscomp$destructuring$var308&&init)for(var $jscomp$iter$401=$jscomp.makeIterator(init),$jscomp$key$initVal=$jscomp$iter$401.next();!$jscomp$key$initVal.done;$jscomp$key$initVal=
$jscomp$iter$401.next())if($jscomp$key$initVal=$jscomp$key$initVal.value,vegaUtil.isObject($jscomp$key$initVal)){$jscomp$key$initVal=$jscomp.makeIterator(keys$jscomp$0($jscomp$key$initVal));for(var $jscomp$key$key=$jscomp$key$initVal.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$key$initVal.next())$jscomp$key$key=$jscomp$key$key.value,SINGLE_DEF_UNIT_CHANNEL_INDEX[$jscomp$key$key]?($jscomp$destructuring$var308||($jscomp$destructuring$var308=[])).push($jscomp$key$key):"interval"===type?(warn('Interval selections should be initialized using "x" and/or "y" keys.'),
$jscomp$destructuring$var308=cfg.encodings):(selDef||(selDef=[])).push($jscomp$key$key)}selDef||$jscomp$destructuring$var308||($jscomp$destructuring$var308=cfg.encodings,"fields"in cfg&&(selDef=cfg.fields));var $jscomp$nullish$tmp40;cfg=$jscomp.makeIterator(null!=($jscomp$nullish$tmp40=$jscomp$destructuring$var308)?$jscomp$nullish$tmp40:[]);for($jscomp$nullish$tmp40=cfg.next();!$jscomp$nullish$tmp40.done;$jscomp$nullish$tmp40=cfg.next())$jscomp$nullish$tmp40=$jscomp$nullish$tmp40.value,($jscomp$iter$401=
model.fieldDef($jscomp$nullish$tmp40))?($jscomp$destructuring$var308=$jscomp$iter$401.field,$jscomp$iter$401.aggregate?warn('Cannot project a selection on encoding channel "'+$jscomp$nullish$tmp40+'" as it uses an aggregate function ("'+$jscomp$iter$401.aggregate+'").'):$jscomp$destructuring$var308?($jscomp$iter$401.timeUnit&&($jscomp$destructuring$var308=model.vgField($jscomp$nullish$tmp40),$jscomp$key$initVal={timeUnit:$jscomp$iter$401.timeUnit,as:$jscomp$destructuring$var308,field:$jscomp$iter$401.field},
$jscomp$nullish$tmp39[hash($jscomp$key$initVal)]=$jscomp$key$initVal),parsed[$jscomp$destructuring$var308]||($jscomp$key$initVal="E","interval"===type?model.getScaleComponent($jscomp$nullish$tmp40).get("type")in CONTINUOUS_DOMAIN_INDEX&&($jscomp$key$initVal="R"):$jscomp$iter$401.bin&&($jscomp$key$initVal="R-RE"),$jscomp$iter$401={field:$jscomp$destructuring$var308,channel:$jscomp$nullish$tmp40,type:$jscomp$key$initVal},$jscomp$iter$401.signals=Object.assign({},signalName($jscomp$iter$401,"data"),
signalName($jscomp$iter$401,"visual")),proj.items.push(parsed[$jscomp$destructuring$var308]=$jscomp$iter$401),proj.hasField[$jscomp$destructuring$var308]=proj.hasChannel[$jscomp$nullish$tmp40]=parsed[$jscomp$destructuring$var308])):warn(cannotProjectOnChannelWithoutField($jscomp$nullish$tmp40))):warn(cannotProjectOnChannelWithoutField($jscomp$nullish$tmp40));var $jscomp$nullish$tmp41;model=$jscomp.makeIterator(null!=($jscomp$nullish$tmp41=selDef)?$jscomp$nullish$tmp41:[]);for($jscomp$nullish$tmp41=
model.next();!$jscomp$nullish$tmp41.done;$jscomp$nullish$tmp41=model.next())$jscomp$nullish$tmp41=$jscomp$nullish$tmp41.value,proj.hasField[$jscomp$nullish$tmp41]||(parsed={type:"E",field:$jscomp$nullish$tmp41},parsed.signals=Object.assign({},signalName(parsed,"data")),proj.items.push(parsed),proj.hasField[$jscomp$nullish$tmp41]=parsed);init&&(selCmpt.init=init.map(function(v){return proj.items.map(function(p){return vegaUtil.isObject(v)?void 0!==v[p.channel]?v[p.channel]:v[p.field]:v})}));isEmpty($jscomp$nullish$tmp39)||
(proj.timeUnit=new TimeUnitNode(null,$jscomp$nullish$tmp39))},signals:function(model,selCmpt,allSignals){var name=selCmpt.name+"_tuple_fields";return 0<allSignals.filter(function(s){return s.name===name}).length?allSignals:allSignals.concat({name:name,value:selCmpt.project.items.map(function(proj){proj=Object.assign({},proj);proj=(delete proj.signals,delete proj.hasLegend,proj);proj.field=replacePathInField(proj.field);return proj})})}},toggle,inputBindings,scaleBindings,legendBindings,{defined:function(selCmpt){return void 0!==
selCmpt.clear&&!1!==selCmpt.clear},parse:function(model,selCmpt){selCmpt.clear&&(selCmpt.clear=vegaUtil.isString(selCmpt.clear)?eventSelector(selCmpt.clear,"view"):selCmpt.clear)},topLevelSignals:function(model,selCmpt,signals){if(inputBindings.defined(selCmpt)){model={};for(var $jscomp$iter$410=$jscomp.makeIterator(selCmpt.project.items),$jscomp$key$proj=$jscomp$iter$410.next();!$jscomp$key$proj.done;model={$jscomp$loop$prop$proj$1667:model.$jscomp$loop$prop$proj$1667},$jscomp$key$proj=$jscomp$iter$410.next())model.$jscomp$loop$prop$proj$1667=
$jscomp$key$proj.value,$jscomp$key$proj=signals.findIndex(function($jscomp$loop$1666){return function(n){return n.name===varName(selCmpt.name+"_"+$jscomp$loop$1666.$jscomp$loop$prop$proj$1667.field)}}(model)),-1!==$jscomp$key$proj&&signals[$jscomp$key$proj].on.push({events:selCmpt.clear,update:"null"})}return signals},signals:function(model,selCmpt,signals){function addClear(idx,update){-1!==idx&&signals[idx].on&&signals[idx].on.push({events:selCmpt.clear,update:update})}if("interval"===selCmpt.type){model=
{};for(var $jscomp$iter$411=$jscomp.makeIterator(selCmpt.project.items),$jscomp$key$proj=$jscomp$iter$411.next();!$jscomp$key$proj.done;model={$jscomp$loop$prop$proj$1670:model.$jscomp$loop$prop$proj$1670},$jscomp$key$proj=$jscomp$iter$411.next())model.$jscomp$loop$prop$proj$1670=$jscomp$key$proj.value,$jscomp$key$proj=signals.findIndex(function($jscomp$loop$1668){return function(n){return n.name===$jscomp$loop$1668.$jscomp$loop$prop$proj$1670.signals.visual}}(model)),addClear($jscomp$key$proj,"[0, 0]"),
-1===$jscomp$key$proj&&($jscomp$key$proj=signals.findIndex(function($jscomp$loop$1668){return function(n){return n.name===$jscomp$loop$1668.$jscomp$loop$prop$proj$1670.signals.data}}(model)),addClear($jscomp$key$proj,"null"))}else model=signals.findIndex(function(n){return n.name===selCmpt.name+"_tuple"}),addClear(model,"null"),toggle.defined(selCmpt)&&(model=signals.findIndex(function(n){return n.name===selCmpt.name+"_toggle"}),addClear(model,"false"));return signals}},{defined:function(selCmpt){return"interval"===
selCmpt.type&&selCmpt.translate},signals:function(model,selCmpt,signals){var name=selCmpt.name,hasScales=scaleBindings.defined(selCmpt),anchor=name+"_translate_anchor",$jscomp$destructuring$var367=selCmpt.project.hasChannel,x=$jscomp$destructuring$var367.x;$jscomp$destructuring$var367=$jscomp$destructuring$var367.y;var events=eventSelector(selCmpt.translate,"scope");hasScales||(events=events.map(function(e){return e.between[0].markname=name+"_brush",e}));signals.push({name:anchor,value:{},on:[{events:events.map(function(e){return e.between[0]}),
update:"{x: x(unit), y: y(unit)"+(void 0!==x?", extent_x: "+(hasScales?domain$jscomp$0(model,"x"):"slice("+x.signals.visual+")"):"")+(void 0!==$jscomp$destructuring$var367?", extent_y: "+(hasScales?domain$jscomp$0(model,"y"):"slice("+$jscomp$destructuring$var367.signals.visual+")"):"")+"}"}]},{name:name+"_translate_delta",value:{},on:[{events:events,update:"{x: "+anchor+".x - x(unit), y: "+anchor+".y - y(unit)}"}]});void 0!==x&&onDelta$1(model,selCmpt,x,"width",signals);void 0!==$jscomp$destructuring$var367&&
onDelta$1(model,selCmpt,$jscomp$destructuring$var367,"height",signals);return signals}},{defined:function(selCmpt){return"interval"===selCmpt.type&&selCmpt.zoom},signals:function(model,selCmpt,signals){var name=selCmpt.name,hasScales=scaleBindings.defined(selCmpt),delta=name+"_zoom_delta",$jscomp$destructuring$var368=selCmpt.project.hasChannel,x=$jscomp$destructuring$var368.x;$jscomp$destructuring$var368=$jscomp$destructuring$var368.y;var sx=vegaUtil.stringValue(model.scaleName("x")),sy=vegaUtil.stringValue(model.scaleName("y")),
events=eventSelector(selCmpt.zoom,"scope");hasScales||(events=events.map(function(e){return e.markname=name+"_brush",e}));signals.push({name:name+"_zoom_anchor",on:[{events:events,update:hasScales?"{"+[sx?"x: invert("+sx+", x(unit))":"",sy?"y: invert("+sy+", y(unit))":""].filter(function(expr){return!!expr}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:delta,on:[{events:events,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]});void 0!==x&&onDelta(model,selCmpt,x,"width",
signals);void 0!==$jscomp$destructuring$var368&&onDelta(model,selCmpt,$jscomp$destructuring$var368,"height",signals);return signals}},nearest];ASTNode.prototype.visit=function(visitor){var n;if(visitor(this))return 1;var c=children$jscomp$0(this);var i=0;for(n=c.length;i<n;++i)if(c[i].visit(visitor))return 1};var source$jscomp$0,index$jscomp$0,length$jscomp$0,lookahead,RegexNonAsciiIdentifierStart=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,
RegexNonAsciiIdentifierPart=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,
keywords={"if":1,"in":1,"do":1,"var":1,"for":1,"new":1,"try":1,let:1,"this":1,"else":1,"case":1,"void":1,"with":1,"enum":1,"while":1,"break":1,"catch":1,"throw":1,"const":1,yield:1,"class":1,"super":1,"return":1,"typeof":1,"delete":1,"switch":1,"export":1,"import":1,"public":1,"static":1,"default":1,"finally":1,"extends":1,"package":1,"private":1,"function":1,"continue":1,"debugger":1,"interface":1,"protected":1,"instanceof":1,"implements":1},legalKeywords={"if":1},FilterNode=function(parent,model,
filter){parent=DataFlowNode.call(this,parent)||this;parent.model=model;parent.filter=filter;_defineProperty(parent,"expr",void 0);_defineProperty(parent,"_dependentFields",void 0);parent.expr=expression$jscomp$0(parent.model,parent.filter,parent);parent._dependentFields=getDependentFields(parent.expr);return parent};$jscomp.inherits(FilterNode,DataFlowNode);FilterNode.prototype.clone=function(){return new FilterNode(null,this.model,duplicate(this.filter))};FilterNode.prototype.dependentFields=function(){return this._dependentFields};
FilterNode.prototype.producedFields=function(){return new Set};FilterNode.prototype.assemble=function(){return{type:"filter",expr:this.expr}};FilterNode.prototype.hash=function(){return"Filter "+this.expr};var $jscomp$nullish$tmp73,$jscomp$nullish$tmp74,$jscomp$nullish$tmp75,$jscomp$nullish$tmp77,axisRules={scale:function($jscomp$destructuring$var387){return $jscomp$destructuring$var387.model.scaleName($jscomp$destructuring$var387.channel)},format:function($jscomp$destructuring$var389){var fieldOrDatumDef=
$jscomp$destructuring$var389.fieldOrDatumDef,$jscomp$destructuring$var391=$jscomp$destructuring$var389.axis;return guideFormat(fieldOrDatumDef,fieldOrDatumDef.type,$jscomp$destructuring$var391.format,$jscomp$destructuring$var391.formatType,$jscomp$destructuring$var389.config,!0)},formatType:function($jscomp$destructuring$var392){return guideFormatType($jscomp$destructuring$var392.axis.formatType,$jscomp$destructuring$var392.fieldOrDatumDef,$jscomp$destructuring$var392.scaleType)},grid:function($jscomp$destructuring$var395){var fieldOrDatumDef=
$jscomp$destructuring$var395.fieldOrDatumDef,scaleType=$jscomp$destructuring$var395.scaleType;return null!=($jscomp$nullish$tmp73=$jscomp$destructuring$var395.axis.grid)?$jscomp$nullish$tmp73:!(scaleType in DISCRETE_DOMAIN_INDEX)&&isFieldDef(fieldOrDatumDef)&&!isBinning(null===fieldOrDatumDef||void 0===fieldOrDatumDef?void 0:fieldOrDatumDef.bin)&&!isBinned(null===fieldOrDatumDef||void 0===fieldOrDatumDef?void 0:fieldOrDatumDef.bin)},gridScale:function($jscomp$destructuring$var397){var JSCompiler_inline_result=
$jscomp$destructuring$var397.model;$jscomp$destructuring$var397="x"===$jscomp$destructuring$var397.channel?"y":"x";JSCompiler_inline_result=JSCompiler_inline_result.getScaleComponent($jscomp$destructuring$var397)?JSCompiler_inline_result.scaleName($jscomp$destructuring$var397):void 0;return JSCompiler_inline_result},labelAlign:function($jscomp$destructuring$var399){var labelAngle=$jscomp$destructuring$var399.labelAngle,orient=$jscomp$destructuring$var399.orient,channel=$jscomp$destructuring$var399.channel;
return $jscomp$destructuring$var399.axis.labelAlign||defaultLabelAlign(labelAngle,orient,channel)},labelAngle:function($jscomp$destructuring$var401){return $jscomp$destructuring$var401.labelAngle},labelBaseline:function($jscomp$destructuring$var403){var labelAngle=$jscomp$destructuring$var403.labelAngle,orient=$jscomp$destructuring$var403.orient,channel=$jscomp$destructuring$var403.channel;return $jscomp$destructuring$var403.axis.labelBaseline||defaultLabelBaseline(labelAngle,orient,channel)},labelFlush:function($jscomp$destructuring$var405){var fieldOrDatumDef=
$jscomp$destructuring$var405.fieldOrDatumDef,channel=$jscomp$destructuring$var405.channel;$jscomp$destructuring$var405=null!=($jscomp$nullish$tmp74=$jscomp$destructuring$var405.axis.labelFlush)?$jscomp$nullish$tmp74:"x"===channel&&contains(["quantitative","temporal"],fieldOrDatumDef.type)?!0:void 0;return $jscomp$destructuring$var405},labelOverlap:function($jscomp$destructuring$var407){var fieldOrDatumDef=$jscomp$destructuring$var407.fieldOrDatumDef,scaleType=$jscomp$destructuring$var407.scaleType;
if(null!=($jscomp$nullish$tmp75=$jscomp$destructuring$var407.axis.labelOverlap))scaleType=$jscomp$nullish$tmp75;else{$jscomp$destructuring$var407=fieldOrDatumDef.type;var hasTimeUnit=isFieldDef(fieldOrDatumDef)&&!!fieldOrDatumDef.timeUnit;fieldOrDatumDef=isFieldDef(fieldOrDatumDef)?fieldOrDatumDef.sort:void 0;scaleType=hasTimeUnit&&!vegaUtil.isObject(fieldOrDatumDef)||"nominal"!==$jscomp$destructuring$var407&&"ordinal"!==$jscomp$destructuring$var407?"log"===scaleType||"symlog"===scaleType?"greedy":
!0:void 0}return scaleType},orient:function($jscomp$destructuring$var409){return $jscomp$destructuring$var409.orient},tickCount:function($jscomp$destructuring$var411){var channel=$jscomp$destructuring$var411.channel,model=$jscomp$destructuring$var411.model,axis=$jscomp$destructuring$var411.axis,fieldOrDatumDef=$jscomp$destructuring$var411.fieldOrDatumDef;$jscomp$destructuring$var411=$jscomp$destructuring$var411.scaleType;model=(channel="x"===channel?"width":"y"===channel?"height":void 0)?model.getSizeSignalRef(channel):
void 0;if(null!=(channel=axis.tickCount))axis=channel;else a:if(axis.values||$jscomp$destructuring$var411 in DISCRETE_DOMAIN_INDEX||"log"===$jscomp$destructuring$var411)axis=void 0;else{if(isFieldDef(fieldOrDatumDef)){var _normalizeTimeUnit;if(isBinning(fieldOrDatumDef.bin)){axis={signal:"ceil("+model.signal+"/10)"};break a}if(fieldOrDatumDef.timeUnit&&contains(["month","hours","day","quarter"],null===(_normalizeTimeUnit=normalizeTimeUnit(fieldOrDatumDef.timeUnit))||void 0===_normalizeTimeUnit?void 0:
_normalizeTimeUnit.unit)){axis=void 0;break a}}axis={signal:"ceil("+model.signal+"/40)"}}return axis},title:function($jscomp$destructuring$var413){var axis=$jscomp$destructuring$var413.axis,model=$jscomp$destructuring$var413.model;$jscomp$destructuring$var413=$jscomp$destructuring$var413.channel;if(void 0!==axis.title)return axis.title;axis=getFieldDefTitle(model,$jscomp$destructuring$var413);if(void 0!==axis)return axis;axis=model.typedFieldDef($jscomp$destructuring$var413);model=model.fieldDef("x"===
$jscomp$destructuring$var413?"x2":"y2");return mergeTitleFieldDefs(axis?[toFieldDefBase(axis)]:[],isFieldDef(model)?[toFieldDefBase(model)]:[])},values:function($jscomp$destructuring$var415){var JSCompiler_inline_result=$jscomp$destructuring$var415.fieldOrDatumDef;$jscomp$destructuring$var415=$jscomp$destructuring$var415.axis.values;JSCompiler_inline_result=vegaUtil.isArray($jscomp$destructuring$var415)?valueArray(JSCompiler_inline_result,$jscomp$destructuring$var415):isSignalRef($jscomp$destructuring$var415)?
$jscomp$destructuring$var415:void 0;return JSCompiler_inline_result},zindex:function($jscomp$destructuring$var417){var fieldOrDatumDef=$jscomp$destructuring$var417.fieldOrDatumDef,mark=$jscomp$destructuring$var417.mark;$jscomp$destructuring$var417=null!=($jscomp$nullish$tmp77=$jscomp$destructuring$var417.axis.zindex)?$jscomp$nullish$tmp77:"rect"===mark&&isDiscrete(fieldOrDatumDef)?1:0;return $jscomp$destructuring$var417}},CalculateNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||
this;parent.transform=transform;_defineProperty(parent,"_dependentFields",void 0);parent._dependentFields=getDependentFields(parent.transform.calculate);return parent};$jscomp.inherits(CalculateNode,DataFlowNode);CalculateNode.prototype.clone=function(){return new CalculateNode(null,duplicate(this.transform))};CalculateNode.parseAllForSortIndex=function(parent,model){model.forEachFieldDef(function(fieldDef,channel){if(isScaleFieldDef(fieldDef)&&isSortArray(fieldDef.sort)){var field=fieldDef.field,
timeUnit=fieldDef.timeUnit,sort=fieldDef.sort;sort=sort.map(function(sortValue,i){return fieldFilterExpression({field:field,timeUnit:timeUnit,equal:sortValue})+" ? "+i+" : "}).join("")+sort.length;parent=new CalculateNode(parent,{calculate:sort,as:sortArrayIndexField(fieldDef,channel,{forAs:!0})})}});return parent};CalculateNode.prototype.producedFields=function(){return new Set([this.transform.as])};CalculateNode.prototype.dependentFields=function(){return this._dependentFields};CalculateNode.prototype.assemble=
function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}};CalculateNode.prototype.hash=function(){return"Calculate "+hash(this.transform)};var HEADER_CHANNELS=["row","column"],HEADER_TYPES=["header","footer"],LAYOUT_TITLE_BAND={column:{start:0,end:1},row:{start:1,end:0}},LEGEND_COMPONENT_PROPERTY_INDEX=Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,
gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,
tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),LEGEND_COMPONENT_PROPERTIES=keys$jscomp$0(LEGEND_COMPONENT_PROPERTY_INDEX),LegendComponent=function(){return Split.apply(this,arguments)||
this};$jscomp.inherits(LegendComponent,Split);var legendEncodeRules={symbols:function(symbolsSpec,$jscomp$destructuring$var429){var fieldOrDatumDef=$jscomp$destructuring$var429.fieldOrDatumDef,model=$jscomp$destructuring$var429.model,channel=$jscomp$destructuring$var429.channel,legendCmpt=$jscomp$destructuring$var429.legendCmpt;if("symbol"===$jscomp$destructuring$var429.legendType){var markDef=model.markDef,encoding=model.encoding;$jscomp$destructuring$var429=model.config;var mark=model.mark,filled=
markDef.filled&&"trail"!==mark;mark=Object.assign({},applyMarkConfig({},model,FILL_STROKE_CONFIG),color$jscomp$0(model,{filled:filled}));var $jscomp$nullish$tmp81,symbolOpacity=null!=($jscomp$nullish$tmp81=legendCmpt.get("symbolOpacity"))?$jscomp$nullish$tmp81:$jscomp$destructuring$var429.legend.symbolOpacity,$jscomp$nullish$tmp82;$jscomp$nullish$tmp81=null!=($jscomp$nullish$tmp82=legendCmpt.get("symbolFillColor"))?$jscomp$nullish$tmp82:$jscomp$destructuring$var429.legend.symbolFillColor;var $jscomp$nullish$tmp83;
$jscomp$nullish$tmp82=null!=($jscomp$nullish$tmp83=legendCmpt.get("symbolStrokeColor"))?$jscomp$nullish$tmp83:$jscomp$destructuring$var429.legend.symbolStrokeColor;var $jscomp$nullish$tmp84;$jscomp$nullish$tmp83=void 0===symbolOpacity?null!=($jscomp$nullish$tmp84=getMaxValue(encoding.opacity))?$jscomp$nullish$tmp84:markDef.opacity:void 0;if(mark.fill)if("fill"===channel||filled&&"color"===channel)delete mark.fill;else if(mark.fill.field)if($jscomp$nullish$tmp81)delete mark.fill;else{var $jscomp$nullish$tmp85;
mark.fill=signalOrValueRef(null!=($jscomp$nullish$tmp85=$jscomp$destructuring$var429.legend.symbolBaseFillColor)?$jscomp$nullish$tmp85:"black");mark.fillOpacity=signalOrValueRef(null!=$jscomp$nullish$tmp83?$jscomp$nullish$tmp83:1)}else if(vegaUtil.isArray(mark.fill)){var $jscomp$nullish$tmp87,$jscomp$nullish$tmp88,$jscomp$nullish$tmp89;if($jscomp$nullish$tmp84=null!=($jscomp$nullish$tmp89=null!=($jscomp$nullish$tmp88=getFirstConditionValue(null!=($jscomp$nullish$tmp87=encoding.fill)?$jscomp$nullish$tmp87:
encoding.color))?$jscomp$nullish$tmp88:markDef.fill)?$jscomp$nullish$tmp89:filled&&markDef.color)mark.fill=signalOrValueRef($jscomp$nullish$tmp84)}mark.stroke&&("stroke"===channel||!filled&&"color"===channel?delete mark.stroke:mark.stroke.field||$jscomp$nullish$tmp82?delete mark.stroke:vegaUtil.isArray(mark.stroke)&&($jscomp$nullish$tmp87=getFirstDefined(getFirstConditionValue(encoding.stroke||encoding.color),markDef.stroke,filled?markDef.color:void 0))&&(mark.stroke={value:$jscomp$nullish$tmp87}));
"opacity"!==channel&&((fieldOrDatumDef=isFieldDef(fieldOrDatumDef)&&selectedCondition(model,legendCmpt,fieldOrDatumDef))?mark.opacity=[Object.assign({},{test:fieldOrDatumDef},signalOrValueRef(null!=$jscomp$nullish$tmp83?$jscomp$nullish$tmp83:1)),signalOrValueRef($jscomp$destructuring$var429.legend.unselectedOpacity)]:$jscomp$nullish$tmp83&&(mark.opacity=signalOrValueRef($jscomp$nullish$tmp83)));mark=Object.assign({},mark,symbolsSpec);return isEmpty(mark)?void 0:mark}},gradient:function(gradientSpec,
$jscomp$destructuring$var432){if("gradient"===$jscomp$destructuring$var432.legendType){var $jscomp$destructuring$var434=$jscomp$destructuring$var432.model,config=$jscomp$destructuring$var434.config,markDef=$jscomp$destructuring$var434.markDef,encoding=$jscomp$destructuring$var434.encoding;$jscomp$destructuring$var434={};var $jscomp$nullish$tmp91;if($jscomp$destructuring$var432=void 0===(null!=($jscomp$nullish$tmp91=$jscomp$destructuring$var432.legendCmpt.get("gradientOpacity"))?$jscomp$nullish$tmp91:
config.legend.gradientOpacity)?getMaxValue(encoding.opacity)||markDef.opacity:void 0)$jscomp$destructuring$var434.opacity=signalOrValueRef($jscomp$destructuring$var432);$jscomp$destructuring$var434=Object.assign({},$jscomp$destructuring$var434,gradientSpec);return isEmpty($jscomp$destructuring$var434)?void 0:$jscomp$destructuring$var434}},labels:function(specifiedlabelsSpec,$jscomp$destructuring$var435){var fieldOrDatumDef=$jscomp$destructuring$var435.fieldOrDatumDef,model=$jscomp$destructuring$var435.model,
legendCmpt=$jscomp$destructuring$var435.legendCmpt,legend=model.legend($jscomp$destructuring$var435.channel)||{};$jscomp$destructuring$var435=model.config;model=(model=isFieldDef(fieldOrDatumDef)?selectedCondition(model,legendCmpt,fieldOrDatumDef):void 0)?[{test:model,value:1},{value:$jscomp$destructuring$var435.legend.unselectedOpacity}]:void 0;legendCmpt=legend.format;legend=legend.formatType;fieldOrDatumDef=isCustomFormatType(legend)?formatCustomType({fieldOrDatumDef:fieldOrDatumDef,field:"datum.value",
format:legendCmpt,formatType:legend,config:$jscomp$destructuring$var435}):void 0;specifiedlabelsSpec=Object.assign({},model?{opacity:model}:{},fieldOrDatumDef?{text:fieldOrDatumDef}:{},specifiedlabelsSpec);return isEmpty(specifiedlabelsSpec)?void 0:specifiedlabelsSpec},entries:function(entriesSpec,$jscomp$destructuring$var438){$jscomp$destructuring$var438=$jscomp$destructuring$var438.legendCmpt.get("selections");return null!==$jscomp$destructuring$var438&&void 0!==$jscomp$destructuring$var438&&$jscomp$destructuring$var438.length?
Object.assign({},entriesSpec,{fill:{value:"transparent"}}):entriesSpec}},$jscomp$nullish$tmp94,$jscomp$nullish$tmp95,$jscomp$nullish$tmp96,legendRules={direction:function($jscomp$destructuring$var440){return $jscomp$destructuring$var440.direction},format:function($jscomp$destructuring$var442){var fieldOrDatumDef=$jscomp$destructuring$var442.fieldOrDatumDef,$jscomp$destructuring$var444=$jscomp$destructuring$var442.legend;return guideFormat(fieldOrDatumDef,fieldOrDatumDef.type,$jscomp$destructuring$var444.format,
$jscomp$destructuring$var444.formatType,$jscomp$destructuring$var442.config,!1)},formatType:function($jscomp$destructuring$var445){return guideFormatType($jscomp$destructuring$var445.legend.formatType,$jscomp$destructuring$var445.fieldOrDatumDef,$jscomp$destructuring$var445.scaleType)},gradientLength:function(params){var legendConfig=params.legendConfig,$jscomp$nullish$tmp92;if(null!=(legendConfig=null!=($jscomp$nullish$tmp92=params.legend.gradientLength)?$jscomp$nullish$tmp92:legendConfig.gradientLength))params=
legendConfig;else{$jscomp$nullish$tmp92=params.model;legendConfig=params.direction;var orient=params.orient,$jscomp$inline_5918=params.legendConfig,gradientHorizontalMaxLength=$jscomp$inline_5918.gradientHorizontalMaxLength,gradientHorizontalMinLength=$jscomp$inline_5918.gradientHorizontalMinLength,gradientVerticalMaxLength=$jscomp$inline_5918.gradientVerticalMaxLength;$jscomp$inline_5918=$jscomp$inline_5918.gradientVerticalMinLength;params=params.scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX?"horizontal"===
legendConfig?"top"===orient||"bottom"===orient?{signal:"clamp("+$jscomp$nullish$tmp92.getSizeSignalRef("width").signal+", "+gradientHorizontalMinLength+", "+gradientHorizontalMaxLength+")"}:gradientHorizontalMinLength:{signal:"clamp("+$jscomp$nullish$tmp92.getSizeSignalRef("height").signal+", "+$jscomp$inline_5918+", "+gradientVerticalMaxLength+")"}:void 0}return params},labelOverlap:function($jscomp$destructuring$var449){var legendConfig=$jscomp$destructuring$var449.legendConfig,scaleType=$jscomp$destructuring$var449.scaleType;
$jscomp$destructuring$var449=null!=($jscomp$nullish$tmp95=null!=($jscomp$nullish$tmp94=$jscomp$destructuring$var449.legend.labelOverlap)?$jscomp$nullish$tmp94:legendConfig.labelOverlap)?$jscomp$nullish$tmp95:contains(["quantile","threshold","log","symlog"],scaleType)?"greedy":void 0;return $jscomp$destructuring$var449},symbolType:function($jscomp$destructuring$var451){var markDef=$jscomp$destructuring$var451.markDef,channel=$jscomp$destructuring$var451.channel,encoding=$jscomp$destructuring$var451.encoding;
if(null!=($jscomp$nullish$tmp96=$jscomp$destructuring$var451.legend.symbolType))var JSCompiler_temp=$jscomp$nullish$tmp96;else a:{$jscomp$destructuring$var451=markDef.type;markDef=markDef.shape;if("shape"!==channel&&(channel=null!=(JSCompiler_temp=getFirstConditionValue(encoding.shape))?JSCompiler_temp:markDef)){JSCompiler_temp=channel;break a}switch($jscomp$destructuring$var451){case "bar":case "rect":case "image":case "square":JSCompiler_temp="square";break a;case "line":case "trail":case "rule":JSCompiler_temp=
"stroke";break a;case "arc":case "point":case "circle":case "tick":case "geoshape":case "area":case "text":JSCompiler_temp="circle";break a}JSCompiler_temp=void 0}return JSCompiler_temp},title:function($jscomp$destructuring$var453){return title$jscomp$0($jscomp$destructuring$var453.fieldOrDatumDef,$jscomp$destructuring$var453.config,{allowDisabling:!0})},type:function($jscomp$destructuring$var455){var legendType=$jscomp$destructuring$var455.legendType,scaleType=$jscomp$destructuring$var455.scaleType;
if(isColorChannel($jscomp$destructuring$var455.channel)&&scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX){if("gradient"===legendType)return}else if("symbol"===legendType)return;return legendType},values:function($jscomp$destructuring$var457){var JSCompiler_inline_result=$jscomp$destructuring$var457.fieldOrDatumDef;$jscomp$destructuring$var457=$jscomp$destructuring$var457.legend.values;JSCompiler_inline_result=vegaUtil.isArray($jscomp$destructuring$var457)?valueArray(JSCompiler_inline_result,$jscomp$destructuring$var457):
isSignalRef($jscomp$destructuring$var457)?$jscomp$destructuring$var457:void 0;return JSCompiler_inline_result}},PROJECTION_PROPERTIES="type clipAngle clipExtent center rotate precision reflectX reflectY coefficient distance fraction lobes parallel radius ratio spacing tilt".split(" "),ProjectionComponent=function(name,specifiedProjection,size,data){name=Split.call(this,Object.assign({},specifiedProjection),{name:name})||this;name.specifiedProjection=specifiedProjection;name.size=size;name.data=data;
_defineProperty(name,"merged",!1);return name};$jscomp.inherits(ProjectionComponent,Split);$jscomp.global.Object.defineProperties(ProjectionComponent.prototype,{isFit:{configurable:!0,enumerable:!0,get:function(){return!!this.data}}});var BinNode=function(parent,bins){parent=DataFlowNode.call(this,parent)||this;parent.bins=bins;return parent};$jscomp.inherits(BinNode,DataFlowNode);BinNode.prototype.clone=function(){return new BinNode(null,duplicate(this.bins))};BinNode.makeFromEncoding=function(parent,
model){var bins=model.reduceFieldDef(function(binComponentIndex,fieldDef,channel){if(isTypedFieldDef(fieldDef)&&isBinning(fieldDef.bin)){var $jscomp$destructuring$var475=createBinComponent(fieldDef,fieldDef.bin,model),key=$jscomp$destructuring$var475.key;binComponentIndex[key]=Object.assign({},$jscomp$destructuring$var475.binComponent,binComponentIndex[key],rangeFormula(model,fieldDef,channel,model.config))}return binComponentIndex},{});return isEmpty(bins)?null:new BinNode(parent,bins)};BinNode.makeFromTransform=
function(parent,t,model){t=createBinComponent(t,t.bin,model);model={};return new BinNode(parent,(model[t.key]=t.binComponent,model))};BinNode.prototype.merge=function(other,renameSignal){for(var $jscomp$iter$445=$jscomp.makeIterator(keys$jscomp$0(other.bins)),$jscomp$key$key=$jscomp$iter$445.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$445.next())$jscomp$key$key=$jscomp$key$key.value,$jscomp$key$key in this.bins?(renameSignal(other.bins[$jscomp$key$key].signal,this.bins[$jscomp$key$key].signal),
this.bins[$jscomp$key$key].as=unique([].concat($jscomp.arrayFromIterable(this.bins[$jscomp$key$key].as),$jscomp.arrayFromIterable(other.bins[$jscomp$key$key].as)),hash)):this.bins[$jscomp$key$key]=other.bins[$jscomp$key$key];renameSignal=$jscomp.makeIterator(other.children);for($jscomp$iter$445=renameSignal.next();!$jscomp$iter$445.done;$jscomp$iter$445=renameSignal.next())$jscomp$iter$445=$jscomp$iter$445.value,other.removeChild($jscomp$iter$445),$jscomp$iter$445.parent=this;other.remove()};BinNode.prototype.producedFields=
function(){return new Set(vals$jscomp$0(this.bins).map(function(c){return c.as}).flat(2))};BinNode.prototype.dependentFields=function(){return new Set(vals$jscomp$0(this.bins).map(function(c){return c.field}))};BinNode.prototype.hash=function(){return"Bin "+hash(this.bins)};BinNode.prototype.assemble=function(){return vals$jscomp$0(this.bins).flatMap(function(bin){var transform=[],$jscomp$destructuring$var477=$jscomp.makeIterator(bin.as),binAs=$jscomp$destructuring$var477.next().value;$jscomp$destructuring$var477=
$jscomp.arrayFromIterator($jscomp$destructuring$var477);var $jscomp$destructuring$var478=bin.bin,$jscomp$destructuring$var479=Object.assign({},$jscomp$destructuring$var478);$jscomp$destructuring$var478=$jscomp$destructuring$var478.extent;$jscomp$destructuring$var479=(delete $jscomp$destructuring$var479.extent,$jscomp$destructuring$var479);$jscomp$destructuring$var479=Object.assign({},{type:"bin",field:replacePathInField(bin.field),as:binAs,signal:bin.signal},isParameterExtent($jscomp$destructuring$var478)?
{extent:null}:{extent:$jscomp$destructuring$var478},bin.span?{span:{signal:"span("+bin.span+")"}}:{},$jscomp$destructuring$var479);!$jscomp$destructuring$var478&&bin.extentSignal&&(transform.push({type:"extent",field:replacePathInField(bin.field),signal:bin.extentSignal}),$jscomp$destructuring$var479.extent={signal:bin.extentSignal});transform.push($jscomp$destructuring$var479);$jscomp$destructuring$var477=$jscomp.makeIterator($jscomp$destructuring$var477);for($jscomp$destructuring$var478=$jscomp$destructuring$var477.next();!$jscomp$destructuring$var478.done;$jscomp$destructuring$var478=
$jscomp$destructuring$var477.next())for($jscomp$destructuring$var478=$jscomp$destructuring$var478.value,$jscomp$destructuring$var479=0;2>$jscomp$destructuring$var479;$jscomp$destructuring$var479++)transform.push({type:"formula",expr:vgField({field:binAs[$jscomp$destructuring$var479]},{expr:"datum"}),as:$jscomp$destructuring$var478[$jscomp$destructuring$var479]});bin.formula&&transform.push({type:"formula",expr:bin.formula,as:bin.formulaAs});return transform})};var AggregateNode=function(parent,dimensions,
measures){parent=DataFlowNode.call(this,parent)||this;parent.dimensions=dimensions;parent.measures=measures;return parent};$jscomp.inherits(AggregateNode,DataFlowNode);AggregateNode.prototype.clone=function(){return new AggregateNode(null,new Set(this.dimensions),duplicate(this.measures))};AggregateNode.makeFromEncoding=function(parent,model){var isAggregate=!1;model.forEachFieldDef(function(fd){fd.aggregate&&(isAggregate=!0)});var meas={},dims=new Set;if(!isAggregate)return null;model.forEachFieldDef(function(fieldDef,
channel){var aggregate=fieldDef.aggregate,field=fieldDef.field;if(aggregate)if("count"===aggregate)null!=meas["*"]||(meas["*"]={}),meas["*"].count=new Set([vgField(fieldDef,{forAs:!0})]);else{if(isArgminDef(aggregate)||isArgmaxDef(aggregate)){fieldDef=isArgminDef(aggregate)?"argmin":"argmax";var argField=aggregate[fieldDef];null!=meas[argField]||(meas[argField]={});meas[argField][fieldDef]=new Set([vgField({op:fieldDef,field:argField},{forAs:!0})])}else null!=meas[field]||(meas[field]={}),meas[field][aggregate]=
new Set([vgField(fieldDef,{forAs:!0})]);SCALE_CHANNEL_INDEX[channel]&&"unaggregated"===model.scaleDomain(channel)&&(null!=meas[field]||(meas[field]={}),meas[field].min=new Set([vgField({field:field,aggregate:"min"},{forAs:!0})]),meas[field].max=new Set([vgField({field:field,aggregate:"max"},{forAs:!0})]))}else{field=isUnitModel(model)?model.encoding[getSecondaryRangeChannel(channel)]:void 0;isTypedFieldDef(fieldDef)&&isUnitModel(model)&&hasBandEnd(fieldDef,field,model.markDef,model.config)?(dims.add(vgField(fieldDef,
{})),dims.add(vgField(fieldDef,{suffix:"end"})),fieldDef.bin&&binRequiresRange(fieldDef,channel)&&dims.add(vgField(fieldDef,{binSuffix:"range"}))):channel in GEO_POSIITON_CHANNEL_INDEX?(channel=getPositionChannelFromLatLong(channel),dims.add(model.getName(channel))):dims.add(vgField(fieldDef));if(channel=isScaleFieldDef(fieldDef))channel=null===(argField=fieldDef.scale)||void 0===argField?void 0:argField.range,channel=vega.isObject(channel)&&"field"in channel;channel&&dims.add(fieldDef.scale.range.field)}});
return 0===dims.size+keys$jscomp$0(meas).length?null:new AggregateNode(parent,dims,meas)};AggregateNode.makeFromTransform=function(parent,t){for(var dims=new Set,meas={},$jscomp$iter$450=$jscomp.makeIterator(t.aggregate),$jscomp$key$s=$jscomp$iter$450.next();!$jscomp$key$s.done;$jscomp$key$s=$jscomp$iter$450.next()){var $jscomp$destructuring$var481=$jscomp$key$s=$jscomp$key$s.value,op=$jscomp$destructuring$var481.op,field=$jscomp$destructuring$var481.field;$jscomp$destructuring$var481=$jscomp$destructuring$var481.as;
op&&("count"===op?(null!=meas["*"]||(meas["*"]={}),meas["*"].count=new Set([$jscomp$destructuring$var481?$jscomp$destructuring$var481:vgField($jscomp$key$s,{forAs:!0})])):(null!=meas[field]||(meas[field]={}),meas[field][op]=new Set([$jscomp$destructuring$var481?$jscomp$destructuring$var481:vgField($jscomp$key$s,{forAs:!0})])))}var $jscomp$nullish$tmp117;t=$jscomp.makeIterator(null!=($jscomp$nullish$tmp117=t.groupby)?$jscomp$nullish$tmp117:[]);for($jscomp$key$s=t.next();!$jscomp$key$s.done;$jscomp$key$s=
t.next())dims.add($jscomp$key$s.value);return 0===dims.size+keys$jscomp$0(meas).length?null:new AggregateNode(parent,dims,meas)};AggregateNode.prototype.merge=function(other){if(setEqual(this.dimensions,other.dimensions)){var parentMeasures=this.measures;other=other.measures;for(var $jscomp$inline_4893=$jscomp.makeIterator(keys$jscomp$0(other)),$jscomp$key$field=$jscomp$inline_4893.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$inline_4893.next()){$jscomp$key$field=$jscomp$key$field.value;
for(var ops=other[$jscomp$key$field],$jscomp$inline_4897=$jscomp.makeIterator(keys$jscomp$0(ops)),$jscomp$inline_4898=$jscomp$inline_4897.next();!$jscomp$inline_4898.done;$jscomp$inline_4898=$jscomp$inline_4897.next())if($jscomp$inline_4898=$jscomp$inline_4898.value,$jscomp$key$field in parentMeasures){var $jscomp$inline_4900=void 0;parentMeasures[$jscomp$key$field][$jscomp$inline_4898]=new Set([].concat($jscomp.arrayFromIterable(null!=($jscomp$inline_4900=parentMeasures[$jscomp$key$field][$jscomp$inline_4898])?
$jscomp$inline_4900:[]),$jscomp.arrayFromIterable(ops[$jscomp$inline_4898])))}else $jscomp$inline_4900={},parentMeasures[$jscomp$key$field]=($jscomp$inline_4900[$jscomp$inline_4898]=ops[$jscomp$inline_4898],$jscomp$inline_4900)}return!0}debug("different dimensions, cannot merge");return!1};AggregateNode.prototype.addDimensions=function(fields){fields.forEach(this.dimensions.add,this.dimensions)};AggregateNode.prototype.dependentFields=function(){return new Set([].concat($jscomp.arrayFromIterable(this.dimensions),
$jscomp.arrayFromIterable(keys$jscomp$0(this.measures))))};AggregateNode.prototype.producedFields=function(){for(var out=new Set,$jscomp$iter$453=$jscomp.makeIterator(keys$jscomp$0(this.measures)),$jscomp$key$field=$jscomp$iter$453.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$453.next()){$jscomp$key$field=$jscomp$key$field.value;for(var $jscomp$iter$452=$jscomp.makeIterator(keys$jscomp$0(this.measures[$jscomp$key$field])),$jscomp$key$op=$jscomp$iter$452.next();!$jscomp$key$op.done;$jscomp$key$op=
$jscomp$iter$452.next()){$jscomp$key$op=$jscomp$key$op.value;var m=this.measures[$jscomp$key$field][$jscomp$key$op];0===m.size?out.add($jscomp$key$op+"_"+$jscomp$key$field):m.forEach(out.add,out)}}return out};AggregateNode.prototype.hash=function(){return"Aggregate "+hash({dimensions:this.dimensions,measures:this.measures})};AggregateNode.prototype.assemble=function(){for(var ops=[],fields=[],as=[],$jscomp$iter$456=$jscomp.makeIterator(keys$jscomp$0(this.measures)),$jscomp$key$field=$jscomp$iter$456.next();!$jscomp$key$field.done;$jscomp$key$field=
$jscomp$iter$456.next()){$jscomp$key$field=$jscomp$key$field.value;for(var $jscomp$iter$455=$jscomp.makeIterator(keys$jscomp$0(this.measures[$jscomp$key$field])),$jscomp$key$op=$jscomp$iter$455.next();!$jscomp$key$op.done;$jscomp$key$op=$jscomp$iter$455.next()){$jscomp$key$op=$jscomp$key$op.value;for(var $jscomp$iter$454=$jscomp.makeIterator(this.measures[$jscomp$key$field][$jscomp$key$op]),$jscomp$key$alias=$jscomp$iter$454.next();!$jscomp$key$alias.done;$jscomp$key$alias=$jscomp$iter$454.next())as.push($jscomp$key$alias.value),
ops.push($jscomp$key$op),fields.push("*"===$jscomp$key$field?null:replacePathInField($jscomp$key$field))}}return{type:"aggregate",groupby:[].concat($jscomp.arrayFromIterable(this.dimensions)).map(replacePathInField),ops:ops,fields:fields,as:as}};$jscomp.global.Object.defineProperties(AggregateNode.prototype,{groupBy:{configurable:!0,enumerable:!0,get:function(){return this.dimensions}}});var FacetNode=function(parent,model,name,data){parent=DataFlowNode.call(this,parent)||this;parent.model=model;
parent.name=name;parent.data=data;_defineProperty(parent,"column",void 0);_defineProperty(parent,"row",void 0);_defineProperty(parent,"facet",void 0);_defineProperty(parent,"childModel",void 0);name=$jscomp.makeIterator(FACET_CHANNELS);for(data=name.next();!data.done;data=name.next()){data=data.value;var fieldDef=model.facet[data];if(fieldDef){var $jscomp$destructuring$var482=fieldDef,bin$830=$jscomp$destructuring$var482.bin;$jscomp$destructuring$var482=$jscomp$destructuring$var482.sort;parent[data]=
Object.assign({},{name:model.getName(data+"_domain"),fields:[vgField(fieldDef)].concat($jscomp.arrayFromIterable(isBinning(bin$830)?[vgField(fieldDef,{binSuffix:"end"})]:[]))},isSortField($jscomp$destructuring$var482)?{sortField:$jscomp$destructuring$var482}:vegaUtil.isArray($jscomp$destructuring$var482)?{sortIndexField:sortArrayIndexField(fieldDef,data)}:{})}}parent.childModel=model.child;return parent};$jscomp.inherits(FacetNode,DataFlowNode);FacetNode.prototype.hash=function(){for(var out="Facet",
$jscomp$iter$458=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$458.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$458.next())$jscomp$key$channel=$jscomp$key$channel.value,this[$jscomp$key$channel]&&(out+=" "+$jscomp$key$channel.charAt(0)+":"+hash(this[$jscomp$key$channel]));return out};FacetNode.prototype.dependentFields=function(){for(var depFields=new Set(this.fields),$jscomp$iter$459=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$459.next();!$jscomp$key$channel.done;$jscomp$key$channel=
$jscomp$iter$459.next())$jscomp$key$channel=$jscomp$key$channel.value,this[$jscomp$key$channel]&&(this[$jscomp$key$channel].sortField&&depFields.add(this[$jscomp$key$channel].sortField.field),this[$jscomp$key$channel].sortIndexField&&depFields.add(this[$jscomp$key$channel].sortIndexField));return depFields};FacetNode.prototype.producedFields=function(){return new Set};FacetNode.prototype.getSource=function(){return this.name};FacetNode.prototype.getChildIndependentFieldsWithStep=function(){for(var childIndependentFieldsWithStep=
{},$jscomp$iter$460=$jscomp.makeIterator(POSITION_SCALE_CHANNELS),$jscomp$key$channel=$jscomp$iter$460.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$460.next()){$jscomp$key$channel=$jscomp$key$channel.value;var childScaleComponent=this.childModel.component.scales[$jscomp$key$channel];if(childScaleComponent&&!childScaleComponent.merged){var type$831=childScaleComponent.get("type");childScaleComponent=childScaleComponent.get("range");type$831 in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(childScaleComponent)&&
(type$831=assembleDomain(this.childModel,$jscomp$key$channel),(type$831=getFieldFromDomain(type$831))?childIndependentFieldsWithStep[$jscomp$key$channel]=type$831:warn(unknownField($jscomp$key$channel)))}}return childIndependentFieldsWithStep};FacetNode.prototype.assembleRowColumnHeaderData=function(channel,crossedDataName,childIndependentFieldsWithStep){var childChannel={row:"y",column:"x",facet:void 0}[channel],fields=[],ops=[],as=[];childChannel&&childIndependentFieldsWithStep&&childIndependentFieldsWithStep[childChannel]&&
(crossedDataName?(fields.push("distinct_"+childIndependentFieldsWithStep[childChannel]),ops.push("max")):(fields.push(childIndependentFieldsWithStep[childChannel]),ops.push("distinct")),as.push("distinct_"+childIndependentFieldsWithStep[childChannel]));childChannel=this[channel];childIndependentFieldsWithStep=childChannel.sortField;childChannel=childChannel.sortIndexField;childIndependentFieldsWithStep?(childChannel=void 0===childIndependentFieldsWithStep.op?"min":childIndependentFieldsWithStep.op,
fields.push(childIndependentFieldsWithStep.field),ops.push(childChannel),as.push(vgField(childIndependentFieldsWithStep,{forAs:!0}))):childChannel&&(fields.push(childChannel),ops.push("max"),as.push(childChannel));return{name:this[channel].name,source:null!=crossedDataName?crossedDataName:this.data,transform:[Object.assign({},{type:"aggregate",groupby:this[channel].fields},fields.length?{fields:fields,ops:ops,as:as}:{})]}};FacetNode.prototype.assembleFacetHeaderData=function(childIndependentFieldsWithStep){for(var columns=
this.model.layout.columns,layoutHeaders=this.model.component.layoutHeaders,data=[],hasSharedAxis={},$jscomp$iter$463=$jscomp.makeIterator(HEADER_CHANNELS),$jscomp$key$headerChannel=$jscomp$iter$463.next();!$jscomp$key$headerChannel.done;$jscomp$key$headerChannel=$jscomp$iter$463.next()){$jscomp$key$headerChannel=$jscomp$key$headerChannel.value;for(var $jscomp$iter$462=$jscomp.makeIterator(HEADER_TYPES),$jscomp$key$headerType=$jscomp$iter$462.next();!$jscomp$key$headerType.done;$jscomp$key$headerType=
$jscomp$iter$462.next()){var headerType=$jscomp$key$headerType.value;$jscomp$key$headerType=void 0;headerType=null!=($jscomp$key$headerType=layoutHeaders[$jscomp$key$headerChannel]&&layoutHeaders[$jscomp$key$headerChannel][headerType])?$jscomp$key$headerType:[];$jscomp$key$headerType=$jscomp.makeIterator(headerType);for(headerType=$jscomp$key$headerType.next();!headerType.done;headerType=$jscomp$key$headerType.next()){var _header$axes;if(0<(null===(_header$axes=headerType.value.axes)||void 0===_header$axes?
void 0:_header$axes.length)){hasSharedAxis[$jscomp$key$headerChannel]=!0;break}}}hasSharedAxis[$jscomp$key$headerChannel]&&($jscomp$iter$462='length(data("'+this.facet.name+'"))',data.push({name:this.facet.name+"_"+$jscomp$key$headerChannel,transform:[{type:"sequence",start:0,stop:"row"===$jscomp$key$headerChannel?columns?{signal:"ceil("+$jscomp$iter$462+" / "+columns+")"}:1:columns?{signal:"min("+$jscomp$iter$462+", "+columns+")"}:{signal:$jscomp$iter$462}}]}))}columns=hasSharedAxis.column;(hasSharedAxis.row||
columns)&&data.unshift(this.assembleRowColumnHeaderData("facet",null,childIndependentFieldsWithStep));return data};FacetNode.prototype.assemble=function(){var data=[],crossedDataName=null,childIndependentFieldsWithStep=this.getChildIndependentFieldsWithStep(),row=this.row,facet=this.facet;if(this.column&&row&&(childIndependentFieldsWithStep.x||childIndependentFieldsWithStep.y)){crossedDataName="cross_"+this.column.name+"_"+this.row.name;var $jscomp$nullish$tmp120,$jscomp$nullish$tmp121;row=[].concat(null!=
($jscomp$nullish$tmp120=childIndependentFieldsWithStep.x)?$jscomp$nullish$tmp120:[],null!=($jscomp$nullish$tmp121=childIndependentFieldsWithStep.y)?$jscomp$nullish$tmp121:[]);$jscomp$nullish$tmp120=row.map(function(){return"distinct"});data.push({name:crossedDataName,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:row,ops:$jscomp$nullish$tmp120}]})}$jscomp$nullish$tmp120=$jscomp.makeIterator(["column","row"]);for($jscomp$nullish$tmp121=$jscomp$nullish$tmp120.next();!$jscomp$nullish$tmp121.done;$jscomp$nullish$tmp121=
$jscomp$nullish$tmp120.next())$jscomp$nullish$tmp121=$jscomp$nullish$tmp121.value,this[$jscomp$nullish$tmp121]&&data.push(this.assembleRowColumnHeaderData($jscomp$nullish$tmp121,crossedDataName,childIndependentFieldsWithStep));facet&&(crossedDataName=this.assembleFacetHeaderData(childIndependentFieldsWithStep))&&data.push.apply(data,$jscomp.arrayFromIterable(crossedDataName));return data};$jscomp.global.Object.defineProperties(FacetNode.prototype,{fields:{configurable:!0,enumerable:!0,get:function(){for(var f=
[],$jscomp$iter$465=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$465.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$465.next()){$jscomp$key$channel=$jscomp$key$channel.value;var _this$channel;null!==(_this$channel=this[$jscomp$key$channel])&&void 0!==_this$channel&&_this$channel.fields&&f.push.apply(f,$jscomp.arrayFromIterable(this[$jscomp$key$channel].fields))}return f}}});var ParseNode=function(parent,parse){parent=DataFlowNode.call(this,parent)||this;
_defineProperty(parent,"_parse",void 0);parent._parse=parse;return parent};$jscomp.inherits(ParseNode,DataFlowNode);ParseNode.prototype.clone=function(){return new ParseNode(null,duplicate(this._parse))};ParseNode.prototype.hash=function(){return"Parse "+hash(this._parse)};ParseNode.makeExplicit=function(parent,model,ancestorParse){var _data$format,explicit={};model=model.data;!isGenerator(model)&&null!==model&&void 0!==model&&null!==(_data$format=model.format)&&void 0!==_data$format&&_data$format.parse&&
(explicit=model.format.parse);return this.makeWithAncestors(parent,explicit,{},ancestorParse)};ParseNode.makeWithAncestors=function(parent,explicit,implicit,ancestorParse){for(var $jscomp$iter$468=$jscomp.makeIterator(keys$jscomp$0(implicit)),$jscomp$key$field=$jscomp$iter$468.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$468.next()){$jscomp$key$field=$jscomp$key$field.value;var parsedAs=ancestorParse.getWithExplicit($jscomp$key$field);void 0!==parsedAs.value&&(parsedAs.explicit||
parsedAs.value===implicit[$jscomp$key$field]||"derived"===parsedAs.value||"flatten"===implicit[$jscomp$key$field]?delete implicit[$jscomp$key$field]:warn(differentParse($jscomp$key$field,implicit[$jscomp$key$field],parsedAs.value)))}$jscomp$iter$468=$jscomp.makeIterator(keys$jscomp$0(explicit));for($jscomp$key$field=$jscomp$iter$468.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$468.next())$jscomp$key$field=$jscomp$key$field.value,parsedAs=ancestorParse.get($jscomp$key$field),void 0!==
parsedAs&&(parsedAs===explicit[$jscomp$key$field]?delete explicit[$jscomp$key$field]:warn(differentParse($jscomp$key$field,explicit[$jscomp$key$field],parsedAs)));explicit=new Split(explicit,implicit);ancestorParse.copyAll(explicit);implicit={};$jscomp$iter$468=$jscomp.makeIterator(keys$jscomp$0(explicit.combine()));for($jscomp$key$field=$jscomp$iter$468.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$468.next())$jscomp$key$field=$jscomp$key$field.value,parsedAs=explicit.get($jscomp$key$field),
null!==parsedAs&&(implicit[$jscomp$key$field]=parsedAs);return 0===keys$jscomp$0(implicit).length||ancestorParse.parseNothing?null:new ParseNode(parent,implicit)};ParseNode.prototype.merge=function(other){this._parse=Object.assign({},this._parse,other.parse);other.remove()};ParseNode.prototype.assembleFormatParse=function(){for(var formatParse={},$jscomp$iter$471=$jscomp.makeIterator(keys$jscomp$0(this._parse)),$jscomp$key$field=$jscomp$iter$471.next();!$jscomp$key$field.done;$jscomp$key$field=$jscomp$iter$471.next()){$jscomp$key$field=
$jscomp$key$field.value;var p=this._parse[$jscomp$key$field];1===accessPathDepth($jscomp$key$field)&&(formatParse[$jscomp$key$field]=p)}return formatParse};ParseNode.prototype.producedFields=function(){return new Set(keys$jscomp$0(this._parse))};ParseNode.prototype.dependentFields=function(){return new Set(keys$jscomp$0(this._parse))};ParseNode.prototype.assembleTransforms=function(onlyNested){var $jscomp$this=this;onlyNested=void 0===onlyNested?!1:onlyNested;return keys$jscomp$0(this._parse).filter(function(field){return onlyNested?
1<accessPathDepth(field):!0}).map(function(field){var expr=parseExpression(field,$jscomp$this._parse[field]);return expr?{type:"formula",expr:expr,as:removePathFromField(field)}:null}).filter(function(t){return null!==t})};$jscomp.global.Object.defineProperties(ParseNode.prototype,{parse:{configurable:!0,enumerable:!0,get:function(){return this._parse}}});var IdentifierNode=function(parent){return DataFlowNode.call(this,parent)||this};$jscomp.inherits(IdentifierNode,DataFlowNode);IdentifierNode.prototype.clone=
function(){return new IdentifierNode(null)};IdentifierNode.prototype.dependentFields=function(){return new Set};IdentifierNode.prototype.producedFields=function(){return new Set(["_vgsid_"])};IdentifierNode.prototype.hash=function(){return"Identifier"};IdentifierNode.prototype.assemble=function(){return{type:"identifier",as:"_vgsid_"}};var GraticuleNode=function(parent,params){parent=DataFlowNode.call(this,parent)||this;parent.params=params;return parent};$jscomp.inherits(GraticuleNode,DataFlowNode);
GraticuleNode.prototype.clone=function(){return new GraticuleNode(null,this.params)};GraticuleNode.prototype.dependentFields=function(){return new Set};GraticuleNode.prototype.producedFields=function(){};GraticuleNode.prototype.hash=function(){return"Graticule "+hash(this.params)};GraticuleNode.prototype.assemble=function(){return Object.assign({},{type:"graticule"},!0===this.params?{}:this.params)};var SequenceNode=function(parent,params){parent=DataFlowNode.call(this,parent)||this;parent.params=
params;return parent};$jscomp.inherits(SequenceNode,DataFlowNode);SequenceNode.prototype.clone=function(){return new SequenceNode(null,this.params)};SequenceNode.prototype.dependentFields=function(){return new Set};SequenceNode.prototype.producedFields=function(){var $jscomp$nullish$tmp123;return new Set([null!=($jscomp$nullish$tmp123=this.params.as)?$jscomp$nullish$tmp123:"data"])};SequenceNode.prototype.hash=function(){return"Hash "+hash(this.params)};SequenceNode.prototype.assemble=function(){return Object.assign({},
{type:"sequence"},this.params)};var SourceNode=function(data){var $jscomp$super$this=DataFlowNode.call(this,null)||this;_defineProperty($jscomp$super$this,"_data",void 0);_defineProperty($jscomp$super$this,"_name",void 0);_defineProperty($jscomp$super$this,"_generator",void 0);null!=data||(data={name:"source"});var format;isGenerator(data)||(format=data.format?Object.assign({},omit(data.format,["parse"])):{});if("values"in data)$jscomp$super$this._data={values:data.values};else if("url"in data){if($jscomp$super$this._data=
{url:data.url},!format.type){var defaultExtension=/(?:\.([^.]+))?$/.exec(data.url)[1];contains(["json","csv","tsv","dsv","topojson"],defaultExtension)||(defaultExtension="json");format.type=defaultExtension}}else if("sphere"in data)$jscomp$super$this._data={values:[{type:"Sphere"}]};else if(isNamedData(data)||isGenerator(data))$jscomp$super$this._data={};$jscomp$super$this._generator=isGenerator(data);data.name&&($jscomp$super$this._name=data.name);format&&!isEmpty(format)&&($jscomp$super$this._data.format=
format);return $jscomp$super$this};$jscomp.inherits(SourceNode,DataFlowNode);SourceNode.prototype.dependentFields=function(){return new Set};SourceNode.prototype.producedFields=function(){};SourceNode.prototype.hasName=function(){return!!this._name};SourceNode.prototype.remove=function(){throw Error("Source nodes are roots and cannot be removed.");};SourceNode.prototype.hash=function(){throw Error("Cannot hash sources");};SourceNode.prototype.assemble=function(){return Object.assign({},{name:this._name},
this._data,{transform:[]})};$jscomp.global.Object.defineProperties(SourceNode.prototype,{data:{configurable:!0,enumerable:!0,get:function(){return this._data}},isGenerator:{configurable:!0,enumerable:!0,get:function(){return this._generator}},dataName:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(name){this._name=name}},parent:{configurable:!0,enumerable:!0,set:function(parent){throw Error("Source nodes have to be roots.");}}});var _modified=new WeakMap,Optimizer=function(){_modified.set(this,
{writable:!0,value:void 0});_classPrivateFieldSet(this,_modified,!1)};Optimizer.prototype.setModified=function(){_classPrivateFieldSet(this,_modified,!0)};$jscomp.global.Object.defineProperties(Optimizer.prototype,{modifiedFlag:{configurable:!0,enumerable:!0,get:function(){var descriptor=_classExtractFieldDescriptor(this,_modified,"get");return descriptor.get?descriptor.get.call(this):descriptor.value}}});var BottomUpOptimizer=function(){return Optimizer.apply(this,arguments)||this};$jscomp.inherits(BottomUpOptimizer,
Optimizer);BottomUpOptimizer.prototype.getNodeDepths=function(node,depth,depths){depths.set(node,depth);node=$jscomp.makeIterator(node.children);for(var $jscomp$key$child=node.next();!$jscomp$key$child.done;$jscomp$key$child=node.next())this.getNodeDepths($jscomp$key$child.value,depth+1,depths);return depths};BottomUpOptimizer.prototype.optimize=function(node){node=this.getNodeDepths(node,0,new Map);node=[].concat($jscomp.arrayFromIterable(node.entries())).sort(function(a,b){return b[1]-a[1]});node=
$jscomp.makeIterator(node);for(var $jscomp$key$tuple=node.next();!$jscomp$key$tuple.done;$jscomp$key$tuple=node.next())this.run($jscomp$key$tuple.value[0]);return this.modifiedFlag};var TopDownOptimizer=function(){return Optimizer.apply(this,arguments)||this};$jscomp.inherits(TopDownOptimizer,Optimizer);TopDownOptimizer.prototype.optimize=function(node){this.run(node);node=$jscomp.makeIterator(node.children);for(var $jscomp$key$child=node.next();!$jscomp$key$child.done;$jscomp$key$child=node.next())this.optimize($jscomp$key$child.value);
return this.modifiedFlag};var MergeIdenticalNodes=function(){return TopDownOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeIdenticalNodes,TopDownOptimizer);MergeIdenticalNodes.prototype.mergeNodes=function(parent,nodes){var mergedNode=nodes.shift();nodes=$jscomp.makeIterator(nodes);for(var $jscomp$key$node=nodes.next();!$jscomp$key$node.done;$jscomp$key$node=nodes.next())$jscomp$key$node=$jscomp$key$node.value,parent.removeChild($jscomp$key$node),$jscomp$key$node.parent=mergedNode,$jscomp$key$node.remove()};
MergeIdenticalNodes.prototype.run=function(node){for(var hashes=node.children.map(function(x){return x.hash()}),buckets={},i=0;i<hashes.length;i++)void 0===buckets[hashes[i]]?buckets[hashes[i]]=[node.children[i]]:buckets[hashes[i]].push(node.children[i]);hashes=$jscomp.makeIterator(keys$jscomp$0(buckets));for(i=hashes.next();!i.done;i=hashes.next())i=i.value,1<buckets[i].length&&(this.setModified(),this.mergeNodes(node,buckets[i]))};var RemoveUnnecessaryIdentifierNodes=function(model){var $jscomp$super$this=
TopDownOptimizer.call(this)||this;_defineProperty($jscomp$super$this,"requiresSelectionId",void 0);$jscomp$super$this.requiresSelectionId=model&&requiresSelectionId(model);return $jscomp$super$this};$jscomp.inherits(RemoveUnnecessaryIdentifierNodes,TopDownOptimizer);RemoveUnnecessaryIdentifierNodes.prototype.run=function(node){!(node instanceof IdentifierNode)||this.requiresSelectionId&&(isDataSourceNode(node.parent)||node.parent instanceof AggregateNode||node.parent instanceof ParseNode)||(this.setModified(),
node.remove())};var RemoveDuplicateTimeUnits=function(){return Optimizer.apply(this,arguments)||this};$jscomp.inherits(RemoveDuplicateTimeUnits,Optimizer);RemoveDuplicateTimeUnits.prototype.optimize=function(node){this.run(node,new Set);return this.modifiedFlag};RemoveDuplicateTimeUnits.prototype.run=function(node,timeUnitFields){var producedFields=new Set;node instanceof TimeUnitNode&&(producedFields=node.producedFields(),hasIntersection(producedFields,timeUnitFields)&&(this.setModified(),node.removeFormulas(timeUnitFields),
0===node.producedFields.length&&node.remove()));node=$jscomp.makeIterator(node.children);for(var $jscomp$key$child=node.next();!$jscomp$key$child.done;$jscomp$key$child=node.next())this.run($jscomp$key$child.value,new Set([].concat($jscomp.arrayFromIterable(timeUnitFields),$jscomp.arrayFromIterable(producedFields))))};var RemoveUnnecessaryOutputNodes=function(){return TopDownOptimizer.call(this)||this};$jscomp.inherits(RemoveUnnecessaryOutputNodes,TopDownOptimizer);RemoveUnnecessaryOutputNodes.prototype.run=
function(node){node instanceof OutputNode&&!node.isRequired()&&(this.setModified(),node.remove())};var MoveParseUp=function(){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MoveParseUp,BottomUpOptimizer);MoveParseUp.prototype.run=function(node){if(!(isDataSourceNode(node)||1<node.numChildren()))for(var $jscomp$iter$478=$jscomp.makeIterator(node.children),$jscomp$key$child=$jscomp$iter$478.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$478.next())$jscomp$key$child=
$jscomp$key$child.value,$jscomp$key$child instanceof ParseNode&&(node instanceof ParseNode?(this.setModified(),node.merge($jscomp$key$child)):fieldIntersection(node.producedFields(),$jscomp$key$child.dependentFields())||(this.setModified(),$jscomp$key$child.swapWithParent()))};var MergeParse=function(){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeParse,BottomUpOptimizer);MergeParse.prototype.run=function(node){var originalChildren=[].concat($jscomp.arrayFromIterable(node.children)),
parseChildren=node.children.filter(function(child){return child instanceof ParseNode});if(1<node.numChildren()&&1<=parseChildren.length){var commonParse={},conflictingParse=new Set;parseChildren=$jscomp.makeIterator(parseChildren);for(var $jscomp$key$parseNode=parseChildren.next();!$jscomp$key$parseNode.done;$jscomp$key$parseNode=parseChildren.next()){$jscomp$key$parseNode=$jscomp$key$parseNode.value.parse;for(var $jscomp$iter$479=$jscomp.makeIterator(keys$jscomp$0($jscomp$key$parseNode)),$jscomp$key$k=
$jscomp$iter$479.next();!$jscomp$key$k.done;$jscomp$key$k=$jscomp$iter$479.next())$jscomp$key$k=$jscomp$key$k.value,$jscomp$key$k in commonParse?commonParse[$jscomp$key$k]!==$jscomp$key$parseNode[$jscomp$key$k]&&conflictingParse.add($jscomp$key$k):commonParse[$jscomp$key$k]=$jscomp$key$parseNode[$jscomp$key$k]}conflictingParse=$jscomp.makeIterator(conflictingParse);for(parseChildren=conflictingParse.next();!parseChildren.done;parseChildren=conflictingParse.next())delete commonParse[parseChildren.value];
if(!isEmpty(commonParse))for(this.setModified(),conflictingParse=new ParseNode(node,commonParse),originalChildren=$jscomp.makeIterator(originalChildren),parseChildren=originalChildren.next();!parseChildren.done;parseChildren=originalChildren.next()){parseChildren=parseChildren.value;if(parseChildren instanceof ParseNode)for($jscomp$key$parseNode=$jscomp.makeIterator(keys$jscomp$0(commonParse)),$jscomp$iter$479=$jscomp$key$parseNode.next();!$jscomp$iter$479.done;$jscomp$iter$479=$jscomp$key$parseNode.next())delete parseChildren.parse[$jscomp$iter$479.value];
node.removeChild(parseChildren);parseChildren.parent=conflictingParse;parseChildren instanceof ParseNode&&0===keys$jscomp$0(parseChildren.parse).length&&parseChildren.remove()}}};var RemoveUnusedSubtrees=function(){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(RemoveUnusedSubtrees,BottomUpOptimizer);RemoveUnusedSubtrees.prototype.run=function(node){node instanceof OutputNode||0<node.numChildren()||node instanceof FacetNode||node instanceof SourceNode||(this.setModified(),
node.remove())};var MergeTimeUnits=function(){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeTimeUnits,BottomUpOptimizer);MergeTimeUnits.prototype.run=function(node){var timeUnitChildren=node.children.filter(function(x){return x instanceof TimeUnitNode});node=timeUnitChildren.pop();timeUnitChildren=$jscomp.makeIterator(timeUnitChildren);for(var $jscomp$key$timeUnit=timeUnitChildren.next();!$jscomp$key$timeUnit.done;$jscomp$key$timeUnit=timeUnitChildren.next())$jscomp$key$timeUnit=
$jscomp$key$timeUnit.value,this.setModified(),node.merge($jscomp$key$timeUnit)};var MergeAggregates=function(){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeAggregates,BottomUpOptimizer);MergeAggregates.prototype.run=function(node){var aggChildren=node.children.filter(function(child){return child instanceof AggregateNode}),groupedAggregates={};aggChildren=$jscomp.makeIterator(aggChildren);for(var $jscomp$key$agg=aggChildren.next();!$jscomp$key$agg.done;$jscomp$key$agg=
aggChildren.next()){var agg=$jscomp$key$agg.value;$jscomp$key$agg=hash(agg.groupBy);$jscomp$key$agg in groupedAggregates||(groupedAggregates[$jscomp$key$agg]=[]);groupedAggregates[$jscomp$key$agg].push(agg)}aggChildren=$jscomp.makeIterator(keys$jscomp$0(groupedAggregates));for(agg=aggChildren.next();!agg.done;agg=aggChildren.next())if($jscomp$key$agg=groupedAggregates[agg.value],1<$jscomp$key$agg.length){agg=$jscomp$key$agg.pop();var $jscomp$iter$486=$jscomp.makeIterator($jscomp$key$agg);for($jscomp$key$agg=
$jscomp$iter$486.next();!$jscomp$key$agg.done;$jscomp$key$agg=$jscomp$iter$486.next())$jscomp$key$agg=$jscomp$key$agg.value,agg.merge($jscomp$key$agg)&&(node.removeChild($jscomp$key$agg),$jscomp$key$agg.parent=agg,$jscomp$key$agg.remove(),this.setModified())}};var MergeBins=function(model){var $jscomp$super$this=BottomUpOptimizer.call(this)||this;$jscomp$super$this.model=model;return $jscomp$super$this};$jscomp.inherits(MergeBins,BottomUpOptimizer);MergeBins.prototype.run=function(node){for(var moveBinsUp=
!(isDataSourceNode(node)||node instanceof FilterNode||node instanceof ParseNode||node instanceof IdentifierNode),promotableBins=[],remainingBins=[],$jscomp$iter$488=$jscomp.makeIterator(node.children),$jscomp$key$child=$jscomp$iter$488.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$488.next())$jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child instanceof BinNode&&(moveBinsUp&&!fieldIntersection(node.producedFields(),$jscomp$key$child.dependentFields())?promotableBins.push($jscomp$key$child):
remainingBins.push($jscomp$key$child));if(0<promotableBins.length){moveBinsUp=promotableBins.pop();$jscomp$iter$488=$jscomp.makeIterator(promotableBins);for(promotableBins=$jscomp$iter$488.next();!promotableBins.done;promotableBins=$jscomp$iter$488.next())moveBinsUp.merge(promotableBins.value,this.model.renameSignal.bind(this.model));this.setModified();node instanceof BinNode?node.merge(moveBinsUp,this.model.renameSignal.bind(this.model)):moveBinsUp.swapWithParent()}if(1<remainingBins.length){node=
remainingBins.pop();remainingBins=$jscomp.makeIterator(remainingBins);for(promotableBins=remainingBins.next();!promotableBins.done;promotableBins=remainingBins.next())node.merge(promotableBins.value,this.model.renameSignal.bind(this.model));this.setModified()}};var MergeOutputs=function(){return BottomUpOptimizer.apply(this,arguments)||this};$jscomp.inherits(MergeOutputs,BottomUpOptimizer);MergeOutputs.prototype.run=function(node){var children=[].concat($jscomp.arrayFromIterable(node.children));if(some(children,
function(child){return child instanceof OutputNode})&&!(1>=node.numChildren())){var otherChildren=[];children=$jscomp.makeIterator(children);for(var $jscomp$key$child=children.next();!$jscomp$key$child.done;$jscomp$key$child=children.next())if($jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child instanceof OutputNode){for(var lastOutput=$jscomp$key$child;1===lastOutput.numChildren();){var theChild=$jscomp.makeIterator(lastOutput.children).next().value;if(theChild instanceof OutputNode)lastOutput=
theChild;else break}otherChildren.push.apply(otherChildren,$jscomp.arrayFromIterable(lastOutput.children));if(mainOutput)node.removeChild($jscomp$key$child),$jscomp$key$child.parent=mainOutput.parent,mainOutput.parent.removeChild(mainOutput),mainOutput.parent=lastOutput,this.setModified();else var mainOutput=lastOutput}else otherChildren.push($jscomp$key$child);if(otherChildren.length)for(this.setModified(),node=$jscomp.makeIterator(otherChildren),$jscomp$key$child=node.next();!$jscomp$key$child.done;$jscomp$key$child=
node.next())otherChildren=$jscomp$key$child.value,otherChildren.parent.removeChild(otherChildren),otherChildren.parent=mainOutput}};var JoinAggregateTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};$jscomp.inherits(JoinAggregateTransformNode,DataFlowNode);JoinAggregateTransformNode.prototype.clone=function(){return new JoinAggregateTransformNode(null,duplicate(this.transform))};JoinAggregateTransformNode.prototype.addDimensions=
function(fields){this.transform.groupby=unique(this.transform.groupby.concat(fields),function(d){return d})};JoinAggregateTransformNode.prototype.dependentFields=function(){var out=new Set;this.transform.groupby&&this.transform.groupby.forEach(out.add,out);this.transform.joinaggregate.map(function(w){return w.field}).filter(function(f){return void 0!==f}).forEach(out.add,out);return out};JoinAggregateTransformNode.prototype.producedFields=function(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))};
JoinAggregateTransformNode.prototype.getDefaultName=function(joinAggregateFieldDef){var $jscomp$nullish$tmp125;return null!=($jscomp$nullish$tmp125=joinAggregateFieldDef.as)?$jscomp$nullish$tmp125:vgField(joinAggregateFieldDef)};JoinAggregateTransformNode.prototype.hash=function(){return"JoinAggregateTransform "+hash(this.transform)};JoinAggregateTransformNode.prototype.assemble=function(){for(var fields=[],ops=[],as=[],$jscomp$iter$493=$jscomp.makeIterator(this.transform.joinaggregate),$jscomp$key$joinaggregate=
$jscomp$iter$493.next();!$jscomp$key$joinaggregate.done;$jscomp$key$joinaggregate=$jscomp$iter$493.next())$jscomp$key$joinaggregate=$jscomp$key$joinaggregate.value,ops.push($jscomp$key$joinaggregate.op),as.push(this.getDefaultName($jscomp$key$joinaggregate)),fields.push(void 0===$jscomp$key$joinaggregate.field?null:$jscomp$key$joinaggregate.field);$jscomp$iter$493=this.transform.groupby;return Object.assign({},{type:"joinaggregate",as:as,ops:ops,fields:fields},void 0!==$jscomp$iter$493?{groupby:$jscomp$iter$493}:
{})};var StackNode=function(parent,stack){parent=DataFlowNode.call(this,parent)||this;_defineProperty(parent,"_stack",void 0);parent._stack=stack;return parent};$jscomp.inherits(StackNode,DataFlowNode);StackNode.prototype.clone=function(){return new StackNode(null,duplicate(this._stack))};StackNode.makeFromTransform=function(parent,stackTransform){var stack=stackTransform.stack,groupby=stackTransform.groupby,as=stackTransform.as,offset=void 0===stackTransform.offset?"zero":stackTransform.offset,sortFields=
[],sortOrder=[];if(void 0!==stackTransform.sort)for(var $jscomp$iter$494=$jscomp.makeIterator(stackTransform.sort),$jscomp$key$sortField=$jscomp$iter$494.next();!$jscomp$key$sortField.done;$jscomp$key$sortField=$jscomp$iter$494.next())$jscomp$key$sortField=$jscomp$key$sortField.value,sortFields.push($jscomp$key$sortField.field),sortOrder.push(getFirstDefined($jscomp$key$sortField.order,"ascending"));sortFields={field:sortFields,order:sortOrder};stackTransform=isValidAsArray(as)?as:vegaUtil.isString(as)?
[as,as+"_end"]:[stackTransform.stack+"_start",stackTransform.stack+"_end"];return new StackNode(parent,{stackField:stack,groupby:groupby,offset:offset,sort:sortFields,facetby:[],as:stackTransform})};StackNode.makeFromEncoding=function(parent,model){var stackProperties=model.stack,encoding=model.encoding;if(!stackProperties)return null;var groupbyChannel=stackProperties.groupbyChannel,fieldChannel=stackProperties.fieldChannel,offset=stackProperties.offset;stackProperties=stackProperties.impute;var dimensionFieldDef;
groupbyChannel&&(dimensionFieldDef=getFieldDef(encoding[groupbyChannel]));encoding=getStackByFields(model);groupbyChannel=model.encoding.order;groupbyChannel=vegaUtil.isArray(groupbyChannel)||isFieldDef(groupbyChannel)?sortParams(groupbyChannel):encoding.reduce(function(s,field){s.field.push(field);s.order.push("y"===fieldChannel?"descending":"ascending");return s},{field:[],order:[]});return new StackNode(parent,{dimensionFieldDef:dimensionFieldDef,stackField:model.vgField(fieldChannel),facetby:[],
stackby:encoding,sort:groupbyChannel,offset:offset,impute:stackProperties,as:[model.vgField(fieldChannel,{suffix:"start",forAs:!0}),model.vgField(fieldChannel,{suffix:"end",forAs:!0})]})};StackNode.prototype.addDimensions=function(fields){this._stack.facetby.push.apply(this._stack.facetby,$jscomp.arrayFromIterable(fields))};StackNode.prototype.dependentFields=function(){var out=new Set;out.add(this._stack.stackField);this.getGroupbyFields().forEach(out.add,out);this._stack.facetby.forEach(out.add,
out);this._stack.sort.field.forEach(out.add,out);return out};StackNode.prototype.producedFields=function(){return new Set(this._stack.as)};StackNode.prototype.hash=function(){return"Stack "+hash(this._stack)};StackNode.prototype.getGroupbyFields=function(){var $jscomp$destructuring$var494=this._stack,dimensionFieldDef=$jscomp$destructuring$var494.dimensionFieldDef,impute=$jscomp$destructuring$var494.impute;$jscomp$destructuring$var494=$jscomp$destructuring$var494.groupby;return dimensionFieldDef?
dimensionFieldDef.bin?impute?[vgField(dimensionFieldDef,{binSuffix:"mid"})]:[vgField(dimensionFieldDef,{}),vgField(dimensionFieldDef,{binSuffix:"end"})]:[vgField(dimensionFieldDef)]:null!=$jscomp$destructuring$var494?$jscomp$destructuring$var494:[]};StackNode.prototype.assemble=function(){var transform=[],$jscomp$destructuring$var495=this._stack,facetby=$jscomp$destructuring$var495.facetby,dimensionFieldDef=$jscomp$destructuring$var495.dimensionFieldDef,field=$jscomp$destructuring$var495.stackField,
stackby=$jscomp$destructuring$var495.stackby,sort=$jscomp$destructuring$var495.sort,offset=$jscomp$destructuring$var495.offset,as=$jscomp$destructuring$var495.as;$jscomp$destructuring$var495.impute&&dimensionFieldDef&&($jscomp$destructuring$var495=void 0===dimensionFieldDef.bandPosition?.5:dimensionFieldDef.bandPosition,dimensionFieldDef.bin&&transform.push({type:"formula",expr:$jscomp$destructuring$var495+"*"+vgField(dimensionFieldDef,{expr:"datum"})+("+"+(1-$jscomp$destructuring$var495)+"*")+vgField(dimensionFieldDef,
{expr:"datum",binSuffix:"end"}),as:vgField(dimensionFieldDef,{binSuffix:"mid",forAs:!0})}),transform.push({type:"impute",field:field,groupby:[].concat($jscomp.arrayFromIterable(stackby),$jscomp.arrayFromIterable(facetby)),key:vgField(dimensionFieldDef,{binSuffix:"mid"}),method:"value",value:0}));transform.push({type:"stack",groupby:[].concat($jscomp.arrayFromIterable(this.getGroupbyFields()),$jscomp.arrayFromIterable(facetby)),field:field,sort:sort,as:as,offset:offset});return transform};$jscomp.global.Object.defineProperties(StackNode.prototype,
{stack:{configurable:!0,enumerable:!0,get:function(){return this._stack}}});var WindowTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};$jscomp.inherits(WindowTransformNode,DataFlowNode);WindowTransformNode.prototype.clone=function(){return new WindowTransformNode(null,duplicate(this.transform))};WindowTransformNode.prototype.addDimensions=function(fields){this.transform.groupby=unique(this.transform.groupby.concat(fields),
function(d){return d})};WindowTransformNode.prototype.dependentFields=function(){var out=new Set,$jscomp$nullish$tmp127;(null!=($jscomp$nullish$tmp127=this.transform.groupby)?$jscomp$nullish$tmp127:[]).forEach(out.add,out);var $jscomp$nullish$tmp128;(null!=($jscomp$nullish$tmp128=this.transform.sort)?$jscomp$nullish$tmp128:[]).forEach(function(m){return out.add(m.field)});this.transform.window.map(function(w){return w.field}).filter(function(f){return void 0!==f}).forEach(out.add,out);return out};
WindowTransformNode.prototype.producedFields=function(){return new Set(this.transform.window.map(this.getDefaultName))};WindowTransformNode.prototype.getDefaultName=function(windowFieldDef){var $jscomp$nullish$tmp129;return null!=($jscomp$nullish$tmp129=windowFieldDef.as)?$jscomp$nullish$tmp129:vgField(windowFieldDef)};WindowTransformNode.prototype.hash=function(){return"WindowTransform "+hash(this.transform)};WindowTransformNode.prototype.assemble=function(){for(var fields=[],ops=[],as=[],params=
[],$jscomp$iter$495=$jscomp.makeIterator(this.transform.window),$jscomp$key$window=$jscomp$iter$495.next();!$jscomp$key$window.done;$jscomp$key$window=$jscomp$iter$495.next())$jscomp$key$window=$jscomp$key$window.value,ops.push($jscomp$key$window.op),as.push(this.getDefaultName($jscomp$key$window)),params.push(void 0===$jscomp$key$window.param?null:$jscomp$key$window.param),fields.push(void 0===$jscomp$key$window.field?null:$jscomp$key$window.field);$jscomp$iter$495=this.transform.frame;$jscomp$key$window=
this.transform.groupby;if($jscomp$iter$495&&null===$jscomp$iter$495[0]&&null===$jscomp$iter$495[1]&&ops.every(function(o){return isAggregateOp(o)}))return Object.assign({},{type:"joinaggregate",as:as,ops:ops,fields:fields},void 0!==$jscomp$key$window?{groupby:$jscomp$key$window}:{});var sortFields=[],sortOrder=[];if(void 0!==this.transform.sort)for(var $jscomp$iter$496=$jscomp.makeIterator(this.transform.sort),$jscomp$key$sortField=$jscomp$iter$496.next();!$jscomp$key$sortField.done;$jscomp$key$sortField=
$jscomp$iter$496.next()){$jscomp$key$sortField=$jscomp$key$sortField.value;sortFields.push($jscomp$key$sortField.field);var $jscomp$nullish$tmp130=void 0;sortOrder.push(null!=($jscomp$nullish$tmp130=$jscomp$key$sortField.order)?$jscomp$nullish$tmp130:"ascending")}$jscomp$iter$496=this.transform.ignorePeers;return Object.assign({},{type:"window",params:params,as:as,ops:ops,fields:fields,sort:{field:sortFields,order:sortOrder}},void 0!==$jscomp$iter$496?{ignorePeers:$jscomp$iter$496}:{},void 0!==$jscomp$key$window?
{groupby:$jscomp$key$window}:{},void 0!==$jscomp$iter$495?{frame:$jscomp$iter$495}:{})};var SignalRefWrapper=function(exprGenerator){_defineProperty(this,"signal",void 0);Object.defineProperty(this,"signal",{enumerable:!0,get:exprGenerator})};SignalRefWrapper.fromName=function(rename,signalName){return new SignalRefWrapper(function(){return rename(signalName)})};var ScaleComponent=function(name,typeWithExplicit){name=Split.call(this,{},{name:name})||this;_defineProperty(name,"merged",!1);name.setWithExplicit("type",
typeWithExplicit);return name};$jscomp.inherits(ScaleComponent,Split);ScaleComponent.prototype.domainDefinitelyIncludesZero=function(){return!1!==this.get("zero")?!0:some(this.get("domains"),function(d){return vegaUtil.isArray(d)&&2===d.length&&0>=d[0]&&0<=d[1]})};var RANGE_PROPERTIES=["range","scheme"],scaleRules={bins:function($jscomp$destructuring$var520){var model=$jscomp$destructuring$var520.model;$jscomp$destructuring$var520=$jscomp$destructuring$var520.fieldOrDatumDef;return isFieldDef($jscomp$destructuring$var520)?
bins$jscomp$0(model,$jscomp$destructuring$var520):void 0},interpolate:function($jscomp$destructuring$var522){var type=$jscomp$destructuring$var522.fieldOrDatumDef.type;$jscomp$destructuring$var522=contains(["color","fill","stroke"],$jscomp$destructuring$var522.channel)&&"nominal"!==type?"hcl":void 0;return $jscomp$destructuring$var522},nice:function($jscomp$destructuring$var524){var scaleType=$jscomp$destructuring$var524.scaleType,channel=$jscomp$destructuring$var524.channel,specifiedDomain=$jscomp$destructuring$var524.domain,
_getFieldDef;$jscomp$destructuring$var524=null!==(_getFieldDef=getFieldDef($jscomp$destructuring$var524.fieldOrDatumDef))&&void 0!==_getFieldDef&&_getFieldDef.bin||vegaUtil.isArray(specifiedDomain)||contains([ScaleType.TIME,ScaleType.UTC],scaleType)?void 0:channel in POSITION_SCALE_CHANNEL_INDEX?!0:void 0;return $jscomp$destructuring$var524},padding:function($jscomp$destructuring$var526){var config=$jscomp$destructuring$var526.config;a:{var JSCompiler_inline_result=$jscomp$destructuring$var526.channel;
var scaleType=$jscomp$destructuring$var526.scaleType,scaleConfig=config.scale,fieldOrDatumDef=$jscomp$destructuring$var526.fieldOrDatumDef;$jscomp$destructuring$var526=$jscomp$destructuring$var526.markDef;config=config.bar;if(JSCompiler_inline_result in POSITION_SCALE_CHANNEL_INDEX){if(scaleType in CONTINUOUS_TO_CONTINUOUS_INDEX){if(void 0!==scaleConfig.continuousPadding){JSCompiler_inline_result=scaleConfig.continuousPadding;break a}var orient$865=$jscomp$destructuring$var526.orient;if("bar"===$jscomp$destructuring$var526.type&&
(!isFieldDef(fieldOrDatumDef)||!fieldOrDatumDef.bin&&!fieldOrDatumDef.timeUnit)&&("vertical"===orient$865&&"x"===JSCompiler_inline_result||"horizontal"===orient$865&&"y"===JSCompiler_inline_result)){JSCompiler_inline_result=config.continuousBandSize;break a}}if(scaleType===ScaleType.POINT){JSCompiler_inline_result=scaleConfig.pointPadding;break a}}JSCompiler_inline_result=void 0}return JSCompiler_inline_result},paddingInner:function($jscomp$destructuring$var528){var channel=$jscomp$destructuring$var528.channel,
markDef=$jscomp$destructuring$var528.markDef,config=$jscomp$destructuring$var528.config;void 0!==$jscomp$destructuring$var528.scalePadding?markDef=void 0:channel in POSITION_SCALE_CHANNEL_INDEX?($jscomp$destructuring$var528=config.scale,channel=$jscomp$destructuring$var528.barBandPaddingInner,config=$jscomp$destructuring$var528.rectBandPaddingInner,markDef=getFirstDefined($jscomp$destructuring$var528.bandPaddingInner,"bar"===markDef.type?channel:config)):markDef=void 0;return markDef},paddingOuter:function($jscomp$destructuring$var530){var channel=
$jscomp$destructuring$var530.channel,scaleType=$jscomp$destructuring$var530.scaleType,config=$jscomp$destructuring$var530.config;var paddingInnerValue=$jscomp$destructuring$var530.scalePaddingInner;$jscomp$destructuring$var530=void 0!==$jscomp$destructuring$var530.scalePadding?void 0:channel in POSITION_SCALE_CHANNEL_INDEX&&scaleType===ScaleType.BAND?getFirstDefined(config.scale.bandPaddingOuter,isSignalRef(paddingInnerValue)?{signal:paddingInnerValue.signal+"/2"}:paddingInnerValue/2):void 0;return $jscomp$destructuring$var530},
reverse:function($jscomp$destructuring$var532){var fieldOrDatumDef=$jscomp$destructuring$var532.fieldOrDatumDef,scaleType=$jscomp$destructuring$var532.scaleType,channel=$jscomp$destructuring$var532.channel;$jscomp$destructuring$var532=$jscomp$destructuring$var532.config;fieldOrDatumDef=isFieldDef(fieldOrDatumDef)?fieldOrDatumDef.sort:void 0;$jscomp$destructuring$var532=$jscomp$destructuring$var532.scale;scaleType="x"===channel&&void 0!==$jscomp$destructuring$var532.xReverse?scaleType in CONTINUOUS_DOMAIN_INDEX&&
"descending"===fieldOrDatumDef?isSignalRef($jscomp$destructuring$var532.xReverse)?{signal:"!"+$jscomp$destructuring$var532.xReverse.signal}:!$jscomp$destructuring$var532.xReverse:$jscomp$destructuring$var532.xReverse:scaleType in CONTINUOUS_DOMAIN_INDEX&&"descending"===fieldOrDatumDef?!0:void 0;return scaleType},zero:function($jscomp$destructuring$var534){a:{var JSCompiler_inline_result=$jscomp$destructuring$var534.channel;var fieldDef=$jscomp$destructuring$var534.fieldOrDatumDef,specifiedDomain=
$jscomp$destructuring$var534.domain,markDef=$jscomp$destructuring$var534.markDef;$jscomp$destructuring$var534=$jscomp$destructuring$var534.scaleType;if(specifiedDomain&&"unaggregated"!==specifiedDomain&&$jscomp$destructuring$var534 in CONTINUOUS_DOMAIN_INDEX){if(vegaUtil.isArray(specifiedDomain)&&(JSCompiler_inline_result=specifiedDomain[specifiedDomain.length-1],0>=specifiedDomain[0]&&0<=JSCompiler_inline_result)){JSCompiler_inline_result=!0;break a}JSCompiler_inline_result=!1}else"size"!==JSCompiler_inline_result||
"quantitative"!==fieldDef.type||$jscomp$destructuring$var534 in CONTINUOUS_TO_DISCRETE_INDEX?isFieldDef(fieldDef)&&fieldDef.bin||!contains([].concat($jscomp.arrayFromIterable(POSITION_SCALE_CHANNELS),$jscomp.arrayFromIterable(POLAR_POSITION_SCALE_CHANNELS)),JSCompiler_inline_result)?JSCompiler_inline_result=!1:(specifiedDomain=markDef.orient,JSCompiler_inline_result=contains(["bar","area","line","trail"],markDef.type)&&("horizontal"===specifiedDomain&&"y"===JSCompiler_inline_result||"vertical"===
specifiedDomain&&"x"===JSCompiler_inline_result)?!1:!0):JSCompiler_inline_result=!0}return JSCompiler_inline_result}},scaleTypeTieBreaker=tieBreakByComparing(function(st1,st2){return SCALE_PRECEDENCE_INDEX[st1]-SCALE_PRECEDENCE_INDEX[st2]}),NameMap=function(){_defineProperty(this,"nameMap",void 0);this.nameMap={}};NameMap.prototype.rename=function(oldName,newName){this.nameMap[oldName]=newName};NameMap.prototype.has=function(name){return void 0!==this.nameMap[name]};NameMap.prototype.get=function(name){for(;this.nameMap[name]&&
name!==this.nameMap[name];)name=this.nameMap[name];return name};var Model=function(spec,type,parent,parentGivenName,config,resolve,view){var $jscomp$this=this;this.type=type;this.parent=parent;this.config=config;_defineProperty(this,"name",void 0);_defineProperty(this,"size",void 0);_defineProperty(this,"title",void 0);_defineProperty(this,"description",void 0);_defineProperty(this,"data",void 0);_defineProperty(this,"transforms",void 0);_defineProperty(this,"layout",void 0);_defineProperty(this,
"scaleNameMap",void 0);_defineProperty(this,"projectionNameMap",void 0);_defineProperty(this,"signalNameMap",void 0);_defineProperty(this,"component",void 0);_defineProperty(this,"view",void 0);_defineProperty(this,"children",void 0);_defineProperty(this,"correctDataNames",function(mark){var _mark$from,_mark$from2,_mark$from2$facet;null!==(_mark$from=mark.from)&&void 0!==_mark$from&&_mark$from.data&&(mark.from.data=$jscomp$this.lookupDataSource(mark.from.data));null!==(_mark$from2=mark.from)&&void 0!==
_mark$from2&&null!==(_mark$from2$facet=_mark$from2.facet)&&void 0!==_mark$from2$facet&&_mark$from2$facet.data&&(mark.from.facet.data=$jscomp$this.lookupDataSource(mark.from.facet.data));return mark});this.parent=parent;this.config=config;this.view=replaceExprRef(view);var $jscomp$nullish$tmp137;this.name=null!=($jscomp$nullish$tmp137=spec.name)?$jscomp$nullish$tmp137:parentGivenName;this.title=isText(spec.title)?{text:spec.title}:spec.title?replaceExprRef(spec.title):void 0;this.scaleNameMap=parent?
parent.scaleNameMap:new NameMap;this.projectionNameMap=parent?parent.projectionNameMap:new NameMap;this.signalNameMap=parent?parent.signalNameMap:new NameMap;this.data=spec.data;this.description=spec.description;var $jscomp$nullish$tmp138;this.transforms=normalizeTransform(null!=($jscomp$nullish$tmp138=spec.transform)?$jscomp$nullish$tmp138:[]);this.layout="layer"===type||"unit"===type?{}:extractCompositionLayout(spec,type,config);this.component={data:{sources:parent?parent.component.data.sources:
[],outputNodes:parent?parent.component.data.outputNodes:{},outputNodeRefCounts:parent?parent.component.data.outputNodeRefCounts:{},isFaceted:"facet"in spec||parent&&parent.component.data.isFaceted&&void 0===spec.data},layoutSize:new Split,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({},{scale:{},axis:{},legend:{}},resolve?duplicate(resolve):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}};Model.prototype.parse=function(){this.parseScale();this.parseLayoutSize();
this.renameTopLevelLayoutSizeSignal();this.parseSelections();this.parseProjection();this.parseData();this.parseAxesAndHeaders();this.parseLegends();this.parseMarkGroup()};Model.prototype.parseScale=function(){var ignoreRange={}.ignoreRange;parseScaleCore(this);isUnitModel(this)?parseUnitScaleDomain(this):parseNonUnitScaleDomain(this);for(var $jscomp$inline_4953=$jscomp.makeIterator(NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES),$jscomp$key$prop=$jscomp$inline_4953.next();!$jscomp$key$prop.done;$jscomp$key$prop=
$jscomp$inline_4953.next())parseScaleProperty(this,$jscomp$key$prop.value);ignoreRange||parseScaleRange(this)};Model.prototype.parseProjection=function(){this.component.projection=isUnitModel(this)?parseUnitProjection(this):parseNonUnitProjections(this)};Model.prototype.renameTopLevelLayoutSizeSignal=function(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width");"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")};Model.prototype.parseLegends=
function(){parseLegend(this)};Model.prototype.assembleEncodeFromView=function(view){view=Object.assign({},view);view=(delete view.style,view);for(var e={},$jscomp$iter$519=$jscomp.makeIterator(keys$jscomp$0(view)),$jscomp$key$property=$jscomp$iter$519.next();!$jscomp$key$property.done;$jscomp$key$property=$jscomp$iter$519.next()){$jscomp$key$property=$jscomp$key$property.value;var value=view[$jscomp$key$property];void 0!==value&&(e[$jscomp$key$property]=signalOrValueRef(value))}return e};Model.prototype.assembleGroupEncodeEntry=
function(isTopLevel){var encodeEntry={};this.view&&(encodeEntry=this.assembleEncodeFromView(this.view));if(!isTopLevel&&(this.description&&(encodeEntry.description=signalOrValueRef(this.description)),"unit"===this.type||"layer"===this.type)){var $jscomp$nullish$tmp139;return Object.assign({},{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=($jscomp$nullish$tmp139=encodeEntry)?$jscomp$nullish$tmp139:{})}return isEmpty(encodeEntry)?void 0:encodeEntry};Model.prototype.assembleLayout=
function(){if(this.layout){var $jscomp$destructuring$var546=this.layout,$jscomp$destructuring$var547=Object.assign({},$jscomp$destructuring$var546);$jscomp$destructuring$var546=$jscomp$destructuring$var546.spacing;$jscomp$destructuring$var547=(delete $jscomp$destructuring$var547.spacing,$jscomp$destructuring$var547);for(var config=this.config,headerComponentIndex=this.component.layoutHeaders,titleBand={},$jscomp$inline_4962=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$inline_4962.next();!$jscomp$key$channel.done;$jscomp$key$channel=
$jscomp$inline_4962.next()){$jscomp$key$channel=$jscomp$key$channel.value;var headerComponent=headerComponentIndex[$jscomp$key$channel];if(null!==headerComponent&&void 0!==headerComponent&&headerComponent.facetFieldDef){var $jscomp$inline_4966=getHeaderProperties(["titleAnchor","titleOrient"],headerComponent.facetFieldDef.header,config,$jscomp$key$channel);headerComponent=$jscomp$inline_4966.titleAnchor;$jscomp$key$channel=getHeaderChannel($jscomp$key$channel,$jscomp$inline_4966.titleOrient);headerComponent=
LAYOUT_TITLE_BAND[$jscomp$key$channel][headerComponent];void 0!==headerComponent&&(titleBand[$jscomp$key$channel]=headerComponent)}}config=isEmpty(titleBand)?void 0:titleBand;return Object.assign({},{padding:$jscomp$destructuring$var546},this.assembleDefaultLayout(),$jscomp$destructuring$var547,config?{titleBand:config}:{})}};Model.prototype.assembleDefaultLayout=function(){return{}};Model.prototype.assembleHeaderMarks=function(){for(var layoutHeaders=this.component.layoutHeaders,headerMarks=[],$jscomp$iter$520=
$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$520.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$520.next())$jscomp$key$channel=$jscomp$key$channel.value,layoutHeaders[$jscomp$key$channel].title&&headerMarks.push(assembleTitleGroup(this,$jscomp$key$channel));layoutHeaders=$jscomp.makeIterator(HEADER_CHANNELS);for($jscomp$key$channel=layoutHeaders.next();!$jscomp$key$channel.done;$jscomp$key$channel=layoutHeaders.next())headerMarks=headerMarks.concat(assembleHeaderGroups(this,
$jscomp$key$channel.value));return headerMarks};Model.prototype.assembleAxes=function(){return assembleAxes(this.component.axes,this.config)};Model.prototype.assembleLegends=function(){return assembleLegends(this)};Model.prototype.assembleProjections=function(){var JSCompiler_inline_result=isLayerModel(this)||isConcatModel(this)?assembleProjectionsForModelAndChildren(this):assembleProjectionForModel(this);return JSCompiler_inline_result};Model.prototype.assembleTitle=function(){var $jscomp$nullish$tmp140,
$jscomp$destructuring$var550=null!=($jscomp$nullish$tmp140=this.title)?$jscomp$nullish$tmp140:{};$jscomp$nullish$tmp140=Object.assign({},$jscomp$destructuring$var550);$jscomp$destructuring$var550=$jscomp$destructuring$var550.encoding;$jscomp$nullish$tmp140=(delete $jscomp$nullish$tmp140.encoding,$jscomp$nullish$tmp140);$jscomp$destructuring$var550=Object.assign({},extractTitleConfig(this.config.title).nonMarkTitleProperties,$jscomp$nullish$tmp140,$jscomp$destructuring$var550?{encode:{update:$jscomp$destructuring$var550}}:
{});if($jscomp$destructuring$var550.text)return contains(["unit","layer"],this.type)?contains(["middle",void 0],$jscomp$destructuring$var550.anchor)&&(null!=$jscomp$destructuring$var550.frame||($jscomp$destructuring$var550.frame="group")):null!=$jscomp$destructuring$var550.anchor||($jscomp$destructuring$var550.anchor="start"),isEmpty($jscomp$destructuring$var550)?void 0:$jscomp$destructuring$var550};Model.prototype.assembleGroup=function(signals){signals=void 0===signals?[]:signals;var group={};signals=
signals.concat(this.assembleSignals());0<signals.length&&(group.signals=signals);if(signals=this.assembleLayout())group.layout=signals;group.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());signals=!this.parent||isFacetModel(this.parent)?assembleScales(this):[];0<signals.length&&(group.scales=signals);signals=this.assembleAxes();0<signals.length&&(group.axes=signals);signals=this.assembleLegends();0<signals.length&&(group.legends=signals);return group};Model.prototype.getName=function(text){return varName((this.name?
this.name+"_":"")+text)};Model.prototype.getDataName=function(type){return this.getName(DataSourceType[type].toLowerCase())};Model.prototype.requestDataName=function(name){name=this.getDataName(name);var refCounts=this.component.data.outputNodeRefCounts;refCounts[name]=(refCounts[name]||0)+1;return name};Model.prototype.getSizeSignalRef=function(layoutSizeType){if(isFacetModel(this.parent)){var sizeType=getSizeTypeFromLayoutSizeType(layoutSizeType),channel=getPositionScaleChannel(sizeType);if((sizeType=
this.component.scales[channel])&&!sizeType.merged){var type$872=sizeType.get("type"),range$873=sizeType.get("range");if(type$872 in DISCRETE_DOMAIN_INDEX&&isVgRangeStep(range$873)){layoutSizeType=sizeType.get("name");type$872=assembleDomain(this,channel);if(type$872=getFieldFromDomain(type$872))return channel=vgField({aggregate:"distinct",field:type$872},{expr:"datum"}),{signal:sizeExpr(layoutSizeType,sizeType,channel)};warn(unknownField(channel));return null}}}return{signal:this.signalNameMap.get(this.getName(layoutSizeType))}};
Model.prototype.lookupDataSource=function(name){var node=this.component.data.outputNodes[name];return node?node.getSource():name};Model.prototype.getSignalName=function(oldSignalName){return this.signalNameMap.get(oldSignalName)};Model.prototype.renameSignal=function(oldName,newName){this.signalNameMap.rename(oldName,newName)};Model.prototype.renameScale=function(oldName,newName){this.scaleNameMap.rename(oldName,newName)};Model.prototype.renameProjection=function(oldName,newName){this.projectionNameMap.rename(oldName,
newName)};Model.prototype.scaleName=function(originalScaleName,parse){if(parse)return this.getName(originalScaleName);if(CHANNEL_INDEX[originalScaleName]&&SCALE_CHANNEL_INDEX[originalScaleName]&&this.component.scales[originalScaleName]||this.scaleNameMap.has(this.getName(originalScaleName)))return this.scaleNameMap.get(this.getName(originalScaleName))};Model.prototype.projectionName=function(parse){if(parse)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||
this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))};Model.prototype.getScaleComponent=function(channel){if(!this.component.scales)throw Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");var localScaleComponent=this.component.scales[channel];return localScaleComponent&&!localScaleComponent.merged?localScaleComponent:this.parent?this.parent.getScaleComponent(channel):
void 0};Model.prototype.getSelectionComponent=function(variableName,origName){var sel=this.component.selection[variableName];!sel&&this.parent&&(sel=this.parent.getSelectionComponent(variableName,origName));if(!sel)throw Error('Cannot find a selection named "'+origName+'".');return sel};Model.prototype.hasAxisOrientSignalRef=function(){var _this$component$axes$,_this$component$axes$2;return(null===(_this$component$axes$=this.component.axes.x)||void 0===_this$component$axes$?void 0:_this$component$axes$.some(function(a){return a.hasOrientSignalRef()}))||
(null===(_this$component$axes$2=this.component.axes.y)||void 0===_this$component$axes$2?void 0:_this$component$axes$2.some(function(a){return a.hasOrientSignalRef()}))};$jscomp.global.Object.defineProperties(Model.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this.getSizeSignalRef("width")}},height:{configurable:!0,enumerable:!0,get:function(){return this.getSizeSignalRef("height")}}});var ModelWithField=function(){return Model.apply(this,arguments)||this};$jscomp.inherits(ModelWithField,
Model);ModelWithField.prototype.vgField=function(channel,opt){opt=void 0===opt?{}:opt;if(channel=this.fieldDef(channel))return vgField(channel,opt)};ModelWithField.prototype.reduceFieldDef=function(f,init){return reduce(this.getMapping(),function(acc,cd,c){return(cd=getFieldDef(cd))?f(acc,cd,c):acc},init)};ModelWithField.prototype.forEachFieldDef=function(f,t){forEach(this.getMapping(),function(cd,c){(cd=getFieldDef(cd))&&f(cd,c)},t)};var DensityTransformNode=function(parent,transform){parent=DataFlowNode.call(this,
parent)||this;parent.transform=transform;parent.transform=duplicate(transform);var $jscomp$nullish$tmp143;transform=null!=($jscomp$nullish$tmp143=parent.transform.as)?$jscomp$nullish$tmp143:[void 0,void 0];var $jscomp$nullish$tmp144,$jscomp$nullish$tmp145;parent.transform.as=[null!=($jscomp$nullish$tmp144=transform[0])?$jscomp$nullish$tmp144:"value",null!=($jscomp$nullish$tmp145=transform[1])?$jscomp$nullish$tmp145:"density"];return parent};$jscomp.inherits(DensityTransformNode,DataFlowNode);DensityTransformNode.prototype.clone=
function(){return new DensityTransformNode(null,duplicate(this.transform))};DensityTransformNode.prototype.dependentFields=function(){var $jscomp$nullish$tmp146;return new Set([this.transform.density].concat($jscomp.arrayFromIterable(null!=($jscomp$nullish$tmp146=this.transform.groupby)?$jscomp$nullish$tmp146:[])))};DensityTransformNode.prototype.producedFields=function(){return new Set(this.transform.as)};DensityTransformNode.prototype.hash=function(){return"DensityTransform "+hash(this.transform)};
DensityTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var552=this.transform,$jscomp$destructuring$var553=Object.assign({},$jscomp$destructuring$var552);$jscomp$destructuring$var552=$jscomp$destructuring$var552.density;$jscomp$destructuring$var553=(delete $jscomp$destructuring$var553.density,$jscomp$destructuring$var553);return Object.assign({},{type:"kde",field:$jscomp$destructuring$var552},$jscomp$destructuring$var553)};var FilterInvalidNode=function(parent,filter){parent=
DataFlowNode.call(this,parent)||this;parent.filter=filter;return parent};$jscomp.inherits(FilterInvalidNode,DataFlowNode);FilterInvalidNode.prototype.clone=function(){return new FilterInvalidNode(null,Object.assign({},this.filter))};FilterInvalidNode.make=function(parent,model){var mark=model.mark;if("filter"!==getMarkPropOrConfig("invalid",model.markDef,model.config))return null;var filter=model.reduceFieldDef(function(aggregator,fieldDef,channel){(channel=!!SCALE_CHANNEL_INDEX[channel]&&model.getScaleComponent(channel))&&
channel.get("type")in CONTINUOUS_DOMAIN_INDEX&&"count"!==fieldDef.aggregate&&!isPathMark(mark)&&(aggregator[fieldDef.field]=fieldDef);return aggregator},{});return keys$jscomp$0(filter).length?new FilterInvalidNode(parent,filter):null};FilterInvalidNode.prototype.dependentFields=function(){return new Set(keys$jscomp$0(this.filter))};FilterInvalidNode.prototype.producedFields=function(){return new Set};FilterInvalidNode.prototype.hash=function(){return"FilterInvalid "+hash(this.filter)};FilterInvalidNode.prototype.assemble=
function(){var $jscomp$this=this,filters=keys$jscomp$0(this.filter).reduce(function(vegaFilters,field){field=$jscomp$this.filter[field];var ref=vgField(field,{expr:"datum"});null!==field&&("temporal"===field.type?vegaFilters.push("(isDate("+ref+") || (isValid("+ref+") \x26\x26 isFinite(+"+ref+")))"):"quantitative"===field.type&&(vegaFilters.push("isValid("+ref+")"),vegaFilters.push("isFinite(+"+ref+")")));return vegaFilters},[]);return 0<filters.length?{type:"filter",expr:filters.join(" \x26\x26 ")}:
null};var FlattenTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.transform=duplicate(transform);transform=parent.transform;var as=void 0===transform.as?[]:transform.as,$jscomp$nullish$tmp147;parent.transform.as=transform.flatten.map(function(f,i){return null!=($jscomp$nullish$tmp147=as[i])?$jscomp$nullish$tmp147:f});return parent};$jscomp.inherits(FlattenTransformNode,DataFlowNode);FlattenTransformNode.prototype.clone=function(){return new FlattenTransformNode(this.parent,
duplicate(this.transform))};FlattenTransformNode.prototype.dependentFields=function(){return new Set(this.transform.flatten)};FlattenTransformNode.prototype.producedFields=function(){return new Set(this.transform.as)};FlattenTransformNode.prototype.hash=function(){return"FlattenTransform "+hash(this.transform)};FlattenTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var556=this.transform;return{type:"flatten",fields:$jscomp$destructuring$var556.flatten,as:$jscomp$destructuring$var556.as}};
var FoldTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.transform=duplicate(transform);var $jscomp$nullish$tmp148;transform=null!=($jscomp$nullish$tmp148=parent.transform.as)?$jscomp$nullish$tmp148:[void 0,void 0];var $jscomp$nullish$tmp149,$jscomp$nullish$tmp150;parent.transform.as=[null!=($jscomp$nullish$tmp149=transform[0])?$jscomp$nullish$tmp149:"key",null!=($jscomp$nullish$tmp150=transform[1])?$jscomp$nullish$tmp150:"value"];
return parent};$jscomp.inherits(FoldTransformNode,DataFlowNode);FoldTransformNode.prototype.clone=function(){return new FoldTransformNode(null,duplicate(this.transform))};FoldTransformNode.prototype.dependentFields=function(){return new Set(this.transform.fold)};FoldTransformNode.prototype.producedFields=function(){return new Set(this.transform.as)};FoldTransformNode.prototype.hash=function(){return"FoldTransform "+hash(this.transform)};FoldTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var557=
this.transform;return{type:"fold",fields:$jscomp$destructuring$var557.fold,as:$jscomp$destructuring$var557.as}};var GeoJSONNode=function(parent,fields,geojson,signal){parent=DataFlowNode.call(this,parent)||this;parent.fields=fields;parent.geojson=geojson;parent.signal=signal;return parent};$jscomp.inherits(GeoJSONNode,DataFlowNode);GeoJSONNode.prototype.clone=function(){return new GeoJSONNode(null,duplicate(this.fields),this.geojson,this.signal)};GeoJSONNode.parseAll=function(parent,model){if(model.component.projection&&
!model.component.projection.isFit)return parent;for(var geoJsonCounter=0,$jscomp$iter$522=$jscomp.makeIterator([["longitude","latitude"],["longitude2","latitude2"]]),$jscomp$key$coordinates=$jscomp$iter$522.next();!$jscomp$key$coordinates.done;$jscomp$key$coordinates=$jscomp$iter$522.next())if($jscomp$key$coordinates=$jscomp$key$coordinates.value.map(function(channel){channel=getFieldOrDatumDef(model.encoding[channel]);return isFieldDef(channel)?channel.field:isDatumDef(channel)?{expr:""+channel.datum}:
isValueDef(channel)?{expr:""+channel.value}:void 0}),$jscomp$key$coordinates[0]||$jscomp$key$coordinates[1])parent=new GeoJSONNode(parent,$jscomp$key$coordinates,null,model.getName("geojson_"+geoJsonCounter++));model.channelHasField("shape")&&($jscomp$iter$522=model.typedFieldDef("shape"),"geojson"===$jscomp$iter$522.type&&(parent=new GeoJSONNode(parent,null,$jscomp$iter$522.field,model.getName("geojson_"+geoJsonCounter++))));return parent};GeoJSONNode.prototype.dependentFields=function(){var $jscomp$nullish$tmp151,
fields=(null!=($jscomp$nullish$tmp151=this.fields)?$jscomp$nullish$tmp151:[]).filter(vegaUtil.isString);return new Set([].concat($jscomp.arrayFromIterable(this.geojson?[this.geojson]:[]),$jscomp.arrayFromIterable(fields)))};GeoJSONNode.prototype.producedFields=function(){return new Set};GeoJSONNode.prototype.hash=function(){return"GeoJSON "+this.geojson+" "+this.signal+" "+hash(this.fields)};GeoJSONNode.prototype.assemble=function(){return[].concat($jscomp.arrayFromIterable(this.geojson?[{type:"filter",
expr:'isValid(datum["'+this.geojson+'"])'}]:[]),[Object.assign({},{type:"geojson"},this.fields?{fields:this.fields}:{},this.geojson?{geojson:this.geojson}:{},{signal:this.signal})])};var GeoPointNode=function(parent,projection,fields,as){parent=DataFlowNode.call(this,parent)||this;parent.projection=projection;parent.fields=fields;parent.as=as;return parent};$jscomp.inherits(GeoPointNode,DataFlowNode);GeoPointNode.prototype.clone=function(){return new GeoPointNode(null,this.projection,duplicate(this.fields),
duplicate(this.as))};GeoPointNode.parseAll=function(parent,model){if(!model.projectionName())return parent;for(var $jscomp$iter$523=$jscomp.makeIterator([["longitude","latitude"],["longitude2","latitude2"]]),$jscomp$key$coordinates=$jscomp$iter$523.next();!$jscomp$key$coordinates.done;$jscomp$key$coordinates=$jscomp$iter$523.next()){var coordinates=$jscomp$key$coordinates.value;$jscomp$key$coordinates=coordinates.map(function(channel){channel=getFieldOrDatumDef(model.encoding[channel]);return isFieldDef(channel)?
channel.field:isDatumDef(channel)?{expr:""+channel.datum}:isValueDef(channel)?{expr:""+channel.value}:void 0});coordinates="longitude2"===coordinates[0]?"2":"";if($jscomp$key$coordinates[0]||$jscomp$key$coordinates[1])parent=new GeoPointNode(parent,model.projectionName(),$jscomp$key$coordinates,[model.getName("x"+coordinates),model.getName("y"+coordinates)])}return parent};GeoPointNode.prototype.dependentFields=function(){return new Set(this.fields.filter(vegaUtil.isString))};GeoPointNode.prototype.producedFields=
function(){return new Set(this.as)};GeoPointNode.prototype.hash=function(){return"Geopoint "+this.projection+" "+hash(this.fields)+" "+hash(this.as)};GeoPointNode.prototype.assemble=function(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}};var ImputeNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};$jscomp.inherits(ImputeNode,DataFlowNode);ImputeNode.prototype.clone=function(){return new ImputeNode(null,
duplicate(this.transform))};ImputeNode.prototype.dependentFields=function(){var $jscomp$nullish$tmp152;return new Set([this.transform.impute,this.transform.key].concat($jscomp.arrayFromIterable(null!=($jscomp$nullish$tmp152=this.transform.groupby)?$jscomp$nullish$tmp152:[])))};ImputeNode.prototype.producedFields=function(){return new Set([this.transform.impute])};ImputeNode.prototype.processSequence=function(keyvals){var step=keyvals.step;return{signal:"sequence("+[void 0===keyvals.start?0:keyvals.start,
keyvals.stop].concat($jscomp.arrayFromIterable(step?[step]:[])).join(",")+")"}};ImputeNode.makeFromTransform=function(parent,imputeTransform){return new ImputeNode(parent,imputeTransform)};ImputeNode.makeFromEncoding=function(parent,model){var encoding=model.encoding,xDef=encoding.x,yDef=encoding.y;if(isFieldDef(xDef)&&isFieldDef(yDef)){var imputedChannel=xDef.impute?xDef:yDef.impute?yDef:void 0;if(void 0===imputedChannel)return;xDef=xDef.impute?yDef:yDef.impute?xDef:void 0;var $jscomp$destructuring$var559=
imputedChannel.impute;yDef=$jscomp$destructuring$var559.method;var value=$jscomp$destructuring$var559.value,frame=$jscomp$destructuring$var559.frame;$jscomp$destructuring$var559=$jscomp$destructuring$var559.keyvals;model=pathGroupingFields(model.mark,encoding);return new ImputeNode(parent,Object.assign({},{impute:imputedChannel.field,key:xDef.field},yDef?{method:yDef}:{},void 0!==value?{value:value}:{},frame?{frame:frame}:{},void 0!==$jscomp$destructuring$var559?{keyvals:$jscomp$destructuring$var559}:
{},model.length?{groupby:model}:{}))}return null};ImputeNode.prototype.hash=function(){return"Impute "+hash(this.transform)};ImputeNode.prototype.assemble=function(){var $jscomp$destructuring$var560=this.transform,impute=$jscomp$destructuring$var560.impute,keyvals=$jscomp$destructuring$var560.keyvals,method=$jscomp$destructuring$var560.method,groupby=$jscomp$destructuring$var560.groupby,value=$jscomp$destructuring$var560.value,frame=void 0===$jscomp$destructuring$var560.frame?[null,null]:$jscomp$destructuring$var560.frame;
$jscomp$destructuring$var560=Object.assign({},{type:"impute",field:impute,key:$jscomp$destructuring$var560.key},keyvals?{keyvals:void 0!==(null===keyvals||void 0===keyvals?void 0:keyvals.stop)?this.processSequence(keyvals):keyvals}:{},{method:"value"},groupby?{groupby:groupby}:{},{value:method&&"value"!==method?null:value});return method&&"value"!==method?(method=Object.assign({},{type:"window",as:["imputed_"+impute+"_value"],ops:[method],fields:[impute],frame:frame,ignorePeers:!1},groupby?{groupby:groupby}:
{}),[$jscomp$destructuring$var560,method,{type:"formula",expr:"datum."+impute+" \x3d\x3d\x3d null ? datum.imputed_"+impute+"_value : datum."+impute,as:impute}]):[$jscomp$destructuring$var560]};var LoessTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.transform=duplicate(transform);var $jscomp$nullish$tmp153,specifiedAs=null!=($jscomp$nullish$tmp153=parent.transform.as)?$jscomp$nullish$tmp153:[void 0,void 0],$jscomp$nullish$tmp154,
$jscomp$nullish$tmp155;parent.transform.as=[null!=($jscomp$nullish$tmp154=specifiedAs[0])?$jscomp$nullish$tmp154:transform.on,null!=($jscomp$nullish$tmp155=specifiedAs[1])?$jscomp$nullish$tmp155:transform.loess];return parent};$jscomp.inherits(LoessTransformNode,DataFlowNode);LoessTransformNode.prototype.clone=function(){return new LoessTransformNode(null,duplicate(this.transform))};LoessTransformNode.prototype.dependentFields=function(){var $jscomp$nullish$tmp156;return new Set([this.transform.loess,
this.transform.on].concat($jscomp.arrayFromIterable(null!=($jscomp$nullish$tmp156=this.transform.groupby)?$jscomp$nullish$tmp156:[])))};LoessTransformNode.prototype.producedFields=function(){return new Set(this.transform.as)};LoessTransformNode.prototype.hash=function(){return"LoessTransform "+hash(this.transform)};LoessTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var561=this.transform,$jscomp$destructuring$var562=Object.assign({},$jscomp$destructuring$var561),loess=$jscomp$destructuring$var561.loess;
$jscomp$destructuring$var561=$jscomp$destructuring$var561.on;$jscomp$destructuring$var562=(delete $jscomp$destructuring$var562.loess,delete $jscomp$destructuring$var562.on,$jscomp$destructuring$var562);return Object.assign({},{type:"loess",x:$jscomp$destructuring$var561,y:loess},$jscomp$destructuring$var562)};var LookupNode=function(parent,transform,secondary){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.secondary=secondary;return parent};$jscomp.inherits(LookupNode,
DataFlowNode);LookupNode.prototype.clone=function(){return new LookupNode(null,duplicate(this.transform),this.secondary)};LookupNode.make=function(parent,model,transform,counter){var sources=model.component.data.sources,from=transform.from,fromOutputNode=null;if("data"in from)fromOutputNode=findSource(from.data,sources),fromOutputNode||(fromOutputNode=new SourceNode(from.data),sources.push(fromOutputNode)),counter=model.getName("lookup_"+counter),fromOutputNode=new OutputNode(fromOutputNode,counter,
DataSourceType.Lookup,model.component.data.outputNodeRefCounts),model.component.data.outputNodes[counter]=fromOutputNode;else if("param"in from){counter=from.param;transform=Object.assign({},{as:counter},transform);try{var selCmpt=model.getSelectionComponent(varName(counter),counter)}catch(e){throw Error('Lookups can only be performed on selection parameters. "'+counter+'" is a variable parameter.');}fromOutputNode=selCmpt.materialized;if(!fromOutputNode)throw Error('Cannot define and lookup the "'+
counter+'" selection in the same view. Try moving the lookup into a second, layered view?');}return new LookupNode(parent,transform,fromOutputNode.getSource())};LookupNode.prototype.dependentFields=function(){return new Set([this.transform.lookup])};LookupNode.prototype.producedFields=function(){return new Set(this.transform.as?vegaUtil.array(this.transform.as):this.transform.from.fields)};LookupNode.prototype.hash=function(){return"Lookup "+hash({transform:this.transform,secondary:this.secondary})};
LookupNode.prototype.assemble=function(){if(this.transform.from.fields)var foreign=Object.assign({},{values:this.transform.from.fields},this.transform.as?{as:vegaUtil.array(this.transform.as)}:{});else foreign=this.transform.as,vegaUtil.isString(foreign)||(warn('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),foreign="_lookup"),foreign={as:[foreign]};return Object.assign({},{type:"lookup",from:this.secondary,key:this.transform.from.key,
fields:[this.transform.lookup]},foreign,this.transform.default?{default:this.transform.default}:{})};var QuantileTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.transform=duplicate(transform);var $jscomp$nullish$tmp157;transform=null!=($jscomp$nullish$tmp157=parent.transform.as)?$jscomp$nullish$tmp157:[void 0,void 0];var $jscomp$nullish$tmp158,$jscomp$nullish$tmp159;parent.transform.as=[null!=($jscomp$nullish$tmp158=transform[0])?
$jscomp$nullish$tmp158:"prob",null!=($jscomp$nullish$tmp159=transform[1])?$jscomp$nullish$tmp159:"value"];return parent};$jscomp.inherits(QuantileTransformNode,DataFlowNode);QuantileTransformNode.prototype.clone=function(){return new QuantileTransformNode(null,duplicate(this.transform))};QuantileTransformNode.prototype.dependentFields=function(){var $jscomp$nullish$tmp160;return new Set([this.transform.quantile].concat($jscomp.arrayFromIterable(null!=($jscomp$nullish$tmp160=this.transform.groupby)?
$jscomp$nullish$tmp160:[])))};QuantileTransformNode.prototype.producedFields=function(){return new Set(this.transform.as)};QuantileTransformNode.prototype.hash=function(){return"QuantileTransform "+hash(this.transform)};QuantileTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var564=this.transform,$jscomp$destructuring$var565=Object.assign({},$jscomp$destructuring$var564);$jscomp$destructuring$var564=$jscomp$destructuring$var564.quantile;$jscomp$destructuring$var565=(delete $jscomp$destructuring$var565.quantile,
$jscomp$destructuring$var565);return Object.assign({},{type:"quantile",field:$jscomp$destructuring$var564},$jscomp$destructuring$var565)};var RegressionTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;parent.transform=duplicate(transform);var $jscomp$nullish$tmp161,specifiedAs=null!=($jscomp$nullish$tmp161=parent.transform.as)?$jscomp$nullish$tmp161:[void 0,void 0],$jscomp$nullish$tmp162,$jscomp$nullish$tmp163;parent.transform.as=[null!=
($jscomp$nullish$tmp162=specifiedAs[0])?$jscomp$nullish$tmp162:transform.on,null!=($jscomp$nullish$tmp163=specifiedAs[1])?$jscomp$nullish$tmp163:transform.regression];return parent};$jscomp.inherits(RegressionTransformNode,DataFlowNode);RegressionTransformNode.prototype.clone=function(){return new RegressionTransformNode(null,duplicate(this.transform))};RegressionTransformNode.prototype.dependentFields=function(){var $jscomp$nullish$tmp164;return new Set([this.transform.regression,this.transform.on].concat($jscomp.arrayFromIterable(null!=
($jscomp$nullish$tmp164=this.transform.groupby)?$jscomp$nullish$tmp164:[])))};RegressionTransformNode.prototype.producedFields=function(){return new Set(this.transform.as)};RegressionTransformNode.prototype.hash=function(){return"RegressionTransform "+hash(this.transform)};RegressionTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var566=this.transform,$jscomp$destructuring$var567=Object.assign({},$jscomp$destructuring$var566),regression=$jscomp$destructuring$var566.regression;
$jscomp$destructuring$var566=$jscomp$destructuring$var566.on;$jscomp$destructuring$var567=(delete $jscomp$destructuring$var567.regression,delete $jscomp$destructuring$var567.on,$jscomp$destructuring$var567);return Object.assign({},{type:"regression",x:$jscomp$destructuring$var566,y:regression},$jscomp$destructuring$var567)};var PivotTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};$jscomp.inherits(PivotTransformNode,DataFlowNode);
PivotTransformNode.prototype.clone=function(){return new PivotTransformNode(null,duplicate(this.transform))};PivotTransformNode.prototype.addDimensions=function(fields){var $jscomp$nullish$tmp165;this.transform.groupby=unique((null!=($jscomp$nullish$tmp165=this.transform.groupby)?$jscomp$nullish$tmp165:[]).concat(fields),function(d){return d})};PivotTransformNode.prototype.producedFields=function(){};PivotTransformNode.prototype.dependentFields=function(){var $jscomp$nullish$tmp166;return new Set([this.transform.pivot,
this.transform.value].concat($jscomp.arrayFromIterable(null!=($jscomp$nullish$tmp166=this.transform.groupby)?$jscomp$nullish$tmp166:[])))};PivotTransformNode.prototype.hash=function(){return"PivotTransform "+hash(this.transform)};PivotTransformNode.prototype.assemble=function(){var $jscomp$destructuring$var568=this.transform,groupby=$jscomp$destructuring$var568.groupby,limit=$jscomp$destructuring$var568.limit,op=$jscomp$destructuring$var568.op;return Object.assign({},{type:"pivot",field:$jscomp$destructuring$var568.pivot,
value:$jscomp$destructuring$var568.value},void 0!==limit?{limit:limit}:{},void 0!==op?{op:op}:{},void 0!==groupby?{groupby:groupby}:{})};var SampleTransformNode=function(parent,transform){parent=DataFlowNode.call(this,parent)||this;parent.transform=transform;return parent};$jscomp.inherits(SampleTransformNode,DataFlowNode);SampleTransformNode.prototype.clone=function(){return new SampleTransformNode(null,duplicate(this.transform))};SampleTransformNode.prototype.dependentFields=function(){return new Set};
SampleTransformNode.prototype.producedFields=function(){return new Set};SampleTransformNode.prototype.hash=function(){return"SampleTransform "+hash(this.transform)};SampleTransformNode.prototype.assemble=function(){return{type:"sample",size:this.transform.sample}};var FacetModel=function(spec,parent,parentGivenName,config){parent=ModelWithField.call(this,spec,"facet",parent,parentGivenName,config,spec.resolve)||this;_defineProperty(parent,"facet",void 0);_defineProperty(parent,"child",void 0);_defineProperty(parent,
"children",void 0);parent.child=buildModel(spec.spec,parent,parent.getName("child"),void 0,config);parent.children=[parent.child];parent.facet=parent.initFacet(spec.facet);return parent};$jscomp.inherits(FacetModel,ModelWithField);FacetModel.prototype.initFacet=function(facet){if(!isFacetMapping(facet))return{facet:this.initFacetFieldDef(facet,"facet")};var channels=keys$jscomp$0(facet),normalizedFacet={};channels=$jscomp.makeIterator(channels);for(var $jscomp$key$channel=channels.next();!$jscomp$key$channel.done;$jscomp$key$channel=
channels.next()){$jscomp$key$channel=$jscomp$key$channel.value;if(!["row","column"].includes($jscomp$key$channel)){warn(incompatibleChannel($jscomp$key$channel,"facet"));break}var fieldDef=facet[$jscomp$key$channel];if(void 0===fieldDef.field){warn(emptyFieldDef(fieldDef,$jscomp$key$channel));break}normalizedFacet[$jscomp$key$channel]=this.initFacetFieldDef(fieldDef,$jscomp$key$channel)}return normalizedFacet};FacetModel.prototype.initFacetFieldDef=function(fieldDef,channel){fieldDef=initFieldDef(fieldDef,
channel);fieldDef.header?fieldDef.header=replaceExprRef(fieldDef.header):null===fieldDef.header&&(fieldDef.header=null);return fieldDef};FacetModel.prototype.channelHasField=function(channel){return!!this.facet[channel]};FacetModel.prototype.fieldDef=function(channel){return this.facet[channel]};FacetModel.prototype.parseData=function(){this.component.data=parseData(this);this.child.parseData()};FacetModel.prototype.parseLayoutSize=function(){parseChildrenLayoutSize(this)};FacetModel.prototype.parseSelections=
function(){this.child.parseSelections();this.component.selection=this.child.component.selection};FacetModel.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()};FacetModel.prototype.parseAxesAndHeaders=function(){this.child.parseAxesAndHeaders();for(var $jscomp$inline_4975=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$inline_4975.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_4975.next()){var _fieldDef$header=void 0;$jscomp$key$channel=$jscomp$key$channel.value;
var facet=this.facet,config=this.config,child=this.child,component=this.component;if(this.channelHasField($jscomp$key$channel)){facet=facet[$jscomp$key$channel];var titleConfig=getHeaderProperty("title",null,config,$jscomp$key$channel);titleConfig=title$jscomp$0(facet,config,{allowDisabling:!0,includeDefault:void 0===titleConfig||!!titleConfig});child.component.layoutHeaders[$jscomp$key$channel].title&&(titleConfig=vegaUtil.isArray(titleConfig)?titleConfig.join(", "):titleConfig,titleConfig+=" / "+
child.component.layoutHeaders[$jscomp$key$channel].title,child.component.layoutHeaders[$jscomp$key$channel].title=null);child=getHeaderProperty("labelOrient",facet.header,config,$jscomp$key$channel);config=null!==facet.header?getFirstDefined(null===(_fieldDef$header=facet.header)||void 0===_fieldDef$header?void 0:_fieldDef$header.labels,config.header.labels,!0):!1;_fieldDef$header=contains(["bottom","right"],child)?"footer":"header";child={};component.layoutHeaders[$jscomp$key$channel]=(child.title=
null!==facet.header?titleConfig:null,child.facetFieldDef=facet,child[_fieldDef$header]="facet"===$jscomp$key$channel?[]:[makeHeaderComponent(this,$jscomp$key$channel,config)],child)}}mergeChildAxis(this,"x");mergeChildAxis(this,"y")};FacetModel.prototype.assembleSelectionTopLevelSignals=function(signals){return this.child.assembleSelectionTopLevelSignals(signals)};FacetModel.prototype.assembleSignals=function(){this.child.assembleSignals();return[]};FacetModel.prototype.assembleSelectionData=function(data){return this.child.assembleSelectionData(data)};
FacetModel.prototype.getHeaderLayoutMixins=function(){for(var layoutMixins={},$jscomp$iter$540=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$540.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$540.next()){$jscomp$key$channel=$jscomp$key$channel.value;for(var $jscomp$iter$539=$jscomp.makeIterator(HEADER_TYPES),$jscomp$key$headerType=$jscomp$iter$539.next();!$jscomp$key$headerType.done;$jscomp$key$headerType=$jscomp$iter$539.next()){var headerType=$jscomp$key$headerType.value;
$jscomp$key$headerType=this.component.layoutHeaders[$jscomp$key$channel];var headerComponent=$jscomp$key$headerType[headerType],facetFieldDef=$jscomp$key$headerType.facetFieldDef;facetFieldDef&&(facetFieldDef=getHeaderProperty("titleOrient",facetFieldDef.header,this.config,$jscomp$key$channel),["right","bottom"].includes(facetFieldDef)&&(facetFieldDef=getHeaderChannel($jscomp$key$channel,facetFieldDef),null!=layoutMixins.titleAnchor||(layoutMixins.titleAnchor={}),layoutMixins.titleAnchor[facetFieldDef]=
"end"));null!==headerComponent&&void 0!==headerComponent&&headerComponent[0]&&(headerComponent="row"===$jscomp$key$channel?"height":"width",headerType="header"===headerType?"headerBand":"footerBand","facet"===$jscomp$key$channel||this.child.component.layoutSize.get(headerComponent)||(null!=layoutMixins[headerType]||(layoutMixins[headerType]={}),layoutMixins[headerType][$jscomp$key$channel]=.5),$jscomp$key$headerType.title&&(null!=layoutMixins.offset||(layoutMixins.offset={}),layoutMixins.offset["row"===
$jscomp$key$channel?"rowTitle":"columnTitle"]=10))}}return layoutMixins};FacetModel.prototype.assembleDefaultLayout=function(){var $jscomp$destructuring$var576=this.facet,column=$jscomp$destructuring$var576.column;$jscomp$destructuring$var576=$jscomp$destructuring$var576.row;var columns=column?this.columnDistinctSignal():$jscomp$destructuring$var576?1:void 0,align="all";$jscomp$destructuring$var576||"independent"!==this.component.resolve.scale.x?column||"independent"!==this.component.resolve.scale.y||
(align="none"):align="none";return Object.assign({},this.getHeaderLayoutMixins(),columns?{columns:columns}:{},{bounds:"full",align:align})};FacetModel.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()};FacetModel.prototype.columnDistinctSignal=function(){if(!(this.parent&&this.parent instanceof FacetModel))return{signal:"length(data('"+this.getName("column_domain")+"'))"}};FacetModel.prototype.assembleGroupStyle=function(){};FacetModel.prototype.assembleGroup=function(signals){return this.parent&&
this.parent instanceof FacetModel?Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:vgField(this.facet.column,{prefix:"distinct"})}}}}:{},ModelWithField.prototype.assembleGroup.call(this,signals)):ModelWithField.prototype.assembleGroup.call(this,signals)};FacetModel.prototype.getCardinalityAggregateForChild=function(){var fields=[],ops=[],as=[];if(this.child instanceof FacetModel){if(this.child.channelHasField("column")){var field=vgField(this.child.facet.column);fields.push(field);
ops.push("distinct");as.push("distinct_"+field)}}else{field=$jscomp.makeIterator(POSITION_SCALE_CHANNELS);for(var $jscomp$key$channel=field.next();!$jscomp$key$channel.done;$jscomp$key$channel=field.next()){$jscomp$key$channel=$jscomp$key$channel.value;var childScaleComponent=this.child.component.scales[$jscomp$key$channel];if(childScaleComponent&&!childScaleComponent.merged){var type$889=childScaleComponent.get("type");childScaleComponent=childScaleComponent.get("range");type$889 in DISCRETE_DOMAIN_INDEX&&
isVgRangeStep(childScaleComponent)&&(type$889=assembleDomain(this.child,$jscomp$key$channel),(type$889=getFieldFromDomain(type$889))?(fields.push(type$889),ops.push("distinct"),as.push("distinct_"+type$889)):warn(unknownField($jscomp$key$channel)))}}}return{fields:fields,ops:ops,as:as}};FacetModel.prototype.assembleFacet=function(){var $jscomp$destructuring$var577=this.component.data.facetRoot,name=$jscomp$destructuring$var577.name;$jscomp$destructuring$var577=$jscomp$destructuring$var577.data;var $jscomp$destructuring$var578=
this.facet,row=$jscomp$destructuring$var578.row,column=$jscomp$destructuring$var578.column,$jscomp$destructuring$var579=this.getCardinalityAggregateForChild();$jscomp$destructuring$var578=$jscomp$destructuring$var579.fields;var ops=$jscomp$destructuring$var579.ops;$jscomp$destructuring$var579=$jscomp$destructuring$var579.as;for(var groupby=[],$jscomp$iter$542=$jscomp.makeIterator(FACET_CHANNELS),$jscomp$key$channel=$jscomp$iter$542.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$542.next()){var channel=
$jscomp$key$channel.value;if($jscomp$key$channel=this.facet[channel]){groupby.push(vgField($jscomp$key$channel));var $jscomp$destructuring$var580=$jscomp$key$channel,sort=$jscomp$destructuring$var580.sort;isBinning($jscomp$destructuring$var580.bin)&&groupby.push(vgField($jscomp$key$channel,{binSuffix:"end"}));isSortField(sort)?($jscomp$destructuring$var580=sort,channel=$jscomp$destructuring$var580.field,$jscomp$destructuring$var580=void 0===$jscomp$destructuring$var580.op?"min":$jscomp$destructuring$var580.op,
$jscomp$key$channel=facetSortFieldName($jscomp$key$channel,sort),row&&column?($jscomp$destructuring$var578.push($jscomp$key$channel),ops.push("max")):($jscomp$destructuring$var578.push(channel),ops.push($jscomp$destructuring$var580)),$jscomp$destructuring$var579.push($jscomp$key$channel)):vegaUtil.isArray(sort)&&($jscomp$key$channel=sortArrayIndexField($jscomp$key$channel,channel),$jscomp$destructuring$var578.push($jscomp$key$channel),ops.push("max"),$jscomp$destructuring$var579.push($jscomp$key$channel))}}row=
!!row&&!!column;return Object.assign({},{name:name,data:$jscomp$destructuring$var577,groupby:groupby},row||0<$jscomp$destructuring$var578.length?{aggregate:Object.assign({},row?{cross:row}:{},$jscomp$destructuring$var578.length?{fields:$jscomp$destructuring$var578,ops:ops,as:$jscomp$destructuring$var579}:{})}:{})};FacetModel.prototype.facetSortFields=function(channel){var fieldDef=this.facet[channel];return fieldDef?isSortField(fieldDef.sort)?[facetSortFieldName(fieldDef,fieldDef.sort,{expr:"datum"})]:
vegaUtil.isArray(fieldDef.sort)?[sortArrayIndexField(fieldDef,channel,{expr:"datum"})]:[vgField(fieldDef,{expr:"datum"})]:[]};FacetModel.prototype.facetSortOrder=function(channel){return(channel=this.facet[channel])?(channel=channel.sort,[(isSortField(channel)?channel.order:!vegaUtil.isArray(channel)&&channel)||"ascending"]):[]};FacetModel.prototype.assembleLabelTitle=function(){var facet=this.facet,config=this.config;if(facet.facet)return assembleLabelTitle(facet.facet,"facet",config);for(var ORTHOGONAL_ORIENT=
{row:["top","bottom"],column:["left","right"]},$jscomp$iter$543=$jscomp.makeIterator(HEADER_CHANNELS),$jscomp$key$channel=$jscomp$iter$543.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$iter$543.next())if($jscomp$key$channel=$jscomp$key$channel.value,facet[$jscomp$key$channel]){var _facet$channel,labelOrient=getHeaderProperty("labelOrient",null===(_facet$channel=facet[$jscomp$key$channel])||void 0===_facet$channel?void 0:_facet$channel.header,config,$jscomp$key$channel);if(ORTHOGONAL_ORIENT[$jscomp$key$channel].includes(labelOrient))return assembleLabelTitle(facet[$jscomp$key$channel],
$jscomp$key$channel,config)}};FacetModel.prototype.assembleMarks=function(){var $jscomp$this=this,child=this.child,data=assembleFacetData(this.component.data.facetRoot),encodeEntry=child.assembleGroupEncodeEntry(!1),title=this.assembleLabelTitle()||child.assembleTitle(),style=child.assembleGroupStyle();return[Object.assign({},{name:this.getName("cell"),type:"group"},title?{title:title}:{},style?{style:style}:{},{from:{facet:this.assembleFacet()},sort:{field:FACET_CHANNELS.map(function(c){return $jscomp$this.facetSortFields(c)}).flat(),
order:FACET_CHANNELS.map(function(c){return $jscomp$this.facetSortOrder(c)}).flat()}},0<data.length?{data:data}:{},encodeEntry?{encode:{update:encodeEntry}}:{},child.assembleGroup(assembleFacetSignals(this,[])))]};FacetModel.prototype.getMapping=function(){return this.facet};var ConcatModel=function(spec,parent,parentGivenName,config){var _spec$resolve,_spec$resolve$axis,_spec$resolve2,_spec$resolve2$axis;var $jscomp$super$this=Model.call(this,spec,"concat",parent,parentGivenName,config,spec.resolve)||
this;_defineProperty($jscomp$super$this,"children",void 0);"shared"!==(null===(_spec$resolve=spec.resolve)||void 0===_spec$resolve?void 0:null===(_spec$resolve$axis=_spec$resolve.axis)||void 0===_spec$resolve$axis?void 0:_spec$resolve$axis.x)&&"shared"!==(null===(_spec$resolve2=spec.resolve)||void 0===_spec$resolve2?void 0:null===(_spec$resolve2$axis=_spec$resolve2.axis)||void 0===_spec$resolve2$axis?void 0:_spec$resolve2$axis.y)||warn("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).");
$jscomp$super$this.children=$jscomp$super$this.getChildren(spec).map(function(child,i){return buildModel(child,$jscomp$super$this,$jscomp$super$this.getName("concat_"+i),void 0,config)});return $jscomp$super$this};$jscomp.inherits(ConcatModel,Model);ConcatModel.prototype.parseData=function(){this.component.data=parseData(this);for(var $jscomp$iter$548=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$548.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$548.next())$jscomp$key$child.value.parseData()};
ConcatModel.prototype.parseSelections=function(){this.component.selection={};for(var $jscomp$iter$550=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$550.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$550.next()){$jscomp$key$child=$jscomp$key$child.value;$jscomp$key$child.parseSelections();for(var $jscomp$iter$549=$jscomp.makeIterator(keys$jscomp$0($jscomp$key$child.component.selection)),$jscomp$key$key=$jscomp$iter$549.next();!$jscomp$key$key.done;$jscomp$key$key=
$jscomp$iter$549.next())$jscomp$key$key=$jscomp$key$key.value,this.component.selection[$jscomp$key$key]=$jscomp$key$child.component.selection[$jscomp$key$key]}};ConcatModel.prototype.parseMarkGroup=function(){for(var $jscomp$iter$551=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$551.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$551.next())$jscomp$key$child.value.parseMarkGroup()};ConcatModel.prototype.parseAxesAndHeaders=function(){for(var $jscomp$iter$552=$jscomp.makeIterator(this.children),
$jscomp$key$child=$jscomp$iter$552.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$552.next())$jscomp$key$child.value.parseAxesAndHeaders()};ConcatModel.prototype.getChildren=function(spec){return"vconcat"in spec?spec.vconcat:"hconcat"in spec?spec.hconcat:spec.concat};ConcatModel.prototype.parseLayoutSize=function(){parseChildrenLayoutSize(this);var heightType=void 0===this.layout.columns?"height":"childHeight";parseNonUnitLayoutSizeForChannel(this,1===this.layout.columns?"width":"childWidth");
parseNonUnitLayoutSizeForChannel(this,heightType)};ConcatModel.prototype.parseAxisGroup=function(){return null};ConcatModel.prototype.assembleSelectionTopLevelSignals=function(signals){return this.children.reduce(function(sg,child){return child.assembleSelectionTopLevelSignals(sg)},signals)};ConcatModel.prototype.assembleSignals=function(){this.children.forEach(function(child){return child.assembleSignals()});return[]};ConcatModel.prototype.assembleLayoutSignals=function(){for(var layoutSignals=assembleLayoutSignals(this),
$jscomp$iter$553=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$553.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$553.next())layoutSignals.push.apply(layoutSignals,$jscomp.arrayFromIterable($jscomp$key$child.value.assembleLayoutSignals()));return layoutSignals};ConcatModel.prototype.assembleSelectionData=function(data){return this.children.reduce(function(db,child){return child.assembleSelectionData(db)},data)};ConcatModel.prototype.assembleMarks=function(){return this.children.map(function(child){var title=
child.assembleTitle(),style=child.assembleGroupStyle(),encodeEntry=child.assembleGroupEncodeEntry(!1);return Object.assign({},{type:"group",name:child.getName("group")},title?{title:title}:{},style?{style:style}:{},encodeEntry?{encode:{update:encodeEntry}}:{},child.assembleGroup())})};ConcatModel.prototype.assembleGroupStyle=function(){};ConcatModel.prototype.assembleDefaultLayout=function(){var columns=this.layout.columns;return Object.assign({},null!=columns?{columns:columns}:{},{bounds:"full",
align:"each"})};var AXIS_COMPONENT_PROPERTIES_INDEX=Object.assign({},{disable:1,gridScale:1,scale:1},COMMON_AXIS_PROPERTIES_INDEX,{labelExpr:1,encode:1}),AXIS_COMPONENT_PROPERTIES=keys$jscomp$0(AXIS_COMPONENT_PROPERTIES_INDEX),AxisComponent=function(explicit,implicit,mainExtracted){explicit=void 0===explicit?{}:explicit;implicit=void 0===implicit?{}:implicit;mainExtracted=void 0===mainExtracted?!1:mainExtracted;var $jscomp$super$this=Split.call(this)||this;$jscomp$super$this.explicit=explicit;$jscomp$super$this.implicit=
implicit;$jscomp$super$this.mainExtracted=mainExtracted;return $jscomp$super$this};$jscomp.inherits(AxisComponent,Split);AxisComponent.prototype.clone=function(){return new AxisComponent(duplicate(this.explicit),duplicate(this.implicit),this.mainExtracted)};AxisComponent.prototype.hasAxisPart=function(part){if("axis"===part)return!0;if("grid"===part||"title"===part)return!!this.get(part);part=this.get(part);return!(!1===part||null===part)};AxisComponent.prototype.hasOrientSignalRef=function(){return isSignalRef(this.explicit.orient)};
var OPPOSITE_ORIENT={bottom:"top",top:"bottom",left:"right",right:"left"},propsToAlwaysIncludeConfig=new Set("grid translate format formatType orient labelExpr tickCount position tickMinStep".split(" ")),markCompiler={arc:{vgMark:"arc",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),pointPosition("x",model,{defaultPos:"mid"}),pointPosition("y",model,{defaultPos:"mid"}),rectPosition(model,
"radius","arc"),rectPosition(model,"theta","arc"))}},area:{vgMark:"area",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),pointOrRangePosition("x",model,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===model.markDef.orient}),pointOrRangePosition("y",model,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===model.markDef.orient}),defined(model))}},
bar:{vgMark:"rect",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),rectPosition(model,"x","bar"),rectPosition(model,"y","bar"))}},circle:{vgMark:"symbol",encodeEntry:function(model){return encodeEntry(model,"circle")}},geoshape:{vgMark:"shape",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",
orient:"ignore",theta:"ignore"}))},postEncodingTransform:function(model){var shapeDef=model.encoding.shape;return[Object.assign({},{type:"geoshape",projection:model.projectionName()},shapeDef&&isFieldDef(shapeDef)&&"geojson"===shapeDef.type?{field:vgField(shapeDef,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),rectPosition(model,"x",
"image"),rectPosition(model,"y","image"),text$1(model,"url"))}},line:{vgMark:"line",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),pointPosition("x",model,{defaultPos:"mid"}),pointPosition("y",model,{defaultPos:"mid"}),nonPosition("size",model,{vgChannel:"strokeWidth"}),defined(model))}},point:{vgMark:"symbol",encodeEntry:function(model){return encodeEntry(model)}},rect:{vgMark:"rect",
encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),rectPosition(model,"x","rect"),rectPosition(model,"y","rect"))}},rule:{vgMark:"rule",encodeEntry:function(model){var orient=model.markDef.orient;return model.encoding.x||model.encoding.y||model.encoding.latitude||model.encoding.longitude?Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",
size:"ignore",theta:"ignore"}),pointOrRangePosition("x",model,{defaultPos:"horizontal"===orient?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==orient}),pointOrRangePosition("y",model,{defaultPos:"vertical"===orient?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==orient}),nonPosition("size",model,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:function(model){return encodeEntry(model,"square")}},text:{vgMark:"text",encodeEntry:function(model){var config=
model.config,encoding=model.encoding;return Object.assign({},baseEncodeEntry(model,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),pointPosition("x",model,{defaultPos:"mid"}),pointPosition("y",model,{defaultPos:"mid"}),text$1(model),nonPosition("size",model,{vgChannel:"fontSize"}),nonPosition("angle",model),valueIfDefined("align",align$jscomp$0(model.markDef,encoding,config)),valueIfDefined("baseline",baseline(model.markDef,encoding,config)),pointPosition("radius",
model,{defaultPos:null}),pointPosition("theta",model,{defaultPos:null}))}},tick:{vgMark:"rect",encodeEntry:function(model){var config=model.config,markDef=model.markDef,orient=markDef.orient,vgSizeChannel="horizontal"===orient?"width":"height";orient="horizontal"===orient?"height":"width";var $jscomp$compprop252={};return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),pointPosition("x",model,{defaultPos:"mid",
vgChannel:"xc"}),pointPosition("y",model,{defaultPos:"mid",vgChannel:"yc"}),nonPosition("size",model,{defaultValue:defaultSize(model),vgChannel:vgSizeChannel}),($jscomp$compprop252[orient]=signalOrValueRef(getMarkPropOrConfig("thickness",markDef,config)),$jscomp$compprop252))}},trail:{vgMark:"trail",encodeEntry:function(model){return Object.assign({},baseEncodeEntry(model,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),pointPosition("x",model,{defaultPos:"mid"}),
pointPosition("y",model,{defaultPos:"mid"}),nonPosition("size",model),defined(model))}}},UnitModel=function(spec,parent,parentGivenName,parentGivenSize,config){parentGivenSize=void 0===parentGivenSize?{}:parentGivenSize;parent=ModelWithField.call(this,spec,"unit",parent,parentGivenName,config,void 0,isFrameMixins(spec)?spec.view:void 0)||this;_defineProperty(parent,"markDef",void 0);_defineProperty(parent,"encoding",void 0);_defineProperty(parent,"specifiedScales",{});_defineProperty(parent,"stack",
void 0);_defineProperty(parent,"specifiedAxes",{});_defineProperty(parent,"specifiedLegends",{});_defineProperty(parent,"specifiedProjection",{});_defineProperty(parent,"selection",[]);_defineProperty(parent,"children",[]);parentGivenName=isMarkDef(spec.mark)?Object.assign({},spec.mark):{type:spec.mark};var mark=parentGivenName.type;void 0===parentGivenName.filled&&(parentGivenName.filled=defaultFilled(parentGivenName,config,{graticule:spec.data&&"graticule"in spec.data}));var encoding=parent.encoding=
initEncoding(spec.encoding||{},mark,parentGivenName.filled,config);parent.markDef=initMarkdef(parentGivenName,encoding,config);parent.size=initLayoutSize({encoding:encoding,size:isFrameMixins(spec)?Object.assign({},parentGivenSize,spec.width?{width:spec.width}:{},spec.height?{height:spec.height}:{}):parentGivenSize});parent.stack=stack$jscomp$0(mark,encoding);parent.specifiedScales=parent.initScales(mark,encoding);parent.specifiedAxes=parent.initAxes(encoding);parent.specifiedLegends=parent.initLegends(encoding);
parent.specifiedProjection=spec.projection;var $jscomp$nullish$tmp192;parent.selection=(null!=($jscomp$nullish$tmp192=spec.params)?$jscomp$nullish$tmp192:[]).filter(function(p){return!!p.select});return parent};$jscomp.inherits(UnitModel,ModelWithField);UnitModel.prototype.scaleDomain=function(channel){return(channel=this.specifiedScales[channel])?channel.domain:void 0};UnitModel.prototype.axis=function(channel){return this.specifiedAxes[channel]};UnitModel.prototype.legend=function(channel){return this.specifiedLegends[channel]};
UnitModel.prototype.initScales=function(mark,encoding){var $jscomp$this=this;return SCALE_CHANNELS.reduce(function(scales,channel){var fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]);if(fieldOrDatumDef){var $jscomp$nullish$tmp193;scales[channel]=$jscomp$this.initScale(null!=($jscomp$nullish$tmp193=fieldOrDatumDef.scale)?$jscomp$nullish$tmp193:{})}return scales},{})};UnitModel.prototype.initScale=function(scale){var domain=scale.domain,range=scale.range;scale=replaceExprRef(scale);vegaUtil.isArray(domain)&&
(scale.domain=domain.map(signalRefOrValue));vegaUtil.isArray(range)&&(scale.range=range.map(signalRefOrValue));return scale};UnitModel.prototype.initAxes=function(encoding){var $jscomp$this=this;return POSITION_SCALE_CHANNELS.reduce(function(_axis,channel){var channelDef=encoding[channel];if(isFieldOrDatumDef(channelDef)||"x"===channel&&isFieldOrDatumDef(encoding.x2)||"y"===channel&&isFieldOrDatumDef(encoding.y2))channelDef=isFieldOrDatumDef(channelDef)?channelDef.axis:void 0,_axis[channel]=channelDef?
$jscomp$this.initAxis(Object.assign({},channelDef)):channelDef;return _axis},{})};UnitModel.prototype.initAxis=function(axis){var props=keys$jscomp$0(axis),axisInternal={};props=$jscomp.makeIterator(props);for(var $jscomp$key$prop=props.next();!$jscomp$key$prop.done;$jscomp$key$prop=props.next()){$jscomp$key$prop=$jscomp$key$prop.value;var val=axis[$jscomp$key$prop];axisInternal[$jscomp$key$prop]=isConditionalAxisValue(val)?signalOrValueRefWithCondition(val):signalRefOrValue(val)}return axisInternal};
UnitModel.prototype.initLegends=function(encoding){return NONPOSITION_SCALE_CHANNELS.reduce(function(_legend,channel){var fieldOrDatumDef=getFieldOrDatumDef(encoding[channel]),JSCompiler_temp;if(JSCompiler_temp=fieldOrDatumDef)a:{switch(channel){case "color":case "fill":case "stroke":case "size":case "shape":case "opacity":case "strokeWidth":case "strokeDash":JSCompiler_temp=!0;break a;case "fillOpacity":case "strokeOpacity":case "angle":JSCompiler_temp=!1;break a}JSCompiler_temp=void 0}JSCompiler_temp&&
(fieldOrDatumDef=fieldOrDatumDef.legend,_legend[channel]=fieldOrDatumDef?replaceExprRef(fieldOrDatumDef):fieldOrDatumDef);return _legend},{})};UnitModel.prototype.parseData=function(){this.component.data=parseData(this)};UnitModel.prototype.parseLayoutSize=function(){for(var size=this.size,component=this.component,$jscomp$inline_4991=$jscomp.makeIterator(POSITION_SCALE_CHANNELS),$jscomp$key$channel=$jscomp$inline_4991.next();!$jscomp$key$channel.done;$jscomp$key$channel=$jscomp$inline_4991.next())if($jscomp$key$channel=
getSizeChannel$1($jscomp$key$channel.value),size[$jscomp$key$channel]){var specifiedSize=size[$jscomp$key$channel];component.layoutSize.set($jscomp$key$channel,isStep(specifiedSize)?"step":specifiedSize,!0)}else specifiedSize=defaultUnitSize(this,$jscomp$key$channel),component.layoutSize.set($jscomp$key$channel,specifiedSize,!1)};UnitModel.prototype.parseSelections=function(){var JSCompiler_temp_const=this.component;var selDefs=this.selection,selCmpts={},selectionConfig=this.config.selection;if(selDefs&&
selDefs.length){selDefs=$jscomp.makeIterator(selDefs);for(var $jscomp$key$def=selDefs.next();!$jscomp$key$def.done;$jscomp$key$def=selDefs.next()){$jscomp$key$def=$jscomp$key$def.value;var name$812=varName($jscomp$key$def.name),selDef=$jscomp$key$def.select,type$813=vegaUtil.isString(selDef)?selDef:selDef.type;selDef=vegaUtil.isObject(selDef)?duplicate(selDef):{type:type$813};var cfg=selectionConfig[type$813],key;for(key in cfg)if("fields"!==key&&"encodings"!==key&&("mark"===key&&(selDef[key]=Object.assign({},
cfg[key],selDef[key])),void 0===selDef[key]||!0===selDef[key])){var $jscomp$inline_5011=void 0;selDef[key]=null!=($jscomp$inline_5011=cfg[key])?$jscomp$inline_5011:selDef[key]}name$812=selCmpts[name$812]=Object.assign({},selDef,{name:name$812,type:type$813,init:$jscomp$key$def.value,bind:$jscomp$key$def.bind,events:vegaUtil.isString(selDef.on)?eventSelector(selDef.on,"scope"):vegaUtil.array(duplicate(selDef.on))});type$813=$jscomp.makeIterator(selectionCompilers);for(selDef=type$813.next();!selDef.done;selDef=
type$813.next())selDef=selDef.value,selDef.defined(name$812)&&selDef.parse&&selDef.parse(this,name$812,$jscomp$key$def)}}JSCompiler_temp_const.selection=selCmpts};UnitModel.prototype.parseMarkGroup=function(){this.component.mark=parseMarkGroups(this)};UnitModel.prototype.parseAxesAndHeaders=function(){this.component.axes=parseUnitAxes(this)};UnitModel.prototype.assembleSelectionTopLevelSignals=function(signals){return assembleTopLevelSignals(this,signals)};UnitModel.prototype.assembleSignals=function(){return[].concat($jscomp.arrayFromIterable(assembleAxisSignals(this)),
$jscomp.arrayFromIterable(assembleUnitSelectionSignals(this,[])))};UnitModel.prototype.assembleSelectionData=function(data){return assembleUnitSelectionData(this,data)};UnitModel.prototype.assembleLayout=function(){return null};UnitModel.prototype.assembleLayoutSignals=function(){return assembleLayoutSignals(this)};UnitModel.prototype.assembleMarks=function(){var $jscomp$nullish$tmp194,marks=null!=($jscomp$nullish$tmp194=this.component.mark)?$jscomp$nullish$tmp194:[];this.parent&&isLayerModel(this.parent)||
(marks=assembleUnitSelectionMarks(this,marks));return marks.map(this.correctDataNames)};UnitModel.prototype.assembleGroupStyle=function(){var style=(this.view||{}).style;if(void 0!==style)return style;if(this.encoding.x||this.encoding.y)return"cell"};UnitModel.prototype.getMapping=function(){return this.encoding};UnitModel.prototype.channelHasField=function(channel){return channelHasField(this.encoding,channel)};UnitModel.prototype.fieldDef=function(channel){return getFieldDef(this.encoding[channel])};
UnitModel.prototype.typedFieldDef=function(channel){channel=this.fieldDef(channel);return isTypedFieldDef(channel)?channel:null};$jscomp.global.Object.defineProperties(UnitModel.prototype,{hasProjection:{configurable:!0,enumerable:!0,get:function(){var encoding=this.encoding,isGeoShapeMark=this.mark===GEOSHAPE,hasGeoPosition=encoding&&GEOPOSITION_CHANNELS.some(function(channel){return isFieldOrDatumDef(encoding[channel])});return isGeoShapeMark||hasGeoPosition}},mark:{configurable:!0,enumerable:!0,
get:function(){return this.markDef.type}}});var LayerModel=function(spec,parent,parentGivenName,parentGivenSize,config){var $jscomp$super$this=Model.call(this,spec,"layer",parent,parentGivenName,config,spec.resolve,spec.view)||this;_defineProperty($jscomp$super$this,"children",void 0);var layoutSize=Object.assign({},parentGivenSize,spec.width?{width:spec.width}:{},spec.height?{height:spec.height}:{});$jscomp$super$this.children=spec.layer.map(function(layer,i){if("layer"in layer)return new LayerModel(layer,
$jscomp$super$this,$jscomp$super$this.getName("layer_"+i),layoutSize,config);if(isUnitSpec(layer))return new UnitModel(layer,$jscomp$super$this,$jscomp$super$this.getName("layer_"+i),layoutSize,config);throw Error(invalidSpec(layer));});return $jscomp$super$this};$jscomp.inherits(LayerModel,Model);LayerModel.prototype.parseData=function(){this.component.data=parseData(this);for(var $jscomp$iter$566=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$566.next();!$jscomp$key$child.done;$jscomp$key$child=
$jscomp$iter$566.next())$jscomp$key$child.value.parseData()};LayerModel.prototype.parseLayoutSize=function(){parseChildrenLayoutSize(this);parseNonUnitLayoutSizeForChannel(this,"width");parseNonUnitLayoutSizeForChannel(this,"height")};LayerModel.prototype.parseSelections=function(){this.component.selection={};for(var $jscomp$iter$568=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$568.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$568.next()){$jscomp$key$child=$jscomp$key$child.value;
$jscomp$key$child.parseSelections();for(var $jscomp$iter$567=$jscomp.makeIterator(keys$jscomp$0($jscomp$key$child.component.selection)),$jscomp$key$key=$jscomp$iter$567.next();!$jscomp$key$key.done;$jscomp$key$key=$jscomp$iter$567.next())$jscomp$key$key=$jscomp$key$key.value,this.component.selection[$jscomp$key$key]=$jscomp$key$child.component.selection[$jscomp$key$key]}};LayerModel.prototype.parseMarkGroup=function(){for(var $jscomp$iter$569=$jscomp.makeIterator(this.children),$jscomp$key$child=
$jscomp$iter$569.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$569.next())$jscomp$key$child.value.parseMarkGroup()};LayerModel.prototype.parseAxesAndHeaders=function(){var $jscomp$inline_5020=this.component,axes=$jscomp$inline_5020.axes;$jscomp$inline_5020=$jscomp$inline_5020.resolve;for(var axisCount={top:0,bottom:0,right:0,left:0},$jscomp$inline_5024=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$inline_5024.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_5024.next()){var child=
$jscomp$key$child.value;child.parseAxesAndHeaders();var $jscomp$inline_5027=$jscomp.makeIterator(keys$jscomp$0(child.component.axes));for($jscomp$key$child=$jscomp$inline_5027.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_5027.next())$jscomp$key$child=$jscomp$key$child.value,$jscomp$inline_5020.axis[$jscomp$key$child]=parseGuideResolve(this.component.resolve,$jscomp$key$child),"shared"===$jscomp$inline_5020.axis[$jscomp$key$child]&&(axes[$jscomp$key$child]=mergeAxisComponents(axes[$jscomp$key$child],
child.component.axes[$jscomp$key$child]),axes[$jscomp$key$child]||($jscomp$inline_5020.axis[$jscomp$key$child]="independent",delete axes[$jscomp$key$child]))}$jscomp$inline_5024=$jscomp.makeIterator(POSITION_SCALE_CHANNELS);for($jscomp$key$child=$jscomp$inline_5024.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$inline_5024.next()){child=$jscomp$key$child.value;$jscomp$inline_5027=$jscomp.makeIterator(this.children);for($jscomp$key$child=$jscomp$inline_5027.next();!$jscomp$key$child.done;$jscomp$key$child=
$jscomp$inline_5027.next())if($jscomp$key$child=$jscomp$key$child.value,$jscomp$key$child.component.axes[child]){if("independent"===$jscomp$inline_5020.axis[child]){var $jscomp$inline_5034=void 0;axes[child]=(null!=($jscomp$inline_5034=axes[child])?$jscomp$inline_5034:[]).concat($jscomp$key$child.component.axes[child]);$jscomp$inline_5034=$jscomp.makeIterator($jscomp$key$child.component.axes[child]);for(var $jscomp$key$axisComponent=$jscomp$inline_5034.next();!$jscomp$key$axisComponent.done;$jscomp$key$axisComponent=
$jscomp$inline_5034.next()){$jscomp$key$axisComponent=$jscomp$key$axisComponent.value;var $jscomp$inline_5038=$jscomp$key$axisComponent.getWithExplicit("orient"),orient$899=$jscomp$inline_5038.value;$jscomp$inline_5038=$jscomp$inline_5038.explicit;isSignalRef(orient$899)||(0<axisCount[orient$899]&&!$jscomp$inline_5038&&($jscomp$inline_5038=OPPOSITE_ORIENT[orient$899],axisCount[orient$899]>axisCount[$jscomp$inline_5038]&&$jscomp$key$axisComponent.set("orient",$jscomp$inline_5038,!1)),axisCount[orient$899]++)}}delete $jscomp$key$child.component.axes[child]}if("independent"===
$jscomp$inline_5020.axis[child]&&axes[child]&&1<axes[child].length)for(child=$jscomp.makeIterator(axes[child]),$jscomp$inline_5027=child.next();!$jscomp$inline_5027.done;$jscomp$inline_5027=child.next())$jscomp$inline_5027=$jscomp$inline_5027.value,$jscomp$inline_5027.get("grid")&&!$jscomp$inline_5027.explicit.grid&&($jscomp$inline_5027.implicit.grid=!1)}};LayerModel.prototype.assembleSelectionTopLevelSignals=function(signals){return this.children.reduce(function(sg,child){return child.assembleSelectionTopLevelSignals(sg)},
signals)};LayerModel.prototype.assembleSignals=function(){return this.children.reduce(function(signals,child){return signals.concat(child.assembleSignals())},assembleAxisSignals(this))};LayerModel.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(signals,child){return signals.concat(child.assembleLayoutSignals())},assembleLayoutSignals(this))};LayerModel.prototype.assembleSelectionData=function(data){return this.children.reduce(function(db,child){return child.assembleSelectionData(db)},
data)};LayerModel.prototype.assembleGroupStyle=function(){for(var uniqueStyles=new Set,$jscomp$iter$571=$jscomp.makeIterator(this.children),$jscomp$key$child=$jscomp$iter$571.next();!$jscomp$key$child.done;$jscomp$key$child=$jscomp$iter$571.next()){$jscomp$key$child=$jscomp.makeIterator(vegaUtil.array($jscomp$key$child.value.assembleGroupStyle()));for(var $jscomp$key$style=$jscomp$key$child.next();!$jscomp$key$style.done;$jscomp$key$style=$jscomp$key$child.next())uniqueStyles.add($jscomp$key$style.value)}uniqueStyles=
Array.from(uniqueStyles);return 1<uniqueStyles.length?uniqueStyles:1===uniqueStyles.length?uniqueStyles[0]:void 0};LayerModel.prototype.assembleTitle=function(){var title=Model.prototype.assembleTitle.call(this);if(title)return title;var $jscomp$iter$572=$jscomp.makeIterator(this.children);for(title=$jscomp$iter$572.next();!title.done;title=$jscomp$iter$572.next())if(title=title.value.assembleTitle())return title};LayerModel.prototype.assembleLayout=function(){return null};LayerModel.prototype.assembleMarks=
function(){return assembleLayerSelectionMarks(this,this.children.flatMap(function(child){return child.assembleMarks()}))};LayerModel.prototype.assembleLegends=function(){return this.children.reduce(function(legends,child){return legends.concat(child.assembleLegends())},assembleLegends(this))};exports.accessPathDepth=accessPathDepth;exports.accessPathWithDatum=accessPathWithDatum;exports.compile=function(inputSpec,opt){opt=void 0===opt?{}:opt;opt.logger&&(current=opt.logger);opt.fieldTitle&&(titleFormatter=
opt.fieldTitle);try{var config=initConfig(vegaUtil.mergeConfig(opt.config,inputSpec.config)),spec=normalize$jscomp$0(inputSpec,config),model=buildModel(spec,null,"",void 0,config);model.parse();var data=model.component.data;checkLinks(data.sources);for(var firstPassCounter=0,secondPassCounter=0,i=0;5>i&&optimizationDataflowHelper(data,model,!0);i++)firstPassCounter++;data.sources.map(moveFacetDown);for(i=0;5>i&&optimizationDataflowHelper(data,model,!1);i++)secondPassCounter++;checkLinks(data.sources);
5===Math.max(firstPassCounter,secondPassCounter)&&warn("Maximum optimization runs(5) reached.");var autosize=spec.autosize,width=model.component.layoutSize.get("width"),height=model.component.layoutSize.get("height");void 0===autosize?(autosize={type:"pad"},model.hasAxisOrientSignalRef()&&(autosize.resize=!0)):vegaUtil.isString(autosize)&&(autosize={type:autosize});var JSCompiler_temp;if(JSCompiler_temp=width&&height){var autoSizeType=autosize.type;JSCompiler_temp="fit"===autoSizeType||"fit-x"===
autoSizeType||"fit-y"===autoSizeType}if(JSCompiler_temp)if("step"===width&&"step"===height)warn(droppingFit()),autosize.type="pad";else if("step"===width||"step"===height){firstPassCounter="step"===width?"width":"height";warn(droppingFit(getPositionScaleChannel(firstPassCounter)));data=autosize;var JSCompiler_inline_result=(firstPassCounter="width"===firstPassCounter?"height":"width","fit-"+getPositionScaleChannel(firstPassCounter));data.type=JSCompiler_inline_result}var JSCompiler_inline_result$jscomp$0=
Object.assign({},1===keys$jscomp$0(autosize).length&&autosize.type?"pad"===autosize.type?{}:{autosize:autosize.type}:{autosize:autosize},extractTopLevelProperties(config,!1),extractTopLevelProperties(inputSpec,!0));return{spec:assembleTopLevelModel(model,JSCompiler_inline_result$jscomp$0,inputSpec.datasets,inputSpec.usermeta),normalized:spec}}finally{opt.logger&&(current=main),opt.fieldTitle&&(titleFormatter=defaultTitleFormatter)}};exports.contains=contains;exports.deepEqual=deepEqual;exports.deleteNestedProperty=
deleteNestedProperty;exports.duplicate=duplicate;exports.entries=entries$1;exports.every=every;exports.fieldIntersection=fieldIntersection;exports.flatAccessWithDatum=flatAccessWithDatum;exports.getFirstDefined=getFirstDefined;exports.hasIntersection=hasIntersection;exports.hash=hash;exports.internalField=internalField;exports.isBoolean=isBoolean;exports.isEmpty=isEmpty;exports.isEqual=function(dict,other){var dictKeys=keys$jscomp$0(dict),otherKeys=keys$jscomp$0(other);if(dictKeys.length!==otherKeys.length)return!1;
dictKeys=$jscomp.makeIterator(dictKeys);for(otherKeys=dictKeys.next();!otherKeys.done;otherKeys=dictKeys.next())if(otherKeys=otherKeys.value,dict[otherKeys]!==other[otherKeys])return!1;return!0};exports.isInternalField=isInternalField;exports.isNullOrFalse=isNullOrFalse;exports.isNumeric=isNumeric;exports.keys=keys$jscomp$0;exports.logicalExpr=logicalExpr;exports.mergeDeep=mergeDeep;exports.normalize=normalize$jscomp$0;exports.normalizeAngle=normalizeAngle;exports.omit=omit;exports.pick=pick;exports.prefixGenerator=
prefixGenerator;exports.removePathFromField=removePathFromField;exports.replaceAll=replaceAll;exports.replacePathInField=replacePathInField;exports.resetIdCounter=function(){idCounter=42};exports.setEqual=setEqual;exports.some=some;exports.stringify=stringify;exports.titleCase=titleCase;exports.unique=unique;exports.uniqueId=uniqueId;exports.vals=vals$jscomp$0;exports.varName=varName;exports.version="5.1.1";Object.defineProperty(exports,"__esModule",{value:!0})})}
//# sourceMappingURL=module$node_modules$vega_lite$build$vega_lite.js.map
