shadow$provide.module$node_modules$vega_dataflow$build$vega_dataflow=function(global$jscomp$0,require,module,exports$jscomp$0){(function(global,factory){"object"===typeof exports$jscomp$0&&"undefined"!==typeof module?factory(exports$jscomp$0,require("module$node_modules$vega_util$build$vega_util"),require("module$node_modules$vega_loader$build$vega_loader_browser"),require("module$node_modules$vega_format$build$vega_format")):"function"===typeof define&&define.amd?define(["exports","vega-util","vega-loader",
"vega-format"],factory):(global="undefined"!==typeof globalThis?globalThis:global||self,factory(global.vega={},global.vega,global.vega,global.vega))})(this,function(exports,vegaUtil,vegaLoader,vegaFormat){function UniqueList(idFunc){var $=idFunc||vegaUtil.identity,list=[],ids={};list.add=function(_){var id=$(_);ids[id]||(ids[id]=1,list.push(_));return list};list.remove=function(_){var id=$(_);ids[id]&&(ids[id]=0,_=list.indexOf(_),0<=_&&list.splice(_,1));return list};return list}function asyncCallback(df,
callback){var err;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){if(1==$jscomp$generator$context.nextAddress)return $jscomp$generator$context.setCatchFinallyBlocks(2),$jscomp$generator$context.yield(callback(df),4);if(2!=$jscomp$generator$context.nextAddress)return $jscomp$generator$context.leaveTryBlock(0);err=$jscomp$generator$context.enterCatchBlock();df.error(err);$jscomp$generator$context.jumpToEnd()})}function ingest$1(datum){datum=datum===Object(datum)?
datum:{data:datum};if(!datum[TUPLE_ID_KEY]){var id=TUPLE_ID++;datum[TUPLE_ID_KEY]=id}return datum}function rederive(t,d){for(var k in t)d[k]=t[k];return d}function isChangeSet(v){return v&&v.constructor===changeset}function changeset(){var add=[],rem=[],mod=[],remp=[],modp=[],clean=null,reflow=!1;return{constructor:changeset,insert:function(t){t=vegaUtil.array(t);for(var n=t.length,i=0;i<n;++i)add.push(t[i]);return this},remove:function(t){var a=vegaUtil.isFunction(t)?remp:rem;t=vegaUtil.array(t);
for(var n=t.length,i=0;i<n;++i)a.push(t[i]);return this},modify:function(t,field,value){field={field:field,value:vegaUtil.constant(value)};vegaUtil.isFunction(t)?(field.filter=t,modp.push(field)):(field.tuple=t,mod.push(field));return this},encode:function(t,set){vegaUtil.isFunction(t)?modp.push({filter:t,field:set}):mod.push({tuple:t,field:set});return this},clean:function(value){clean=value;return this},reflow:function(){reflow=!0;return this},pulse:function(pulse,tuples){function modify(t,f,v){v?
t[f]=v(t):pulse.encode=f;reflow||(out[t[TUPLE_ID_KEY]]=t)}var cur={},out={},n;var i=0;for(n=tuples.length;i<n;++i)cur[tuples[i][TUPLE_ID_KEY]]=1;i=0;for(n=rem.length;i<n;++i){var t$jscomp$0=rem[i];cur[t$jscomp$0[TUPLE_ID_KEY]]=-1}i=0;for(n=remp.length;i<n;++i){var f$jscomp$0=remp[i];tuples.forEach(function(t){f$jscomp$0(t)&&(cur[t[TUPLE_ID_KEY]]=-1)})}i=0;for(n=add.length;i<n;++i){t$jscomp$0=add[i];var id=t$jscomp$0[TUPLE_ID_KEY];cur[id]?cur[id]=1:pulse.add.push(ingest$1(add[i]))}i=0;for(n=tuples.length;i<
n;++i)t$jscomp$0=tuples[i],0>cur[t$jscomp$0[TUPLE_ID_KEY]]&&pulse.rem.push(t$jscomp$0);i=0;for(n=mod.length;i<n;++i){var m=mod[i];t$jscomp$0=m.tuple;f$jscomp$0=m.field;id=cur[t$jscomp$0[TUPLE_ID_KEY]];0<id&&(modify(t$jscomp$0,f$jscomp$0,m.value),pulse.modifies(f$jscomp$0))}i=0;for(n=modp.length;i<n;++i)m=modp[i],f$jscomp$0=m.filter,tuples.forEach(function(t){f$jscomp$0(t)&&0<cur[t[TUPLE_ID_KEY]]&&modify(t,m.field,m.value)}),pulse.modifies(m.field);if(reflow)pulse.mod=rem.length||remp.length?tuples.filter(function(t){return 0<
cur[t[TUPLE_ID_KEY]]}):tuples.slice();else for(id in out)pulse.mod.push(out[id]);(clean||null==clean&&(rem.length||remp.length))&&pulse.clean(!0);return pulse}}}function Parameters(){Object.defineProperty(this,"_:mod:_",{writable:!0,value:{}})}function Operator(init,update,params,react){this.id=++OP_ID;this.value=init;this.qrank=this.rank=this.stamp=-1;this.flags=0;update&&(this._update=update);params&&this.parameters(params,react)}function flag(bit){return function(state){var f=this.flags;if(0===
arguments.length)return!!(f&bit);this.flags=state?f|bit:f&~bit;return this}}function EventStream(filter,apply,receive){this.id=++STREAM_ID;this.value=null;receive&&(this.receive=receive);filter&&(this._filter=filter);apply&&(this._apply=apply)}function stream$jscomp$0(filter,apply,receive){return new EventStream(filter,apply,receive)}function loadPending(df){var accept,pending=new Promise(function(a){return accept=a});pending.requests=0;pending.done=function(){0===--pending.requests&&(df._pending=
null,accept(df))};return df._pending=pending}function onStream(df,stream,target,update,params,options){var opt=vegaUtil.extend({},options,SKIP);vegaUtil.isFunction(target)||(target=vegaUtil.constant(target));if(void 0===update)params=function(e){return df.touch(target(e))};else if(vegaUtil.isFunction(update)){var op=new Operator(null,update,params,!1);params=function(e){op.evaluate(e);e=target(e);var v=op.value;isChangeSet(v)?df.pulse(e,v,options):df.update(e,v,opt)}}else params=function(e){return df.update(target(e),
update,opt)};stream.apply(params)}function onOperator(df,source,target,update,params,options){void 0===update?source.targets().add(target):(options=options||{},update=new Operator(null,updater(target,update),params,!1),update.modified(options.force),update.rank=source.rank,source.targets().add(update),target&&(update.skip(!0),update.value=target.value,update.targets().add(target),df.connect(target,[update])))}function updater(target,update){update=vegaUtil.isFunction(update)?update:vegaUtil.constant(update);
return target?function(_,pulse){_=update(_,pulse);target.skip()||(target.skip(_!==this.value).value=_);return _}:update}function Pulse(dataflow,stamp,encode){this.dataflow=dataflow;this.stamp=null==stamp?-1:stamp;this.add=[];this.rem=[];this.mod=[];this.fields=null;this.encode=encode||null}function materialize(data,filter){var out=[];vegaUtil.visitArray(data,filter,function(_){return out.push(_)});return out}function filter$jscomp$0(pulse,flags){var map={};pulse.visit(flags,function(t){map[t[TUPLE_ID_KEY]]=
1});return function(t){return map[t[TUPLE_ID_KEY]]?null:t}}function addFilter(a,b){return a?function(t,i){return a(t,i)&&b(t,i)}:b}function MultiPulse(dataflow,stamp,pulses,encode){var n=pulses.length,c=0;this.dataflow=dataflow;this.stamp=stamp;this.fields=null;this.encode=encode||null;this.pulses=pulses;for(dataflow=0;dataflow<n;++dataflow)if(encode=pulses[dataflow],encode.stamp===stamp){if(encode.fields){var hash=this.fields||(this.fields={}),f;for(f in encode.fields)hash[f]=1}encode.changed(this.ADD)&&
(c|=this.ADD);encode.changed(this.REM)&&(c|=this.REM);encode.changed(this.MOD)&&(c|=this.MOD)}this.changes=c}function reentrant(df){df.error("Dataflow already running. Use runAsync() to chain invocations.");return df}function singlePulse(p,s){if(s&&s.stamp===p.stamp)return s;p=p.fork();s&&s!==StopPropagation&&(p.source=s.source);return p}function Heap(cmp){var nodes=[];return{clear:function(){return nodes=[]},size:function(){return nodes.length},peek:function(){return nodes[0]},push:function(x){nodes.push(x);
return siftdown(nodes,0,nodes.length-1,cmp)},pop:function(){var last=nodes.pop();if(nodes.length){var item=nodes[0];nodes[0]=last;last=nodes;for(var idx=0,start=idx,end=last.length,item$jscomp$0=last[idx],cidx=(idx<<1)+1,ridx;cidx<end;)ridx=cidx+1,ridx<end&&0<=cmp(last[cidx],last[ridx])&&(cidx=ridx),last[idx]=last[cidx],idx=cidx,cidx=(idx<<1)+1;last[idx]=item$jscomp$0;siftdown(last,start,idx,cmp)}else item=last;return item}}}function siftdown(array,start,idx,cmp){for(var parent,pidx,item=array[idx];idx>
start;)if(pidx=idx-1>>1,parent=array[pidx],0>cmp(item,parent))array[idx]=parent,idx=pidx;else break;return array[idx]=item}function Dataflow(){this.logger(vegaUtil.logger());this.logLevel(vegaUtil.Error);this._rank=this._clock=0;this._locale=vegaFormat.defaultLocale();try{this._loader=vegaLoader.loader()}catch(e){}this._touched=UniqueList(vegaUtil.id);this._input={};this._pulse=null;this._heap=Heap(function(a,b){return a.qrank-b.qrank});this._postrun=[]}function logMethod(method){return function(){return this._log[method].apply(this,
arguments)}}function Transform(init,params){Operator.call(this,init,null,params)}function transform(type){type=type&&type.toLowerCase();return vegaUtil.hasOwnProperty(transforms,type)?transforms[type]:null}var TUPLE_ID_KEY=Symbol("vega_id"),TUPLE_ID=1;Parameters.prototype={set:function(name,index,value,force){var v=this[name],mod=this["_:mod:_"];if(null!=index&&0<=index){if(v[index]!==value||force)v[index]=value,mod[index+":"+name]=-1,mod[name]=-1}else if(v!==value||force)this[name]=value,mod[name]=
vegaUtil.isArray(value)?1+value.length:-1;return this},modified:function(name,index){var mod=this["_:mod:_"];if(!arguments.length){for(var k in mod)if(mod[k])return!0;return!1}if(vegaUtil.isArray(name)){for(k=0;k<name.length;++k)if(mod[name[k]])return!0;return!1}return null!=index&&0<=index?index+1<mod[name]||!!mod[index+":"+name]:!!mod[name]},clear:function(){this["_:mod:_"]={};return this}};var OP_ID=0,NO_PARAMS=new Parameters;Operator.prototype={targets:function(){return this._targets||(this._targets=
UniqueList(vegaUtil.id))},set:function(value){return this.value!==value?(this.value=value,1):0},skip:flag(1),modified:flag(2),parameters:function(params,react,initonly){var $jscomp$this=this;react=!1!==react;var argval=this._argval=this._argval||new Parameters,argops=this._argops=this._argops||[],deps=[],name$jscomp$0,n,i,add=function(name,index,value){value instanceof Operator?(value!==$jscomp$this&&(react&&value.targets().add($jscomp$this),deps.push(value)),argops.push({op:value,name:name,index:index})):
argval.set(name,index,value)};for(name$jscomp$0 in params){var value$jscomp$0=params[name$jscomp$0];if("pulse"===name$jscomp$0)vegaUtil.array(value$jscomp$0).forEach(function(op){op instanceof Operator?op!==$jscomp$this&&(op.targets().add($jscomp$this),deps.push(op)):vegaUtil.error("Pulse parameters must be operator instances.")}),this.source=value$jscomp$0;else if(vegaUtil.isArray(value$jscomp$0))for(argval.set(name$jscomp$0,-1,Array(n=value$jscomp$0.length)),i=0;i<n;++i)add(name$jscomp$0,i,value$jscomp$0[i]);
else add(name$jscomp$0,-1,value$jscomp$0)}this.marshall().clear();initonly&&(argops.initonly=!0);return deps},marshall:function(stamp){var argval=this._argval||NO_PARAMS,argops=this._argops,i;if(argops){var n=argops.length;for(i=0;i<n;++i){var item=argops[i];var op=item.op;var mod=op.modified()&&op.stamp===stamp;argval.set(item.name,item.index,op.value,mod)}if(argops.initonly){for(i=0;i<n;++i)item=argops[i],item.op.targets().remove(this);this._update=this._argops=null}}return argval},detach:function(){var argops=
this._argops,n;if(argops){var i=0;for(n=argops.length;i<n;++i){var item=argops[i];item=item.op;item._targets&&item._targets.remove(this)}}this.source=this.pulse=null},evaluate:function(pulse){var update=this._update;if(update){var params=this.marshall(pulse.stamp);update=update.call(this,params,pulse);params.clear();if(update!==this.value)this.value=update;else if(!this.modified())return pulse.StopPropagation}},run:function(pulse){if(pulse.stamp<this.stamp)return pulse.StopPropagation;if(this.skip()){this.skip(!1);
var rv=0}else rv=this.evaluate(pulse);return this.pulse=rv||pulse}};var STREAM_ID=0;EventStream.prototype={_filter:vegaUtil.truthy,_apply:vegaUtil.identity,targets:function(){return this._targets||(this._targets=UniqueList(vegaUtil.id))},consume:function(_){if(!arguments.length)return!!this._consume;this._consume=!!_;return this},receive:function(evt){if(this._filter(evt)){for(var val=this.value=this._apply(evt),trg=this._targets,n=trg?trg.length:0,i=0;i<n;++i)trg[i].receive(val);this._consume&&(evt.preventDefault(),
evt.stopPropagation())}},filter:function(filter){filter=stream$jscomp$0(filter);this.targets().add(filter);return filter},apply:function(apply){apply=stream$jscomp$0(null,apply);this.targets().add(apply);return apply},merge:function(){var s=stream$jscomp$0();this.targets().add(s);for(var i=0,n=arguments.length;i<n;++i)arguments[i].targets().add(s);return s},throttle:function(pause){var t=-1;return this.filter(function(){var now=Date.now();return now-t>pause?(t=now,1):0})},debounce:function(delay){var s=
stream$jscomp$0();this.targets().add(stream$jscomp$0(null,null,vegaUtil.debounce(delay,function(e){var df=e.dataflow;s.receive(e);df&&df.run&&df.run()})));return s},between:function(a,b){var active=!1;a.targets().add(stream$jscomp$0(null,null,function(){return active=!0}));b.targets().add(stream$jscomp$0(null,null,function(){return active=!1}));return this.filter(function(){return active})},detach:function(){this._filter=vegaUtil.truthy;this._targets=null}};var SKIP={skip:!0},StopPropagation={};Pulse.prototype=
{StopPropagation:StopPropagation,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork:function(flags){return(new Pulse(this.dataflow)).init(this,flags)},clone:function(){var p=this.fork(7);p.add=p.add.slice();p.rem=p.rem.slice();p.mod=p.mod.slice();p.source&&(p.source=p.source.slice());return p.materialize(23)},addAll:function(){var p=this;p.source&&p.add!==p.rem&&(p.rem.length||p.source.length!==p.add.length)&&(p=(new Pulse(this.dataflow)).init(this),p.add=
p.source,p.rem=[]);return p},init:function(src,flags){this.stamp=src.stamp;this.encode=src.encode;!src.fields||flags&64||(this.fields=src.fields);flags&1?(this.addF=src.addF,this.add=src.add):(this.addF=null,this.add=[]);flags&2?(this.remF=src.remF,this.rem=src.rem):(this.remF=null,this.rem=[]);flags&4?(this.modF=src.modF,this.mod=src.mod):(this.modF=null,this.mod=[]);flags&32?this.source=this.srcF=null:(this.srcF=src.srcF,this.source=src.source,src.cleans&&(this.cleans=src.cleans));return this},
runAfter:function(func){this.dataflow.runAfter(func)},changed:function(flags){flags=flags||7;return flags&1&&this.add.length||flags&2&&this.rem.length||flags&4&&this.mod.length},reflow:function(fork){if(fork)return this.fork(7).reflow();fork=this.add.length;var src=this.source&&this.source.length;src&&src!==fork&&(this.mod=this.source,fork&&this.filter(4,filter$jscomp$0(this,1)));return this},clean:function(value){return arguments.length?(this.cleans=!!value,this):this.cleans},modifies:function(_){var hash=
this.fields||(this.fields={});vegaUtil.isArray(_)?_.forEach(function(f){return hash[f]=!0}):hash[_]=!0;return this},modified:function(_,nomod){var fields=this.fields;return(nomod||this.mod.length)&&fields?arguments.length?vegaUtil.isArray(_)?_.some(function(f){return fields[f]}):fields[_]:!!fields:!1},filter:function(flags,filter){flags&1&&(this.addF=addFilter(this.addF,filter));flags&2&&(this.remF=addFilter(this.remF,filter));flags&4&&(this.modF=addFilter(this.modF,filter));flags&16&&(this.srcF=
addFilter(this.srcF,filter));return this},materialize:function(flags){flags=flags||7;flags&1&&this.addF&&(this.add=materialize(this.add,this.addF),this.addF=null);flags&2&&this.remF&&(this.rem=materialize(this.rem,this.remF),this.remF=null);flags&4&&this.modF&&(this.mod=materialize(this.mod,this.modF),this.modF=null);flags&16&&this.srcF&&(this.source=this.source.filter(this.srcF),this.srcF=null);return this},visit:function(flags,visitor){if(flags&16)return vegaUtil.visitArray(this.source,this.srcF,
visitor),this;flags&1&&vegaUtil.visitArray(this.add,this.addF,visitor);flags&2&&vegaUtil.visitArray(this.rem,this.remF,visitor);flags&4&&vegaUtil.visitArray(this.mod,this.modF,visitor);var src=this.source;flags&8&&src&&(flags=this.add.length+this.mod.length,flags!==src.length&&(flags?vegaUtil.visitArray(src,filter$jscomp$0(this,5),visitor):vegaUtil.visitArray(src,this.srcF,visitor)));return this}};vegaUtil.inherits(MultiPulse,Pulse,{fork:function(flags){var p=(new Pulse(this.dataflow)).init(this,
flags&this.NO_FIELDS);void 0!==flags&&(flags&p.ADD&&this.visit(p.ADD,function(t){return p.add.push(t)}),flags&p.REM&&this.visit(p.REM,function(t){return p.rem.push(t)}),flags&p.MOD&&this.visit(p.MOD,function(t){return p.mod.push(t)}));return p},changed:function(flags){return this.changes&flags},modified:function(_){var fields=this.fields;return fields&&this.changes&this.MOD?vegaUtil.isArray(_)?_.some(function(f){return fields[f]}):fields[_]:0},filter:function(){vegaUtil.error("MultiPulse does not support filtering.")},
materialize:function(){vegaUtil.error("MultiPulse does not support materialization.")},visit:function(flags,visitor){var pulses=this.pulses,n=pulses.length,i=0;if(flags&this.SOURCE)for(;i<n;++i)pulses[i].visit(flags,visitor);else for(;i<n;++i)pulses[i].stamp===this.stamp&&pulses[i].visit(flags,visitor);return this}});var NO_OPT={skip:!1,force:!1};Dataflow.prototype={stamp:function(){return this._clock},loader:function(_){return arguments.length?(this._loader=_,this):this._loader},locale:function(_){return arguments.length?
(this._locale=_,this):this._locale},logger:function(logger){return arguments.length?(this._log=logger,this):this._log},error:logMethod("error"),warn:logMethod("warn"),info:logMethod("info"),debug:logMethod("debug"),logLevel:logMethod("level"),cleanThreshold:1E4,add:function(init,update,params,react){var shift=1;init instanceof Operator||(init&&init.prototype instanceof Operator?init=new init:vegaUtil.isFunction(init)?init=new Operator(null,init):(shift=0,init=new Operator(init,update)));this.rank(init);
shift&&(react=params,params=update);params&&this.connect(init,init.parameters(params,react));this.touch(init);return init},connect:function(target,sources){for(var targetRank=target.rank,n=sources.length,i=0;i<n;++i)if(targetRank<sources[i].rank){this.rerank(target);break}},rank:function(op){op.rank=++this._rank},rerank:function(op){for(var queue=[op],cur,list,i;queue.length;)if(this.rank(cur=queue.pop()),list=cur._targets)for(i=list.length;0<=--i;)queue.push(cur=list[i]),cur===op&&vegaUtil.error("Cycle detected in dataflow graph.")},
pulse:function(op,changeset,options){this.touch(op,options||NO_OPT);options=new Pulse(this,this._clock+(this._pulse?0:1));var t=op.pulse&&op.pulse.source||[];options.target=op;this._input[op.id]=changeset.pulse(options,t);return this},touch:function(op,options){options=options||NO_OPT;this._pulse?this._enqueue(op):this._touched.add(op);options.skip&&op.skip(!0);return this},update:function(op,value,options){options=options||NO_OPT;(op.set(value)||options.force)&&this.touch(op,options);return this},
changeset:changeset,ingest:function(target,data,format){data=this.parse(data,format);return this.pulse(target,this.changeset().insert(data))},parse:function(data,format){var locale=this.locale();return vegaLoader.read(data,format,locale.timeParse,locale.utcParse)},preload:function(target,url,format){var $jscomp$async$this=this,df,pending,res;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){if(1==$jscomp$generator$context.nextAddress)return df=$jscomp$async$this,
pending=df._pending||loadPending(df),pending.requests+=1,$jscomp$generator$context.yield(df.request(url,format),2);res=$jscomp$generator$context.yieldResult;df.pulse(target,df.changeset().remove(vegaUtil.truthy).insert(res.data||[]));pending.done();return $jscomp$generator$context.return(res)})},request:function(url,format){var $jscomp$async$this=this,df,status,data,err$652;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){switch($jscomp$generator$context.nextAddress){case 1:return df=
$jscomp$async$this,status=0,$jscomp$generator$context.setCatchFinallyBlocks(2),$jscomp$generator$context.yield(df.loader().load(url,{context:"dataflow",response:vegaLoader.responseType(format&&format.type)}),4);case 4:data=$jscomp$generator$context.yieldResult;try{data=df.parse(data,format)}catch(err){status=-2,df.warn("Data ingestion failed",url,err)}$jscomp$generator$context.leaveTryBlock(3);break;case 2:err$652=$jscomp$generator$context.enterCatchBlock(),status=-1,df.warn("Loading failed",url,
err$652);case 3:return $jscomp$generator$context.return({data:data,status:status})}})},events:function(source,type,filter,apply){var df=this,s=stream$jscomp$0(filter,apply);filter=function(e){e.dataflow=df;try{s.receive(e)}catch(error){df.error(error)}finally{df.run()}};source="string"===typeof source&&"undefined"!==typeof document?document.querySelectorAll(source):vegaUtil.array(source);apply=source.length;for(var i=0;i<apply;++i)source[i].addEventListener(type,filter);return s},on:function(source,
target,update,params,options){(source instanceof Operator?onOperator:onStream)(this,source,target,update,params,options);return this},evaluate:function(encode,prerun,postrun){var $jscomp$async$this=this,df,async,stamp,count,op$jscomp$0,next,error,err,pr,i;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){switch($jscomp$generator$context.nextAddress){case 1:df=$jscomp$async$this;async=[];if(df._pulse)return $jscomp$generator$context.return(reentrant(df));if(!df._pending){$jscomp$generator$context.jumpTo(2);
break}return $jscomp$generator$context.yield(df._pending,2);case 2:if(!prerun){$jscomp$generator$context.jumpTo(4);break}return $jscomp$generator$context.yield(asyncCallback(df,prerun),4);case 4:if(!df._touched.length)return df.debug("Dataflow invoked, but nothing to do."),$jscomp$generator$context.return(df);stamp=++df._clock;df._pulse=new Pulse(df,stamp,encode);df._touched.forEach(function(op){return df._enqueue(op,!0)});df._touched=UniqueList(vegaUtil.id);count=0;$jscomp$generator$context.setCatchFinallyBlocks(6);
case 8:if(!(0<df._heap.size())){$jscomp$generator$context.leaveTryBlock(7);break}op$jscomp$0=df._heap.pop();if(op$jscomp$0.rank!==op$jscomp$0.qrank){df._enqueue(op$jscomp$0,!0);$jscomp$generator$context.jumpTo(8);break}next=op$jscomp$0.run(df._getPulse(op$jscomp$0,encode));if(!next.then){next.async&&(async.push(next.async),next=StopPropagation);$jscomp$generator$context.jumpTo(10);break}return $jscomp$generator$context.yield(next,11);case 11:next=$jscomp$generator$context.yieldResult;case 10:next!==
StopPropagation&&op$jscomp$0._targets&&op$jscomp$0._targets.forEach(function(op){return df._enqueue(op)});++count;$jscomp$generator$context.jumpTo(8);break;case 6:err=$jscomp$generator$context.enterCatchBlock(),df._heap.clear(),error=err;case 7:df._input={};df._pulse=null;df.debug("Pulse "+stamp+": "+count+" operators");error&&(df._postrun=[],df.error(error));if(!df._postrun.length){$jscomp$generator$context.jumpTo(12);break}pr=df._postrun.sort(function(a,b){return b.priority-a.priority});df._postrun=
[];i=0;case 13:if(!(i<pr.length)){$jscomp$generator$context.jumpTo(12);break}return $jscomp$generator$context.yield(asyncCallback(df,pr[i].callback),14);case 14:++i;$jscomp$generator$context.jumpTo(13);break;case 12:if(!postrun){$jscomp$generator$context.jumpTo(17);break}return $jscomp$generator$context.yield(asyncCallback(df,postrun),17);case 17:return async.length&&Promise.all(async).then(function(cb){return df.runAsync(null,function(){cb.forEach(function(f){try{f(df)}catch(err$654){df.error(err$654)}})})}),
$jscomp$generator$context.return(df)}})},run:function(encode,prerun,postrun){return this._pulse?reentrant(this):(this.evaluate(encode,prerun,postrun),this)},runAsync:function(encode,prerun,postrun){var $jscomp$async$this=this,clear;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){if(1==$jscomp$generator$context.nextAddress)return $jscomp$async$this._running?$jscomp$generator$context.yield($jscomp$async$this._running,1):$jscomp$generator$context.jumpTo(3);clear=
function(){return $jscomp$async$this._running=null};($jscomp$async$this._running=$jscomp$async$this.evaluate(encode,prerun,postrun)).then(clear,clear);return $jscomp$generator$context.return($jscomp$async$this._running)})},runAfter:function(callback,enqueue,priority){if(this._pulse||enqueue)this._postrun.push({priority:priority||0,callback:callback});else try{callback(this)}catch(err){this.error(err)}},_enqueue:function(op,force){var q=op.stamp<this._clock;q&&(op.stamp=this._clock);if(q||force)op.qrank=
op.rank,this._heap.push(op)},_getPulse:function(op,encode){var s=op.source,stamp=this._clock;return s&&vegaUtil.isArray(s)?new MultiPulse(this,stamp,s.map(function(_){return _.pulse}),encode):this._input[op.id]||singlePulse(this._pulse,s&&s.pulse)}};vegaUtil.inherits(Transform,Operator,{run:function(pulse){var $jscomp$this=this;if(pulse.stamp<this.stamp)return pulse.StopPropagation;var rv;this.skip()?this.skip(!1):rv=this.evaluate(pulse);rv=rv||pulse;rv.then?rv=rv.then(function(_){return $jscomp$this.pulse=
_}):rv!==pulse.StopPropagation&&(this.pulse=rv);return rv},evaluate:function(pulse){var params=this.marshall(pulse.stamp);pulse=this.transform(params,pulse);params.clear();return pulse},transform:function(){}});var transforms={};exports.Dataflow=Dataflow;exports.EventStream=EventStream;exports.MultiPulse=MultiPulse;exports.Operator=Operator;exports.Parameters=Parameters;exports.Pulse=Pulse;exports.Transform=Transform;exports.UniqueList=UniqueList;exports.asyncCallback=asyncCallback;exports.changeset=
changeset;exports.definition=function(type){return(type=transform(type))&&type.Definition||null};exports.derive=function(t){return rederive(t,ingest$1({}))};exports.ingest=ingest$1;exports.isChangeSet=isChangeSet;exports.isTuple=function(t){return!(!t||!t[TUPLE_ID_KEY])};exports.rederive=rederive;exports.replace=function(t,d){d[TUPLE_ID_KEY]=t[TUPLE_ID_KEY];return d};exports.stableCompare=function(cmp,f){return cmp?f?function(a,b){return cmp(a,b)||f(a)[TUPLE_ID_KEY]-f(b)[TUPLE_ID_KEY]}:function(a,
b){return cmp(a,b)||a[TUPLE_ID_KEY]-b[TUPLE_ID_KEY]}:null};exports.transform=transform;exports.transforms=transforms;exports.tupleid=function(t){return t[TUPLE_ID_KEY]};Object.defineProperty(exports,"__esModule",{value:!0})})}
//# sourceMappingURL=module$node_modules$vega_dataflow$build$vega_dataflow.js.map
